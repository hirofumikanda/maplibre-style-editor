function eA(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const o in n)if(o!=="default"&&!(o in s)){const f=Object.getOwnPropertyDescriptor(n,o);f&&Object.defineProperty(s,o,f.get?f:{enumerable:!0,get:()=>n[o]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const d of f.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(o){if(o.ep)return;o.ep=!0;const f=t(o);fetch(o.href,f)}})();function tA(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Cb={exports:{}},Ig={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g1;function iA(){if(g1)return Ig;g1=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,o,f){var d=null;if(f!==void 0&&(d=""+f),o.key!==void 0&&(d=""+o.key),"key"in o){f={};for(var a in o)a!=="key"&&(f[a]=o[a])}else f=o;return o=f.ref,{$$typeof:s,type:n,key:d,ref:o!==void 0?o:null,props:f}}return Ig.Fragment=e,Ig.jsx=t,Ig.jsxs=t,Ig}var y1;function nA(){return y1||(y1=1,Cb.exports=iA()),Cb.exports}var wn=nA(),Ab={exports:{}},wi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _1;function sA(){if(_1)return wi;_1=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),f=Symbol.for("react.consumer"),d=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),A=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),L=Symbol.iterator;function j(xe){return xe===null||typeof xe!="object"?null:(xe=L&&xe[L]||xe["@@iterator"],typeof xe=="function"?xe:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K=Object.assign,se={};function le(xe,ot,xt){this.props=xe,this.context=ot,this.refs=se,this.updater=xt||F}le.prototype.isReactComponent={},le.prototype.setState=function(xe,ot){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,ot,"setState")},le.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function ve(){}ve.prototype=le.prototype;function Be(xe,ot,xt){this.props=xe,this.context=ot,this.refs=se,this.updater=xt||F}var je=Be.prototype=new ve;je.constructor=Be,K(je,le.prototype),je.isPureReactComponent=!0;var ze=Array.isArray,ke={H:null,A:null,T:null,S:null,V:null},Se=Object.prototype.hasOwnProperty;function Fe(xe,ot,xt,Tt,Rt,Jt){return xt=Jt.ref,{$$typeof:s,type:xe,key:ot,ref:xt!==void 0?xt:null,props:Jt}}function He(xe,ot){return Fe(xe.type,ot,void 0,void 0,void 0,xe.props)}function gt(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===s}function Et(xe){var ot={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(xt){return ot[xt]})}var Mt=/\/+/g;function ht(xe,ot){return typeof xe=="object"&&xe!==null&&xe.key!=null?Et(""+xe.key):ot.toString(36)}function Gt(){}function Ft(xe){switch(xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason;default:switch(typeof xe.status=="string"?xe.then(Gt,Gt):(xe.status="pending",xe.then(function(ot){xe.status==="pending"&&(xe.status="fulfilled",xe.value=ot)},function(ot){xe.status==="pending"&&(xe.status="rejected",xe.reason=ot)})),xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason}}throw xe}function ei(xe,ot,xt,Tt,Rt){var Jt=typeof xe;(Jt==="undefined"||Jt==="boolean")&&(xe=null);var Nt=!1;if(xe===null)Nt=!0;else switch(Jt){case"bigint":case"string":case"number":Nt=!0;break;case"object":switch(xe.$$typeof){case s:case e:Nt=!0;break;case P:return Nt=xe._init,ei(Nt(xe._payload),ot,xt,Tt,Rt)}}if(Nt)return Rt=Rt(xe),Nt=Tt===""?"."+ht(xe,0):Tt,ze(Rt)?(xt="",Nt!=null&&(xt=Nt.replace(Mt,"$&/")+"/"),ei(Rt,ot,xt,"",function(ms){return ms})):Rt!=null&&(gt(Rt)&&(Rt=He(Rt,xt+(Rt.key==null||xe&&xe.key===Rt.key?"":(""+Rt.key).replace(Mt,"$&/")+"/")+Nt)),ot.push(Rt)),1;Nt=0;var Ei=Tt===""?".":Tt+":";if(ze(xe))for(var Ni=0;Ni<xe.length;Ni++)Tt=xe[Ni],Jt=Ei+ht(Tt,Ni),Nt+=ei(Tt,ot,xt,Jt,Rt);else if(Ni=j(xe),typeof Ni=="function")for(xe=Ni.call(xe),Ni=0;!(Tt=xe.next()).done;)Tt=Tt.value,Jt=Ei+ht(Tt,Ni++),Nt+=ei(Tt,ot,xt,Jt,Rt);else if(Jt==="object"){if(typeof xe.then=="function")return ei(Ft(xe),ot,xt,Tt,Rt);throw ot=String(xe),Error("Objects are not valid as a React child (found: "+(ot==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":ot)+"). If you meant to render a collection of children, use an array instead.")}return Nt}function Xe(xe,ot,xt){if(xe==null)return xe;var Tt=[],Rt=0;return ei(xe,Tt,"","",function(Jt){return ot.call(xt,Jt,Rt++)}),Tt}function dt(xe){if(xe._status===-1){var ot=xe._result;ot=ot(),ot.then(function(xt){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=xt)},function(xt){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=xt)}),xe._status===-1&&(xe._status=0,xe._result=ot)}if(xe._status===1)return xe._result.default;throw xe._result}var _t=typeof reportError=="function"?reportError:function(xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ot=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof xe=="object"&&xe!==null&&typeof xe.message=="string"?String(xe.message):String(xe),error:xe});if(!window.dispatchEvent(ot))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",xe);return}console.error(xe)};function qt(){}return wi.Children={map:Xe,forEach:function(xe,ot,xt){Xe(xe,function(){ot.apply(this,arguments)},xt)},count:function(xe){var ot=0;return Xe(xe,function(){ot++}),ot},toArray:function(xe){return Xe(xe,function(ot){return ot})||[]},only:function(xe){if(!gt(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},wi.Component=le,wi.Fragment=t,wi.Profiler=o,wi.PureComponent=Be,wi.StrictMode=n,wi.Suspense=v,wi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,wi.__COMPILER_RUNTIME={__proto__:null,c:function(xe){return ke.H.useMemoCache(xe)}},wi.cache=function(xe){return function(){return xe.apply(null,arguments)}},wi.cloneElement=function(xe,ot,xt){if(xe==null)throw Error("The argument must be a React element, but you passed "+xe+".");var Tt=K({},xe.props),Rt=xe.key,Jt=void 0;if(ot!=null)for(Nt in ot.ref!==void 0&&(Jt=void 0),ot.key!==void 0&&(Rt=""+ot.key),ot)!Se.call(ot,Nt)||Nt==="key"||Nt==="__self"||Nt==="__source"||Nt==="ref"&&ot.ref===void 0||(Tt[Nt]=ot[Nt]);var Nt=arguments.length-2;if(Nt===1)Tt.children=xt;else if(1<Nt){for(var Ei=Array(Nt),Ni=0;Ni<Nt;Ni++)Ei[Ni]=arguments[Ni+2];Tt.children=Ei}return Fe(xe.type,Rt,void 0,void 0,Jt,Tt)},wi.createContext=function(xe){return xe={$$typeof:d,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null},xe.Provider=xe,xe.Consumer={$$typeof:f,_context:xe},xe},wi.createElement=function(xe,ot,xt){var Tt,Rt={},Jt=null;if(ot!=null)for(Tt in ot.key!==void 0&&(Jt=""+ot.key),ot)Se.call(ot,Tt)&&Tt!=="key"&&Tt!=="__self"&&Tt!=="__source"&&(Rt[Tt]=ot[Tt]);var Nt=arguments.length-2;if(Nt===1)Rt.children=xt;else if(1<Nt){for(var Ei=Array(Nt),Ni=0;Ni<Nt;Ni++)Ei[Ni]=arguments[Ni+2];Rt.children=Ei}if(xe&&xe.defaultProps)for(Tt in Nt=xe.defaultProps,Nt)Rt[Tt]===void 0&&(Rt[Tt]=Nt[Tt]);return Fe(xe,Jt,void 0,void 0,null,Rt)},wi.createRef=function(){return{current:null}},wi.forwardRef=function(xe){return{$$typeof:a,render:xe}},wi.isValidElement=gt,wi.lazy=function(xe){return{$$typeof:P,_payload:{_status:-1,_result:xe},_init:dt}},wi.memo=function(xe,ot){return{$$typeof:A,type:xe,compare:ot===void 0?null:ot}},wi.startTransition=function(xe){var ot=ke.T,xt={};ke.T=xt;try{var Tt=xe(),Rt=ke.S;Rt!==null&&Rt(xt,Tt),typeof Tt=="object"&&Tt!==null&&typeof Tt.then=="function"&&Tt.then(qt,_t)}catch(Jt){_t(Jt)}finally{ke.T=ot}},wi.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},wi.use=function(xe){return ke.H.use(xe)},wi.useActionState=function(xe,ot,xt){return ke.H.useActionState(xe,ot,xt)},wi.useCallback=function(xe,ot){return ke.H.useCallback(xe,ot)},wi.useContext=function(xe){return ke.H.useContext(xe)},wi.useDebugValue=function(){},wi.useDeferredValue=function(xe,ot){return ke.H.useDeferredValue(xe,ot)},wi.useEffect=function(xe,ot,xt){var Tt=ke.H;if(typeof xt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Tt.useEffect(xe,ot)},wi.useId=function(){return ke.H.useId()},wi.useImperativeHandle=function(xe,ot,xt){return ke.H.useImperativeHandle(xe,ot,xt)},wi.useInsertionEffect=function(xe,ot){return ke.H.useInsertionEffect(xe,ot)},wi.useLayoutEffect=function(xe,ot){return ke.H.useLayoutEffect(xe,ot)},wi.useMemo=function(xe,ot){return ke.H.useMemo(xe,ot)},wi.useOptimistic=function(xe,ot){return ke.H.useOptimistic(xe,ot)},wi.useReducer=function(xe,ot,xt){return ke.H.useReducer(xe,ot,xt)},wi.useRef=function(xe){return ke.H.useRef(xe)},wi.useState=function(xe){return ke.H.useState(xe)},wi.useSyncExternalStore=function(xe,ot,xt){return ke.H.useSyncExternalStore(xe,ot,xt)},wi.useTransition=function(){return ke.H.useTransition()},wi.version="19.1.0",wi}var b1;function vx(){return b1||(b1=1,Ab.exports=sA()),Ab.exports}var Ot=vx(),kb={exports:{}},zg={},Eb={exports:{}},Pb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v1;function rA(){return v1||(v1=1,function(s){function e(Xe,dt){var _t=Xe.length;Xe.push(dt);e:for(;0<_t;){var qt=_t-1>>>1,xe=Xe[qt];if(0<o(xe,dt))Xe[qt]=dt,Xe[_t]=xe,_t=qt;else break e}}function t(Xe){return Xe.length===0?null:Xe[0]}function n(Xe){if(Xe.length===0)return null;var dt=Xe[0],_t=Xe.pop();if(_t!==dt){Xe[0]=_t;e:for(var qt=0,xe=Xe.length,ot=xe>>>1;qt<ot;){var xt=2*(qt+1)-1,Tt=Xe[xt],Rt=xt+1,Jt=Xe[Rt];if(0>o(Tt,_t))Rt<xe&&0>o(Jt,Tt)?(Xe[qt]=Jt,Xe[Rt]=_t,qt=Rt):(Xe[qt]=Tt,Xe[xt]=_t,qt=xt);else if(Rt<xe&&0>o(Jt,_t))Xe[qt]=Jt,Xe[Rt]=_t,qt=Rt;else break e}}return dt}function o(Xe,dt){var _t=Xe.sortIndex-dt.sortIndex;return _t!==0?_t:Xe.id-dt.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var f=performance;s.unstable_now=function(){return f.now()}}else{var d=Date,a=d.now();s.unstable_now=function(){return d.now()-a}}var v=[],A=[],P=1,L=null,j=3,F=!1,K=!1,se=!1,le=!1,ve=typeof setTimeout=="function"?setTimeout:null,Be=typeof clearTimeout=="function"?clearTimeout:null,je=typeof setImmediate<"u"?setImmediate:null;function ze(Xe){for(var dt=t(A);dt!==null;){if(dt.callback===null)n(A);else if(dt.startTime<=Xe)n(A),dt.sortIndex=dt.expirationTime,e(v,dt);else break;dt=t(A)}}function ke(Xe){if(se=!1,ze(Xe),!K)if(t(v)!==null)K=!0,Se||(Se=!0,ht());else{var dt=t(A);dt!==null&&ei(ke,dt.startTime-Xe)}}var Se=!1,Fe=-1,He=5,gt=-1;function Et(){return le?!0:!(s.unstable_now()-gt<He)}function Mt(){if(le=!1,Se){var Xe=s.unstable_now();gt=Xe;var dt=!0;try{e:{K=!1,se&&(se=!1,Be(Fe),Fe=-1),F=!0;var _t=j;try{t:{for(ze(Xe),L=t(v);L!==null&&!(L.expirationTime>Xe&&Et());){var qt=L.callback;if(typeof qt=="function"){L.callback=null,j=L.priorityLevel;var xe=qt(L.expirationTime<=Xe);if(Xe=s.unstable_now(),typeof xe=="function"){L.callback=xe,ze(Xe),dt=!0;break t}L===t(v)&&n(v),ze(Xe)}else n(v);L=t(v)}if(L!==null)dt=!0;else{var ot=t(A);ot!==null&&ei(ke,ot.startTime-Xe),dt=!1}}break e}finally{L=null,j=_t,F=!1}dt=void 0}}finally{dt?ht():Se=!1}}}var ht;if(typeof je=="function")ht=function(){je(Mt)};else if(typeof MessageChannel<"u"){var Gt=new MessageChannel,Ft=Gt.port2;Gt.port1.onmessage=Mt,ht=function(){Ft.postMessage(null)}}else ht=function(){ve(Mt,0)};function ei(Xe,dt){Fe=ve(function(){Xe(s.unstable_now())},dt)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(Xe){Xe.callback=null},s.unstable_forceFrameRate=function(Xe){0>Xe||125<Xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):He=0<Xe?Math.floor(1e3/Xe):5},s.unstable_getCurrentPriorityLevel=function(){return j},s.unstable_next=function(Xe){switch(j){case 1:case 2:case 3:var dt=3;break;default:dt=j}var _t=j;j=dt;try{return Xe()}finally{j=_t}},s.unstable_requestPaint=function(){le=!0},s.unstable_runWithPriority=function(Xe,dt){switch(Xe){case 1:case 2:case 3:case 4:case 5:break;default:Xe=3}var _t=j;j=Xe;try{return dt()}finally{j=_t}},s.unstable_scheduleCallback=function(Xe,dt,_t){var qt=s.unstable_now();switch(typeof _t=="object"&&_t!==null?(_t=_t.delay,_t=typeof _t=="number"&&0<_t?qt+_t:qt):_t=qt,Xe){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=_t+xe,Xe={id:P++,callback:dt,priorityLevel:Xe,startTime:_t,expirationTime:xe,sortIndex:-1},_t>qt?(Xe.sortIndex=_t,e(A,Xe),t(v)===null&&Xe===t(A)&&(se?(Be(Fe),Fe=-1):se=!0,ei(ke,_t-qt))):(Xe.sortIndex=xe,e(v,Xe),K||F||(K=!0,Se||(Se=!0,ht()))),Xe},s.unstable_shouldYield=Et,s.unstable_wrapCallback=function(Xe){var dt=j;return function(){var _t=j;j=dt;try{return Xe.apply(this,arguments)}finally{j=_t}}}}(Pb)),Pb}var x1;function oA(){return x1||(x1=1,Eb.exports=rA()),Eb.exports}var Ob={exports:{}},Zr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w1;function aA(){if(w1)return Zr;w1=1;var s=vx();function e(v){var A="https://react.dev/errors/"+v;if(1<arguments.length){A+="?args[]="+encodeURIComponent(arguments[1]);for(var P=2;P<arguments.length;P++)A+="&args[]="+encodeURIComponent(arguments[P])}return"Minified React error #"+v+"; visit "+A+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},o=Symbol.for("react.portal");function f(v,A,P){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:L==null?null:""+L,children:v,containerInfo:A,implementation:P}}var d=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(v,A){if(v==="font")return"";if(typeof A=="string")return A==="use-credentials"?A:""}return Zr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Zr.createPortal=function(v,A){var P=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!A||A.nodeType!==1&&A.nodeType!==9&&A.nodeType!==11)throw Error(e(299));return f(v,A,null,P)},Zr.flushSync=function(v){var A=d.T,P=n.p;try{if(d.T=null,n.p=2,v)return v()}finally{d.T=A,n.p=P,n.d.f()}},Zr.preconnect=function(v,A){typeof v=="string"&&(A?(A=A.crossOrigin,A=typeof A=="string"?A==="use-credentials"?A:"":void 0):A=null,n.d.C(v,A))},Zr.prefetchDNS=function(v){typeof v=="string"&&n.d.D(v)},Zr.preinit=function(v,A){if(typeof v=="string"&&A&&typeof A.as=="string"){var P=A.as,L=a(P,A.crossOrigin),j=typeof A.integrity=="string"?A.integrity:void 0,F=typeof A.fetchPriority=="string"?A.fetchPriority:void 0;P==="style"?n.d.S(v,typeof A.precedence=="string"?A.precedence:void 0,{crossOrigin:L,integrity:j,fetchPriority:F}):P==="script"&&n.d.X(v,{crossOrigin:L,integrity:j,fetchPriority:F,nonce:typeof A.nonce=="string"?A.nonce:void 0})}},Zr.preinitModule=function(v,A){if(typeof v=="string")if(typeof A=="object"&&A!==null){if(A.as==null||A.as==="script"){var P=a(A.as,A.crossOrigin);n.d.M(v,{crossOrigin:P,integrity:typeof A.integrity=="string"?A.integrity:void 0,nonce:typeof A.nonce=="string"?A.nonce:void 0})}}else A==null&&n.d.M(v)},Zr.preload=function(v,A){if(typeof v=="string"&&typeof A=="object"&&A!==null&&typeof A.as=="string"){var P=A.as,L=a(P,A.crossOrigin);n.d.L(v,P,{crossOrigin:L,integrity:typeof A.integrity=="string"?A.integrity:void 0,nonce:typeof A.nonce=="string"?A.nonce:void 0,type:typeof A.type=="string"?A.type:void 0,fetchPriority:typeof A.fetchPriority=="string"?A.fetchPriority:void 0,referrerPolicy:typeof A.referrerPolicy=="string"?A.referrerPolicy:void 0,imageSrcSet:typeof A.imageSrcSet=="string"?A.imageSrcSet:void 0,imageSizes:typeof A.imageSizes=="string"?A.imageSizes:void 0,media:typeof A.media=="string"?A.media:void 0})}},Zr.preloadModule=function(v,A){if(typeof v=="string")if(A){var P=a(A.as,A.crossOrigin);n.d.m(v,{as:typeof A.as=="string"&&A.as!=="script"?A.as:void 0,crossOrigin:P,integrity:typeof A.integrity=="string"?A.integrity:void 0})}else n.d.m(v)},Zr.requestFormReset=function(v){n.d.r(v)},Zr.unstable_batchedUpdates=function(v,A){return v(A)},Zr.useFormState=function(v,A,P){return d.H.useFormState(v,A,P)},Zr.useFormStatus=function(){return d.H.useHostTransitionStatus()},Zr.version="19.1.0",Zr}var S1;function GS(){if(S1)return Ob.exports;S1=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Ob.exports=aA(),Ob.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T1;function lA(){if(T1)return zg;T1=1;var s=oA(),e=vx(),t=GS();function n(l){var p="https://react.dev/errors/"+l;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+l+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function f(l){var p=l,y=l;if(l.alternate)for(;p.return;)p=p.return;else{l=p;do p=l,(p.flags&4098)!==0&&(y=p.return),l=p.return;while(l)}return p.tag===3?y:null}function d(l){if(l.tag===13){var p=l.memoizedState;if(p===null&&(l=l.alternate,l!==null&&(p=l.memoizedState)),p!==null)return p.dehydrated}return null}function a(l){if(f(l)!==l)throw Error(n(188))}function v(l){var p=l.alternate;if(!p){if(p=f(l),p===null)throw Error(n(188));return p!==l?null:l}for(var y=l,w=p;;){var E=y.return;if(E===null)break;var I=E.alternate;if(I===null){if(w=E.return,w!==null){y=w;continue}break}if(E.child===I.child){for(I=E.child;I;){if(I===y)return a(E),l;if(I===w)return a(E),p;I=I.sibling}throw Error(n(188))}if(y.return!==w.return)y=E,w=I;else{for(var X=!1,ie=E.child;ie;){if(ie===y){X=!0,y=E,w=I;break}if(ie===w){X=!0,w=E,y=I;break}ie=ie.sibling}if(!X){for(ie=I.child;ie;){if(ie===y){X=!0,y=I,w=E;break}if(ie===w){X=!0,w=I,y=E;break}ie=ie.sibling}if(!X)throw Error(n(189))}}if(y.alternate!==w)throw Error(n(190))}if(y.tag!==3)throw Error(n(188));return y.stateNode.current===y?l:p}function A(l){var p=l.tag;if(p===5||p===26||p===27||p===6)return l;for(l=l.child;l!==null;){if(p=A(l),p!==null)return p;l=l.sibling}return null}var P=Object.assign,L=Symbol.for("react.element"),j=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),K=Symbol.for("react.fragment"),se=Symbol.for("react.strict_mode"),le=Symbol.for("react.profiler"),ve=Symbol.for("react.provider"),Be=Symbol.for("react.consumer"),je=Symbol.for("react.context"),ze=Symbol.for("react.forward_ref"),ke=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),Fe=Symbol.for("react.memo"),He=Symbol.for("react.lazy"),gt=Symbol.for("react.activity"),Et=Symbol.for("react.memo_cache_sentinel"),Mt=Symbol.iterator;function ht(l){return l===null||typeof l!="object"?null:(l=Mt&&l[Mt]||l["@@iterator"],typeof l=="function"?l:null)}var Gt=Symbol.for("react.client.reference");function Ft(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===Gt?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case K:return"Fragment";case le:return"Profiler";case se:return"StrictMode";case ke:return"Suspense";case Se:return"SuspenseList";case gt:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case F:return"Portal";case je:return(l.displayName||"Context")+".Provider";case Be:return(l._context.displayName||"Context")+".Consumer";case ze:var p=l.render;return l=l.displayName,l||(l=p.displayName||p.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case Fe:return p=l.displayName||null,p!==null?p:Ft(l.type)||"Memo";case He:p=l._payload,l=l._init;try{return Ft(l(p))}catch{}}return null}var ei=Array.isArray,Xe=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,dt=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_t={pending:!1,data:null,method:null,action:null},qt=[],xe=-1;function ot(l){return{current:l}}function xt(l){0>xe||(l.current=qt[xe],qt[xe]=null,xe--)}function Tt(l,p){xe++,qt[xe]=l.current,l.current=p}var Rt=ot(null),Jt=ot(null),Nt=ot(null),Ei=ot(null);function Ni(l,p){switch(Tt(Nt,p),Tt(Jt,l),Tt(Rt,null),p.nodeType){case 9:case 11:l=(l=p.documentElement)&&(l=l.namespaceURI)?Eg(l):0;break;default:if(l=p.tagName,p=p.namespaceURI)p=Eg(p),l=Ad(p,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}xt(Rt),Tt(Rt,l)}function ms(){xt(Rt),xt(Jt),xt(Nt)}function dl(l){l.memoizedState!==null&&Tt(Ei,l);var p=Rt.current,y=Ad(p,l.type);p!==y&&(Tt(Jt,l),Tt(Rt,y))}function Es(l){Jt.current===l&&(xt(Rt),xt(Jt)),Ei.current===l&&(xt(Ei),bt._currentValue=_t)}var Hs=Object.prototype.hasOwnProperty,gs=s.unstable_scheduleCallback,ji=s.unstable_cancelCallback,yo=s.unstable_shouldYield,wa=s.unstable_requestPaint,Rn=s.unstable_now,Yc=s.unstable_getCurrentPriorityLevel,sc=s.unstable_ImmediatePriority,tr=s.unstable_UserBlockingPriority,br=s.unstable_NormalPriority,pl=s.unstable_LowPriority,Kr=s.unstable_IdlePriority,Jc=s.log,rc=s.unstable_setDisableYieldValue,_o=null,Kn=null;function ys(l){if(typeof Jc=="function"&&rc(l),Kn&&typeof Kn.setStrictMode=="function")try{Kn.setStrictMode(_o,l)}catch{}}var Yn=Math.clz32?Math.clz32:bo,Uo=Math.log,Sa=Math.LN2;function bo(l){return l>>>=0,l===0?32:31-(Uo(l)/Sa|0)|0}var _s=256,Lr=4194304;function De(l){var p=l&42;if(p!==0)return p;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function ee(l,p,y){var w=l.pendingLanes;if(w===0)return 0;var E=0,I=l.suspendedLanes,X=l.pingedLanes;l=l.warmLanes;var ie=w&134217727;return ie!==0?(w=ie&~I,w!==0?E=De(w):(X&=ie,X!==0?E=De(X):y||(y=ie&~l,y!==0&&(E=De(y))))):(ie=w&~I,ie!==0?E=De(ie):X!==0?E=De(X):y||(y=w&~l,y!==0&&(E=De(y)))),E===0?0:p!==0&&p!==E&&(p&I)===0&&(I=E&-E,y=p&-p,I>=y||I===32&&(y&4194048)!==0)?p:E}function te(l,p){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&p)===0}function ae(l,p){switch(l){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ge(){var l=_s;return _s<<=1,(_s&4194048)===0&&(_s=256),l}function ne(){var l=Lr;return Lr<<=1,(Lr&62914560)===0&&(Lr=4194304),l}function Oe(l){for(var p=[],y=0;31>y;y++)p.push(l);return p}function Ve(l,p){l.pendingLanes|=p,p!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function Te(l,p,y,w,E,I){var X=l.pendingLanes;l.pendingLanes=y,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=y,l.entangledLanes&=y,l.errorRecoveryDisabledLanes&=y,l.shellSuspendCounter=0;var ie=l.entanglements,we=l.expirationTimes,$e=l.hiddenUpdates;for(y=X&~y;0<y;){var ct=31-Yn(y),pt=1<<ct;ie[ct]=0,we[ct]=-1;var Ze=$e[ct];if(Ze!==null)for($e[ct]=null,ct=0;ct<Ze.length;ct++){var Ke=Ze[ct];Ke!==null&&(Ke.lane&=-536870913)}y&=~pt}w!==0&&Qe(l,w,0),I!==0&&E===0&&l.tag!==0&&(l.suspendedLanes|=I&~(X&~p))}function Qe(l,p,y){l.pendingLanes|=p,l.suspendedLanes&=~p;var w=31-Yn(p);l.entangledLanes|=p,l.entanglements[w]=l.entanglements[w]|1073741824|y&4194090}function Ye(l,p){var y=l.entangledLanes|=p;for(l=l.entanglements;y;){var w=31-Yn(y),E=1<<w;E&p|l[w]&p&&(l[w]|=p),y&=~E}}function Re(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function at(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function St(){var l=dt.p;return l!==0?l:(l=window.event,l===void 0?32:fs(l.type))}function Ct(l,p){var y=dt.p;try{return dt.p=l,p()}finally{dt.p=y}}var Vt=Math.random().toString(36).slice(2),Xt="__reactFiber$"+Vt,We="__reactProps$"+Vt,Wt="__reactContainer$"+Vt,_i="__reactEvents$"+Vt,zi="__reactListeners$"+Vt,Si="__reactHandles$"+Vt,st="__reactResources$"+Vt,kt="__reactMarker$"+Vt;function Qt(l){delete l[Xt],delete l[We],delete l[_i],delete l[zi],delete l[Si]}function Vn(l){var p=l[Xt];if(p)return p;for(var y=l.parentNode;y;){if(p=y[Wt]||y[Xt]){if(y=p.alternate,p.child!==null||y!==null&&y.child!==null)for(l=Gp(l);l!==null;){if(y=l[Xt])return y;l=Gp(l)}return p}l=y,y=l.parentNode}return null}function In(l){if(l=l[Xt]||l[Wt]){var p=l.tag;if(p===5||p===6||p===13||p===26||p===27||p===3)return l}return null}function Vi(l){var p=l.tag;if(p===5||p===26||p===27||p===6)return l.stateNode;throw Error(n(33))}function ti(l){var p=l[st];return p||(p=l[st]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function En(l){l[kt]=!0}var Ta=new Set,eu={};function ir(l,p){qo(l,p),qo(l+"Capture",p)}function qo(l,p){for(eu[l]=p,l=0;l<p.length;l++)Ta.add(p[l])}var os=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wi={},Jn={};function tu(l){return Hs.call(Jn,l)?!0:Hs.call(Wi,l)?!1:os.test(l)?Jn[l]=!0:(Wi[l]=!0,!1)}function ml(l,p,y){if(tu(p))if(y===null)l.removeAttribute(p);else{switch(typeof y){case"undefined":case"function":case"symbol":l.removeAttribute(p);return;case"boolean":var w=p.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){l.removeAttribute(p);return}}l.setAttribute(p,""+y)}}function nr(l,p,y){if(y===null)l.removeAttribute(p);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttribute(p,""+y)}}function Zs(l,p,y,w){if(w===null)l.removeAttribute(y);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(y);return}l.setAttributeNS(p,y,""+w)}}var ah,Ef;function Ma(l){if(ah===void 0)try{throw Error()}catch(y){var p=y.stack.trim().match(/\n( *(at )?)/);ah=p&&p[1]||"",Ef=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ah+l+Ef}var Ca=!1;function iu(l,p){if(!l||Ca)return"";Ca=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(p){var pt=function(){throw Error()};if(Object.defineProperty(pt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pt,[])}catch(Ke){var Ze=Ke}Reflect.construct(l,[],pt)}else{try{pt.call()}catch(Ke){Ze=Ke}l.call(pt.prototype)}}else{try{throw Error()}catch(Ke){Ze=Ke}(pt=l())&&typeof pt.catch=="function"&&pt.catch(function(){})}}catch(Ke){if(Ke&&Ze&&typeof Ke.stack=="string")return[Ke.stack,Ze.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=w.DetermineComponentFrameRoot(),X=I[0],ie=I[1];if(X&&ie){var we=X.split(`
`),$e=ie.split(`
`);for(E=w=0;w<we.length&&!we[w].includes("DetermineComponentFrameRoot");)w++;for(;E<$e.length&&!$e[E].includes("DetermineComponentFrameRoot");)E++;if(w===we.length||E===$e.length)for(w=we.length-1,E=$e.length-1;1<=w&&0<=E&&we[w]!==$e[E];)E--;for(;1<=w&&0<=E;w--,E--)if(we[w]!==$e[E]){if(w!==1||E!==1)do if(w--,E--,0>E||we[w]!==$e[E]){var ct=`
`+we[w].replace(" at new "," at ");return l.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",l.displayName)),ct}while(1<=w&&0<=E);break}}}finally{Ca=!1,Error.prepareStackTrace=y}return(y=l?l.displayName||l.name:"")?Ma(y):""}function Um(l){switch(l.tag){case 26:case 27:case 5:return Ma(l.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 15:return iu(l.type,!1);case 11:return iu(l.type.render,!1);case 1:return iu(l.type,!0);case 31:return Ma("Activity");default:return""}}function Yd(l){try{var p="";do p+=Um(l),l=l.return;while(l);return p}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function Br(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Pf(l){var p=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Jd(l){var p=Pf(l)?"checked":"value",y=Object.getOwnPropertyDescriptor(l.constructor.prototype,p),w=""+l[p];if(!l.hasOwnProperty(p)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var E=y.get,I=y.set;return Object.defineProperty(l,p,{configurable:!0,get:function(){return E.call(this)},set:function(X){w=""+X,I.call(this,X)}}),Object.defineProperty(l,p,{enumerable:y.enumerable}),{getValue:function(){return w},setValue:function(X){w=""+X},stopTracking:function(){l._valueTracker=null,delete l[p]}}}}function oc(l){l._valueTracker||(l._valueTracker=Jd(l))}function lh(l){if(!l)return!1;var p=l._valueTracker;if(!p)return!0;var y=p.getValue(),w="";return l&&(w=Pf(l)?l.checked?"true":"false":l.value),l=w,l!==y?(p.setValue(l),!0):!1}function ac(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var gl=/[\n"\\]/g;function sr(l){return l.replace(gl,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function lc(l,p,y,w,E,I,X,ie){l.name="",X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?l.type=X:l.removeAttribute("type"),p!=null?X==="number"?(p===0&&l.value===""||l.value!=p)&&(l.value=""+Br(p)):l.value!==""+Br(p)&&(l.value=""+Br(p)):X!=="submit"&&X!=="reset"||l.removeAttribute("value"),p!=null?Aa(l,X,Br(p)):y!=null?Aa(l,X,Br(y)):w!=null&&l.removeAttribute("value"),E==null&&I!=null&&(l.defaultChecked=!!I),E!=null&&(l.checked=E&&typeof E!="function"&&typeof E!="symbol"),ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"?l.name=""+Br(ie):l.removeAttribute("name")}function yl(l,p,y,w,E,I,X,ie){if(I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(l.type=I),p!=null||y!=null){if(!(I!=="submit"&&I!=="reset"||p!=null))return;y=y!=null?""+Br(y):"",p=p!=null?""+Br(p):y,ie||p===l.value||(l.value=p),l.defaultValue=p}w=w??E,w=typeof w!="function"&&typeof w!="symbol"&&!!w,l.checked=ie?l.checked:!!w,l.defaultChecked=!!w,X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"&&(l.name=X)}function Aa(l,p,y){p==="number"&&ac(l.ownerDocument)===l||l.defaultValue===""+y||(l.defaultValue=""+y)}function _l(l,p,y,w){if(l=l.options,p){p={};for(var E=0;E<y.length;E++)p["$"+y[E]]=!0;for(y=0;y<l.length;y++)E=p.hasOwnProperty("$"+l[y].value),l[y].selected!==E&&(l[y].selected=E),E&&w&&(l[y].defaultSelected=!0)}else{for(y=""+Br(y),p=null,E=0;E<l.length;E++){if(l[E].value===y){l[E].selected=!0,w&&(l[E].defaultSelected=!0);return}p!==null||l[E].disabled||(p=l[E])}p!==null&&(p.selected=!0)}}function ep(l,p,y){if(p!=null&&(p=""+Br(p),p!==l.value&&(l.value=p),y==null)){l.defaultValue!==p&&(l.defaultValue=p);return}l.defaultValue=y!=null?""+Br(y):""}function vo(l,p,y,w){if(p==null){if(w!=null){if(y!=null)throw Error(n(92));if(ei(w)){if(1<w.length)throw Error(n(93));w=w[0]}y=w}y==null&&(y=""),p=y}y=Br(p),l.defaultValue=y,w=l.textContent,w===y&&w!==""&&w!==null&&(l.value=w)}function Yr(l,p){if(p){var y=l.firstChild;if(y&&y===l.lastChild&&y.nodeType===3){y.nodeValue=p;return}}l.textContent=p}var hi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bi(l,p,y){var w=p.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?w?l.setProperty(p,""):p==="float"?l.cssFloat="":l[p]="":w?l.setProperty(p,y):typeof y!="number"||y===0||hi.has(p)?p==="float"?l.cssFloat=y:l[p]=(""+y).trim():l[p]=y+"px"}function bl(l,p,y){if(p!=null&&typeof p!="object")throw Error(n(62));if(l=l.style,y!=null){for(var w in y)!y.hasOwnProperty(w)||p!=null&&p.hasOwnProperty(w)||(w.indexOf("--")===0?l.setProperty(w,""):w==="float"?l.cssFloat="":l[w]="");for(var E in p)w=p[E],p.hasOwnProperty(E)&&y[E]!==w&&bi(l,E,w)}else for(var I in p)p.hasOwnProperty(I)&&bi(l,I,p[I])}function Nr(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ps=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rn(l){return Ps.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var vl=null;function es(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var as=null,Un=null;function Ho(l){var p=In(l);if(p&&(l=p.stateNode)){var y=l[We]||null;e:switch(l=p.stateNode,p.type){case"input":if(lc(l,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),p=y.name,y.type==="radio"&&p!=null){for(y=l;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+sr(""+p)+'"][type="radio"]'),p=0;p<y.length;p++){var w=y[p];if(w!==l&&w.form===l.form){var E=w[We]||null;if(!E)throw Error(n(90));lc(w,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(p=0;p<y.length;p++)w=y[p],w.form===l.form&&lh(w)}break e;case"textarea":ep(l,y.value,y.defaultValue);break e;case"select":p=y.value,p!=null&&_l(l,!!y.multiple,p,!1)}}}var xl=!1;function mn(l,p,y){if(xl)return l(p,y);xl=!0;try{var w=l(p);return w}finally{if(xl=!1,(as!==null||Un!==null)&&(Op(),as&&(p=as,l=Un,Un=as=null,Ho(p),l)))for(p=0;p<l.length;p++)Ho(l[p])}}function or(l,p){var y=l.stateNode;if(y===null)return null;var w=y[We]||null;if(w===null)return null;y=w[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(l=l.type,w=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!w;break e;default:l=!1}if(l)return null;if(y&&typeof y!="function")throw Error(n(231,p,typeof y));return y}var Os=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wl=!1;if(Os)try{var Ds={};Object.defineProperty(Ds,"passive",{get:function(){wl=!0}}),window.addEventListener("test",Ds,Ds),window.removeEventListener("test",Ds,Ds)}catch{wl=!1}var Fr=null,Ai=null,cc=null;function Ti(){if(cc)return cc;var l,p=Ai,y=p.length,w,E="value"in Fr?Fr.value:Fr.textContent,I=E.length;for(l=0;l<y&&p[l]===E[l];l++);var X=y-l;for(w=1;w<=X&&p[y-w]===E[I-w];w++);return cc=E.slice(l,1<w?1-w:void 0)}function ri(l){var p=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&p===13&&(l=13)):l=p,l===10&&(l=13),32<=l||l===13?l:0}function Zo(){return!0}function vi(){return!1}function ls(l){function p(y,w,E,I,X){this._reactName=y,this._targetInst=E,this.type=w,this.nativeEvent=I,this.target=X,this.currentTarget=null;for(var ie in l)l.hasOwnProperty(ie)&&(y=l[ie],this[ie]=y?y(I):I[ie]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?Zo:vi,this.isPropagationStopped=vi,this}return P(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Zo)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Zo)},persist:function(){},isPersistent:Zo}),p}var bs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Go=ls(bs),ka=P({},bs,{view:0,detail:0}),ch=ls(ka),Ea,Sl,$o,nu=P({},ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fc,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==$o&&($o&&l.type==="mousemove"?(Ea=l.screenX-$o.screenX,Sl=l.screenY-$o.screenY):Sl=Ea=0,$o=l),Ea)},movementY:function(l){return"movementY"in l?l.movementY:Sl}}),su=ls(nu),uc=P({},nu,{dataTransfer:0}),Rs=ls(uc),uh=P({},ka,{relatedTarget:0}),Is=ls(uh),hc=P({},bs,{animationName:0,elapsedTime:0,pseudoElement:0}),Ki=ls(hc),ru=P({},bs,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),hh=ls(ru),Of=P({},bs,{data:0}),Tl=ls(Of),fh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Df={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dh(l){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(l):(l=qm[l])?!!p[l]:!1}function fc(){return dh}var Jr=P({},ka,{key:function(l){if(l.key){var p=fh[l.key]||l.key;if(p!=="Unidentified")return p}return l.type==="keypress"?(l=ri(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?Df[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fc,charCode:function(l){return l.type==="keypress"?ri(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?ri(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),ou=ls(Jr),dc=P({},nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),au=ls(dc),lu=P({},ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fc}),Rf=ls(lu),xo=P({},bs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hm=ls(xo),If=P({},nu,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),Pa=ls(If),cu=P({},bs,{newState:0,oldState:0}),tp=ls(cu),uu=[9,13,27,32],zf=Os&&"CompositionEvent"in window,eo=null;Os&&"documentMode"in document&&(eo=document.documentMode);var Zm=Os&&"TextEvent"in window&&!eo,Lf=Os&&(!zf||eo&&8<eo&&11>=eo),ip=" ",Bf=!1;function ph(l,p){switch(l){case"keyup":return uu.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mh(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Oa=!1;function Nf(l,p){switch(l){case"compositionend":return mh(p);case"keypress":return p.which!==32?null:(Bf=!0,ip);case"textInput":return l=p.data,l===ip&&Bf?null:l;default:return null}}function np(l,p){if(Oa)return l==="compositionend"||!zf&&ph(l,p)?(l=Ti(),cc=Ai=Fr=null,Oa=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return Lf&&p.locale!=="ko"?null:p.data;default:return null}}var Ml={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ff(l){var p=l&&l.nodeName&&l.nodeName.toLowerCase();return p==="input"?!!Ml[l.type]:p==="textarea"}function hu(l,p,y,w){as?Un?Un.push(w):Un=[w]:as=w,p=Md(p,"onChange"),0<p.length&&(y=new Go("onChange","change",null,y,w),l.push({event:y,listeners:p}))}var Xo=null,fu=null;function gh(l){Fp(l,0)}function du(l){var p=Vi(l);if(lh(p))return l}function jf(l,p){if(l==="change")return p}var Vf=!1;if(Os){var yh;if(Os){var pu="oninput"in document;if(!pu){var mu=document.createElement("div");mu.setAttribute("oninput","return;"),pu=typeof mu.oninput=="function"}yh=pu}else yh=!1;Vf=yh&&(!document.documentMode||9<document.documentMode)}function Uf(){Xo&&(Xo.detachEvent("onpropertychange",gu),fu=Xo=null)}function gu(l){if(l.propertyName==="value"&&du(fu)){var p=[];hu(p,fu,l,es(l)),mn(gh,p)}}function Qo(l,p,y){l==="focusin"?(Uf(),Xo=p,fu=y,Xo.attachEvent("onpropertychange",gu)):l==="focusout"&&Uf()}function _h(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return du(fu)}function qf(l,p){if(l==="click")return du(p)}function Hf(l,p){if(l==="input"||l==="change")return du(p)}function sp(l,p){return l===p&&(l!==0||1/l===1/p)||l!==l&&p!==p}var Gs=typeof Object.is=="function"?Object.is:sp;function fi(l,p){if(Gs(l,p))return!0;if(typeof l!="object"||l===null||typeof p!="object"||p===null)return!1;var y=Object.keys(l),w=Object.keys(p);if(y.length!==w.length)return!1;for(w=0;w<y.length;w++){var E=y[w];if(!Hs.call(p,E)||!Gs(l[E],p[E]))return!1}return!0}function bh(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function rp(l,p){var y=bh(l);l=0;for(var w;y;){if(y.nodeType===3){if(w=l+y.textContent.length,l<=p&&w>=p)return{node:y,offset:p-l};l=w}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=bh(y)}}function op(l,p){return l&&p?l===p?!0:l&&l.nodeType===3?!1:p&&p.nodeType===3?op(l,p.parentNode):"contains"in l?l.contains(p):l.compareDocumentPosition?!!(l.compareDocumentPosition(p)&16):!1:!1}function ap(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var p=ac(l.document);p instanceof l.HTMLIFrameElement;){try{var y=typeof p.contentWindow.location.href=="string"}catch{y=!1}if(y)l=p.contentWindow;else break;p=ac(l.document)}return p}function Zf(l){var p=l&&l.nodeName&&l.nodeName.toLowerCase();return p&&(p==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||p==="textarea"||l.contentEditable==="true")}var lp=Os&&"documentMode"in document&&11>=document.documentMode,pc=null,vh=null,Da=null,mc=!1;function yu(l,p,y){var w=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;mc||pc==null||pc!==ac(w)||(w=pc,"selectionStart"in w&&Zf(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Da&&fi(Da,w)||(Da=w,w=Md(vh,"onSelect"),0<w.length&&(p=new Go("onSelect","select",null,p,y),l.push({event:p,listeners:w}),p.target=pc)))}function Wo(l,p){var y={};return y[l.toLowerCase()]=p.toLowerCase(),y["Webkit"+l]="webkit"+p,y["Moz"+l]="moz"+p,y}var jr={animationend:Wo("Animation","AnimationEnd"),animationiteration:Wo("Animation","AnimationIteration"),animationstart:Wo("Animation","AnimationStart"),transitionrun:Wo("Transition","TransitionRun"),transitionstart:Wo("Transition","TransitionStart"),transitioncancel:Wo("Transition","TransitionCancel"),transitionend:Wo("Transition","TransitionEnd")},Ra={},vr={};Os&&(vr=document.createElement("div").style,"AnimationEvent"in window||(delete jr.animationend.animation,delete jr.animationiteration.animation,delete jr.animationstart.animation),"TransitionEvent"in window||delete jr.transitionend.transition);function Ia(l){if(Ra[l])return Ra[l];if(!jr[l])return l;var p=jr[l],y;for(y in p)if(p.hasOwnProperty(y)&&y in vr)return Ra[l]=p[y];return l}var Gf=Ia("animationend"),xh=Ia("animationiteration"),za=Ia("animationstart"),wh=Ia("transitionrun"),Sh=Ia("transitionstart"),_u=Ia("transitioncancel"),bu=Ia("transitionend"),$f=new Map,La="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");La.push("scrollEnd");function zs(l,p){$f.set(l,p),ir(p,[l])}var Xf=new WeakMap;function ar(l,p){if(typeof l=="object"&&l!==null){var y=Xf.get(l);return y!==void 0?y:(p={value:l,source:p,stack:Yd(p)},Xf.set(l,p),p)}return{value:l,source:p,stack:Yd(p)}}var ai=[],Ko=0,Qf=0;function Cl(){for(var l=Ko,p=Qf=Ko=0;p<l;){var y=ai[p];ai[p++]=null;var w=ai[p];ai[p++]=null;var E=ai[p];ai[p++]=null;var I=ai[p];if(ai[p++]=null,w!==null&&E!==null){var X=w.pending;X===null?E.next=E:(E.next=X.next,X.next=E),w.pending=E}I!==0&&Th(y,E,I)}}function Ba(l,p,y,w){ai[Ko++]=l,ai[Ko++]=p,ai[Ko++]=y,ai[Ko++]=w,Qf|=w,l.lanes|=w,l=l.alternate,l!==null&&(l.lanes|=w)}function Wf(l,p,y,w){return Ba(l,p,y,w),Mh(l)}function gc(l,p){return Ba(l,null,null,p),Mh(l)}function Th(l,p,y){l.lanes|=y;var w=l.alternate;w!==null&&(w.lanes|=y);for(var E=!1,I=l.return;I!==null;)I.childLanes|=y,w=I.alternate,w!==null&&(w.childLanes|=y),I.tag===22&&(l=I.stateNode,l===null||l._visibility&1||(E=!0)),l=I,I=I.return;return l.tag===3?(I=l.stateNode,E&&p!==null&&(E=31-Yn(y),l=I.hiddenUpdates,w=l[E],w===null?l[E]=[p]:w.push(p),p.lane=y|536870912),I):null}function Mh(l){if(50<ju)throw ju=0,Ep=null,Error(n(185));for(var p=l.return;p!==null;)l=p,p=l.return;return l.tag===3?l.stateNode:null}var Na={};function Al(l,p,y,w){this.tag=l,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(l,p,y,w){return new Al(l,p,y,w)}function vu(l){return l=l.prototype,!(!l||!l.isReactComponent)}function to(l,p){var y=l.alternate;return y===null?(y=vs(l.tag,p,l.key,l.mode),y.elementType=l.elementType,y.type=l.type,y.stateNode=l.stateNode,y.alternate=l,l.alternate=y):(y.pendingProps=p,y.type=l.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=l.flags&65011712,y.childLanes=l.childLanes,y.lanes=l.lanes,y.child=l.child,y.memoizedProps=l.memoizedProps,y.memoizedState=l.memoizedState,y.updateQueue=l.updateQueue,p=l.dependencies,y.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},y.sibling=l.sibling,y.index=l.index,y.ref=l.ref,y.refCleanup=l.refCleanup,y}function Kf(l,p){l.flags&=65011714;var y=l.alternate;return y===null?(l.childLanes=0,l.lanes=p,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=y.childLanes,l.lanes=y.lanes,l.child=y.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=y.memoizedProps,l.memoizedState=y.memoizedState,l.updateQueue=y.updateQueue,l.type=y.type,p=y.dependencies,l.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),l}function kl(l,p,y,w,E,I){var X=0;if(w=l,typeof l=="function")vu(l)&&(X=1);else if(typeof l=="string")X=pe(l,y,Rt.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case gt:return l=vs(31,y,p,E),l.elementType=gt,l.lanes=I,l;case K:return wo(y.children,E,I,p);case se:X=8,E|=24;break;case le:return l=vs(12,y,p,E|2),l.elementType=le,l.lanes=I,l;case ke:return l=vs(13,y,p,E),l.elementType=ke,l.lanes=I,l;case Se:return l=vs(19,y,p,E),l.elementType=Se,l.lanes=I,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case ve:case je:X=10;break e;case Be:X=9;break e;case ze:X=11;break e;case Fe:X=14;break e;case He:X=16,w=null;break e}X=29,y=Error(n(130,l===null?"null":typeof l,"")),w=null}return p=vs(X,y,p,E),p.elementType=l,p.type=w,p.lanes=I,p}function wo(l,p,y,w){return l=vs(7,l,w,p),l.lanes=y,l}function yc(l,p,y){return l=vs(6,l,null,p),l.lanes=y,l}function Ch(l,p,y){return p=vs(4,l.children!==null?l.children:[],l.key,p),p.lanes=y,p.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},p}var Fa=[],_c=0,bc=null,ja=0,$s=[],lr=0,So=null,cr=1,xr="";function To(l,p){Fa[_c++]=ja,Fa[_c++]=bc,bc=l,ja=p}function Yf(l,p,y){$s[lr++]=cr,$s[lr++]=xr,$s[lr++]=So,So=l;var w=cr;l=xr;var E=32-Yn(w)-1;w&=~(1<<E),y+=1;var I=32-Yn(p)+E;if(30<I){var X=E-E%5;I=(w&(1<<X)-1).toString(32),w>>=X,E-=X,cr=1<<32-Yn(p)+E|y<<E|w,xr=I+l}else cr=1<<I|y<<E|w,xr=l}function gn(l){l.return!==null&&(To(l,1),Yf(l,1,0))}function Yo(l){for(;l===bc;)bc=Fa[--_c],Fa[_c]=null,ja=Fa[--_c],Fa[_c]=null;for(;l===So;)So=$s[--lr],$s[lr]=null,xr=$s[--lr],$s[lr]=null,cr=$s[--lr],$s[lr]=null}var on=null,yn=null,Pi=!1,Jo=null,Ls=!1,Mo=Error(n(519));function ea(l){var p=Error(n(418,""));throw Xs(ar(p,l)),Mo}function Ah(l){var p=l.stateNode,y=l.type,w=l.memoizedProps;switch(p[Xt]=l,p[We]=w,y){case"dialog":Ci("cancel",p),Ci("close",p);break;case"iframe":case"object":case"embed":Ci("load",p);break;case"video":case"audio":for(y=0;y<Ql.length;y++)Ci(Ql[y],p);break;case"source":Ci("error",p);break;case"img":case"image":case"link":Ci("error",p),Ci("load",p);break;case"details":Ci("toggle",p);break;case"input":Ci("invalid",p),yl(p,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0),oc(p);break;case"select":Ci("invalid",p);break;case"textarea":Ci("invalid",p),vo(p,w.value,w.defaultValue,w.children),oc(p)}y=w.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||p.textContent===""+y||w.suppressHydrationWarning===!0||Ag(p.textContent,y)?(w.popover!=null&&(Ci("beforetoggle",p),Ci("toggle",p)),w.onScroll!=null&&Ci("scroll",p),w.onScrollEnd!=null&&Ci("scrollend",p),w.onClick!=null&&(p.onclick=Cd),p=!0):p=!1,p||ea(l)}function kh(l){for(on=l.return;on;)switch(on.tag){case 5:case 13:Ls=!1;return;case 27:case 3:Ls=!0;return;default:on=on.return}}function vc(l){if(l!==on)return!1;if(!Pi)return kh(l),Pi=!0,!1;var p=l.tag,y;if((y=p!==3&&p!==27)&&((y=p===5)&&(y=l.type,y=!(y!=="form"&&y!=="button")||ef(l.type,l.memoizedProps)),y=!y),y&&yn&&ea(l),kh(l),p===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));e:{for(l=l.nextSibling,p=0;l;){if(l.nodeType===8)if(y=l.data,y==="/$"){if(p===0){yn=da(l.nextSibling);break e}p--}else y!=="$"&&y!=="$!"&&y!=="$?"||p++;l=l.nextSibling}yn=null}}else p===27?(p=yn,il(l.type)?(l=Zp,Zp=null,yn=l):yn=p):yn=on?da(l.stateNode.nextSibling):null;return!0}function El(){yn=on=null,Pi=!1}function Eh(){var l=Jo;return l!==null&&(kr===null?kr=l:kr.push.apply(kr,l),Jo=null),l}function Xs(l){Jo===null?Jo=[l]:Jo.push(l)}var Ph=ot(null),Va=null,Co=null;function ta(l,p,y){Tt(Ph,p._currentValue),p._currentValue=y}function Ao(l){l._currentValue=Ph.current,xt(Ph)}function Oh(l,p,y){for(;l!==null;){var w=l.alternate;if((l.childLanes&p)!==p?(l.childLanes|=p,w!==null&&(w.childLanes|=p)):w!==null&&(w.childLanes&p)!==p&&(w.childLanes|=p),l===y)break;l=l.return}}function Ua(l,p,y,w){var E=l.child;for(E!==null&&(E.return=l);E!==null;){var I=E.dependencies;if(I!==null){var X=E.child;I=I.firstContext;e:for(;I!==null;){var ie=I;I=E;for(var we=0;we<p.length;we++)if(ie.context===p[we]){I.lanes|=y,ie=I.alternate,ie!==null&&(ie.lanes|=y),Oh(I.return,y,l),w||(X=null);break e}I=ie.next}}else if(E.tag===18){if(X=E.return,X===null)throw Error(n(341));X.lanes|=y,I=X.alternate,I!==null&&(I.lanes|=y),Oh(X,y,l),X=null}else X=E.child;if(X!==null)X.return=E;else for(X=E;X!==null;){if(X===l){X=null;break}if(E=X.sibling,E!==null){E.return=X.return,X=E;break}X=X.return}E=X}}function Vr(l,p,y,w){l=null;for(var E=p,I=!1;E!==null;){if(!I){if((E.flags&524288)!==0)I=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var X=E.alternate;if(X===null)throw Error(n(387));if(X=X.memoizedProps,X!==null){var ie=E.type;Gs(E.pendingProps.value,X.value)||(l!==null?l.push(ie):l=[ie])}}else if(E===Ei.current){if(X=E.alternate,X===null)throw Error(n(387));X.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(l!==null?l.push(bt):l=[bt])}E=E.return}l!==null&&Ua(p,l,y,w),p.flags|=262144}function xs(l){for(l=l.firstContext;l!==null;){if(!Gs(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function zn(l){Va=l,Co=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function an(l){return io(Va,l)}function xu(l,p){return Va===null&&zn(l),io(l,p)}function io(l,p){var y=p._currentValue;if(p={context:p,memoizedValue:y,next:null},Co===null){if(l===null)throw Error(n(308));Co=p,l.dependencies={lanes:0,firstContext:p},l.flags|=524288}else Co=Co.next=p;return y}var ko=typeof AbortController<"u"?AbortController:function(){var l=[],p=this.signal={aborted:!1,addEventListener:function(y,w){l.push(w)}};this.abort=function(){p.aborted=!0,l.forEach(function(y){return y()})}},cp=s.unstable_scheduleCallback,Jf=s.unstable_NormalPriority,ts={$$typeof:je,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wu(){return{controller:new ko,data:new Map,refCount:0}}function xc(l){l.refCount--,l.refCount===0&&cp(Jf,function(){l.controller.abort()})}var wr=null,no=0,At=0,Pl=null;function ed(l,p){if(wr===null){var y=wr=[];no=0,At=tl(),Pl={status:"pending",value:void 0,then:function(w){y.push(w)}}}return no++,p.then(wc,wc),p}function wc(){if(--no===0&&wr!==null){Pl!==null&&(Pl.status="fulfilled");var l=wr;wr=null,At=0,Pl=null;for(var p=0;p<l.length;p++)(0,l[p])()}}function Su(l,p){var y=[],w={status:"pending",value:null,reason:null,then:function(E){y.push(E)}};return l.then(function(){w.status="fulfilled",w.value=p;for(var E=0;E<y.length;E++)(0,y[E])(p)},function(E){for(w.status="rejected",w.reason=E,E=0;E<y.length;E++)(0,y[E])(void 0)}),w}var qa=Xe.S;Xe.S=function(l,p){typeof p=="object"&&p!==null&&typeof p.then=="function"&&ed(l,p),qa!==null&&qa(l,p)};var so=ot(null);function di(){var l=so.current;return l!==null?l:fn.pooledCache}function Ol(l,p){p===null?Tt(so,so.current):Tt(so,p.pool)}function td(){var l=di();return l===null?null:{parent:ts._currentValue,pool:l}}var Ha=Error(n(460)),Dh=Error(n(474)),Tu=Error(n(542)),Rh={then:function(){}};function Mu(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Cu(){}function id(l,p,y){switch(y=l[y],y===void 0?l.push(p):y!==p&&(p.then(Cu,Cu),p=y),p.status){case"fulfilled":return p.value;case"rejected":throw l=p.reason,up(l),l;default:if(typeof p.status=="string")p.then(Cu,Cu);else{if(l=fn,l!==null&&100<l.shellSuspendCounter)throw Error(n(482));l=p,l.status="pending",l.then(function(w){if(p.status==="pending"){var E=p;E.status="fulfilled",E.value=w}},function(w){if(p.status==="pending"){var E=p;E.status="rejected",E.reason=w}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw l=p.reason,up(l),l}throw Dl=p,Ha}}var Dl=null;function nd(){if(Dl===null)throw Error(n(459));var l=Dl;return Dl=null,l}function up(l){if(l===Ha||l===Tu)throw Error(n(483))}var Qs=!1;function Hi(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rl(l,p){l=l.updateQueue,p.updateQueue===l&&(p.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function ro(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Eo(l,p,y){var w=l.updateQueue;if(w===null)return null;if(w=w.shared,(Ui&2)!==0){var E=w.pending;return E===null?p.next=p:(p.next=E.next,E.next=p),w.pending=p,p=Mh(l),Th(l,null,y),p}return Ba(l,w,p,y),Mh(l)}function ia(l,p,y){if(p=p.updateQueue,p!==null&&(p=p.shared,(y&4194048)!==0)){var w=p.lanes;w&=l.pendingLanes,y|=w,p.lanes=y,Ye(l,y)}}function Ih(l,p){var y=l.updateQueue,w=l.alternate;if(w!==null&&(w=w.updateQueue,y===w)){var E=null,I=null;if(y=y.firstBaseUpdate,y!==null){do{var X={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};I===null?E=I=X:I=I.next=X,y=y.next}while(y!==null);I===null?E=I=p:I=I.next=p}else E=I=p;y={baseState:w.baseState,firstBaseUpdate:E,lastBaseUpdate:I,shared:w.shared,callbacks:w.callbacks},l.updateQueue=y;return}l=y.lastBaseUpdate,l===null?y.firstBaseUpdate=p:l.next=p,y.lastBaseUpdate=p}var Au=!1;function ur(){if(Au){var l=Pl;if(l!==null)throw l}}function Za(l,p,y,w){Au=!1;var E=l.updateQueue;Qs=!1;var I=E.firstBaseUpdate,X=E.lastBaseUpdate,ie=E.shared.pending;if(ie!==null){E.shared.pending=null;var we=ie,$e=we.next;we.next=null,X===null?I=$e:X.next=$e,X=we;var ct=l.alternate;ct!==null&&(ct=ct.updateQueue,ie=ct.lastBaseUpdate,ie!==X&&(ie===null?ct.firstBaseUpdate=$e:ie.next=$e,ct.lastBaseUpdate=we))}if(I!==null){var pt=E.baseState;X=0,ct=$e=we=null,ie=I;do{var Ze=ie.lane&-536870913,Ke=Ze!==ie.lane;if(Ke?(Di&Ze)===Ze:(w&Ze)===Ze){Ze!==0&&Ze===At&&(Au=!0),ct!==null&&(ct=ct.next={lane:0,tag:ie.tag,payload:ie.payload,callback:null,next:null});e:{var oi=l,si=ie;Ze=p;var hn=y;switch(si.tag){case 1:if(oi=si.payload,typeof oi=="function"){pt=oi.call(hn,pt,Ze);break e}pt=oi;break e;case 3:oi.flags=oi.flags&-65537|128;case 0:if(oi=si.payload,Ze=typeof oi=="function"?oi.call(hn,pt,Ze):oi,Ze==null)break e;pt=P({},pt,Ze);break e;case 2:Qs=!0}}Ze=ie.callback,Ze!==null&&(l.flags|=64,Ke&&(l.flags|=8192),Ke=E.callbacks,Ke===null?E.callbacks=[Ze]:Ke.push(Ze))}else Ke={lane:Ze,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null},ct===null?($e=ct=Ke,we=pt):ct=ct.next=Ke,X|=Ze;if(ie=ie.next,ie===null){if(ie=E.shared.pending,ie===null)break;Ke=ie,ie=Ke.next,Ke.next=null,E.lastBaseUpdate=Ke,E.shared.pending=null}}while(!0);ct===null&&(we=pt),E.baseState=we,E.firstBaseUpdate=$e,E.lastBaseUpdate=ct,I===null&&(E.shared.lanes=0),$l|=X,l.lanes=X,l.memoizedState=pt}}function jt(l,p){if(typeof l!="function")throw Error(n(191,l));l.call(p)}function Yt(l,p){var y=l.callbacks;if(y!==null)for(l.callbacks=null,l=0;l<y.length;l++)jt(y[l],p)}var Po=ot(null),Sc=ot(0);function zh(l,p){l=Gl,Tt(Sc,l),Tt(Po,p),Gl=l|p.baseLanes}function Bs(){Tt(Sc,Gl),Tt(Po,Po.current)}function Lh(){Gl=Sc.current,xt(Po),xt(Sc)}var ws=0,ui=null,Ri=null,pi=null,_n=!1,Ga=!1,oo=!1,Il=0,Sr=0,na=null,ku=0;function ln(){throw Error(n(321))}function zl(l,p){if(p===null)return!1;for(var y=0;y<p.length&&y<l.length;y++)if(!Gs(l[y],p[y]))return!1;return!0}function Eu(l,p,y,w,E,I){return ws=I,ui=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Xe.H=l===null||l.memoizedState===null?rd:Qa,oo=!1,I=y(w,E),oo=!1,Ga&&(I=$a(p,y,w,E)),Ll(l),I}function Ll(l){Xe.H=Gi;var p=Ri!==null&&Ri.next!==null;if(ws=0,pi=Ri=ui=null,_n=!1,Sr=0,na=null,p)throw Error(n(300));l===null||Zn||(l=l.dependencies,l!==null&&xs(l)&&(Zn=!0))}function $a(l,p,y,w){ui=l;var E=0;do{if(Ga&&(na=null),Sr=0,Ga=!1,25<=E)throw Error(n(301));if(E+=1,pi=Ri=null,l.updateQueue!=null){var I=l.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}Xe.H=Gm,I=p(y,w)}while(Ga);return I}function sd(){var l=Xe.H,p=l.useState()[0];return p=typeof p.then=="function"?x(p):p,l=l.useState()[0],(Ri!==null?Ri.memoizedState:null)!==l&&(ui.flags|=1024),p}function Tc(){var l=Il!==0;return Il=0,l}function sa(l,p,y){p.updateQueue=l.updateQueue,p.flags&=-2053,l.lanes&=~y}function Pu(l){if(_n){for(l=l.memoizedState;l!==null;){var p=l.queue;p!==null&&(p.pending=null),l=l.next}_n=!1}ws=0,pi=Ri=ui=null,Ga=!1,Sr=Il=0,na=null}function Ss(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?ui.memoizedState=pi=l:pi=pi.next=l,pi}function Sn(){if(Ri===null){var l=ui.alternate;l=l!==null?l.memoizedState:null}else l=Ri.next;var p=pi===null?ui.memoizedState:pi.next;if(p!==null)pi=p,Ri=l;else{if(l===null)throw ui.alternate===null?Error(n(467)):Error(n(310));Ri=l,l={memoizedState:Ri.memoizedState,baseState:Ri.baseState,baseQueue:Ri.baseQueue,queue:Ri.queue,next:null},pi===null?ui.memoizedState=pi=l:pi=pi.next=l}return pi}function Ou(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function x(l){var p=Sr;return Sr+=1,na===null&&(na=[]),l=id(na,l,p),p=ui,(pi===null?p.memoizedState:pi.next)===null&&(p=p.alternate,Xe.H=p===null||p.memoizedState===null?rd:Qa),l}function i(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return x(l);if(l.$$typeof===je)return an(l)}throw Error(n(438,String(l)))}function c(l){var p=null,y=ui.updateQueue;if(y!==null&&(p=y.memoCache),p==null){var w=ui.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(p={data:w.data.map(function(E){return E.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),y===null&&(y=Ou(),ui.updateQueue=y),y.memoCache=p,y=p.data[p.index],y===void 0)for(y=p.data[p.index]=Array(l),w=0;w<l;w++)y[w]=Et;return p.index++,y}function g(l,p){return typeof p=="function"?p(l):p}function _(l){var p=Sn();return S(p,Ri,l)}function S(l,p,y){var w=l.queue;if(w===null)throw Error(n(311));w.lastRenderedReducer=y;var E=l.baseQueue,I=w.pending;if(I!==null){if(E!==null){var X=E.next;E.next=I.next,I.next=X}p.baseQueue=E=I,w.pending=null}if(I=l.baseState,E===null)l.memoizedState=I;else{p=E.next;var ie=X=null,we=null,$e=p,ct=!1;do{var pt=$e.lane&-536870913;if(pt!==$e.lane?(Di&pt)===pt:(ws&pt)===pt){var Ze=$e.revertLane;if(Ze===0)we!==null&&(we=we.next={lane:0,revertLane:0,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null}),pt===At&&(ct=!0);else if((ws&Ze)===Ze){$e=$e.next,Ze===At&&(ct=!0);continue}else pt={lane:0,revertLane:$e.revertLane,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null},we===null?(ie=we=pt,X=I):we=we.next=pt,ui.lanes|=Ze,$l|=Ze;pt=$e.action,oo&&y(I,pt),I=$e.hasEagerState?$e.eagerState:y(I,pt)}else Ze={lane:pt,revertLane:$e.revertLane,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null},we===null?(ie=we=Ze,X=I):we=we.next=Ze,ui.lanes|=pt,$l|=pt;$e=$e.next}while($e!==null&&$e!==p);if(we===null?X=I:we.next=ie,!Gs(I,l.memoizedState)&&(Zn=!0,ct&&(y=Pl,y!==null)))throw y;l.memoizedState=I,l.baseState=X,l.baseQueue=we,w.lastRenderedState=I}return E===null&&(w.lanes=0),[l.memoizedState,w.dispatch]}function C(l){var p=Sn(),y=p.queue;if(y===null)throw Error(n(311));y.lastRenderedReducer=l;var w=y.dispatch,E=y.pending,I=p.memoizedState;if(E!==null){y.pending=null;var X=E=E.next;do I=l(I,X.action),X=X.next;while(X!==E);Gs(I,p.memoizedState)||(Zn=!0),p.memoizedState=I,p.baseQueue===null&&(p.baseState=I),y.lastRenderedState=I}return[I,w]}function O(l,p,y){var w=ui,E=Sn(),I=Pi;if(I){if(y===void 0)throw Error(n(407));y=y()}else y=p();var X=!Gs((Ri||E).memoizedState,y);X&&(E.memoizedState=y,Zn=!0),E=E.queue;var ie=V.bind(null,w,E,l);if(rt(2048,8,ie,[l]),E.getSnapshot!==p||X||pi!==null&&pi.memoizedState.tag&1){if(w.flags|=2048,tt(9,et(),B.bind(null,w,E,y,p),null),fn===null)throw Error(n(349));I||(ws&124)!==0||R(w,p,y)}return y}function R(l,p,y){l.flags|=16384,l={getSnapshot:p,value:y},p=ui.updateQueue,p===null?(p=Ou(),ui.updateQueue=p,p.stores=[l]):(y=p.stores,y===null?p.stores=[l]:y.push(l))}function B(l,p,y,w){p.value=y,p.getSnapshot=w,q(p)&&H(l)}function V(l,p,y){return y(function(){q(p)&&H(l)})}function q(l){var p=l.getSnapshot;l=l.value;try{var y=p();return!Gs(l,y)}catch{return!0}}function H(l){var p=gc(l,2);p!==null&&Ws(p,l,2)}function W(l){var p=Ss();if(typeof l=="function"){var y=l;if(l=y(),oo){ys(!0);try{y()}finally{ys(!1)}}}return p.memoizedState=p.baseState=l,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:l},p}function Y(l,p,y,w){return l.baseState=y,S(l,Ri,typeof w=="function"?w:g)}function ue(l,p,y,w,E){if(Yi(l))throw Error(n(485));if(l=p.action,l!==null){var I={payload:E,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(X){I.listeners.push(X)}};Xe.T!==null?y(!0):I.isTransition=!1,w(I),y=p.pending,y===null?(I.next=p.pending=I,ce(p,I)):(I.next=y.next,p.pending=y.next=I)}}function ce(l,p){var y=p.action,w=p.payload,E=l.state;if(p.isTransition){var I=Xe.T,X={};Xe.T=X;try{var ie=y(E,w),we=Xe.S;we!==null&&we(X,ie),he(l,p,ie)}catch($e){_e(l,p,$e)}finally{Xe.T=I}}else try{I=y(E,w),he(l,p,I)}catch($e){_e(l,p,$e)}}function he(l,p,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(w){de(l,p,w)},function(w){return _e(l,p,w)}):de(l,p,y)}function de(l,p,y){p.status="fulfilled",p.value=y,be(p),l.state=y,p=l.pending,p!==null&&(y=p.next,y===p?l.pending=null:(y=y.next,p.next=y,ce(l,y)))}function _e(l,p,y){var w=l.pending;if(l.pending=null,w!==null){w=w.next;do p.status="rejected",p.reason=y,be(p),p=p.next;while(p!==w)}l.action=null}function be(l){l=l.listeners;for(var p=0;p<l.length;p++)(0,l[p])()}function Me(l,p){return p}function Pe(l,p){if(Pi){var y=fn.formState;if(y!==null){e:{var w=ui;if(Pi){if(yn){t:{for(var E=yn,I=Ls;E.nodeType!==8;){if(!I){E=null;break t}if(E=da(E.nextSibling),E===null){E=null;break t}}I=E.data,E=I==="F!"||I==="F"?E:null}if(E){yn=da(E.nextSibling),w=E.data==="F!";break e}}ea(w)}w=!1}w&&(p=y[0])}}return y=Ss(),y.memoizedState=y.baseState=p,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Me,lastRenderedState:p},y.queue=w,y=oa.bind(null,ui,w),w.dispatch=y,w=W(!1),I=co.bind(null,ui,!1,w.queue),w=Ss(),E={state:p,dispatch:null,action:l,pending:null},w.queue=E,y=ue.bind(null,ui,E,I,y),E.dispatch=y,w.memoizedState=l,[p,y,!1]}function Ce(l){var p=Sn();return Ne(p,Ri,l)}function Ne(l,p,y){if(p=S(l,p,Me)[0],l=_(g)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var w=x(p)}catch(X){throw X===Ha?Tu:X}else w=p;p=Sn();var E=p.queue,I=E.dispatch;return y!==p.memoizedState&&(ui.flags|=2048,tt(9,et(),qe.bind(null,E,y),null)),[w,I,l]}function qe(l,p){l.action=p}function it(l){var p=Sn(),y=Ri;if(y!==null)return Ne(p,y,l);Sn(),p=p.memoizedState,y=Sn();var w=y.queue.dispatch;return y.memoizedState=l,[p,w,!1]}function tt(l,p,y,w){return l={tag:l,create:y,deps:w,inst:p,next:null},p=ui.updateQueue,p===null&&(p=Ou(),ui.updateQueue=p),y=p.lastEffect,y===null?p.lastEffect=l.next=l:(w=y.next,y.next=l,l.next=w,p.lastEffect=l),l}function et(){return{destroy:void 0,resource:void 0}}function wt(){return Sn().memoizedState}function vt(l,p,y,w){var E=Ss();w=w===void 0?null:w,ui.flags|=l,E.memoizedState=tt(1|p,et(),y,w)}function rt(l,p,y,w){var E=Sn();w=w===void 0?null:w;var I=E.memoizedState.inst;Ri!==null&&w!==null&&zl(w,Ri.memoizedState.deps)?E.memoizedState=tt(p,I,y,w):(ui.flags|=l,E.memoizedState=tt(1|p,I,y,w))}function zt(l,p){vt(8390656,8,l,p)}function ci(l,p){rt(2048,8,l,p)}function ii(l,p){return rt(4,2,l,p)}function cn(l,p){return rt(4,4,l,p)}function Ii(l,p){if(typeof p=="function"){l=l();var y=p(l);return function(){typeof y=="function"?y():p(null)}}if(p!=null)return l=l(),p.current=l,function(){p.current=null}}function un(l,p,y){y=y!=null?y.concat([l]):null,rt(4,4,Ii.bind(null,p,l),y)}function Zi(){}function Li(l,p){var y=Sn();p=p===void 0?null:p;var w=y.memoizedState;return p!==null&&zl(p,w[1])?w[0]:(y.memoizedState=[l,p],l)}function Oi(l,p){var y=Sn();p=p===void 0?null:p;var w=y.memoizedState;if(p!==null&&zl(p,w[1]))return w[0];if(w=l(),oo){ys(!0);try{l()}finally{ys(!1)}}return y.memoizedState=[w,p],w}function qn(l,p,y){return y===void 0||(ws&1073741824)!==0?l.memoizedState=p:(l.memoizedState=y,l=bd(),ui.lanes|=l,$l|=l,y)}function Hn(l,p,y,w){return Gs(y,p)?y:Po.current!==null?(l=qn(l,y,w),Gs(l,p)||(Zn=!0),l):(ws&42)===0?(Zn=!0,l.memoizedState=y):(l=bd(),ui.lanes|=l,$l|=l,p)}function cs(l,p,y,w,E){var I=dt.p;dt.p=I!==0&&8>I?I:8;var X=Xe.T,ie={};Xe.T=ie,co(l,!1,p,y);try{var we=E(),$e=Xe.S;if($e!==null&&$e(ie,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var ct=Su(we,w);Mr(l,p,ct,hs(l))}else Mr(l,p,w,hs(l))}catch(pt){Mr(l,p,{then:function(){},status:"rejected",reason:pt},hs())}finally{dt.p=I,Xe.T=X}}function Ns(){}function Ur(l,p,y,w){if(l.tag!==5)throw Error(n(476));var E=ra(l).queue;cs(l,E,p,_t,y===null?Ns:function(){return Oo(l),y(w)})}function ra(l){var p=l.memoizedState;if(p!==null)return p;p={memoizedState:_t,baseState:_t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:_t},next:null};var y={};return p.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:y},next:null},l.memoizedState=p,l=l.alternate,l!==null&&(l.memoizedState=p),p}function Oo(l){var p=ra(l).next.queue;Mr(l,p,{},hs())}function ao(){return an(bt)}function lo(){return Sn().memoizedState}function Xa(){return Sn().memoizedState}function Bl(l){for(var p=l.return;p!==null;){switch(p.tag){case 24:case 3:var y=hs();l=ro(y);var w=Eo(p,l,y);w!==null&&(Ws(w,p,y),ia(w,p,y)),p={cache:wu()},l.payload=p;return}p=p.return}}function Tr(l,p,y){var w=hs();y={lane:w,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},Yi(l)?Ji(p,y):(y=Wf(l,p,y,w),y!==null&&(Ws(y,l,w),Tn(y,p,w)))}function oa(l,p,y){var w=hs();Mr(l,p,y,w)}function Mr(l,p,y,w){var E={lane:w,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(Yi(l))Ji(p,E);else{var I=l.alternate;if(l.lanes===0&&(I===null||I.lanes===0)&&(I=p.lastRenderedReducer,I!==null))try{var X=p.lastRenderedState,ie=I(X,y);if(E.hasEagerState=!0,E.eagerState=ie,Gs(ie,X))return Ba(l,p,E,0),fn===null&&Cl(),!1}catch{}finally{}if(y=Wf(l,p,E,w),y!==null)return Ws(y,l,w),Tn(y,p,w),!0}return!1}function co(l,p,y,w){if(w={lane:2,revertLane:tl(),action:w,hasEagerState:!1,eagerState:null,next:null},Yi(l)){if(p)throw Error(n(479))}else p=Wf(l,y,w,2),p!==null&&Ws(p,l,2)}function Yi(l){var p=l.alternate;return l===ui||p!==null&&p===ui}function Ji(l,p){Ga=_n=!0;var y=l.pending;y===null?p.next=p:(p.next=y.next,y.next=p),l.pending=p}function Tn(l,p,y){if((y&4194048)!==0){var w=p.lanes;w&=l.pendingLanes,y|=w,p.lanes=y,Ye(l,y)}}var Gi={readContext:an,use:i,useCallback:ln,useContext:ln,useEffect:ln,useImperativeHandle:ln,useLayoutEffect:ln,useInsertionEffect:ln,useMemo:ln,useReducer:ln,useRef:ln,useState:ln,useDebugValue:ln,useDeferredValue:ln,useTransition:ln,useSyncExternalStore:ln,useId:ln,useHostTransitionStatus:ln,useFormState:ln,useActionState:ln,useOptimistic:ln,useMemoCache:ln,useCacheRefresh:ln},rd={readContext:an,use:i,useCallback:function(l,p){return Ss().memoizedState=[l,p===void 0?null:p],l},useContext:an,useEffect:zt,useImperativeHandle:function(l,p,y){y=y!=null?y.concat([l]):null,vt(4194308,4,Ii.bind(null,p,l),y)},useLayoutEffect:function(l,p){return vt(4194308,4,l,p)},useInsertionEffect:function(l,p){vt(4,2,l,p)},useMemo:function(l,p){var y=Ss();p=p===void 0?null:p;var w=l();if(oo){ys(!0);try{l()}finally{ys(!1)}}return y.memoizedState=[w,p],w},useReducer:function(l,p,y){var w=Ss();if(y!==void 0){var E=y(p);if(oo){ys(!0);try{y(p)}finally{ys(!1)}}}else E=p;return w.memoizedState=w.baseState=E,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:E},w.queue=l,l=l.dispatch=Tr.bind(null,ui,l),[w.memoizedState,l]},useRef:function(l){var p=Ss();return l={current:l},p.memoizedState=l},useState:function(l){l=W(l);var p=l.queue,y=oa.bind(null,ui,p);return p.dispatch=y,[l.memoizedState,y]},useDebugValue:Zi,useDeferredValue:function(l,p){var y=Ss();return qn(y,l,p)},useTransition:function(){var l=W(!1);return l=cs.bind(null,ui,l.queue,!0,!1),Ss().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,p,y){var w=ui,E=Ss();if(Pi){if(y===void 0)throw Error(n(407));y=y()}else{if(y=p(),fn===null)throw Error(n(349));(Di&124)!==0||R(w,p,y)}E.memoizedState=y;var I={value:y,getSnapshot:p};return E.queue=I,zt(V.bind(null,w,I,l),[l]),w.flags|=2048,tt(9,et(),B.bind(null,w,I,y,p),null),y},useId:function(){var l=Ss(),p=fn.identifierPrefix;if(Pi){var y=xr,w=cr;y=(w&~(1<<32-Yn(w)-1)).toString(32)+y,p="«"+p+"R"+y,y=Il++,0<y&&(p+="H"+y.toString(32)),p+="»"}else y=ku++,p="«"+p+"r"+y.toString(32)+"»";return l.memoizedState=p},useHostTransitionStatus:ao,useFormState:Pe,useActionState:Pe,useOptimistic:function(l){var p=Ss();p.memoizedState=p.baseState=l;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=y,p=co.bind(null,ui,!0,y),y.dispatch=p,[l,p]},useMemoCache:c,useCacheRefresh:function(){return Ss().memoizedState=Bl.bind(null,ui)}},Qa={readContext:an,use:i,useCallback:Li,useContext:an,useEffect:ci,useImperativeHandle:un,useInsertionEffect:ii,useLayoutEffect:cn,useMemo:Oi,useReducer:_,useRef:wt,useState:function(){return _(g)},useDebugValue:Zi,useDeferredValue:function(l,p){var y=Sn();return Hn(y,Ri.memoizedState,l,p)},useTransition:function(){var l=_(g)[0],p=Sn().memoizedState;return[typeof l=="boolean"?l:x(l),p]},useSyncExternalStore:O,useId:lo,useHostTransitionStatus:ao,useFormState:Ce,useActionState:Ce,useOptimistic:function(l,p){var y=Sn();return Y(y,Ri,l,p)},useMemoCache:c,useCacheRefresh:Xa},Gm={readContext:an,use:i,useCallback:Li,useContext:an,useEffect:ci,useImperativeHandle:un,useInsertionEffect:ii,useLayoutEffect:cn,useMemo:Oi,useReducer:C,useRef:wt,useState:function(){return C(g)},useDebugValue:Zi,useDeferredValue:function(l,p){var y=Sn();return Ri===null?qn(y,l,p):Hn(y,Ri.memoizedState,l,p)},useTransition:function(){var l=C(g)[0],p=Sn().memoizedState;return[typeof l=="boolean"?l:x(l),p]},useSyncExternalStore:O,useId:lo,useHostTransitionStatus:ao,useFormState:it,useActionState:it,useOptimistic:function(l,p){var y=Sn();return Ri!==null?Y(y,Ri,l,p):(y.baseState=l,[l,y.queue.dispatch])},useMemoCache:c,useCacheRefresh:Xa},Nl=null,Fl=0;function Du(l){var p=Fl;return Fl+=1,Nl===null&&(Nl=[]),id(Nl,l,p)}function Ts(l,p){p=p.props.ref,l.ref=p!==void 0?p:null}function uo(l,p){throw p.$$typeof===L?Error(n(525)):(l=Object.prototype.toString.call(p),Error(n(31,l==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":l)))}function Bh(l){var p=l._init;return p(l._payload)}function od(l){function p(Ie,Ee){if(l){var Le=Ie.deletions;Le===null?(Ie.deletions=[Ee],Ie.flags|=16):Le.push(Ee)}}function y(Ie,Ee){if(!l)return null;for(;Ee!==null;)p(Ie,Ee),Ee=Ee.sibling;return null}function w(Ie){for(var Ee=new Map;Ie!==null;)Ie.key!==null?Ee.set(Ie.key,Ie):Ee.set(Ie.index,Ie),Ie=Ie.sibling;return Ee}function E(Ie,Ee){return Ie=to(Ie,Ee),Ie.index=0,Ie.sibling=null,Ie}function I(Ie,Ee,Le){return Ie.index=Le,l?(Le=Ie.alternate,Le!==null?(Le=Le.index,Le<Ee?(Ie.flags|=67108866,Ee):Le):(Ie.flags|=67108866,Ee)):(Ie.flags|=1048576,Ee)}function X(Ie){return l&&Ie.alternate===null&&(Ie.flags|=67108866),Ie}function ie(Ie,Ee,Le,lt){return Ee===null||Ee.tag!==6?(Ee=yc(Le,Ie.mode,lt),Ee.return=Ie,Ee):(Ee=E(Ee,Le),Ee.return=Ie,Ee)}function we(Ie,Ee,Le,lt){var It=Le.type;return It===K?ct(Ie,Ee,Le.props.children,lt,Le.key):Ee!==null&&(Ee.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===He&&Bh(It)===Ee.type)?(Ee=E(Ee,Le.props),Ts(Ee,Le),Ee.return=Ie,Ee):(Ee=kl(Le.type,Le.key,Le.props,null,Ie.mode,lt),Ts(Ee,Le),Ee.return=Ie,Ee)}function $e(Ie,Ee,Le,lt){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Le.containerInfo||Ee.stateNode.implementation!==Le.implementation?(Ee=Ch(Le,Ie.mode,lt),Ee.return=Ie,Ee):(Ee=E(Ee,Le.children||[]),Ee.return=Ie,Ee)}function ct(Ie,Ee,Le,lt,It){return Ee===null||Ee.tag!==7?(Ee=wo(Le,Ie.mode,lt,It),Ee.return=Ie,Ee):(Ee=E(Ee,Le),Ee.return=Ie,Ee)}function pt(Ie,Ee,Le){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return Ee=yc(""+Ee,Ie.mode,Le),Ee.return=Ie,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case j:return Le=kl(Ee.type,Ee.key,Ee.props,null,Ie.mode,Le),Ts(Le,Ee),Le.return=Ie,Le;case F:return Ee=Ch(Ee,Ie.mode,Le),Ee.return=Ie,Ee;case He:var lt=Ee._init;return Ee=lt(Ee._payload),pt(Ie,Ee,Le)}if(ei(Ee)||ht(Ee))return Ee=wo(Ee,Ie.mode,Le,null),Ee.return=Ie,Ee;if(typeof Ee.then=="function")return pt(Ie,Du(Ee),Le);if(Ee.$$typeof===je)return pt(Ie,xu(Ie,Ee),Le);uo(Ie,Ee)}return null}function Ze(Ie,Ee,Le,lt){var It=Ee!==null?Ee.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return It!==null?null:ie(Ie,Ee,""+Le,lt);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case j:return Le.key===It?we(Ie,Ee,Le,lt):null;case F:return Le.key===It?$e(Ie,Ee,Le,lt):null;case He:return It=Le._init,Le=It(Le._payload),Ze(Ie,Ee,Le,lt)}if(ei(Le)||ht(Le))return It!==null?null:ct(Ie,Ee,Le,lt,null);if(typeof Le.then=="function")return Ze(Ie,Ee,Du(Le),lt);if(Le.$$typeof===je)return Ze(Ie,Ee,xu(Ie,Le),lt);uo(Ie,Le)}return null}function Ke(Ie,Ee,Le,lt,It){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return Ie=Ie.get(Le)||null,ie(Ee,Ie,""+lt,It);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case j:return Ie=Ie.get(lt.key===null?Le:lt.key)||null,we(Ee,Ie,lt,It);case F:return Ie=Ie.get(lt.key===null?Le:lt.key)||null,$e(Ee,Ie,lt,It);case He:var mi=lt._init;return lt=mi(lt._payload),Ke(Ie,Ee,Le,lt,It)}if(ei(lt)||ht(lt))return Ie=Ie.get(Le)||null,ct(Ee,Ie,lt,It,null);if(typeof lt.then=="function")return Ke(Ie,Ee,Le,Du(lt),It);if(lt.$$typeof===je)return Ke(Ie,Ee,Le,xu(Ee,lt),It);uo(Ee,lt)}return null}function oi(Ie,Ee,Le,lt){for(var It=null,mi=null,Ht=Ee,li=Ee=0,yr=null;Ht!==null&&li<Le.length;li++){Ht.index>li?(yr=Ht,Ht=null):yr=Ht.sibling;var Xi=Ze(Ie,Ht,Le[li],lt);if(Xi===null){Ht===null&&(Ht=yr);break}l&&Ht&&Xi.alternate===null&&p(Ie,Ht),Ee=I(Xi,Ee,li),mi===null?It=Xi:mi.sibling=Xi,mi=Xi,Ht=yr}if(li===Le.length)return y(Ie,Ht),Pi&&To(Ie,li),It;if(Ht===null){for(;li<Le.length;li++)Ht=pt(Ie,Le[li],lt),Ht!==null&&(Ee=I(Ht,Ee,li),mi===null?It=Ht:mi.sibling=Ht,mi=Ht);return Pi&&To(Ie,li),It}for(Ht=w(Ht);li<Le.length;li++)yr=Ke(Ht,Ie,li,Le[li],lt),yr!==null&&(l&&yr.alternate!==null&&Ht.delete(yr.key===null?li:yr.key),Ee=I(yr,Ee,li),mi===null?It=yr:mi.sibling=yr,mi=yr);return l&&Ht.forEach(function(of){return p(Ie,of)}),Pi&&To(Ie,li),It}function si(Ie,Ee,Le,lt){if(Le==null)throw Error(n(151));for(var It=null,mi=null,Ht=Ee,li=Ee=0,yr=null,Xi=Le.next();Ht!==null&&!Xi.done;li++,Xi=Le.next()){Ht.index>li?(yr=Ht,Ht=null):yr=Ht.sibling;var of=Ze(Ie,Ht,Xi.value,lt);if(of===null){Ht===null&&(Ht=yr);break}l&&Ht&&of.alternate===null&&p(Ie,Ht),Ee=I(of,Ee,li),mi===null?It=of:mi.sibling=of,mi=of,Ht=yr}if(Xi.done)return y(Ie,Ht),Pi&&To(Ie,li),It;if(Ht===null){for(;!Xi.done;li++,Xi=Le.next())Xi=pt(Ie,Xi.value,lt),Xi!==null&&(Ee=I(Xi,Ee,li),mi===null?It=Xi:mi.sibling=Xi,mi=Xi);return Pi&&To(Ie,li),It}for(Ht=w(Ht);!Xi.done;li++,Xi=Le.next())Xi=Ke(Ht,Ie,li,Xi.value,lt),Xi!==null&&(l&&Xi.alternate!==null&&Ht.delete(Xi.key===null?li:Xi.key),Ee=I(Xi,Ee,li),mi===null?It=Xi:mi.sibling=Xi,mi=Xi);return l&&Ht.forEach(function(JC){return p(Ie,JC)}),Pi&&To(Ie,li),It}function hn(Ie,Ee,Le,lt){if(typeof Le=="object"&&Le!==null&&Le.type===K&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case j:e:{for(var It=Le.key;Ee!==null;){if(Ee.key===It){if(It=Le.type,It===K){if(Ee.tag===7){y(Ie,Ee.sibling),lt=E(Ee,Le.props.children),lt.return=Ie,Ie=lt;break e}}else if(Ee.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===He&&Bh(It)===Ee.type){y(Ie,Ee.sibling),lt=E(Ee,Le.props),Ts(lt,Le),lt.return=Ie,Ie=lt;break e}y(Ie,Ee);break}else p(Ie,Ee);Ee=Ee.sibling}Le.type===K?(lt=wo(Le.props.children,Ie.mode,lt,Le.key),lt.return=Ie,Ie=lt):(lt=kl(Le.type,Le.key,Le.props,null,Ie.mode,lt),Ts(lt,Le),lt.return=Ie,Ie=lt)}return X(Ie);case F:e:{for(It=Le.key;Ee!==null;){if(Ee.key===It)if(Ee.tag===4&&Ee.stateNode.containerInfo===Le.containerInfo&&Ee.stateNode.implementation===Le.implementation){y(Ie,Ee.sibling),lt=E(Ee,Le.children||[]),lt.return=Ie,Ie=lt;break e}else{y(Ie,Ee);break}else p(Ie,Ee);Ee=Ee.sibling}lt=Ch(Le,Ie.mode,lt),lt.return=Ie,Ie=lt}return X(Ie);case He:return It=Le._init,Le=It(Le._payload),hn(Ie,Ee,Le,lt)}if(ei(Le))return oi(Ie,Ee,Le,lt);if(ht(Le)){if(It=ht(Le),typeof It!="function")throw Error(n(150));return Le=It.call(Le),si(Ie,Ee,Le,lt)}if(typeof Le.then=="function")return hn(Ie,Ee,Du(Le),lt);if(Le.$$typeof===je)return hn(Ie,Ee,xu(Ie,Le),lt);uo(Ie,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint"?(Le=""+Le,Ee!==null&&Ee.tag===6?(y(Ie,Ee.sibling),lt=E(Ee,Le),lt.return=Ie,Ie=lt):(y(Ie,Ee),lt=yc(Le,Ie.mode,lt),lt.return=Ie,Ie=lt),X(Ie)):y(Ie,Ee)}return function(Ie,Ee,Le,lt){try{Fl=0;var It=hn(Ie,Ee,Le,lt);return Nl=null,It}catch(Ht){if(Ht===Ha||Ht===Tu)throw Ht;var mi=vs(29,Ht,null,Ie.mode);return mi.lanes=lt,mi.return=Ie,mi}finally{}}}var Do=od(!0),Nh=od(!1),hr=ot(null),aa=null;function Mc(l){var p=l.alternate;Tt(us,us.current&1),Tt(hr,l),aa===null&&(p===null||Po.current!==null||p.memoizedState!==null)&&(aa=l)}function hp(l){if(l.tag===22){if(Tt(us,us.current),Tt(hr,l),aa===null){var p=l.alternate;p!==null&&p.memoizedState!==null&&(aa=l)}}else Cc()}function Cc(){Tt(us,us.current),Tt(hr,hr.current)}function la(l){xt(hr),aa===l&&(aa=null),xt(us)}var us=ot(0);function ad(l){for(var p=l;p!==null;){if(p.tag===13){var y=p.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||Hp(y)))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}function jl(l,p,y,w){p=l.memoizedState,y=y(w,p),y=y==null?p:P({},p,y),l.memoizedState=y,l.lanes===0&&(l.updateQueue.baseState=y)}var $m={enqueueSetState:function(l,p,y){l=l._reactInternals;var w=hs(),E=ro(w);E.payload=p,y!=null&&(E.callback=y),p=Eo(l,E,w),p!==null&&(Ws(p,l,w),ia(p,l,w))},enqueueReplaceState:function(l,p,y){l=l._reactInternals;var w=hs(),E=ro(w);E.tag=1,E.payload=p,y!=null&&(E.callback=y),p=Eo(l,E,w),p!==null&&(Ws(p,l,w),ia(p,l,w))},enqueueForceUpdate:function(l,p){l=l._reactInternals;var y=hs(),w=ro(y);w.tag=2,p!=null&&(w.callback=p),p=Eo(l,w,y),p!==null&&(Ws(p,l,y),ia(p,l,y))}};function Fh(l,p,y,w,E,I,X){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(w,I,X):p.prototype&&p.prototype.isPureReactComponent?!fi(y,w)||!fi(E,I):!0}function ld(l,p,y,w){l=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(y,w),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(y,w),p.state!==l&&$m.enqueueReplaceState(p,p.state,null)}function Wa(l,p){var y=p;if("ref"in p){y={};for(var w in p)w!=="ref"&&(y[w]=p[w])}if(l=l.defaultProps){y===p&&(y=P({},y));for(var E in l)y[E]===void 0&&(y[E]=l[E])}return y}var cd=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function Xm(l){cd(l)}function Dy(l){console.error(l)}function Ry(l){cd(l)}function ud(l,p){try{var y=l.onUncaughtError;y(p.value,{componentStack:p.stack})}catch(w){setTimeout(function(){throw w})}}function Qm(l,p,y){try{var w=l.onCaughtError;w(y.value,{componentStack:y.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function fp(l,p,y){return y=ro(y),y.tag=3,y.payload={element:null},y.callback=function(){ud(l,p)},y}function Iy(l){return l=ro(l),l.tag=3,l}function dp(l,p,y,w){var E=y.type.getDerivedStateFromError;if(typeof E=="function"){var I=w.value;l.payload=function(){return E(I)},l.callback=function(){Qm(p,y,w)}}var X=y.stateNode;X!==null&&typeof X.componentDidCatch=="function"&&(l.callback=function(){Qm(p,y,w),typeof E!="function"&&(Ja===null?Ja=new Set([this]):Ja.add(this));var ie=w.stack;this.componentDidCatch(w.value,{componentStack:ie!==null?ie:""})})}function zy(l,p,y,w,E){if(y.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(p=y.alternate,p!==null&&Vr(p,y,E,!0),y=hr.current,y!==null){switch(y.tag){case 13:return aa===null?xd():y.alternate===null&&$n===0&&($n=3),y.flags&=-257,y.flags|=65536,y.lanes=E,w===Rh?y.flags|=16384:(p=y.updateQueue,p===null?y.updateQueue=new Set([w]):p.add(w),Sd(l,w,E)),!1;case 22:return y.flags|=65536,w===Rh?y.flags|=16384:(p=y.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([w])},y.updateQueue=p):(y=p.retryQueue,y===null?p.retryQueue=new Set([w]):y.add(w)),Sd(l,w,E)),!1}throw Error(n(435,y.tag))}return Sd(l,w,E),xd(),!1}if(Pi)return p=hr.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=E,w!==Mo&&(l=Error(n(422),{cause:w}),Xs(ar(l,y)))):(w!==Mo&&(p=Error(n(423),{cause:w}),Xs(ar(p,y))),l=l.current.alternate,l.flags|=65536,E&=-E,l.lanes|=E,w=ar(w,y),E=fp(l.stateNode,w,E),Ih(l,E),$n!==4&&($n=2)),!1;var I=Error(n(520),{cause:w});if(I=ar(I,y),Fu===null?Fu=[I]:Fu.push(I),$n!==4&&($n=2),p===null)return!0;w=ar(w,y),y=p;do{switch(y.tag){case 3:return y.flags|=65536,l=E&-E,y.lanes|=l,l=fp(y.stateNode,w,l),Ih(y,l),!1;case 1:if(p=y.type,I=y.stateNode,(y.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Ja===null||!Ja.has(I))))return y.flags|=65536,E&=-E,y.lanes|=E,E=Iy(E),dp(E,l,y,w),Ih(y,E),!1}y=y.return}while(y!==null);return!1}var pp=Error(n(461)),Zn=!1;function en(l,p,y,w){p.child=l===null?Nh(p,null,y,w):Do(p,l.child,y,w)}function Wm(l,p,y,w,E){y=y.render;var I=p.ref;if("ref"in w){var X={};for(var ie in w)ie!=="ref"&&(X[ie]=w[ie])}else X=w;return zn(p),w=Eu(l,p,y,X,I,E),ie=Tc(),l!==null&&!Zn?(sa(l,p,E),ca(l,p,E)):(Pi&&ie&&gn(p),p.flags|=1,en(l,p,w,E),p.child)}function mp(l,p,y,w,E){if(l===null){var I=y.type;return typeof I=="function"&&!vu(I)&&I.defaultProps===void 0&&y.compare===null?(p.tag=15,p.type=I,Ly(l,p,I,w,E)):(l=kl(y.type,null,w,p,p.mode,E),l.ref=p.ref,l.return=p,p.child=l)}if(I=l.child,!ig(l,E)){var X=I.memoizedProps;if(y=y.compare,y=y!==null?y:fi,y(X,w)&&l.ref===p.ref)return ca(l,p,E)}return p.flags|=1,l=to(I,w),l.ref=p.ref,l.return=p,p.child=l}function Ly(l,p,y,w,E){if(l!==null){var I=l.memoizedProps;if(fi(I,w)&&l.ref===p.ref)if(Zn=!1,p.pendingProps=w=I,ig(l,E))(l.flags&131072)!==0&&(Zn=!0);else return p.lanes=l.lanes,ca(l,p,E)}return Ym(l,p,y,w,E)}function Km(l,p,y){var w=p.pendingProps,E=w.children,I=l!==null?l.memoizedState:null;if(w.mode==="hidden"){if((p.flags&128)!==0){if(w=I!==null?I.baseLanes|y:y,l!==null){for(E=p.child=l.child,I=0;E!==null;)I=I|E.lanes|E.childLanes,E=E.sibling;p.childLanes=I&~w}else p.childLanes=0,p.child=null;return By(l,p,w,y)}if((y&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},l!==null&&Ol(p,I!==null?I.cachePool:null),I!==null?zh(p,I):Bs(),hp(p);else return p.lanes=p.childLanes=536870912,By(l,p,I!==null?I.baseLanes|y:y,y)}else I!==null?(Ol(p,I.cachePool),zh(p,I),Cc(),p.memoizedState=null):(l!==null&&Ol(p,null),Bs(),Cc());return en(l,p,E,y),p.child}function By(l,p,y,w){var E=di();return E=E===null?null:{parent:ts._currentValue,pool:E},p.memoizedState={baseLanes:y,cachePool:E},l!==null&&Ol(p,null),Bs(),hp(p),l!==null&&Vr(l,p,w,!0),null}function gp(l,p){var y=p.ref;if(y===null)l!==null&&l.ref!==null&&(p.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(n(284));(l===null||l.ref!==y)&&(p.flags|=4194816)}}function Ym(l,p,y,w,E){return zn(p),y=Eu(l,p,y,w,void 0,E),w=Tc(),l!==null&&!Zn?(sa(l,p,E),ca(l,p,E)):(Pi&&w&&gn(p),p.flags|=1,en(l,p,y,E),p.child)}function Ny(l,p,y,w,E,I){return zn(p),p.updateQueue=null,y=$a(p,w,y,E),Ll(l),w=Tc(),l!==null&&!Zn?(sa(l,p,I),ca(l,p,I)):(Pi&&w&&gn(p),p.flags|=1,en(l,p,y,I),p.child)}function yp(l,p,y,w,E){if(zn(p),p.stateNode===null){var I=Na,X=y.contextType;typeof X=="object"&&X!==null&&(I=an(X)),I=new y(w,I),p.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=$m,p.stateNode=I,I._reactInternals=p,I=p.stateNode,I.props=w,I.state=p.memoizedState,I.refs={},Hi(p),X=y.contextType,I.context=typeof X=="object"&&X!==null?an(X):Na,I.state=p.memoizedState,X=y.getDerivedStateFromProps,typeof X=="function"&&(jl(p,y,X,w),I.state=p.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(X=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),X!==I.state&&$m.enqueueReplaceState(I,I.state,null),Za(p,w,I,E),ur(),I.state=p.memoizedState),typeof I.componentDidMount=="function"&&(p.flags|=4194308),w=!0}else if(l===null){I=p.stateNode;var ie=p.memoizedProps,we=Wa(y,ie);I.props=we;var $e=I.context,ct=y.contextType;X=Na,typeof ct=="object"&&ct!==null&&(X=an(ct));var pt=y.getDerivedStateFromProps;ct=typeof pt=="function"||typeof I.getSnapshotBeforeUpdate=="function",ie=p.pendingProps!==ie,ct||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(ie||$e!==X)&&ld(p,I,w,X),Qs=!1;var Ze=p.memoizedState;I.state=Ze,Za(p,w,I,E),ur(),$e=p.memoizedState,ie||Ze!==$e||Qs?(typeof pt=="function"&&(jl(p,y,pt,w),$e=p.memoizedState),(we=Qs||Fh(p,y,we,w,Ze,$e,X))?(ct||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(p.flags|=4194308)):(typeof I.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=w,p.memoizedState=$e),I.props=w,I.state=$e,I.context=X,w=we):(typeof I.componentDidMount=="function"&&(p.flags|=4194308),w=!1)}else{I=p.stateNode,Rl(l,p),X=p.memoizedProps,ct=Wa(y,X),I.props=ct,pt=p.pendingProps,Ze=I.context,$e=y.contextType,we=Na,typeof $e=="object"&&$e!==null&&(we=an($e)),ie=y.getDerivedStateFromProps,($e=typeof ie=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(X!==pt||Ze!==we)&&ld(p,I,w,we),Qs=!1,Ze=p.memoizedState,I.state=Ze,Za(p,w,I,E),ur();var Ke=p.memoizedState;X!==pt||Ze!==Ke||Qs||l!==null&&l.dependencies!==null&&xs(l.dependencies)?(typeof ie=="function"&&(jl(p,y,ie,w),Ke=p.memoizedState),(ct=Qs||Fh(p,y,ct,w,Ze,Ke,we)||l!==null&&l.dependencies!==null&&xs(l.dependencies))?($e||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(w,Ke,we),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(w,Ke,we)),typeof I.componentDidUpdate=="function"&&(p.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof I.componentDidUpdate!="function"||X===l.memoizedProps&&Ze===l.memoizedState||(p.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||X===l.memoizedProps&&Ze===l.memoizedState||(p.flags|=1024),p.memoizedProps=w,p.memoizedState=Ke),I.props=w,I.state=Ke,I.context=we,w=ct):(typeof I.componentDidUpdate!="function"||X===l.memoizedProps&&Ze===l.memoizedState||(p.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||X===l.memoizedProps&&Ze===l.memoizedState||(p.flags|=1024),w=!1)}return I=w,gp(l,p),w=(p.flags&128)!==0,I||w?(I=p.stateNode,y=w&&typeof y.getDerivedStateFromError!="function"?null:I.render(),p.flags|=1,l!==null&&w?(p.child=Do(p,l.child,null,E),p.child=Do(p,null,y,E)):en(l,p,y,E),p.memoizedState=I.state,l=p.child):l=ca(l,p,E),l}function _p(l,p,y,w){return El(),p.flags|=256,en(l,p,y,w),p.child}var bp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vl(l){return{baseLanes:l,cachePool:td()}}function Ru(l,p,y){return l=l!==null?l.childLanes&~y:0,p&&(l|=pr),l}function Fy(l,p,y){var w=p.pendingProps,E=!1,I=(p.flags&128)!==0,X;if((X=I)||(X=l!==null&&l.memoizedState===null?!1:(us.current&2)!==0),X&&(E=!0,p.flags&=-129),X=(p.flags&32)!==0,p.flags&=-33,l===null){if(Pi){if(E?Mc(p):Cc(),Pi){var ie=yn,we;if(we=ie){e:{for(we=ie,ie=Ls;we.nodeType!==8;){if(!ie){ie=null;break e}if(we=da(we.nextSibling),we===null){ie=null;break e}}ie=we}ie!==null?(p.memoizedState={dehydrated:ie,treeContext:So!==null?{id:cr,overflow:xr}:null,retryLane:536870912,hydrationErrors:null},we=vs(18,null,null,0),we.stateNode=ie,we.return=p,p.child=we,on=p,yn=null,we=!0):we=!1}we||ea(p)}if(ie=p.memoizedState,ie!==null&&(ie=ie.dehydrated,ie!==null))return Hp(ie)?p.lanes=32:p.lanes=536870912,null;la(p)}return ie=w.children,w=w.fallback,E?(Cc(),E=p.mode,ie=vp({mode:"hidden",children:ie},E),w=wo(w,E,y,null),ie.return=p,w.return=p,ie.sibling=w,p.child=ie,E=p.child,E.memoizedState=Vl(y),E.childLanes=Ru(l,X,y),p.memoizedState=bp,w):(Mc(p),Jm(p,ie))}if(we=l.memoizedState,we!==null&&(ie=we.dehydrated,ie!==null)){if(I)p.flags&256?(Mc(p),p.flags&=-257,p=eg(l,p,y)):p.memoizedState!==null?(Cc(),p.child=l.child,p.flags|=128,p=null):(Cc(),E=w.fallback,ie=p.mode,w=vp({mode:"visible",children:w.children},ie),E=wo(E,ie,y,null),E.flags|=2,w.return=p,E.return=p,w.sibling=E,p.child=w,Do(p,l.child,null,y),w=p.child,w.memoizedState=Vl(y),w.childLanes=Ru(l,X,y),p.memoizedState=bp,p=E);else if(Mc(p),Hp(ie)){if(X=ie.nextSibling&&ie.nextSibling.dataset,X)var $e=X.dgst;X=$e,w=Error(n(419)),w.stack="",w.digest=X,Xs({value:w,source:null,stack:null}),p=eg(l,p,y)}else if(Zn||Vr(l,p,y,!1),X=(y&l.childLanes)!==0,Zn||X){if(X=fn,X!==null&&(w=y&-y,w=(w&42)!==0?1:Re(w),w=(w&(X.suspendedLanes|y))!==0?0:w,w!==0&&w!==we.retryLane))throw we.retryLane=w,gc(l,w),Ws(X,l,w),pp;ie.data==="$?"||xd(),p=eg(l,p,y)}else ie.data==="$?"?(p.flags|=192,p.child=l.child,p=null):(l=we.treeContext,yn=da(ie.nextSibling),on=p,Pi=!0,Jo=null,Ls=!1,l!==null&&($s[lr++]=cr,$s[lr++]=xr,$s[lr++]=So,cr=l.id,xr=l.overflow,So=p),p=Jm(p,w.children),p.flags|=4096);return p}return E?(Cc(),E=w.fallback,ie=p.mode,we=l.child,$e=we.sibling,w=to(we,{mode:"hidden",children:w.children}),w.subtreeFlags=we.subtreeFlags&65011712,$e!==null?E=to($e,E):(E=wo(E,ie,y,null),E.flags|=2),E.return=p,w.return=p,w.sibling=E,p.child=w,w=E,E=p.child,ie=l.child.memoizedState,ie===null?ie=Vl(y):(we=ie.cachePool,we!==null?($e=ts._currentValue,we=we.parent!==$e?{parent:$e,pool:$e}:we):we=td(),ie={baseLanes:ie.baseLanes|y,cachePool:we}),E.memoizedState=ie,E.childLanes=Ru(l,X,y),p.memoizedState=bp,w):(Mc(p),y=l.child,l=y.sibling,y=to(y,{mode:"visible",children:w.children}),y.return=p,y.sibling=null,l!==null&&(X=p.deletions,X===null?(p.deletions=[l],p.flags|=16):X.push(l)),p.child=y,p.memoizedState=null,y)}function Jm(l,p){return p=vp({mode:"visible",children:p},l.mode),p.return=l,l.child=p}function vp(l,p){return l=vs(22,l,null,p),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function eg(l,p,y){return Do(p,l.child,null,y),l=Jm(p,p.pendingProps.children),l.flags|=2,p.memoizedState=null,l}function jy(l,p,y){l.lanes|=p;var w=l.alternate;w!==null&&(w.lanes|=p),Oh(l.return,p,y)}function tg(l,p,y,w,E){var I=l.memoizedState;I===null?l.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:w,tail:y,tailMode:E}:(I.isBackwards=p,I.rendering=null,I.renderingStartTime=0,I.last=w,I.tail=y,I.tailMode=E)}function Vy(l,p,y){var w=p.pendingProps,E=w.revealOrder,I=w.tail;if(en(l,p,w.children,y),w=us.current,(w&2)!==0)w=w&1|2,p.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=p.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&jy(l,y,p);else if(l.tag===19)jy(l,y,p);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===p)break e;for(;l.sibling===null;){if(l.return===null||l.return===p)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}w&=1}switch(Tt(us,w),E){case"forwards":for(y=p.child,E=null;y!==null;)l=y.alternate,l!==null&&ad(l)===null&&(E=y),y=y.sibling;y=E,y===null?(E=p.child,p.child=null):(E=y.sibling,y.sibling=null),tg(p,!1,E,y,I);break;case"backwards":for(y=null,E=p.child,p.child=null;E!==null;){if(l=E.alternate,l!==null&&ad(l)===null){p.child=E;break}l=E.sibling,E.sibling=y,y=E,E=l}tg(p,!0,y,null,I);break;case"together":tg(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function ca(l,p,y){if(l!==null&&(p.dependencies=l.dependencies),$l|=p.lanes,(y&p.childLanes)===0)if(l!==null){if(Vr(l,p,y,!1),(y&p.childLanes)===0)return null}else return null;if(l!==null&&p.child!==l.child)throw Error(n(153));if(p.child!==null){for(l=p.child,y=to(l,l.pendingProps),p.child=y,y.return=p;l.sibling!==null;)l=l.sibling,y=y.sibling=to(l,l.pendingProps),y.return=p;y.sibling=null}return p.child}function ig(l,p){return(l.lanes&p)!==0?!0:(l=l.dependencies,!!(l!==null&&xs(l)))}function Uy(l,p,y){switch(p.tag){case 3:Ni(p,p.stateNode.containerInfo),ta(p,ts,l.memoizedState.cache),El();break;case 27:case 5:dl(p);break;case 4:Ni(p,p.stateNode.containerInfo);break;case 10:ta(p,p.type,p.memoizedProps.value);break;case 13:var w=p.memoizedState;if(w!==null)return w.dehydrated!==null?(Mc(p),p.flags|=128,null):(y&p.child.childLanes)!==0?Fy(l,p,y):(Mc(p),l=ca(l,p,y),l!==null?l.sibling:null);Mc(p);break;case 19:var E=(l.flags&128)!==0;if(w=(y&p.childLanes)!==0,w||(Vr(l,p,y,!1),w=(y&p.childLanes)!==0),E){if(w)return Vy(l,p,y);p.flags|=128}if(E=p.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Tt(us,us.current),w)break;return null;case 22:case 23:return p.lanes=0,Km(l,p,y);case 24:ta(p,ts,l.memoizedState.cache)}return ca(l,p,y)}function jh(l,p,y){if(l!==null)if(l.memoizedProps!==p.pendingProps)Zn=!0;else{if(!ig(l,y)&&(p.flags&128)===0)return Zn=!1,Uy(l,p,y);Zn=(l.flags&131072)!==0}else Zn=!1,Pi&&(p.flags&1048576)!==0&&Yf(p,ja,p.index);switch(p.lanes=0,p.tag){case 16:e:{l=p.pendingProps;var w=p.elementType,E=w._init;if(w=E(w._payload),p.type=w,typeof w=="function")vu(w)?(l=Wa(w,l),p.tag=1,p=yp(null,p,w,l,y)):(p.tag=0,p=Ym(null,p,w,l,y));else{if(w!=null){if(E=w.$$typeof,E===ze){p.tag=11,p=Wm(null,p,w,l,y);break e}else if(E===Fe){p.tag=14,p=mp(null,p,w,l,y);break e}}throw p=Ft(w)||w,Error(n(306,p,""))}}return p;case 0:return Ym(l,p,p.type,p.pendingProps,y);case 1:return w=p.type,E=Wa(w,p.pendingProps),yp(l,p,w,E,y);case 3:e:{if(Ni(p,p.stateNode.containerInfo),l===null)throw Error(n(387));w=p.pendingProps;var I=p.memoizedState;E=I.element,Rl(l,p),Za(p,w,null,y);var X=p.memoizedState;if(w=X.cache,ta(p,ts,w),w!==I.cache&&Ua(p,[ts],y,!0),ur(),w=X.element,I.isDehydrated)if(I={element:w,isDehydrated:!1,cache:X.cache},p.updateQueue.baseState=I,p.memoizedState=I,p.flags&256){p=_p(l,p,w,y);break e}else if(w!==E){E=ar(Error(n(424)),p),Xs(E),p=_p(l,p,w,y);break e}else{switch(l=p.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(yn=da(l.firstChild),on=p,Pi=!0,Jo=null,Ls=!0,y=Nh(p,null,w,y),p.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(El(),w===E){p=ca(l,p,y);break e}en(l,p,w,y)}p=p.child}return p;case 26:return gp(l,p),l===null?(y=T(p.type,null,p.pendingProps,null))?p.memoizedState=y:Pi||(y=p.type,l=p.pendingProps,w=$u(Nt.current).createElement(y),w[Xt]=p,w[We]=l,Ks(w,y,l),En(w),p.stateNode=w):p.memoizedState=T(p.type,l.memoizedProps,p.pendingProps,l.memoizedState),null;case 27:return dl(p),l===null&&Pi&&(w=p.stateNode=$p(p.type,p.pendingProps,Nt.current),on=p,Ls=!0,E=yn,il(p.type)?(Zp=E,yn=da(w.firstChild)):yn=E),en(l,p,p.pendingProps.children,y),gp(l,p),l===null&&(p.flags|=4194304),p.child;case 5:return l===null&&Pi&&((E=w=yn)&&(w=Og(w,p.type,p.pendingProps,Ls),w!==null?(p.stateNode=w,on=p,yn=da(w.firstChild),Ls=!1,E=!0):E=!1),E||ea(p)),dl(p),E=p.type,I=p.pendingProps,X=l!==null?l.memoizedProps:null,w=I.children,ef(E,I)?w=null:X!==null&&ef(E,X)&&(p.flags|=32),p.memoizedState!==null&&(E=Eu(l,p,sd,null,null,y),bt._currentValue=E),gp(l,p),en(l,p,w,y),p.child;case 6:return l===null&&Pi&&((l=y=yn)&&(y=Tb(y,p.pendingProps,Ls),y!==null?(p.stateNode=y,on=p,yn=null,l=!0):l=!1),l||ea(p)),null;case 13:return Fy(l,p,y);case 4:return Ni(p,p.stateNode.containerInfo),w=p.pendingProps,l===null?p.child=Do(p,null,w,y):en(l,p,w,y),p.child;case 11:return Wm(l,p,p.type,p.pendingProps,y);case 7:return en(l,p,p.pendingProps,y),p.child;case 8:return en(l,p,p.pendingProps.children,y),p.child;case 12:return en(l,p,p.pendingProps.children,y),p.child;case 10:return w=p.pendingProps,ta(p,p.type,w.value),en(l,p,w.children,y),p.child;case 9:return E=p.type._context,w=p.pendingProps.children,zn(p),E=an(E),w=w(E),p.flags|=1,en(l,p,w,y),p.child;case 14:return mp(l,p,p.type,p.pendingProps,y);case 15:return Ly(l,p,p.type,p.pendingProps,y);case 19:return Vy(l,p,y);case 31:return w=p.pendingProps,y=p.mode,w={mode:w.mode,children:w.children},l===null?(y=vp(w,y),y.ref=p.ref,p.child=y,y.return=p,p=y):(y=to(l.child,w),y.ref=p.ref,p.child=y,y.return=p,p=y),p;case 22:return Km(l,p,y);case 24:return zn(p),w=an(ts),l===null?(E=di(),E===null&&(E=fn,I=wu(),E.pooledCache=I,I.refCount++,I!==null&&(E.pooledCacheLanes|=y),E=I),p.memoizedState={parent:w,cache:E},Hi(p),ta(p,ts,E)):((l.lanes&y)!==0&&(Rl(l,p),Za(p,null,null,y),ur()),E=l.memoizedState,I=p.memoizedState,E.parent!==w?(E={parent:w,cache:w},p.memoizedState=E,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=E),ta(p,ts,w)):(w=I.cache,ta(p,ts,w),w!==E.cache&&Ua(p,[ts],y,!0))),en(l,p,p.pendingProps.children,y),p.child;case 29:throw p.pendingProps}throw Error(n(156,p.tag))}function Ul(l){l.flags|=4}function Pn(l,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!G(p)){if(p=hr.current,p!==null&&((Di&4194048)===Di?aa!==null:(Di&62914560)!==Di&&(Di&536870912)===0||p!==aa))throw Dl=Rh,Dh;l.flags|=8192}}function ql(l,p){p!==null&&(l.flags|=4),l.flags&16384&&(p=l.tag!==22?ne():536870912,l.lanes|=p,Nu|=p)}function Vh(l,p){if(!Pi)switch(l.tailMode){case"hidden":p=l.tail;for(var y=null;p!==null;)p.alternate!==null&&(y=p),p=p.sibling;y===null?l.tail=null:y.sibling=null;break;case"collapsed":y=l.tail;for(var w=null;y!==null;)y.alternate!==null&&(w=y),y=y.sibling;w===null?p||l.tail===null?l.tail=null:l.tail.sibling=null:w.sibling=null}}function bn(l){var p=l.alternate!==null&&l.alternate.child===l.child,y=0,w=0;if(p)for(var E=l.child;E!==null;)y|=E.lanes|E.childLanes,w|=E.subtreeFlags&65011712,w|=E.flags&65011712,E.return=l,E=E.sibling;else for(E=l.child;E!==null;)y|=E.lanes|E.childLanes,w|=E.subtreeFlags,w|=E.flags,E.return=l,E=E.sibling;return l.subtreeFlags|=w,l.childLanes=y,p}function xp(l,p,y){var w=p.pendingProps;switch(Yo(p),p.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bn(p),null;case 1:return bn(p),null;case 3:return y=p.stateNode,w=null,l!==null&&(w=l.memoizedState.cache),p.memoizedState.cache!==w&&(p.flags|=2048),Ao(ts),ms(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(l===null||l.child===null)&&(vc(p)?Ul(p):l===null||l.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Eh())),bn(p),null;case 26:return y=p.memoizedState,l===null?(Ul(p),y!==null?(bn(p),Pn(p,y)):(bn(p),p.flags&=-16777217)):y?y!==l.memoizedState?(Ul(p),bn(p),Pn(p,y)):(bn(p),p.flags&=-16777217):(l.memoizedProps!==w&&Ul(p),bn(p),p.flags&=-16777217),null;case 27:Es(p),y=Nt.current;var E=p.type;if(l!==null&&p.stateNode!=null)l.memoizedProps!==w&&Ul(p);else{if(!w){if(p.stateNode===null)throw Error(n(166));return bn(p),null}l=Rt.current,vc(p)?Ah(p):(l=$p(E,w,y),p.stateNode=l,Ul(p))}return bn(p),null;case 5:if(Es(p),y=p.type,l!==null&&p.stateNode!=null)l.memoizedProps!==w&&Ul(p);else{if(!w){if(p.stateNode===null)throw Error(n(166));return bn(p),null}if(l=Rt.current,vc(p))Ah(p);else{switch(E=$u(Nt.current),l){case 1:l=E.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:l=E.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":l=E.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":l=E.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":l=E.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof w.is=="string"?E.createElement("select",{is:w.is}):E.createElement("select"),w.multiple?l.multiple=!0:w.size&&(l.size=w.size);break;default:l=typeof w.is=="string"?E.createElement(y,{is:w.is}):E.createElement(y)}}l[Xt]=p,l[We]=w;e:for(E=p.child;E!==null;){if(E.tag===5||E.tag===6)l.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===p)break e;for(;E.sibling===null;){if(E.return===null||E.return===p)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}p.stateNode=l;e:switch(Ks(l,y,w),y){case"button":case"input":case"select":case"textarea":l=!!w.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&Ul(p)}}return bn(p),p.flags&=-16777217,null;case 6:if(l&&p.stateNode!=null)l.memoizedProps!==w&&Ul(p);else{if(typeof w!="string"&&p.stateNode===null)throw Error(n(166));if(l=Nt.current,vc(p)){if(l=p.stateNode,y=p.memoizedProps,w=null,E=on,E!==null)switch(E.tag){case 27:case 5:w=E.memoizedProps}l[Xt]=p,l=!!(l.nodeValue===y||w!==null&&w.suppressHydrationWarning===!0||Ag(l.nodeValue,y)),l||ea(p)}else l=$u(l).createTextNode(w),l[Xt]=p,p.stateNode=l}return bn(p),null;case 13:if(w=p.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(E=vc(p),w!==null&&w.dehydrated!==null){if(l===null){if(!E)throw Error(n(318));if(E=p.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(n(317));E[Xt]=p}else El(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;bn(p),E=!1}else E=Eh(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=E),E=!0;if(!E)return p.flags&256?(la(p),p):(la(p),null)}if(la(p),(p.flags&128)!==0)return p.lanes=y,p;if(y=w!==null,l=l!==null&&l.memoizedState!==null,y){w=p.child,E=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(E=w.alternate.memoizedState.cachePool.pool);var I=null;w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(I=w.memoizedState.cachePool.pool),I!==E&&(w.flags|=2048)}return y!==l&&y&&(p.child.flags|=8192),ql(p,p.updateQueue),bn(p),null;case 4:return ms(),l===null&&jp(p.stateNode.containerInfo),bn(p),null;case 10:return Ao(p.type),bn(p),null;case 19:if(xt(us),E=p.memoizedState,E===null)return bn(p),null;if(w=(p.flags&128)!==0,I=E.rendering,I===null)if(w)Vh(E,!1);else{if($n!==0||l!==null&&(l.flags&128)!==0)for(l=p.child;l!==null;){if(I=ad(l),I!==null){for(p.flags|=128,Vh(E,!1),l=I.updateQueue,p.updateQueue=l,ql(p,l),p.subtreeFlags=0,l=y,y=p.child;y!==null;)Kf(y,l),y=y.sibling;return Tt(us,us.current&1|2),p.child}l=l.sibling}E.tail!==null&&Rn()>Ap&&(p.flags|=128,w=!0,Vh(E,!1),p.lanes=4194304)}else{if(!w)if(l=ad(I),l!==null){if(p.flags|=128,w=!0,l=l.updateQueue,p.updateQueue=l,ql(p,l),Vh(E,!0),E.tail===null&&E.tailMode==="hidden"&&!I.alternate&&!Pi)return bn(p),null}else 2*Rn()-E.renderingStartTime>Ap&&y!==536870912&&(p.flags|=128,w=!0,Vh(E,!1),p.lanes=4194304);E.isBackwards?(I.sibling=p.child,p.child=I):(l=E.last,l!==null?l.sibling=I:p.child=I,E.last=I)}return E.tail!==null?(p=E.tail,E.rendering=p,E.tail=p.sibling,E.renderingStartTime=Rn(),p.sibling=null,l=us.current,Tt(us,w?l&1|2:l&1),p):(bn(p),null);case 22:case 23:return la(p),Lh(),w=p.memoizedState!==null,l!==null?l.memoizedState!==null!==w&&(p.flags|=8192):w&&(p.flags|=8192),w?(y&536870912)!==0&&(p.flags&128)===0&&(bn(p),p.subtreeFlags&6&&(p.flags|=8192)):bn(p),y=p.updateQueue,y!==null&&ql(p,y.retryQueue),y=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(y=l.memoizedState.cachePool.pool),w=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(w=p.memoizedState.cachePool.pool),w!==y&&(p.flags|=2048),l!==null&&xt(so),null;case 24:return y=null,l!==null&&(y=l.memoizedState.cache),p.memoizedState.cache!==y&&(p.flags|=2048),Ao(ts),bn(p),null;case 25:return null;case 30:return null}throw Error(n(156,p.tag))}function hd(l,p){switch(Yo(p),p.tag){case 1:return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 3:return Ao(ts),ms(),l=p.flags,(l&65536)!==0&&(l&128)===0?(p.flags=l&-65537|128,p):null;case 26:case 27:case 5:return Es(p),null;case 13:if(la(p),l=p.memoizedState,l!==null&&l.dehydrated!==null){if(p.alternate===null)throw Error(n(340));El()}return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 19:return xt(us),null;case 4:return ms(),null;case 10:return Ao(p.type),null;case 22:case 23:return la(p),Lh(),l!==null&&xt(so),l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 24:return Ao(ts),null;case 25:return null;default:return null}}function ng(l,p){switch(Yo(p),p.tag){case 3:Ao(ts),ms();break;case 26:case 27:case 5:Es(p);break;case 4:ms();break;case 13:la(p);break;case 19:xt(us);break;case 10:Ao(p.type);break;case 22:case 23:la(p),Lh(),l!==null&&xt(so);break;case 24:Ao(ts)}}function Uh(l,p){try{var y=p.updateQueue,w=y!==null?y.lastEffect:null;if(w!==null){var E=w.next;y=E;do{if((y.tag&l)===l){w=void 0;var I=y.create,X=y.inst;w=I(),X.destroy=w}y=y.next}while(y!==E)}}catch(ie){$i(p,p.return,ie)}}function Ro(l,p,y){try{var w=p.updateQueue,E=w!==null?w.lastEffect:null;if(E!==null){var I=E.next;w=I;do{if((w.tag&l)===l){var X=w.inst,ie=X.destroy;if(ie!==void 0){X.destroy=void 0,E=p;var we=y,$e=ie;try{$e()}catch(ct){$i(E,we,ct)}}}w=w.next}while(w!==I)}}catch(ct){$i(p,p.return,ct)}}function wp(l){var p=l.updateQueue;if(p!==null){var y=l.stateNode;try{Yt(p,y)}catch(w){$i(l,l.return,w)}}}function Iu(l,p,y){y.props=Wa(l.type,l.memoizedProps),y.state=l.memoizedState;try{y.componentWillUnmount()}catch(w){$i(l,p,w)}}function Ac(l,p){try{var y=l.ref;if(y!==null){switch(l.tag){case 26:case 27:case 5:var w=l.stateNode;break;case 30:w=l.stateNode;break;default:w=l.stateNode}typeof y=="function"?l.refCleanup=y(w):y.current=w}}catch(E){$i(l,p,E)}}function Cr(l,p){var y=l.ref,w=l.refCleanup;if(y!==null)if(typeof w=="function")try{w()}catch(E){$i(l,p,E)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(E){$i(l,p,E)}else y.current=null}function qh(l){var p=l.type,y=l.memoizedProps,w=l.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":y.autoFocus&&w.focus();break e;case"img":y.src?w.src=y.src:y.srcSet&&(w.srcset=y.srcSet)}}catch(E){$i(l,l.return,E)}}function sg(l,p,y){try{var w=l.stateNode;d_(w,l.type,y,p),w[We]=p}catch(E){$i(l,l.return,E)}}function rg(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&il(l.type)||l.tag===4}function Hl(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||rg(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&il(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function og(l,p,y){var w=l.tag;if(w===5||w===6)l=l.stateNode,p?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(l,p):(p=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,p.appendChild(l),y=y._reactRootContainer,y!=null||p.onclick!==null||(p.onclick=Cd));else if(w!==4&&(w===27&&il(l.type)&&(y=l.stateNode,p=null),l=l.child,l!==null))for(og(l,p,y),l=l.sibling;l!==null;)og(l,p,y),l=l.sibling}function fd(l,p,y){var w=l.tag;if(w===5||w===6)l=l.stateNode,p?y.insertBefore(l,p):y.appendChild(l);else if(w!==4&&(w===27&&il(l.type)&&(y=l.stateNode),l=l.child,l!==null))for(fd(l,p,y),l=l.sibling;l!==null;)fd(l,p,y),l=l.sibling}function Hh(l){var p=l.stateNode,y=l.memoizedProps;try{for(var w=l.type,E=p.attributes;E.length;)p.removeAttributeNode(E[0]);Ks(p,w,y),p[Xt]=l,p[We]=y}catch(I){$i(l,l.return,I)}}var ua=!1,Gn=!1,Sp=!1,qy=typeof WeakSet=="function"?WeakSet:Set,Fs=null;function gb(l,p){if(l=l.containerInfo,Gu=On,l=ap(l),Zf(l)){if("selectionStart"in l)var y={start:l.selectionStart,end:l.selectionEnd};else e:{y=(y=l.ownerDocument)&&y.defaultView||window;var w=y.getSelection&&y.getSelection();if(w&&w.rangeCount!==0){y=w.anchorNode;var E=w.anchorOffset,I=w.focusNode;w=w.focusOffset;try{y.nodeType,I.nodeType}catch{y=null;break e}var X=0,ie=-1,we=-1,$e=0,ct=0,pt=l,Ze=null;t:for(;;){for(var Ke;pt!==y||E!==0&&pt.nodeType!==3||(ie=X+E),pt!==I||w!==0&&pt.nodeType!==3||(we=X+w),pt.nodeType===3&&(X+=pt.nodeValue.length),(Ke=pt.firstChild)!==null;)Ze=pt,pt=Ke;for(;;){if(pt===l)break t;if(Ze===y&&++$e===E&&(ie=X),Ze===I&&++ct===w&&(we=X),(Ke=pt.nextSibling)!==null)break;pt=Ze,Ze=pt.parentNode}pt=Ke}y=ie===-1||we===-1?null:{start:ie,end:we}}else y=null}y=y||{start:0,end:0}}else y=null;for(Up={focusedElem:l,selectionRange:y},On=!1,Fs=p;Fs!==null;)if(p=Fs,l=p.child,(p.subtreeFlags&1024)!==0&&l!==null)l.return=p,Fs=l;else for(;Fs!==null;){switch(p=Fs,I=p.alternate,l=p.flags,p.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&I!==null){l=void 0,y=p,E=I.memoizedProps,I=I.memoizedState,w=y.stateNode;try{var oi=Wa(y.type,E,y.elementType===y.type);l=w.getSnapshotBeforeUpdate(oi,I),w.__reactInternalSnapshotBeforeUpdate=l}catch(si){$i(y,y.return,si)}}break;case 3:if((l&1024)!==0){if(l=p.stateNode.containerInfo,y=l.nodeType,y===9)qp(l);else if(y===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":qp(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(n(163))}if(l=p.sibling,l!==null){l.return=p.return,Fs=l;break}Fs=p.return}}function Hy(l,p,y){var w=y.flags;switch(y.tag){case 0:case 11:case 15:kc(l,y),w&4&&Uh(5,y);break;case 1:if(kc(l,y),w&4)if(l=y.stateNode,p===null)try{l.componentDidMount()}catch(X){$i(y,y.return,X)}else{var E=Wa(y.type,p.memoizedProps);p=p.memoizedState;try{l.componentDidUpdate(E,p,l.__reactInternalSnapshotBeforeUpdate)}catch(X){$i(y,y.return,X)}}w&64&&wp(y),w&512&&Ac(y,y.return);break;case 3:if(kc(l,y),w&64&&(l=y.updateQueue,l!==null)){if(p=null,y.child!==null)switch(y.child.tag){case 27:case 5:p=y.child.stateNode;break;case 1:p=y.child.stateNode}try{Yt(l,p)}catch(X){$i(y,y.return,X)}}break;case 27:p===null&&w&4&&Hh(y);case 26:case 5:kc(l,y),p===null&&w&4&&qh(y),w&512&&Ac(y,y.return);break;case 12:kc(l,y);break;case 13:kc(l,y),w&4&&Tp(l,y),w&64&&(l=y.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(y=vg.bind(null,y),m_(l,y))));break;case 22:if(w=y.memoizedState!==null||ua,!w){p=p!==null&&p.memoizedState!==null||Gn,E=ua;var I=Gn;ua=w,(Gn=p)&&!I?zo(l,y,(y.subtreeFlags&8772)!==0):kc(l,y),ua=E,Gn=I}break;case 30:break;default:kc(l,y)}}function Zy(l){var p=l.alternate;p!==null&&(l.alternate=null,Zy(p)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(p=l.stateNode,p!==null&&Qt(p)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var vn=null,Ar=!1;function ha(l,p,y){for(y=y.child;y!==null;)ag(l,p,y),y=y.sibling}function ag(l,p,y){if(Kn&&typeof Kn.onCommitFiberUnmount=="function")try{Kn.onCommitFiberUnmount(_o,y)}catch{}switch(y.tag){case 26:Gn||Cr(y,p),ha(l,p,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:Gn||Cr(y,p);var w=vn,E=Ar;il(y.type)&&(vn=y.stateNode,Ar=!1),ha(l,p,y),nf(y.stateNode),vn=w,Ar=E;break;case 5:Gn||Cr(y,p);case 6:if(w=vn,E=Ar,vn=null,ha(l,p,y),vn=w,Ar=E,vn!==null)if(Ar)try{(vn.nodeType===9?vn.body:vn.nodeName==="HTML"?vn.ownerDocument.body:vn).removeChild(y.stateNode)}catch(I){$i(y,p,I)}else try{vn.removeChild(y.stateNode)}catch(I){$i(y,p,I)}break;case 18:vn!==null&&(Ar?(l=vn,Pg(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,y.stateNode),sl(l)):Pg(vn,y.stateNode));break;case 4:w=vn,E=Ar,vn=y.stateNode.containerInfo,Ar=!0,ha(l,p,y),vn=w,Ar=E;break;case 0:case 11:case 14:case 15:Gn||Ro(2,y,p),Gn||Ro(4,y,p),ha(l,p,y);break;case 1:Gn||(Cr(y,p),w=y.stateNode,typeof w.componentWillUnmount=="function"&&Iu(y,p,w)),ha(l,p,y);break;case 21:ha(l,p,y);break;case 22:Gn=(w=Gn)||y.memoizedState!==null,ha(l,p,y),Gn=w;break;default:ha(l,p,y)}}function Tp(l,p){if(p.memoizedState===null&&(l=p.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{sl(l)}catch(y){$i(p,p.return,y)}}function Gy(l){switch(l.tag){case 13:case 19:var p=l.stateNode;return p===null&&(p=l.stateNode=new qy),p;case 22:return l=l.stateNode,p=l._retryCache,p===null&&(p=l._retryCache=new qy),p;default:throw Error(n(435,l.tag))}}function Mp(l,p){var y=Gy(l);p.forEach(function(w){var E=Kh.bind(null,l,w);y.has(w)||(y.add(w),w.then(E,E))})}function fr(l,p){var y=p.deletions;if(y!==null)for(var w=0;w<y.length;w++){var E=y[w],I=l,X=p,ie=X;e:for(;ie!==null;){switch(ie.tag){case 27:if(il(ie.type)){vn=ie.stateNode,Ar=!1;break e}break;case 5:vn=ie.stateNode,Ar=!1;break e;case 3:case 4:vn=ie.stateNode.containerInfo,Ar=!0;break e}ie=ie.return}if(vn===null)throw Error(n(160));ag(I,X,E),vn=null,Ar=!1,I=E.alternate,I!==null&&(I.return=null),E.return=null}if(p.subtreeFlags&13878)for(p=p.child;p!==null;)lg(p,l),p=p.sibling}var Io=null;function lg(l,p){var y=l.alternate,w=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:fr(p,l),qr(l),w&4&&(Ro(3,l,l.return),Uh(3,l),Ro(5,l,l.return));break;case 1:fr(p,l),qr(l),w&512&&(Gn||y===null||Cr(y,y.return)),w&64&&ua&&(l=l.updateQueue,l!==null&&(w=l.callbacks,w!==null&&(y=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=y===null?w:y.concat(w))));break;case 26:var E=Io;if(fr(p,l),qr(l),w&512&&(Gn||y===null||Cr(y,y.return)),w&4){var I=y!==null?y.memoizedState:null;if(w=l.memoizedState,y===null)if(w===null)if(l.stateNode===null){e:{w=l.type,y=l.memoizedProps,E=E.ownerDocument||E;t:switch(w){case"title":I=E.getElementsByTagName("title")[0],(!I||I[kt]||I[Xt]||I.namespaceURI==="http://www.w3.org/2000/svg"||I.hasAttribute("itemprop"))&&(I=E.createElement(w),E.head.insertBefore(I,E.querySelector("head > title"))),Ks(I,w,y),I[Xt]=l,En(I),w=I;break e;case"link":var X=fe("link","href",E).get(w+(y.href||""));if(X){for(var ie=0;ie<X.length;ie++)if(I=X[ie],I.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&I.getAttribute("rel")===(y.rel==null?null:y.rel)&&I.getAttribute("title")===(y.title==null?null:y.title)&&I.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){X.splice(ie,1);break t}}I=E.createElement(w),Ks(I,w,y),E.head.appendChild(I);break;case"meta":if(X=fe("meta","content",E).get(w+(y.content||""))){for(ie=0;ie<X.length;ie++)if(I=X[ie],I.getAttribute("content")===(y.content==null?null:""+y.content)&&I.getAttribute("name")===(y.name==null?null:y.name)&&I.getAttribute("property")===(y.property==null?null:y.property)&&I.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&I.getAttribute("charset")===(y.charSet==null?null:y.charSet)){X.splice(ie,1);break t}}I=E.createElement(w),Ks(I,w,y),E.head.appendChild(I);break;default:throw Error(n(468,w))}I[Xt]=l,En(I),w=I}l.stateNode=w}else Ae(E,l.type,l.stateNode);else l.stateNode=Z(E,w,l.memoizedProps);else I!==w?(I===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):I.count--,w===null?Ae(E,l.type,l.stateNode):Z(E,w,l.memoizedProps)):w===null&&l.stateNode!==null&&sg(l,l.memoizedProps,y.memoizedProps)}break;case 27:fr(p,l),qr(l),w&512&&(Gn||y===null||Cr(y,y.return)),y!==null&&w&4&&sg(l,l.memoizedProps,y.memoizedProps);break;case 5:if(fr(p,l),qr(l),w&512&&(Gn||y===null||Cr(y,y.return)),l.flags&32){E=l.stateNode;try{Yr(E,"")}catch(Ke){$i(l,l.return,Ke)}}w&4&&l.stateNode!=null&&(E=l.memoizedProps,sg(l,E,y!==null?y.memoizedProps:E)),w&1024&&(Sp=!0);break;case 6:if(fr(p,l),qr(l),w&4){if(l.stateNode===null)throw Error(n(162));w=l.memoizedProps,y=l.stateNode;try{y.nodeValue=w}catch(Ke){$i(l,l.return,Ke)}}break;case 3:if(oe=null,E=Io,Io=kd(p.containerInfo),fr(p,l),Io=E,qr(l),w&4&&y!==null&&y.memoizedState.isDehydrated)try{sl(p.containerInfo)}catch(Ke){$i(l,l.return,Ke)}Sp&&(Sp=!1,Zh(l));break;case 4:w=Io,Io=kd(l.stateNode.containerInfo),fr(p,l),qr(l),Io=w;break;case 12:fr(p,l),qr(l);break;case 13:fr(p,l),qr(l),l.child.flags&8192&&l.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(yd=Rn()),w&4&&(w=l.updateQueue,w!==null&&(l.updateQueue=null,Mp(l,w)));break;case 22:E=l.memoizedState!==null;var we=y!==null&&y.memoizedState!==null,$e=ua,ct=Gn;if(ua=$e||E,Gn=ct||we,fr(p,l),Gn=ct,ua=$e,qr(l),w&8192)e:for(p=l.stateNode,p._visibility=E?p._visibility&-2:p._visibility|1,E&&(y===null||we||ua||Gn||Zl(l)),y=null,p=l;;){if(p.tag===5||p.tag===26){if(y===null){we=y=p;try{if(I=we.stateNode,E)X=I.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none";else{ie=we.stateNode;var pt=we.memoizedProps.style,Ze=pt!=null&&pt.hasOwnProperty("display")?pt.display:null;ie.style.display=Ze==null||typeof Ze=="boolean"?"":(""+Ze).trim()}}catch(Ke){$i(we,we.return,Ke)}}}else if(p.tag===6){if(y===null){we=p;try{we.stateNode.nodeValue=E?"":we.memoizedProps}catch(Ke){$i(we,we.return,Ke)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===l)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break e;for(;p.sibling===null;){if(p.return===null||p.return===l)break e;y===p&&(y=null),p=p.return}y===p&&(y=null),p.sibling.return=p.return,p=p.sibling}w&4&&(w=l.updateQueue,w!==null&&(y=w.retryQueue,y!==null&&(w.retryQueue=null,Mp(l,y))));break;case 19:fr(p,l),qr(l),w&4&&(w=l.updateQueue,w!==null&&(l.updateQueue=null,Mp(l,w)));break;case 30:break;case 21:break;default:fr(p,l),qr(l)}}function qr(l){var p=l.flags;if(p&2){try{for(var y,w=l.return;w!==null;){if(rg(w)){y=w;break}w=w.return}if(y==null)throw Error(n(160));switch(y.tag){case 27:var E=y.stateNode,I=Hl(l);fd(l,I,E);break;case 5:var X=y.stateNode;y.flags&32&&(Yr(X,""),y.flags&=-33);var ie=Hl(l);fd(l,ie,X);break;case 3:case 4:var we=y.stateNode.containerInfo,$e=Hl(l);og(l,$e,we);break;default:throw Error(n(161))}}catch(ct){$i(l,l.return,ct)}l.flags&=-3}p&4096&&(l.flags&=-4097)}function Zh(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var p=l;Zh(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),l=l.sibling}}function kc(l,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)Hy(l,p.alternate,p),p=p.sibling}function Zl(l){for(l=l.child;l!==null;){var p=l;switch(p.tag){case 0:case 11:case 14:case 15:Ro(4,p,p.return),Zl(p);break;case 1:Cr(p,p.return);var y=p.stateNode;typeof y.componentWillUnmount=="function"&&Iu(p,p.return,y),Zl(p);break;case 27:nf(p.stateNode);case 26:case 5:Cr(p,p.return),Zl(p);break;case 22:p.memoizedState===null&&Zl(p);break;case 30:Zl(p);break;default:Zl(p)}l=l.sibling}}function zo(l,p,y){for(y=y&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var w=p.alternate,E=l,I=p,X=I.flags;switch(I.tag){case 0:case 11:case 15:zo(E,I,y),Uh(4,I);break;case 1:if(zo(E,I,y),w=I,E=w.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch($e){$i(w,w.return,$e)}if(w=I,E=w.updateQueue,E!==null){var ie=w.stateNode;try{var we=E.shared.hiddenCallbacks;if(we!==null)for(E.shared.hiddenCallbacks=null,E=0;E<we.length;E++)jt(we[E],ie)}catch($e){$i(w,w.return,$e)}}y&&X&64&&wp(I),Ac(I,I.return);break;case 27:Hh(I);case 26:case 5:zo(E,I,y),y&&w===null&&X&4&&qh(I),Ac(I,I.return);break;case 12:zo(E,I,y);break;case 13:zo(E,I,y),y&&X&4&&Tp(E,I);break;case 22:I.memoizedState===null&&zo(E,I,y),Ac(I,I.return);break;case 30:break;default:zo(E,I,y)}p=p.sibling}}function dd(l,p){var y=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(y=l.memoizedState.cachePool.pool),l=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(l=p.memoizedState.cachePool.pool),l!==y&&(l!=null&&l.refCount++,y!=null&&xc(y))}function cg(l,p){l=null,p.alternate!==null&&(l=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==l&&(p.refCount++,l!=null&&xc(l))}function Ka(l,p,y,w){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)ug(l,p,y,w),p=p.sibling}function ug(l,p,y,w){var E=p.flags;switch(p.tag){case 0:case 11:case 15:Ka(l,p,y,w),E&2048&&Uh(9,p);break;case 1:Ka(l,p,y,w);break;case 3:Ka(l,p,y,w),E&2048&&(l=null,p.alternate!==null&&(l=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==l&&(p.refCount++,l!=null&&xc(l)));break;case 12:if(E&2048){Ka(l,p,y,w),l=p.stateNode;try{var I=p.memoizedProps,X=I.id,ie=I.onPostCommit;typeof ie=="function"&&ie(X,p.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(we){$i(p,p.return,we)}}else Ka(l,p,y,w);break;case 13:Ka(l,p,y,w);break;case 23:break;case 22:I=p.stateNode,X=p.alternate,p.memoizedState!==null?I._visibility&2?Ka(l,p,y,w):pd(l,p):I._visibility&2?Ka(l,p,y,w):(I._visibility|=2,zu(l,p,y,w,(p.subtreeFlags&10256)!==0)),E&2048&&dd(X,p);break;case 24:Ka(l,p,y,w),E&2048&&cg(p.alternate,p);break;default:Ka(l,p,y,w)}}function zu(l,p,y,w,E){for(E=E&&(p.subtreeFlags&10256)!==0,p=p.child;p!==null;){var I=l,X=p,ie=y,we=w,$e=X.flags;switch(X.tag){case 0:case 11:case 15:zu(I,X,ie,we,E),Uh(8,X);break;case 23:break;case 22:var ct=X.stateNode;X.memoizedState!==null?ct._visibility&2?zu(I,X,ie,we,E):pd(I,X):(ct._visibility|=2,zu(I,X,ie,we,E)),E&&$e&2048&&dd(X.alternate,X);break;case 24:zu(I,X,ie,we,E),E&&$e&2048&&cg(X.alternate,X);break;default:zu(I,X,ie,we,E)}p=p.sibling}}function pd(l,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var y=l,w=p,E=w.flags;switch(w.tag){case 22:pd(y,w),E&2048&&dd(w.alternate,w);break;case 24:pd(y,w),E&2048&&cg(w.alternate,w);break;default:pd(y,w)}p=p.sibling}}var md=8192;function Ya(l){if(l.subtreeFlags&md)for(l=l.child;l!==null;)hg(l),l=l.sibling}function hg(l){switch(l.tag){case 26:Ya(l),l.flags&md&&l.memoizedState!==null&&Ue(Io,l.memoizedState,l.memoizedProps);break;case 5:Ya(l);break;case 3:case 4:var p=Io;Io=kd(l.stateNode.containerInfo),Ya(l),Io=p;break;case 22:l.memoizedState===null&&(p=l.alternate,p!==null&&p.memoizedState!==null?(p=md,md=16777216,Ya(l),md=p):Ya(l));break;default:Ya(l)}}function $y(l){var p=l.alternate;if(p!==null&&(l=p.child,l!==null)){p.child=null;do p=l.sibling,l.sibling=null,l=p;while(l!==null)}}function gd(l){var p=l.deletions;if((l.flags&16)!==0){if(p!==null)for(var y=0;y<p.length;y++){var w=p[y];Fs=w,Qy(w,l)}$y(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)Xy(l),l=l.sibling}function Xy(l){switch(l.tag){case 0:case 11:case 15:gd(l),l.flags&2048&&Ro(9,l,l.return);break;case 3:gd(l);break;case 12:gd(l);break;case 22:var p=l.stateNode;l.memoizedState!==null&&p._visibility&2&&(l.return===null||l.return.tag!==13)?(p._visibility&=-3,Cp(l)):gd(l);break;default:gd(l)}}function Cp(l){var p=l.deletions;if((l.flags&16)!==0){if(p!==null)for(var y=0;y<p.length;y++){var w=p[y];Fs=w,Qy(w,l)}$y(l)}for(l=l.child;l!==null;){switch(p=l,p.tag){case 0:case 11:case 15:Ro(8,p,p.return),Cp(p);break;case 22:y=p.stateNode,y._visibility&2&&(y._visibility&=-3,Cp(p));break;default:Cp(p)}l=l.sibling}}function Qy(l,p){for(;Fs!==null;){var y=Fs;switch(y.tag){case 0:case 11:case 15:Ro(8,y,p);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var w=y.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:xc(y.memoizedState.cache)}if(w=y.child,w!==null)w.return=y,Fs=w;else e:for(y=l;Fs!==null;){w=Fs;var E=w.sibling,I=w.return;if(Zy(w),w===y){Fs=null;break e}if(E!==null){E.return=I,Fs=E;break e}Fs=I}}}var yb={getCacheForType:function(l){var p=an(ts),y=p.data.get(l);return y===void 0&&(y=l(),p.data.set(l,y)),y}},Wy=typeof WeakMap=="function"?WeakMap:Map,Ui=0,fn=null,Mi=null,Di=0,tn=0,dr=null,Ec=!1,Lu=!1,fg=!1,Gl=0,$n=0,$l=0,Bu=0,dg=0,pr=0,Nu=0,Fu=null,kr=null,Ln=!1,yd=0,Ap=1/0,_d=null,Ja=null,Ms=0,Pc=null,Gh=null,$h=0,pg=0,kp=null,mr=null,ju=0,Ep=null;function hs(){if((Ui&2)!==0&&Di!==0)return Di&-Di;if(Xe.T!==null){var l=At;return l!==0?l:tl()}return St()}function bd(){pr===0&&(pr=(Di&536870912)===0||Pi?ge():536870912);var l=hr.current;return l!==null&&(l.flags|=32),pr}function Ws(l,p,y){(l===fn&&(tn===2||tn===9)||l.cancelPendingCommit!==null)&&(Uu(l,0),Oc(l,Di,pr,!1)),Ve(l,y),((Ui&2)===0||l!==fn)&&(l===fn&&((Ui&2)===0&&(Bu|=y),$n===4&&Oc(l,Di,pr,!1)),el(l))}function Vu(l,p,y){if((Ui&6)!==0)throw Error(n(327));var w=!y&&(p&124)===0&&(p&l.expiredLanes)===0||te(l,p),E=w?Yy(l,p):wd(l,p,!0),I=w;do{if(E===0){Lu&&!w&&Oc(l,p,0,!1);break}else{if(y=l.current.alternate,I&&!Pp(y)){E=wd(l,p,!1),I=!1;continue}if(E===2){if(I=p,l.errorRecoveryDisabledLanes&I)var X=0;else X=l.pendingLanes&-536870913,X=X!==0?X:X&536870912?536870912:0;if(X!==0){p=X;e:{var ie=l;E=Fu;var we=ie.current.memoizedState.isDehydrated;if(we&&(Uu(ie,X).flags|=256),X=wd(ie,X,!1),X!==2){if(fg&&!we){ie.errorRecoveryDisabledLanes|=I,Bu|=I,E=4;break e}I=kr,kr=E,I!==null&&(kr===null?kr=I:kr.push.apply(kr,I))}E=X}if(I=!1,E!==2)continue}}if(E===1){Uu(l,0),Oc(l,p,0,!0);break}e:{switch(w=l,I=E,I){case 0:case 1:throw Error(n(345));case 4:if((p&4194048)!==p)break;case 6:Oc(w,p,pr,!Ec);break e;case 2:kr=null;break;case 3:case 5:break;default:throw Error(n(329))}if((p&62914560)===p&&(E=yd+300-Rn(),10<E)){if(Oc(w,p,pr,!Ec),ee(w,0,!0)!==0)break e;w.timeoutHandle=p_(vd.bind(null,w,y,kr,_d,Ln,p,pr,Bu,Nu,Ec,I,2,-0,0),E);break e}vd(w,y,kr,_d,Ln,p,pr,Bu,Nu,Ec,I,0,-0,0)}}break}while(!0);el(l)}function vd(l,p,y,w,E,I,X,ie,we,$e,ct,pt,Ze,Ke){if(l.timeoutHandle=-1,pt=p.subtreeFlags,(pt&8192||(pt&16785408)===16785408)&&(re={stylesheets:null,count:0,unsuspend:ye},hg(p),pt=ut(),pt!==null)){l.cancelPendingCommit=pt(_g.bind(null,l,p,I,y,w,E,X,ie,we,ct,1,Ze,Ke)),Oc(l,I,X,!$e);return}_g(l,p,I,y,w,E,X,ie,we)}function Pp(l){for(var p=l;;){var y=p.tag;if((y===0||y===11||y===15)&&p.flags&16384&&(y=p.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var w=0;w<y.length;w++){var E=y[w],I=E.getSnapshot;E=E.value;try{if(!Gs(I(),E))return!1}catch{return!1}}if(y=p.child,p.subtreeFlags&16384&&y!==null)y.return=p,p=y;else{if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Oc(l,p,y,w){p&=~dg,p&=~Bu,l.suspendedLanes|=p,l.pingedLanes&=~p,w&&(l.warmLanes|=p),w=l.expirationTimes;for(var E=p;0<E;){var I=31-Yn(E),X=1<<I;w[I]=-1,E&=~X}y!==0&&Qe(l,y,p)}function Op(){return(Ui&6)===0?(Yh(0),!1):!0}function Dp(){if(Mi!==null){if(tn===0)var l=Mi.return;else l=Mi,Co=Va=null,Pu(l),Nl=null,Fl=0,l=Mi;for(;l!==null;)ng(l.alternate,l),l=l.return;Mi=null}}function Uu(l,p){var y=l.timeoutHandle;y!==-1&&(l.timeoutHandle=-1,Sb(y)),y=l.cancelPendingCommit,y!==null&&(l.cancelPendingCommit=null,y()),Dp(),fn=l,Mi=y=to(l.current,null),Di=p,tn=0,dr=null,Ec=!1,Lu=te(l,p),fg=!1,Nu=pr=dg=Bu=$l=$n=0,kr=Fu=null,Ln=!1,(p&8)!==0&&(p|=p&32);var w=l.entangledLanes;if(w!==0)for(l=l.entanglements,w&=p;0<w;){var E=31-Yn(w),I=1<<E;p|=l[E],w&=~I}return Gl=p,Cl(),y}function Ky(l,p){ui=null,Xe.H=Gi,p===Ha||p===Tu?(p=nd(),tn=3):p===Dh?(p=nd(),tn=4):tn=p===pp?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,dr=p,Mi===null&&($n=1,ud(l,ar(p,l.current)))}function mg(){var l=Xe.H;return Xe.H=Gi,l===null?Gi:l}function gg(){var l=Xe.A;return Xe.A=yb,l}function xd(){$n=4,Ec||(Di&4194048)!==Di&&hr.current!==null||(Lu=!0),($l&134217727)===0&&(Bu&134217727)===0||fn===null||Oc(fn,Di,pr,!1)}function wd(l,p,y){var w=Ui;Ui|=2;var E=mg(),I=gg();(fn!==l||Di!==p)&&(_d=null,Uu(l,p)),p=!1;var X=$n;e:do try{if(tn!==0&&Mi!==null){var ie=Mi,we=dr;switch(tn){case 8:Dp(),X=6;break e;case 3:case 2:case 9:case 6:hr.current===null&&(p=!0);var $e=tn;if(tn=0,dr=null,Xh(l,ie,we,$e),y&&Lu){X=0;break e}break;default:$e=tn,tn=0,dr=null,Xh(l,ie,we,$e)}}_b(),X=$n;break}catch(ct){Ky(l,ct)}while(!0);return p&&l.shellSuspendCounter++,Co=Va=null,Ui=w,Xe.H=E,Xe.A=I,Mi===null&&(fn=null,Di=0,Cl()),X}function _b(){for(;Mi!==null;)Jy(Mi)}function Yy(l,p){var y=Ui;Ui|=2;var w=mg(),E=gg();fn!==l||Di!==p?(_d=null,Ap=Rn()+500,Uu(l,p)):Lu=te(l,p);e:do try{if(tn!==0&&Mi!==null){p=Mi;var I=dr;t:switch(tn){case 1:tn=0,dr=null,Xh(l,p,I,1);break;case 2:case 9:if(Mu(I)){tn=0,dr=null,e_(p);break}p=function(){tn!==2&&tn!==9||fn!==l||(tn=7),el(l)},I.then(p,p);break e;case 3:tn=7;break e;case 4:tn=5;break e;case 7:Mu(I)?(tn=0,dr=null,e_(p)):(tn=0,dr=null,Xh(l,p,I,7));break;case 5:var X=null;switch(Mi.tag){case 26:X=Mi.memoizedState;case 5:case 27:var ie=Mi;if(!X||G(X)){tn=0,dr=null;var we=ie.sibling;if(we!==null)Mi=we;else{var $e=ie.return;$e!==null?(Mi=$e,Rp($e)):Mi=null}break t}}tn=0,dr=null,Xh(l,p,I,5);break;case 6:tn=0,dr=null,Xh(l,p,I,6);break;case 8:Dp(),$n=6;break e;default:throw Error(n(462))}}bb();break}catch(ct){Ky(l,ct)}while(!0);return Co=Va=null,Xe.H=w,Xe.A=E,Ui=y,Mi!==null?0:(fn=null,Di=0,Cl(),$n)}function bb(){for(;Mi!==null&&!yo();)Jy(Mi)}function Jy(l){var p=jh(l.alternate,l,Gl);l.memoizedProps=l.pendingProps,p===null?Rp(l):Mi=p}function e_(l){var p=l,y=p.alternate;switch(p.tag){case 15:case 0:p=Ny(y,p,p.pendingProps,p.type,void 0,Di);break;case 11:p=Ny(y,p,p.pendingProps,p.type.render,p.ref,Di);break;case 5:Pu(p);default:ng(y,p),p=Mi=Kf(p,Gl),p=jh(y,p,Gl)}l.memoizedProps=l.pendingProps,p===null?Rp(l):Mi=p}function Xh(l,p,y,w){Co=Va=null,Pu(p),Nl=null,Fl=0;var E=p.return;try{if(zy(l,E,p,y,Di)){$n=1,ud(l,ar(y,l.current)),Mi=null;return}}catch(I){if(E!==null)throw Mi=E,I;$n=1,ud(l,ar(y,l.current)),Mi=null;return}p.flags&32768?(Pi||w===1?l=!0:Lu||(Di&536870912)!==0?l=!1:(Ec=l=!0,(w===2||w===9||w===3||w===6)&&(w=hr.current,w!==null&&w.tag===13&&(w.flags|=16384))),yg(p,l)):Rp(p)}function Rp(l){var p=l;do{if((p.flags&32768)!==0){yg(p,Ec);return}l=p.return;var y=xp(p.alternate,p,Gl);if(y!==null){Mi=y;return}if(p=p.sibling,p!==null){Mi=p;return}Mi=p=l}while(p!==null);$n===0&&($n=5)}function yg(l,p){do{var y=hd(l.alternate,l);if(y!==null){y.flags&=32767,Mi=y;return}if(y=l.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!p&&(l=l.sibling,l!==null)){Mi=l;return}Mi=l=y}while(l!==null);$n=6,Mi=null}function _g(l,p,y,w,E,I,X,ie,we){l.cancelPendingCommit=null;do Wh();while(Ms!==0);if((Ui&6)!==0)throw Error(n(327));if(p!==null){if(p===l.current)throw Error(n(177));if(I=p.lanes|p.childLanes,I|=Qf,Te(l,y,I,X,ie,we),l===fn&&(Mi=fn=null,Di=0),Gh=p,Pc=l,$h=y,pg=I,kp=E,mr=w,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,n_(br,function(){return t_(),null})):(l.callbackNode=null,l.callbackPriority=0),w=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||w){w=Xe.T,Xe.T=null,E=dt.p,dt.p=2,X=Ui,Ui|=4;try{gb(l,p,y)}finally{Ui=X,dt.p=E,Xe.T=w}}Ms=1,Qh(),fa(),Xl()}}function Qh(){if(Ms===1){Ms=0;var l=Pc,p=Gh,y=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||y){y=Xe.T,Xe.T=null;var w=dt.p;dt.p=2;var E=Ui;Ui|=4;try{lg(p,l);var I=Up,X=ap(l.containerInfo),ie=I.focusedElem,we=I.selectionRange;if(X!==ie&&ie&&ie.ownerDocument&&op(ie.ownerDocument.documentElement,ie)){if(we!==null&&Zf(ie)){var $e=we.start,ct=we.end;if(ct===void 0&&(ct=$e),"selectionStart"in ie)ie.selectionStart=$e,ie.selectionEnd=Math.min(ct,ie.value.length);else{var pt=ie.ownerDocument||document,Ze=pt&&pt.defaultView||window;if(Ze.getSelection){var Ke=Ze.getSelection(),oi=ie.textContent.length,si=Math.min(we.start,oi),hn=we.end===void 0?si:Math.min(we.end,oi);!Ke.extend&&si>hn&&(X=hn,hn=si,si=X);var Ie=rp(ie,si),Ee=rp(ie,hn);if(Ie&&Ee&&(Ke.rangeCount!==1||Ke.anchorNode!==Ie.node||Ke.anchorOffset!==Ie.offset||Ke.focusNode!==Ee.node||Ke.focusOffset!==Ee.offset)){var Le=pt.createRange();Le.setStart(Ie.node,Ie.offset),Ke.removeAllRanges(),si>hn?(Ke.addRange(Le),Ke.extend(Ee.node,Ee.offset)):(Le.setEnd(Ee.node,Ee.offset),Ke.addRange(Le))}}}}for(pt=[],Ke=ie;Ke=Ke.parentNode;)Ke.nodeType===1&&pt.push({element:Ke,left:Ke.scrollLeft,top:Ke.scrollTop});for(typeof ie.focus=="function"&&ie.focus(),ie=0;ie<pt.length;ie++){var lt=pt[ie];lt.element.scrollLeft=lt.left,lt.element.scrollTop=lt.top}}On=!!Gu,Up=Gu=null}finally{Ui=E,dt.p=w,Xe.T=y}}l.current=p,Ms=2}}function fa(){if(Ms===2){Ms=0;var l=Pc,p=Gh,y=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||y){y=Xe.T,Xe.T=null;var w=dt.p;dt.p=2;var E=Ui;Ui|=4;try{Hy(l,p.alternate,p)}finally{Ui=E,dt.p=w,Xe.T=y}}Ms=3}}function Xl(){if(Ms===4||Ms===3){Ms=0,wa();var l=Pc,p=Gh,y=$h,w=mr;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?Ms=5:(Ms=0,Gh=Pc=null,bg(l,l.pendingLanes));var E=l.pendingLanes;if(E===0&&(Ja=null),at(y),p=p.stateNode,Kn&&typeof Kn.onCommitFiberRoot=="function")try{Kn.onCommitFiberRoot(_o,p,void 0,(p.current.flags&128)===128)}catch{}if(w!==null){p=Xe.T,E=dt.p,dt.p=2,Xe.T=null;try{for(var I=l.onRecoverableError,X=0;X<w.length;X++){var ie=w[X];I(ie.value,{componentStack:ie.stack})}}finally{Xe.T=p,dt.p=E}}($h&3)!==0&&Wh(),el(l),E=l.pendingLanes,(y&4194090)!==0&&(E&42)!==0?l===Ep?ju++:(ju=0,Ep=l):ju=0,Yh(0)}}function bg(l,p){(l.pooledCacheLanes&=p)===0&&(p=l.pooledCache,p!=null&&(l.pooledCache=null,xc(p)))}function Wh(l){return Qh(),fa(),Xl(),t_()}function t_(){if(Ms!==5)return!1;var l=Pc,p=pg;pg=0;var y=at($h),w=Xe.T,E=dt.p;try{dt.p=32>y?32:y,Xe.T=null,y=kp,kp=null;var I=Pc,X=$h;if(Ms=0,Gh=Pc=null,$h=0,(Ui&6)!==0)throw Error(n(331));var ie=Ui;if(Ui|=4,Xy(I.current),ug(I,I.current,X,y),Ui=ie,Yh(0,!1),Kn&&typeof Kn.onPostCommitFiberRoot=="function")try{Kn.onPostCommitFiberRoot(_o,I)}catch{}return!0}finally{dt.p=E,Xe.T=w,bg(l,p)}}function i_(l,p,y){p=ar(y,p),p=fp(l.stateNode,p,2),l=Eo(l,p,2),l!==null&&(Ve(l,2),el(l))}function $i(l,p,y){if(l.tag===3)i_(l,l,y);else for(;p!==null;){if(p.tag===3){i_(p,l,y);break}else if(p.tag===1){var w=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Ja===null||!Ja.has(w))){l=ar(y,l),y=Iy(2),w=Eo(p,y,2),w!==null&&(dp(y,w,p,l),Ve(w,2),el(w));break}}p=p.return}}function Sd(l,p,y){var w=l.pingCache;if(w===null){w=l.pingCache=new Wy;var E=new Set;w.set(p,E)}else E=w.get(p),E===void 0&&(E=new Set,w.set(p,E));E.has(y)||(fg=!0,E.add(y),l=vb.bind(null,l,p,y),p.then(l,l))}function vb(l,p,y){var w=l.pingCache;w!==null&&w.delete(p),l.pingedLanes|=l.suspendedLanes&y,l.warmLanes&=~y,fn===l&&(Di&y)===y&&($n===4||$n===3&&(Di&62914560)===Di&&300>Rn()-yd?(Ui&2)===0&&Uu(l,0):dg|=y,Nu===Di&&(Nu=0)),el(l)}function Ip(l,p){p===0&&(p=ne()),l=gc(l,p),l!==null&&(Ve(l,p),el(l))}function vg(l){var p=l.memoizedState,y=0;p!==null&&(y=p.retryLane),Ip(l,y)}function Kh(l,p){var y=0;switch(l.tag){case 13:var w=l.stateNode,E=l.memoizedState;E!==null&&(y=E.retryLane);break;case 19:w=l.stateNode;break;case 22:w=l.stateNode._retryCache;break;default:throw Error(n(314))}w!==null&&w.delete(p),Ip(l,y)}function n_(l,p){return gs(l,p)}var Td=null,Dc=null,zp=!1,qu=!1,Lp=!1,Hu=0;function el(l){l!==Dc&&l.next===null&&(Dc===null?Td=Dc=l:Dc=Dc.next=l),qu=!0,zp||(zp=!0,xg())}function Yh(l,p){if(!Lp&&qu){Lp=!0;do for(var y=!1,w=Td;w!==null;){if(l!==0){var E=w.pendingLanes;if(E===0)var I=0;else{var X=w.suspendedLanes,ie=w.pingedLanes;I=(1<<31-Yn(42|l)+1)-1,I&=E&~(X&~ie),I=I&201326741?I&201326741|1:I?I|2:0}I!==0&&(y=!0,a_(w,I))}else I=Di,I=ee(w,w===fn?I:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(I&3)===0||te(w,I)||(y=!0,a_(w,I));w=w.next}while(y);Lp=!1}}function xb(){s_()}function s_(){qu=zp=!1;var l=0;Hu!==0&&(wb()&&(l=Hu),Hu=0);for(var p=Rn(),y=null,w=Td;w!==null;){var E=w.next,I=r_(w,p);I===0?(w.next=null,y===null?Td=E:y.next=E,E===null&&(Dc=y)):(y=w,(l!==0||(I&3)!==0)&&(qu=!0)),w=E}Yh(l)}function r_(l,p){for(var y=l.suspendedLanes,w=l.pingedLanes,E=l.expirationTimes,I=l.pendingLanes&-62914561;0<I;){var X=31-Yn(I),ie=1<<X,we=E[X];we===-1?((ie&y)===0||(ie&w)!==0)&&(E[X]=ae(ie,p)):we<=p&&(l.expiredLanes|=ie),I&=~ie}if(p=fn,y=Di,y=ee(l,l===p?y:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),w=l.callbackNode,y===0||l===p&&(tn===2||tn===9)||l.cancelPendingCommit!==null)return w!==null&&w!==null&&ji(w),l.callbackNode=null,l.callbackPriority=0;if((y&3)===0||te(l,y)){if(p=y&-y,p===l.callbackPriority)return p;switch(w!==null&&ji(w),at(y)){case 2:case 8:y=tr;break;case 32:y=br;break;case 268435456:y=Kr;break;default:y=br}return w=o_.bind(null,l),y=gs(y,w),l.callbackPriority=p,l.callbackNode=y,p}return w!==null&&w!==null&&ji(w),l.callbackPriority=2,l.callbackNode=null,2}function o_(l,p){if(Ms!==0&&Ms!==5)return l.callbackNode=null,l.callbackPriority=0,null;var y=l.callbackNode;if(Wh()&&l.callbackNode!==y)return null;var w=Di;return w=ee(l,l===fn?w:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),w===0?null:(Vu(l,w,p),r_(l,Rn()),l.callbackNode!=null&&l.callbackNode===y?o_.bind(null,l):null)}function a_(l,p){if(Wh())return null;Vu(l,p,!0)}function xg(){js(function(){(Ui&6)!==0?gs(sc,xb):s_()})}function tl(){return Hu===0&&(Hu=ge()),Hu}function wg(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:rn(""+l)}function Sg(l,p){var y=p.ownerDocument.createElement("input");return y.name=p.name,y.value=p.value,l.id&&y.setAttribute("form",l.id),p.parentNode.insertBefore(y,p),l=new FormData(l),y.parentNode.removeChild(y),l}function l_(l,p,y,w,E){if(p==="submit"&&y&&y.stateNode===E){var I=wg((E[We]||null).action),X=w.submitter;X&&(p=(p=X[We]||null)?wg(p.formAction):X.getAttribute("formAction"),p!==null&&(I=p,X=null));var ie=new Go("action","action",null,w,E);l.push({event:ie,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(Hu!==0){var we=X?Sg(E,X):new FormData(E);Ur(y,{pending:!0,data:we,method:E.method,action:I},null,we)}}else typeof I=="function"&&(ie.preventDefault(),we=X?Sg(E,X):new FormData(E),Ur(y,{pending:!0,data:we,method:E.method,action:I},I,we))},currentTarget:E}]})}}for(var Bp=0;Bp<La.length;Bp++){var Np=La[Bp],Tg=Np.toLowerCase(),c_=Np[0].toUpperCase()+Np.slice(1);zs(Tg,"on"+c_)}zs(Gf,"onAnimationEnd"),zs(xh,"onAnimationIteration"),zs(za,"onAnimationStart"),zs("dblclick","onDoubleClick"),zs("focusin","onFocus"),zs("focusout","onBlur"),zs(wh,"onTransitionRun"),zs(Sh,"onTransitionStart"),zs(_u,"onTransitionCancel"),zs(bu,"onTransitionEnd"),qo("onMouseEnter",["mouseout","mouseover"]),qo("onMouseLeave",["mouseout","mouseover"]),qo("onPointerEnter",["pointerout","pointerover"]),qo("onPointerLeave",["pointerout","pointerover"]),ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ir("onBeforeInput",["compositionend","keypress","textInput","paste"]),ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),u_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ql));function Fp(l,p){p=(p&4)!==0;for(var y=0;y<l.length;y++){var w=l[y],E=w.event;w=w.listeners;e:{var I=void 0;if(p)for(var X=w.length-1;0<=X;X--){var ie=w[X],we=ie.instance,$e=ie.currentTarget;if(ie=ie.listener,we!==I&&E.isPropagationStopped())break e;I=ie,E.currentTarget=$e;try{I(E)}catch(ct){cd(ct)}E.currentTarget=null,I=we}else for(X=0;X<w.length;X++){if(ie=w[X],we=ie.instance,$e=ie.currentTarget,ie=ie.listener,we!==I&&E.isPropagationStopped())break e;I=ie,E.currentTarget=$e;try{I(E)}catch(ct){cd(ct)}E.currentTarget=null,I=we}}}}function Ci(l,p){var y=p[_i];y===void 0&&(y=p[_i]=new Set);var w=l+"__bubble";y.has(w)||(Mg(p,l,2,!1),y.add(w))}function Er(l,p,y){var w=0;p&&(w|=4),Mg(y,l,w,p)}var Wl="_reactListening"+Math.random().toString(36).slice(2);function jp(l){if(!l[Wl]){l[Wl]=!0,Ta.forEach(function(y){y!=="selectionchange"&&(u_.has(y)||Er(y,!1,l),Er(y,!0,l))});var p=l.nodeType===9?l:l.ownerDocument;p===null||p[Wl]||(p[Wl]=!0,Er("selectionchange",!1,p))}}function Mg(l,p,y,w){switch(fs(p)){case 2:var E=Vs;break;case 8:E=ho;break;default:E=Ys}y=E.bind(null,p,y,l),E=void 0,!wl||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(E=!0),w?E!==void 0?l.addEventListener(p,y,{capture:!0,passive:E}):l.addEventListener(p,y,!0):E!==void 0?l.addEventListener(p,y,{passive:E}):l.addEventListener(p,y,!1)}function Vp(l,p,y,w,E){var I=w;if((p&1)===0&&(p&2)===0&&w!==null)e:for(;;){if(w===null)return;var X=w.tag;if(X===3||X===4){var ie=w.stateNode.containerInfo;if(ie===E)break;if(X===4)for(X=w.return;X!==null;){var we=X.tag;if((we===3||we===4)&&X.stateNode.containerInfo===E)return;X=X.return}for(;ie!==null;){if(X=Vn(ie),X===null)return;if(we=X.tag,we===5||we===6||we===26||we===27){w=I=X;continue e}ie=ie.parentNode}}w=w.return}mn(function(){var $e=I,ct=es(y),pt=[];e:{var Ze=$f.get(l);if(Ze!==void 0){var Ke=Go,oi=l;switch(l){case"keypress":if(ri(y)===0)break e;case"keydown":case"keyup":Ke=ou;break;case"focusin":oi="focus",Ke=Is;break;case"focusout":oi="blur",Ke=Is;break;case"beforeblur":case"afterblur":Ke=Is;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ke=su;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ke=Rs;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ke=Rf;break;case Gf:case xh:case za:Ke=Ki;break;case bu:Ke=Hm;break;case"scroll":case"scrollend":Ke=ch;break;case"wheel":Ke=Pa;break;case"copy":case"cut":case"paste":Ke=hh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ke=au;break;case"toggle":case"beforetoggle":Ke=tp}var si=(p&4)!==0,hn=!si&&(l==="scroll"||l==="scrollend"),Ie=si?Ze!==null?Ze+"Capture":null:Ze;si=[];for(var Ee=$e,Le;Ee!==null;){var lt=Ee;if(Le=lt.stateNode,lt=lt.tag,lt!==5&&lt!==26&&lt!==27||Le===null||Ie===null||(lt=or(Ee,Ie),lt!=null&&si.push(Jh(Ee,lt,Le))),hn)break;Ee=Ee.return}0<si.length&&(Ze=new Ke(Ze,oi,null,y,ct),pt.push({event:Ze,listeners:si}))}}if((p&7)===0){e:{if(Ze=l==="mouseover"||l==="pointerover",Ke=l==="mouseout"||l==="pointerout",Ze&&y!==vl&&(oi=y.relatedTarget||y.fromElement)&&(Vn(oi)||oi[Wt]))break e;if((Ke||Ze)&&(Ze=ct.window===ct?ct:(Ze=ct.ownerDocument)?Ze.defaultView||Ze.parentWindow:window,Ke?(oi=y.relatedTarget||y.toElement,Ke=$e,oi=oi?Vn(oi):null,oi!==null&&(hn=f(oi),si=oi.tag,oi!==hn||si!==5&&si!==27&&si!==6)&&(oi=null)):(Ke=null,oi=$e),Ke!==oi)){if(si=su,lt="onMouseLeave",Ie="onMouseEnter",Ee="mouse",(l==="pointerout"||l==="pointerover")&&(si=au,lt="onPointerLeave",Ie="onPointerEnter",Ee="pointer"),hn=Ke==null?Ze:Vi(Ke),Le=oi==null?Ze:Vi(oi),Ze=new si(lt,Ee+"leave",Ke,y,ct),Ze.target=hn,Ze.relatedTarget=Le,lt=null,Vn(ct)===$e&&(si=new si(Ie,Ee+"enter",oi,y,ct),si.target=Le,si.relatedTarget=hn,lt=si),hn=lt,Ke&&oi)t:{for(si=Ke,Ie=oi,Ee=0,Le=si;Le;Le=Zu(Le))Ee++;for(Le=0,lt=Ie;lt;lt=Zu(lt))Le++;for(;0<Ee-Le;)si=Zu(si),Ee--;for(;0<Le-Ee;)Ie=Zu(Ie),Le--;for(;Ee--;){if(si===Ie||Ie!==null&&si===Ie.alternate)break t;si=Zu(si),Ie=Zu(Ie)}si=null}else si=null;Ke!==null&&h_(pt,Ze,Ke,si,!1),oi!==null&&hn!==null&&h_(pt,hn,oi,si,!0)}}e:{if(Ze=$e?Vi($e):window,Ke=Ze.nodeName&&Ze.nodeName.toLowerCase(),Ke==="select"||Ke==="input"&&Ze.type==="file")var It=jf;else if(Ff(Ze))if(Vf)It=Hf;else{It=_h;var mi=Qo}else Ke=Ze.nodeName,!Ke||Ke.toLowerCase()!=="input"||Ze.type!=="checkbox"&&Ze.type!=="radio"?$e&&Nr($e.elementType)&&(It=jf):It=qf;if(It&&(It=It(l,$e))){hu(pt,It,y,ct);break e}mi&&mi(l,Ze,$e),l==="focusout"&&$e&&Ze.type==="number"&&$e.memoizedProps.value!=null&&Aa(Ze,"number",Ze.value)}switch(mi=$e?Vi($e):window,l){case"focusin":(Ff(mi)||mi.contentEditable==="true")&&(pc=mi,vh=$e,Da=null);break;case"focusout":Da=vh=pc=null;break;case"mousedown":mc=!0;break;case"contextmenu":case"mouseup":case"dragend":mc=!1,yu(pt,y,ct);break;case"selectionchange":if(lp)break;case"keydown":case"keyup":yu(pt,y,ct)}var Ht;if(zf)e:{switch(l){case"compositionstart":var li="onCompositionStart";break e;case"compositionend":li="onCompositionEnd";break e;case"compositionupdate":li="onCompositionUpdate";break e}li=void 0}else Oa?ph(l,y)&&(li="onCompositionEnd"):l==="keydown"&&y.keyCode===229&&(li="onCompositionStart");li&&(Lf&&y.locale!=="ko"&&(Oa||li!=="onCompositionStart"?li==="onCompositionEnd"&&Oa&&(Ht=Ti()):(Fr=ct,Ai="value"in Fr?Fr.value:Fr.textContent,Oa=!0)),mi=Md($e,li),0<mi.length&&(li=new Tl(li,l,null,y,ct),pt.push({event:li,listeners:mi}),Ht?li.data=Ht:(Ht=mh(y),Ht!==null&&(li.data=Ht)))),(Ht=Zm?Nf(l,y):np(l,y))&&(li=Md($e,"onBeforeInput"),0<li.length&&(mi=new Tl("onBeforeInput","beforeinput",null,y,ct),pt.push({event:mi,listeners:li}),mi.data=Ht)),l_(pt,l,$e,y,ct)}Fp(pt,p)})}function Jh(l,p,y){return{instance:l,listener:p,currentTarget:y}}function Md(l,p){for(var y=p+"Capture",w=[];l!==null;){var E=l,I=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||I===null||(E=or(l,y),E!=null&&w.unshift(Jh(l,E,I)),E=or(l,p),E!=null&&w.push(Jh(l,E,I))),l.tag===3)return w;l=l.return}return[]}function Zu(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function h_(l,p,y,w,E){for(var I=p._reactName,X=[];y!==null&&y!==w;){var ie=y,we=ie.alternate,$e=ie.stateNode;if(ie=ie.tag,we!==null&&we===w)break;ie!==5&&ie!==26&&ie!==27||$e===null||(we=$e,E?($e=or(y,I),$e!=null&&X.unshift(Jh(y,$e,we))):E||($e=or(y,I),$e!=null&&X.push(Jh(y,$e,we)))),y=y.return}X.length!==0&&l.push({event:p,listeners:X})}var f_=/\r\n?/g,Rc=/\u0000|\uFFFD/g;function Cg(l){return(typeof l=="string"?l:""+l).replace(f_,`
`).replace(Rc,"")}function Ag(l,p){return p=Cg(p),Cg(l)===p}function Cd(){}function nn(l,p,y,w,E,I){switch(y){case"children":typeof w=="string"?p==="body"||p==="textarea"&&w===""||Yr(l,w):(typeof w=="number"||typeof w=="bigint")&&p!=="body"&&Yr(l,""+w);break;case"className":nr(l,"class",w);break;case"tabIndex":nr(l,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":nr(l,y,w);break;case"style":bl(l,w,I);break;case"data":if(p!=="object"){nr(l,"data",w);break}case"src":case"href":if(w===""&&(p!=="a"||y!=="href")){l.removeAttribute(y);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){l.removeAttribute(y);break}w=rn(""+w),l.setAttribute(y,w);break;case"action":case"formAction":if(typeof w=="function"){l.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof I=="function"&&(y==="formAction"?(p!=="input"&&nn(l,p,"name",E.name,E,null),nn(l,p,"formEncType",E.formEncType,E,null),nn(l,p,"formMethod",E.formMethod,E,null),nn(l,p,"formTarget",E.formTarget,E,null)):(nn(l,p,"encType",E.encType,E,null),nn(l,p,"method",E.method,E,null),nn(l,p,"target",E.target,E,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){l.removeAttribute(y);break}w=rn(""+w),l.setAttribute(y,w);break;case"onClick":w!=null&&(l.onclick=Cd);break;case"onScroll":w!=null&&Ci("scroll",l);break;case"onScrollEnd":w!=null&&Ci("scrollend",l);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(n(61));if(y=w.__html,y!=null){if(E.children!=null)throw Error(n(60));l.innerHTML=y}}break;case"multiple":l.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":l.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){l.removeAttribute("xlink:href");break}y=rn(""+w),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?l.setAttribute(y,""+w):l.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?l.setAttribute(y,""):l.removeAttribute(y);break;case"capture":case"download":w===!0?l.setAttribute(y,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?l.setAttribute(y,w):l.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?l.setAttribute(y,w):l.removeAttribute(y);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?l.removeAttribute(y):l.setAttribute(y,w);break;case"popover":Ci("beforetoggle",l),Ci("toggle",l),ml(l,"popover",w);break;case"xlinkActuate":Zs(l,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":Zs(l,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":Zs(l,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":Zs(l,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":Zs(l,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":Zs(l,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":Zs(l,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":Zs(l,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":Zs(l,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":ml(l,"is",w);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=rr.get(y)||y,ml(l,y,w))}}function kg(l,p,y,w,E,I){switch(y){case"style":bl(l,w,I);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(n(61));if(y=w.__html,y!=null){if(E.children!=null)throw Error(n(60));l.innerHTML=y}}break;case"children":typeof w=="string"?Yr(l,w):(typeof w=="number"||typeof w=="bigint")&&Yr(l,""+w);break;case"onScroll":w!=null&&Ci("scroll",l);break;case"onScrollEnd":w!=null&&Ci("scrollend",l);break;case"onClick":w!=null&&(l.onclick=Cd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!eu.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(E=y.endsWith("Capture"),p=y.slice(2,E?y.length-7:void 0),I=l[We]||null,I=I!=null?I[y]:null,typeof I=="function"&&l.removeEventListener(p,I,E),typeof w=="function")){typeof I!="function"&&I!==null&&(y in l?l[y]=null:l.hasAttribute(y)&&l.removeAttribute(y)),l.addEventListener(p,w,E);break e}y in l?l[y]=w:w===!0?l.setAttribute(y,""):ml(l,y,w)}}}function Ks(l,p,y){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ci("error",l),Ci("load",l);var w=!1,E=!1,I;for(I in y)if(y.hasOwnProperty(I)){var X=y[I];if(X!=null)switch(I){case"src":w=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:nn(l,p,I,X,y,null)}}E&&nn(l,p,"srcSet",y.srcSet,y,null),w&&nn(l,p,"src",y.src,y,null);return;case"input":Ci("invalid",l);var ie=I=X=E=null,we=null,$e=null;for(w in y)if(y.hasOwnProperty(w)){var ct=y[w];if(ct!=null)switch(w){case"name":E=ct;break;case"type":X=ct;break;case"checked":we=ct;break;case"defaultChecked":$e=ct;break;case"value":I=ct;break;case"defaultValue":ie=ct;break;case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(n(137,p));break;default:nn(l,p,w,ct,y,null)}}yl(l,I,ie,we,$e,X,E,!1),oc(l);return;case"select":Ci("invalid",l),w=X=I=null;for(E in y)if(y.hasOwnProperty(E)&&(ie=y[E],ie!=null))switch(E){case"value":I=ie;break;case"defaultValue":X=ie;break;case"multiple":w=ie;default:nn(l,p,E,ie,y,null)}p=I,y=X,l.multiple=!!w,p!=null?_l(l,!!w,p,!1):y!=null&&_l(l,!!w,y,!0);return;case"textarea":Ci("invalid",l),I=E=w=null;for(X in y)if(y.hasOwnProperty(X)&&(ie=y[X],ie!=null))switch(X){case"value":w=ie;break;case"defaultValue":E=ie;break;case"children":I=ie;break;case"dangerouslySetInnerHTML":if(ie!=null)throw Error(n(91));break;default:nn(l,p,X,ie,y,null)}vo(l,w,E,I),oc(l);return;case"option":for(we in y)if(y.hasOwnProperty(we)&&(w=y[we],w!=null))switch(we){case"selected":l.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:nn(l,p,we,w,y,null)}return;case"dialog":Ci("beforetoggle",l),Ci("toggle",l),Ci("cancel",l),Ci("close",l);break;case"iframe":case"object":Ci("load",l);break;case"video":case"audio":for(w=0;w<Ql.length;w++)Ci(Ql[w],l);break;case"image":Ci("error",l),Ci("load",l);break;case"details":Ci("toggle",l);break;case"embed":case"source":case"link":Ci("error",l),Ci("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for($e in y)if(y.hasOwnProperty($e)&&(w=y[$e],w!=null))switch($e){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:nn(l,p,$e,w,y,null)}return;default:if(Nr(p)){for(ct in y)y.hasOwnProperty(ct)&&(w=y[ct],w!==void 0&&kg(l,p,ct,w,y,void 0));return}}for(ie in y)y.hasOwnProperty(ie)&&(w=y[ie],w!=null&&nn(l,p,ie,w,y,null))}function d_(l,p,y,w){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,I=null,X=null,ie=null,we=null,$e=null,ct=null;for(Ke in y){var pt=y[Ke];if(y.hasOwnProperty(Ke)&&pt!=null)switch(Ke){case"checked":break;case"value":break;case"defaultValue":we=pt;default:w.hasOwnProperty(Ke)||nn(l,p,Ke,null,w,pt)}}for(var Ze in w){var Ke=w[Ze];if(pt=y[Ze],w.hasOwnProperty(Ze)&&(Ke!=null||pt!=null))switch(Ze){case"type":I=Ke;break;case"name":E=Ke;break;case"checked":$e=Ke;break;case"defaultChecked":ct=Ke;break;case"value":X=Ke;break;case"defaultValue":ie=Ke;break;case"children":case"dangerouslySetInnerHTML":if(Ke!=null)throw Error(n(137,p));break;default:Ke!==pt&&nn(l,p,Ze,Ke,w,pt)}}lc(l,X,ie,we,$e,ct,I,E);return;case"select":Ke=X=ie=Ze=null;for(I in y)if(we=y[I],y.hasOwnProperty(I)&&we!=null)switch(I){case"value":break;case"multiple":Ke=we;default:w.hasOwnProperty(I)||nn(l,p,I,null,w,we)}for(E in w)if(I=w[E],we=y[E],w.hasOwnProperty(E)&&(I!=null||we!=null))switch(E){case"value":Ze=I;break;case"defaultValue":ie=I;break;case"multiple":X=I;default:I!==we&&nn(l,p,E,I,w,we)}p=ie,y=X,w=Ke,Ze!=null?_l(l,!!y,Ze,!1):!!w!=!!y&&(p!=null?_l(l,!!y,p,!0):_l(l,!!y,y?[]:"",!1));return;case"textarea":Ke=Ze=null;for(ie in y)if(E=y[ie],y.hasOwnProperty(ie)&&E!=null&&!w.hasOwnProperty(ie))switch(ie){case"value":break;case"children":break;default:nn(l,p,ie,null,w,E)}for(X in w)if(E=w[X],I=y[X],w.hasOwnProperty(X)&&(E!=null||I!=null))switch(X){case"value":Ze=E;break;case"defaultValue":Ke=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:E!==I&&nn(l,p,X,E,w,I)}ep(l,Ze,Ke);return;case"option":for(var oi in y)if(Ze=y[oi],y.hasOwnProperty(oi)&&Ze!=null&&!w.hasOwnProperty(oi))switch(oi){case"selected":l.selected=!1;break;default:nn(l,p,oi,null,w,Ze)}for(we in w)if(Ze=w[we],Ke=y[we],w.hasOwnProperty(we)&&Ze!==Ke&&(Ze!=null||Ke!=null))switch(we){case"selected":l.selected=Ze&&typeof Ze!="function"&&typeof Ze!="symbol";break;default:nn(l,p,we,Ze,w,Ke)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var si in y)Ze=y[si],y.hasOwnProperty(si)&&Ze!=null&&!w.hasOwnProperty(si)&&nn(l,p,si,null,w,Ze);for($e in w)if(Ze=w[$e],Ke=y[$e],w.hasOwnProperty($e)&&Ze!==Ke&&(Ze!=null||Ke!=null))switch($e){case"children":case"dangerouslySetInnerHTML":if(Ze!=null)throw Error(n(137,p));break;default:nn(l,p,$e,Ze,w,Ke)}return;default:if(Nr(p)){for(var hn in y)Ze=y[hn],y.hasOwnProperty(hn)&&Ze!==void 0&&!w.hasOwnProperty(hn)&&kg(l,p,hn,void 0,w,Ze);for(ct in w)Ze=w[ct],Ke=y[ct],!w.hasOwnProperty(ct)||Ze===Ke||Ze===void 0&&Ke===void 0||kg(l,p,ct,Ze,w,Ke);return}}for(var Ie in y)Ze=y[Ie],y.hasOwnProperty(Ie)&&Ze!=null&&!w.hasOwnProperty(Ie)&&nn(l,p,Ie,null,w,Ze);for(pt in w)Ze=w[pt],Ke=y[pt],!w.hasOwnProperty(pt)||Ze===Ke||Ze==null&&Ke==null||nn(l,p,pt,Ze,w,Ke)}var Gu=null,Up=null;function $u(l){return l.nodeType===9?l:l.ownerDocument}function Eg(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ad(l,p){if(l===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&p==="foreignObject"?0:l}function ef(l,p){return l==="textarea"||l==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var tf=null;function wb(){var l=window.event;return l&&l.type==="popstate"?l===tf?!1:(tf=l,!0):(tf=null,!1)}var p_=typeof setTimeout=="function"?setTimeout:void 0,Sb=typeof clearTimeout=="function"?clearTimeout:void 0,Xu=typeof Promise=="function"?Promise:void 0,js=typeof queueMicrotask=="function"?queueMicrotask:typeof Xu<"u"?function(l){return Xu.resolve(null).then(l).catch(Ic)}:p_;function Ic(l){setTimeout(function(){throw l})}function il(l){return l==="head"}function Pg(l,p){var y=p,w=0,E=0;do{var I=y.nextSibling;if(l.removeChild(y),I&&I.nodeType===8)if(y=I.data,y==="/$"){if(0<w&&8>w){y=w;var X=l.ownerDocument;if(y&1&&nf(X.documentElement),y&2&&nf(X.body),y&4)for(y=X.head,nf(y),X=y.firstChild;X;){var ie=X.nextSibling,we=X.nodeName;X[kt]||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&X.rel.toLowerCase()==="stylesheet"||y.removeChild(X),X=ie}}if(E===0){l.removeChild(I),sl(p);return}E--}else y==="$"||y==="$?"||y==="$!"?E++:w=y.charCodeAt(0)-48;else w=0;y=I}while(y);sl(p)}function qp(l){var p=l.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var y=p;switch(p=p.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":qp(y),Qt(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}l.removeChild(y)}}function Og(l,p,y,w){for(;l.nodeType===1;){var E=y;if(l.nodeName.toLowerCase()!==p.toLowerCase()){if(!w&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(w){if(!l[kt])switch(p){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(I=l.getAttribute("rel"),I==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(I!==E.rel||l.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||l.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||l.getAttribute("title")!==(E.title==null?null:E.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(I=l.getAttribute("src"),(I!==(E.src==null?null:E.src)||l.getAttribute("type")!==(E.type==null?null:E.type)||l.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&I&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(p==="input"&&l.type==="hidden"){var I=E.name==null?null:""+E.name;if(E.type==="hidden"&&l.getAttribute("name")===I)return l}else return l;if(l=da(l.nextSibling),l===null)break}return null}function Tb(l,p,y){if(p==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!y||(l=da(l.nextSibling),l===null))return null;return l}function Hp(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function m_(l,p){var y=l.ownerDocument;if(l.data!=="$?"||y.readyState==="complete")p();else{var w=function(){p(),y.removeEventListener("DOMContentLoaded",w)};y.addEventListener("DOMContentLoaded",w),l._reactRetry=w}}function da(l){for(;l!=null;l=l.nextSibling){var p=l.nodeType;if(p===1||p===3)break;if(p===8){if(p=l.data,p==="$"||p==="$!"||p==="$?"||p==="F!"||p==="F")break;if(p==="/$")return null}}return l}var Zp=null;function Gp(l){l=l.previousSibling;for(var p=0;l;){if(l.nodeType===8){var y=l.data;if(y==="$"||y==="$!"||y==="$?"){if(p===0)return l;p--}else y==="/$"&&p++}l=l.previousSibling}return null}function $p(l,p,y){switch(p=$u(y),l){case"html":if(l=p.documentElement,!l)throw Error(n(452));return l;case"head":if(l=p.head,!l)throw Error(n(453));return l;case"body":if(l=p.body,!l)throw Error(n(454));return l;default:throw Error(n(451))}}function nf(l){for(var p=l.attributes;p.length;)l.removeAttributeNode(p[0]);Qt(l)}var gr=new Map,Xp=new Set;function kd(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var pa=dt.d;dt.d={f:Qp,r:Ed,D:Dg,C:Mb,L:u,m:r,X:m,S:h,M:b};function Qp(){var l=pa.f(),p=Op();return l||p}function Ed(l){var p=In(l);p!==null&&p.tag===5&&p.type==="form"?Oo(p):pa.r(l)}var zc=typeof document>"u"?null:document;function Wp(l,p,y){var w=zc;if(w&&typeof p=="string"&&p){var E=sr(p);E='link[rel="'+l+'"][href="'+E+'"]',typeof y=="string"&&(E+='[crossorigin="'+y+'"]'),Xp.has(E)||(Xp.add(E),l={rel:l,crossOrigin:y,href:p},w.querySelector(E)===null&&(p=w.createElement("link"),Ks(p,"link",l),En(p),w.head.appendChild(p)))}}function Dg(l){pa.D(l),Wp("dns-prefetch",l,null)}function Mb(l,p){pa.C(l,p),Wp("preconnect",l,p)}function u(l,p,y){pa.L(l,p,y);var w=zc;if(w&&l&&p){var E='link[rel="preload"][as="'+sr(p)+'"]';p==="image"&&y&&y.imageSrcSet?(E+='[imagesrcset="'+sr(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(E+='[imagesizes="'+sr(y.imageSizes)+'"]')):E+='[href="'+sr(l)+'"]';var I=E;switch(p){case"style":I=M(l);break;case"script":I=N(l)}gr.has(I)||(l=P({rel:"preload",href:p==="image"&&y&&y.imageSrcSet?void 0:l,as:p},y),gr.set(I,l),w.querySelector(E)!==null||p==="style"&&w.querySelector(k(I))||p==="script"&&w.querySelector(U(I))||(p=w.createElement("link"),Ks(p,"link",l),En(p),w.head.appendChild(p)))}}function r(l,p){pa.m(l,p);var y=zc;if(y&&l){var w=p&&typeof p.as=="string"?p.as:"script",E='link[rel="modulepreload"][as="'+sr(w)+'"][href="'+sr(l)+'"]',I=E;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":I=N(l)}if(!gr.has(I)&&(l=P({rel:"modulepreload",href:l},p),gr.set(I,l),y.querySelector(E)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(U(I)))return}w=y.createElement("link"),Ks(w,"link",l),En(w),y.head.appendChild(w)}}}function h(l,p,y){pa.S(l,p,y);var w=zc;if(w&&l){var E=ti(w).hoistableStyles,I=M(l);p=p||"default";var X=E.get(I);if(!X){var ie={loading:0,preload:null};if(X=w.querySelector(k(I)))ie.loading=5;else{l=P({rel:"stylesheet",href:l,"data-precedence":p},y),(y=gr.get(I))&&Q(l,y);var we=X=w.createElement("link");En(we),Ks(we,"link",l),we._p=new Promise(function($e,ct){we.onload=$e,we.onerror=ct}),we.addEventListener("load",function(){ie.loading|=1}),we.addEventListener("error",function(){ie.loading|=2}),ie.loading|=4,$(X,p,w)}X={type:"stylesheet",instance:X,count:1,state:ie},E.set(I,X)}}}function m(l,p){pa.X(l,p);var y=zc;if(y&&l){var w=ti(y).hoistableScripts,E=N(l),I=w.get(E);I||(I=y.querySelector(U(E)),I||(l=P({src:l,async:!0},p),(p=gr.get(E))&&J(l,p),I=y.createElement("script"),En(I),Ks(I,"link",l),y.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},w.set(E,I))}}function b(l,p){pa.M(l,p);var y=zc;if(y&&l){var w=ti(y).hoistableScripts,E=N(l),I=w.get(E);I||(I=y.querySelector(U(E)),I||(l=P({src:l,async:!0,type:"module"},p),(p=gr.get(E))&&J(l,p),I=y.createElement("script"),En(I),Ks(I,"link",l),y.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},w.set(E,I))}}function T(l,p,y,w){var E=(E=Nt.current)?kd(E):null;if(!E)throw Error(n(446));switch(l){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(p=M(y.href),y=ti(E).hoistableStyles,w=y.get(p),w||(w={type:"style",instance:null,count:0,state:null},y.set(p,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){l=M(y.href);var I=ti(E).hoistableStyles,X=I.get(l);if(X||(E=E.ownerDocument||E,X={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},I.set(l,X),(I=E.querySelector(k(l)))&&!I._p&&(X.instance=I,X.state.loading=5),gr.has(l)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},gr.set(l,y),I||z(E,l,y,X.state))),p&&w===null)throw Error(n(528,""));return X}if(p&&w!==null)throw Error(n(529,""));return null;case"script":return p=y.async,y=y.src,typeof y=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=N(y),y=ti(E).hoistableScripts,w=y.get(p),w||(w={type:"script",instance:null,count:0,state:null},y.set(p,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,l))}}function M(l){return'href="'+sr(l)+'"'}function k(l){return'link[rel="stylesheet"]['+l+"]"}function D(l){return P({},l,{"data-precedence":l.precedence,precedence:null})}function z(l,p,y,w){l.querySelector('link[rel="preload"][as="style"]['+p+"]")?w.loading=1:(p=l.createElement("link"),w.preload=p,p.addEventListener("load",function(){return w.loading|=1}),p.addEventListener("error",function(){return w.loading|=2}),Ks(p,"link",y),En(p),l.head.appendChild(p))}function N(l){return'[src="'+sr(l)+'"]'}function U(l){return"script[async]"+l}function Z(l,p,y){if(p.count++,p.instance===null)switch(p.type){case"style":var w=l.querySelector('style[data-href~="'+sr(y.href)+'"]');if(w)return p.instance=w,En(w),w;var E=P({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return w=(l.ownerDocument||l).createElement("style"),En(w),Ks(w,"style",E),$(w,y.precedence,l),p.instance=w;case"stylesheet":E=M(y.href);var I=l.querySelector(k(E));if(I)return p.state.loading|=4,p.instance=I,En(I),I;w=D(y),(E=gr.get(E))&&Q(w,E),I=(l.ownerDocument||l).createElement("link"),En(I);var X=I;return X._p=new Promise(function(ie,we){X.onload=ie,X.onerror=we}),Ks(I,"link",w),p.state.loading|=4,$(I,y.precedence,l),p.instance=I;case"script":return I=N(y.src),(E=l.querySelector(U(I)))?(p.instance=E,En(E),E):(w=y,(E=gr.get(I))&&(w=P({},y),J(w,E)),l=l.ownerDocument||l,E=l.createElement("script"),En(E),Ks(E,"link",w),l.head.appendChild(E),p.instance=E);case"void":return null;default:throw Error(n(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(w=p.instance,p.state.loading|=4,$(w,y.precedence,l));return p.instance}function $(l,p,y){for(var w=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=w.length?w[w.length-1]:null,I=E,X=0;X<w.length;X++){var ie=w[X];if(ie.dataset.precedence===p)I=ie;else if(I!==E)break}I?I.parentNode.insertBefore(l,I.nextSibling):(p=y.nodeType===9?y.head:y,p.insertBefore(l,p.firstChild))}function Q(l,p){l.crossOrigin==null&&(l.crossOrigin=p.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=p.referrerPolicy),l.title==null&&(l.title=p.title)}function J(l,p){l.crossOrigin==null&&(l.crossOrigin=p.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=p.referrerPolicy),l.integrity==null&&(l.integrity=p.integrity)}var oe=null;function fe(l,p,y){if(oe===null){var w=new Map,E=oe=new Map;E.set(y,w)}else E=oe,w=E.get(y),w||(w=new Map,E.set(y,w));if(w.has(l))return w;for(w.set(l,null),y=y.getElementsByTagName(l),E=0;E<y.length;E++){var I=y[E];if(!(I[kt]||I[Xt]||l==="link"&&I.getAttribute("rel")==="stylesheet")&&I.namespaceURI!=="http://www.w3.org/2000/svg"){var X=I.getAttribute(p)||"";X=l+X;var ie=w.get(X);ie?ie.push(I):w.set(X,[I])}}return w}function Ae(l,p,y){l=l.ownerDocument||l,l.head.insertBefore(y,p==="title"?l.querySelector("head > title"):null)}function pe(l,p,y){if(y===1||p.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return l=p.disabled,typeof p.precedence=="string"&&l==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function G(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var re=null;function ye(){}function Ue(l,p,y){if(re===null)throw Error(n(475));var w=re;if(p.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var E=M(y.href),I=l.querySelector(k(E));if(I){l=I._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(w.count++,w=Ge.bind(w),l.then(w,w)),p.state.loading|=4,p.instance=I,En(I);return}I=l.ownerDocument||l,y=D(y),(E=gr.get(E))&&Q(y,E),I=I.createElement("link"),En(I);var X=I;X._p=new Promise(function(ie,we){X.onload=ie,X.onerror=we}),Ks(I,"link",y),p.instance=I}w.stylesheets===null&&(w.stylesheets=new Map),w.stylesheets.set(p,l),(l=p.state.preload)&&(p.state.loading&3)===0&&(w.count++,p=Ge.bind(w),l.addEventListener("load",p),l.addEventListener("error",p))}}function ut(){if(re===null)throw Error(n(475));var l=re;return l.stylesheets&&l.count===0&&mt(l,l.stylesheets),0<l.count?function(p){var y=setTimeout(function(){if(l.stylesheets&&mt(l,l.stylesheets),l.unsuspend){var w=l.unsuspend;l.unsuspend=null,w()}},6e4);return l.unsuspend=p,function(){l.unsuspend=null,clearTimeout(y)}}:null}function Ge(){if(this.count--,this.count===0){if(this.stylesheets)mt(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var Je=null;function mt(l,p){l.stylesheets=null,l.unsuspend!==null&&(l.count++,Je=new Map,p.forEach(ft,l),Je=null,Ge.call(l))}function ft(l,p){if(!(p.state.loading&4)){var y=Je.get(l);if(y)var w=y.get(null);else{y=new Map,Je.set(l,y);for(var E=l.querySelectorAll("link[data-precedence],style[data-precedence]"),I=0;I<E.length;I++){var X=E[I];(X.nodeName==="LINK"||X.getAttribute("media")!=="not all")&&(y.set(X.dataset.precedence,X),w=X)}w&&y.set(null,w)}E=p.instance,X=E.getAttribute("data-precedence"),I=y.get(X)||w,I===w&&y.set(null,E),y.set(X,E),this.count++,w=Ge.bind(this),E.addEventListener("load",w),E.addEventListener("error",w),I?I.parentNode.insertBefore(E,I.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(E,l.firstChild)),p.state.loading|=4}}var bt={$$typeof:je,Provider:null,Consumer:null,_currentValue:_t,_currentValue2:_t,_threadCount:0};function nt(l,p,y,w,E,I,X,ie){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Oe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oe(0),this.hiddenUpdates=Oe(null),this.identifierPrefix=w,this.onUncaughtError=E,this.onCaughtError=I,this.onRecoverableError=X,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ie,this.incompleteTransitions=new Map}function Pt(l,p,y,w,E,I,X,ie,we,$e,ct,pt){return l=new nt(l,p,y,X,ie,we,$e,pt),p=1,I===!0&&(p|=24),I=vs(3,null,null,p),l.current=I,I.stateNode=l,p=wu(),p.refCount++,l.pooledCache=p,p.refCount++,I.memoizedState={element:w,isDehydrated:y,cache:p},Hi(I),l}function Kt(l){return l?(l=Na,l):Na}function $t(l,p,y,w,E,I){E=Kt(E),w.context===null?w.context=E:w.pendingContext=E,w=ro(p),w.payload={element:y},I=I===void 0?null:I,I!==null&&(w.callback=I),y=Eo(l,w,p),y!==null&&(Ws(y,l,p),ia(y,l,p))}function Lt(l,p){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var y=l.retryLane;l.retryLane=y!==0&&y<p?y:p}}function gi(l,p){Lt(l,p),(l=l.alternate)&&Lt(l,p)}function xn(l){if(l.tag===13){var p=gc(l,67108864);p!==null&&Ws(p,l,67108864),gi(l,67108864)}}var On=!0;function Vs(l,p,y,w){var E=Xe.T;Xe.T=null;var I=dt.p;try{dt.p=2,Ys(l,p,y,w)}finally{dt.p=I,Xe.T=E}}function ho(l,p,y,w){var E=Xe.T;Xe.T=null;var I=dt.p;try{dt.p=8,Ys(l,p,y,w)}finally{dt.p=I,Xe.T=E}}function Ys(l,p,y,w){if(On){var E=is(w);if(E===null)Vp(l,p,w,sn,y),Nn(l,w);else if(ma(E,l,p,y,w))w.stopPropagation();else if(Nn(l,w),p&4&&-1<ps.indexOf(l)){for(;E!==null;){var I=In(E);if(I!==null)switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var X=De(I.pendingLanes);if(X!==0){var ie=I;for(ie.pendingLanes|=2,ie.entangledLanes|=2;X;){var we=1<<31-Yn(X);ie.entanglements[1]|=we,X&=~we}el(I),(Ui&6)===0&&(Ap=Rn()+500,Yh(0))}}break;case 13:ie=gc(I,2),ie!==null&&Ws(ie,I,2),Op(),gi(I,2)}if(I=is(w),I===null&&Vp(l,p,w,sn,y),I===E)break;E=I}E!==null&&w.stopPropagation()}else Vp(l,p,w,null,y)}}function is(l){return l=es(l),Xn(l)}var sn=null;function Xn(l){if(sn=null,l=Vn(l),l!==null){var p=f(l);if(p===null)l=null;else{var y=p.tag;if(y===13){if(l=d(p),l!==null)return l;l=null}else if(y===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;l=null}else p!==l&&(l=null)}}return sn=l,null}function fs(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Yc()){case sc:return 2;case tr:return 8;case br:case pl:return 32;case Kr:return 268435456;default:return 32}default:return 32}}var ns=!1,Bn=null,ds=null,dn=null,Cs=new Map,Mn=new Map,pn=[],ps="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Nn(l,p){switch(l){case"focusin":case"focusout":Bn=null;break;case"dragenter":case"dragleave":ds=null;break;case"mouseover":case"mouseout":dn=null;break;case"pointerover":case"pointerout":Cs.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mn.delete(p.pointerId)}}function Fi(l,p,y,w,E,I){return l===null||l.nativeEvent!==I?(l={blockedOn:p,domEventName:y,eventSystemFlags:w,nativeEvent:I,targetContainers:[E]},p!==null&&(p=In(p),p!==null&&xn(p)),l):(l.eventSystemFlags|=w,p=l.targetContainers,E!==null&&p.indexOf(E)===-1&&p.push(E),l)}function ma(l,p,y,w,E){switch(p){case"focusin":return Bn=Fi(Bn,l,p,y,w,E),!0;case"dragenter":return ds=Fi(ds,l,p,y,w,E),!0;case"mouseover":return dn=Fi(dn,l,p,y,w,E),!0;case"pointerover":var I=E.pointerId;return Cs.set(I,Fi(Cs.get(I)||null,l,p,y,w,E)),!0;case"gotpointercapture":return I=E.pointerId,Mn.set(I,Fi(Mn.get(I)||null,l,p,y,w,E)),!0}return!1}function Qu(l){var p=Vn(l.target);if(p!==null){var y=f(p);if(y!==null){if(p=y.tag,p===13){if(p=d(y),p!==null){l.blockedOn=p,Ct(l.priority,function(){if(y.tag===13){var w=hs();w=Re(w);var E=gc(y,w);E!==null&&Ws(E,y,w),gi(y,w)}});return}}else if(p===3&&y.stateNode.current.memoizedState.isDehydrated){l.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Hr(l){if(l.blockedOn!==null)return!1;for(var p=l.targetContainers;0<p.length;){var y=is(l.nativeEvent);if(y===null){y=l.nativeEvent;var w=new y.constructor(y.type,y);vl=w,y.target.dispatchEvent(w),vl=null}else return p=In(y),p!==null&&xn(p),l.blockedOn=y,!1;p.shift()}return!0}function g_(l,p,y){Hr(l)&&y.delete(p)}function sf(){ns=!1,Bn!==null&&Hr(Bn)&&(Bn=null),ds!==null&&Hr(ds)&&(ds=null),dn!==null&&Hr(dn)&&(dn=null),Cs.forEach(g_),Mn.forEach(g_)}function nl(l,p){l.blockedOn===p&&(l.blockedOn=null,ns||(ns=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,sf)))}var Kl=null;function Wu(l){Kl!==l&&(Kl=l,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){Kl===l&&(Kl=null);for(var p=0;p<l.length;p+=3){var y=l[p],w=l[p+1],E=l[p+2];if(typeof w!="function"){if(Xn(w||y)===null)continue;break}var I=In(y);I!==null&&(l.splice(p,3),p-=3,Ur(I,{pending:!0,data:E,method:y.method,action:w},w,E))}}))}function sl(l){function p(we){return nl(we,l)}Bn!==null&&nl(Bn,l),ds!==null&&nl(ds,l),dn!==null&&nl(dn,l),Cs.forEach(p),Mn.forEach(p);for(var y=0;y<pn.length;y++){var w=pn[y];w.blockedOn===l&&(w.blockedOn=null)}for(;0<pn.length&&(y=pn[0],y.blockedOn===null);)Qu(y),y.blockedOn===null&&pn.shift();if(y=(l.ownerDocument||l).$$reactFormReplay,y!=null)for(w=0;w<y.length;w+=3){var E=y[w],I=y[w+1],X=E[We]||null;if(typeof I=="function")X||Wu(y);else if(X){var ie=null;if(I&&I.hasAttribute("formAction")){if(E=I,X=I[We]||null)ie=X.formAction;else if(Xn(E)!==null)continue}else ie=X.action;typeof ie=="function"?y[w+1]=ie:(y.splice(w,3),w-=3),Wu(y)}}}function Kp(l){this._internalRoot=l}Pd.prototype.render=Kp.prototype.render=function(l){var p=this._internalRoot;if(p===null)throw Error(n(409));var y=p.current,w=hs();$t(y,w,l,p,null,null)},Pd.prototype.unmount=Kp.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var p=l.containerInfo;$t(l.current,2,null,l,null,null),Op(),p[Wt]=null}};function Pd(l){this._internalRoot=l}Pd.prototype.unstable_scheduleHydration=function(l){if(l){var p=St();l={blockedOn:null,target:l,priority:p};for(var y=0;y<pn.length&&p!==0&&p<pn[y].priority;y++);pn.splice(y,0,l),y===0&&Qu(l)}};var Rg=e.version;if(Rg!=="19.1.0")throw Error(n(527,Rg,"19.1.0"));dt.findDOMNode=function(l){var p=l._reactInternals;if(p===void 0)throw typeof l.render=="function"?Error(n(188)):(l=Object.keys(l).join(","),Error(n(268,l)));return l=v(p),l=l!==null?A(l):null,l=l===null?null:l.stateNode,l};var y_={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Xe,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rf.isDisabled&&rf.supportsFiber)try{_o=rf.inject(y_),Kn=rf}catch{}}return zg.createRoot=function(l,p){if(!o(l))throw Error(n(299));var y=!1,w="",E=Xm,I=Dy,X=Ry,ie=null;return p!=null&&(p.unstable_strictMode===!0&&(y=!0),p.identifierPrefix!==void 0&&(w=p.identifierPrefix),p.onUncaughtError!==void 0&&(E=p.onUncaughtError),p.onCaughtError!==void 0&&(I=p.onCaughtError),p.onRecoverableError!==void 0&&(X=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(ie=p.unstable_transitionCallbacks)),p=Pt(l,1,!1,null,null,y,w,E,I,X,ie,null),l[Wt]=p.current,jp(l),new Kp(p)},zg.hydrateRoot=function(l,p,y){if(!o(l))throw Error(n(299));var w=!1,E="",I=Xm,X=Dy,ie=Ry,we=null,$e=null;return y!=null&&(y.unstable_strictMode===!0&&(w=!0),y.identifierPrefix!==void 0&&(E=y.identifierPrefix),y.onUncaughtError!==void 0&&(I=y.onUncaughtError),y.onCaughtError!==void 0&&(X=y.onCaughtError),y.onRecoverableError!==void 0&&(ie=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(we=y.unstable_transitionCallbacks),y.formState!==void 0&&($e=y.formState)),p=Pt(l,1,!0,p,y??null,w,E,I,X,ie,we,$e),p.context=Kt(null),y=p.current,w=hs(),w=Re(w),E=ro(w),E.callback=null,Eo(y,E,w),y=w,p.current.lanes=y,Ve(p,y),el(p),l[Wt]=p.current,jp(l),new Pd(p)},zg.version="19.1.0",zg}var M1;function cA(){if(M1)return kb.exports;M1=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),kb.exports=lA(),kb.exports}var uA=cA();function iy(){return iy=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},iy.apply(null,arguments)}function hA(s,e){if(s==null)return{};var t={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(e.indexOf(n)!==-1)continue;t[n]=s[n]}return t}class Qi{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){[e,t]=vm(this,e,t);let o=[];return this.decompose(0,e,o,2),n.length&&n.decompose(0,n.length,o,3),this.decompose(t,this.length,o,1),Vc.from(o,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=vm(this,e,t);let n=[];return this.decompose(e,t,n,0),Vc.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),o=new Qg(this),f=new Qg(e);for(let d=t,a=t;;){if(o.next(d),f.next(d),d=0,o.lineBreak!=f.lineBreak||o.done!=f.done||o.value!=f.value)return!1;if(a+=o.value.length,o.done||a>=n)return!0}}iter(e=1){return new Qg(this,e)}iterRange(e,t=this.length){return new $S(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else{t==null&&(t=this.lines+1);let o=this.line(e).from;n=this.iterRange(o,Math.max(o,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new XS(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Qi.empty:e.length<=32?new As(e):Vc.from(As.split(e,[]))}}class As extends Qi{constructor(e,t=fA(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,o){for(let f=0;;f++){let d=this.text[f],a=o+d.length;if((t?n:a)>=e)return new dA(o,a,n,d);o=a+1,n++}}decompose(e,t,n,o){let f=e<=0&&t>=this.length?this:new As(C1(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(o&1){let d=n.pop(),a=G_(f.text,d.text.slice(),0,f.length);if(a.length<=32)n.push(new As(a,d.length+f.length));else{let v=a.length>>1;n.push(new As(a.slice(0,v)),new As(a.slice(v)))}}else n.push(f)}replace(e,t,n){if(!(n instanceof As))return super.replace(e,t,n);[e,t]=vm(this,e,t);let o=G_(this.text,G_(n.text,C1(this.text,0,e)),t),f=this.length+n.length-(t-e);return o.length<=32?new As(o,f):Vc.from(As.split(o,[]),f)}sliceString(e,t=this.length,n=`
`){[e,t]=vm(this,e,t);let o="";for(let f=0,d=0;f<=t&&d<this.text.length;d++){let a=this.text[d],v=f+a.length;f>e&&d&&(o+=n),e<v&&t>f&&(o+=a.slice(Math.max(0,e-f),t-f)),f=v+1}return o}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],o=-1;for(let f of e)n.push(f),o+=f.length+1,n.length==32&&(t.push(new As(n,o)),n=[],o=-1);return o>-1&&t.push(new As(n,o)),t}}class Vc extends Qi{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,t,n,o){for(let f=0;;f++){let d=this.children[f],a=o+d.length,v=n+d.lines-1;if((t?v:a)>=e)return d.lineInner(e,t,n,o);o=a+1,n=v+1}}decompose(e,t,n,o){for(let f=0,d=0;d<=t&&f<this.children.length;f++){let a=this.children[f],v=d+a.length;if(e<=v&&t>=d){let A=o&((d<=e?1:0)|(v>=t?2:0));d>=e&&v<=t&&!A?n.push(a):a.decompose(e-d,t-d,n,A)}d=v+1}}replace(e,t,n){if([e,t]=vm(this,e,t),n.lines<this.lines)for(let o=0,f=0;o<this.children.length;o++){let d=this.children[o],a=f+d.length;if(e>=f&&t<=a){let v=d.replace(e-f,t-f,n),A=this.lines-d.lines+v.lines;if(v.lines<A>>4&&v.lines>A>>6){let P=this.children.slice();return P[o]=v,new Vc(P,this.length-(t-e)+n.length)}return super.replace(f,a,v)}f=a+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){[e,t]=vm(this,e,t);let o="";for(let f=0,d=0;f<this.children.length&&d<=t;f++){let a=this.children[f],v=d+a.length;d>e&&f&&(o+=n),e<v&&t>d&&(o+=a.sliceString(e-d,t-d,n)),d=v+1}return o}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Vc))return 0;let n=0,[o,f,d,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;o+=t,f+=t){if(o==d||f==a)return n;let v=this.children[o],A=e.children[f];if(v!=A)return n+v.scanIdentical(A,t);n+=v.length+1}}static from(e,t=e.reduce((n,o)=>n+o.length+1,-1)){let n=0;for(let F of e)n+=F.lines;if(n<32){let F=[];for(let K of e)K.flatten(F);return new As(F,t)}let o=Math.max(32,n>>5),f=o<<1,d=o>>1,a=[],v=0,A=-1,P=[];function L(F){let K;if(F.lines>f&&F instanceof Vc)for(let se of F.children)L(se);else F.lines>d&&(v>d||!v)?(j(),a.push(F)):F instanceof As&&v&&(K=P[P.length-1])instanceof As&&F.lines+K.lines<=32?(v+=F.lines,A+=F.length+1,P[P.length-1]=new As(K.text.concat(F.text),K.length+1+F.length)):(v+F.lines>o&&j(),v+=F.lines,A+=F.length+1,P.push(F))}function j(){v!=0&&(a.push(P.length==1?P[0]:Vc.from(P,A)),A=-1,v=P.length=0)}for(let F of e)L(F);return j(),a.length==1?a[0]:new Vc(a,t)}}Qi.empty=new As([""],0);function fA(s){let e=-1;for(let t of s)e+=t.length+1;return e}function G_(s,e,t=0,n=1e9){for(let o=0,f=0,d=!0;f<s.length&&o<=n;f++){let a=s[f],v=o+a.length;v>=t&&(v>n&&(a=a.slice(0,n-o)),o<t&&(a=a.slice(t-o)),d?(e[e.length-1]+=a,d=!1):e.push(a)),o=v+1}return e}function C1(s,e,t){return G_(s,[""],e,t)}class Qg{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof As?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,o=this.nodes[n],f=this.offsets[n],d=f>>1,a=o instanceof As?o.text.length:o.children.length;if(d==(t>0?a:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((f&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(o instanceof As){let v=o.text[d+(t<0?-1:0)];if(this.offsets[n]+=t,v.length>Math.max(0,e))return this.value=e==0?v:t>0?v.slice(e):v.slice(0,v.length-e),this;e-=v.length}else{let v=o.children[d+(t<0?-1:0)];e>v.length?(e-=v.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(v),this.offsets.push(t>0?1:(v instanceof As?v.text.length:v.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class $S{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new Qg(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:o}=this.cursor.next(e);return this.pos+=(o.length+e)*t,this.value=o.length<=n?o:t<0?o.slice(o.length-n):o.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class XS{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:o}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=o,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Qi.prototype[Symbol.iterator]=function(){return this.iter()},Qg.prototype[Symbol.iterator]=$S.prototype[Symbol.iterator]=XS.prototype[Symbol.iterator]=function(){return this});class dA{constructor(e,t,n,o){this.from=e,this.to=t,this.number=n,this.text=o}get length(){return this.to-this.from}}function vm(s,e,t){return e=Math.max(0,Math.min(s.length,e)),[e,Math.max(e,Math.min(s.length,t))]}let hm="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<hm.length;s++)hm[s]+=hm[s-1];function pA(s){for(let e=1;e<hm.length;e+=2)if(hm[e]>s)return hm[e-1]<=s;return!1}function A1(s){return s>=127462&&s<=127487}const k1=8205;function Ir(s,e,t=!0,n=!0){return(t?QS:mA)(s,e,n)}function QS(s,e,t){if(e==s.length)return e;e&&WS(s.charCodeAt(e))&&KS(s.charCodeAt(e-1))&&e--;let n=Or(s,e);for(e+=rl(n);e<s.length;){let o=Or(s,e);if(n==k1||o==k1||t&&pA(o))e+=rl(o),n=o;else if(A1(o)){let f=0,d=e-2;for(;d>=0&&A1(Or(s,d));)f++,d-=2;if(f%2==0)break;e+=2}else break}return e}function mA(s,e,t){for(;e>0;){let n=QS(s,e-2,t);if(n<e)return n;e--}return 0}function WS(s){return s>=56320&&s<57344}function KS(s){return s>=55296&&s<56320}function Or(s,e){let t=s.charCodeAt(e);if(!KS(t)||e+1==s.length)return t;let n=s.charCodeAt(e+1);return WS(n)?(t-55296<<10)+(n-56320)+65536:t}function xx(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}function rl(s){return s<65536?1:2}const dv=/\r\n?|\n/;var po=function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s}(po||(po={}));class Zc{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t+1];e+=n<0?this.sections[t]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,n=0,o=0;t<this.sections.length;){let f=this.sections[t++],d=this.sections[t++];d<0?(e(n,o,f),o+=f):o+=d,n+=f}}iterChangedRanges(e,t=!1){pv(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let n=this.sections[t++],o=this.sections[t++];o<0?e.push(n,o):e.push(o,n)}return new Zc(e)}composeDesc(e){return this.empty?e:e.empty?this:YS(this,e)}mapDesc(e,t=!1){return e.empty?this:mv(this,e,t)}mapPos(e,t=-1,n=po.Simple){let o=0,f=0;for(let d=0;d<this.sections.length;){let a=this.sections[d++],v=this.sections[d++],A=o+a;if(v<0){if(A>e)return f+(e-o);f+=a}else{if(n!=po.Simple&&A>=e&&(n==po.TrackDel&&o<e&&A>e||n==po.TrackBefore&&o<e||n==po.TrackAfter&&A>e))return null;if(A>e||A==e&&t<0&&!a)return e==o||t<0?f:f+v;f+=v}o=A}if(e>o)throw new RangeError(`Position ${e} is out of range for changeset of length ${o}`);return f}touchesRange(e,t=e){for(let n=0,o=0;n<this.sections.length&&o<=t;){let f=this.sections[n++],d=this.sections[n++],a=o+f;if(d>=0&&o<=t&&a>=e)return o<e&&a>t?"cover":!0;o=a}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let n=this.sections[t++],o=this.sections[t++];e+=(e?" ":"")+n+(o>=0?":"+o:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Zc(e)}static create(e){return new Zc(e)}}class Js extends Zc{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return pv(this,(t,n,o,f,d)=>e=e.replace(o,o+(n-t),d),!1),e}mapDesc(e,t=!1){return mv(this,e,t,!0)}invert(e){let t=this.sections.slice(),n=[];for(let o=0,f=0;o<t.length;o+=2){let d=t[o],a=t[o+1];if(a>=0){t[o]=a,t[o+1]=d;let v=o>>1;for(;n.length<v;)n.push(Qi.empty);n.push(d?e.slice(f,f+d):Qi.empty)}f+=d}return new Js(t,n)}compose(e){return this.empty?e:e.empty?this:YS(this,e,!0)}map(e,t=!1){return e.empty?this:mv(this,e,t,!0)}iterChanges(e,t=!1){pv(this,e,t)}get desc(){return Zc.create(this.sections)}filter(e){let t=[],n=[],o=[],f=new ny(this);e:for(let d=0,a=0;;){let v=d==e.length?1e9:e[d++];for(;a<v||a==v&&f.len==0;){if(f.done)break e;let P=Math.min(f.len,v-a);Gr(o,P,-1);let L=f.ins==-1?-1:f.off==0?f.ins:0;Gr(t,P,L),L>0&&df(n,t,f.text),f.forward(P),a+=P}let A=e[d++];for(;a<A;){if(f.done)break e;let P=Math.min(f.len,A-a);Gr(t,P,-1),Gr(o,P,f.ins==-1?-1:f.off==0?f.ins:0),f.forward(P),a+=P}}return{changes:new Js(t,n),filtered:Zc.create(o)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t],o=this.sections[t+1];o<0?e.push(n):o==0?e.push([n]):e.push([n].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,n){let o=[],f=[],d=0,a=null;function v(P=!1){if(!P&&!o.length)return;d<t&&Gr(o,t-d,-1);let L=new Js(o,f);a=a?a.compose(L.map(a)):L,o=[],f=[],d=0}function A(P){if(Array.isArray(P))for(let L of P)A(L);else if(P instanceof Js){if(P.length!=t)throw new RangeError(`Mismatched change set length (got ${P.length}, expected ${t})`);v(),a=a?a.compose(P.map(a)):P}else{let{from:L,to:j=L,insert:F}=P;if(L>j||L<0||j>t)throw new RangeError(`Invalid change range ${L} to ${j} (in doc of length ${t})`);let K=F?typeof F=="string"?Qi.of(F.split(n||dv)):F:Qi.empty,se=K.length;if(L==j&&se==0)return;L<d&&v(),L>d&&Gr(o,L-d,-1),Gr(o,j-L,se),df(f,o,K),d=j}}return A(e),v(!a),a}static empty(e){return new Js(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],n=[];for(let o=0;o<e.length;o++){let f=e[o];if(typeof f=="number")t.push(f,-1);else{if(!Array.isArray(f)||typeof f[0]!="number"||f.some((d,a)=>a&&typeof d!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(f.length==1)t.push(f[0],0);else{for(;n.length<o;)n.push(Qi.empty);n[o]=Qi.of(f.slice(1)),t.push(f[0],n[o].length)}}}return new Js(t,n)}static createSet(e,t){return new Js(e,t)}}function Gr(s,e,t,n=!1){if(e==0&&t<=0)return;let o=s.length-2;o>=0&&t<=0&&t==s[o+1]?s[o]+=e:e==0&&s[o]==0?s[o+1]+=t:n?(s[o]+=e,s[o+1]+=t):s.push(e,t)}function df(s,e,t){if(t.length==0)return;let n=e.length-2>>1;if(n<s.length)s[s.length-1]=s[s.length-1].append(t);else{for(;s.length<n;)s.push(Qi.empty);s.push(t)}}function pv(s,e,t){let n=s.inserted;for(let o=0,f=0,d=0;d<s.sections.length;){let a=s.sections[d++],v=s.sections[d++];if(v<0)o+=a,f+=a;else{let A=o,P=f,L=Qi.empty;for(;A+=a,P+=v,v&&n&&(L=L.append(n[d-2>>1])),!(t||d==s.sections.length||s.sections[d+1]<0);)a=s.sections[d++],v=s.sections[d++];e(o,A,f,P,L),o=A,f=P}}}function mv(s,e,t,n=!1){let o=[],f=n?[]:null,d=new ny(s),a=new ny(e);for(let v=-1;;)if(d.ins==-1&&a.ins==-1){let A=Math.min(d.len,a.len);Gr(o,A,-1),d.forward(A),a.forward(A)}else if(a.ins>=0&&(d.ins<0||v==d.i||d.off==0&&(a.len<d.len||a.len==d.len&&!t))){let A=a.len;for(Gr(o,a.ins,-1);A;){let P=Math.min(d.len,A);d.ins>=0&&v<d.i&&d.len<=P&&(Gr(o,0,d.ins),f&&df(f,o,d.text),v=d.i),d.forward(P),A-=P}a.next()}else if(d.ins>=0){let A=0,P=d.len;for(;P;)if(a.ins==-1){let L=Math.min(P,a.len);A+=L,P-=L,a.forward(L)}else if(a.ins==0&&a.len<P)P-=a.len,a.next();else break;Gr(o,A,v<d.i?d.ins:0),f&&v<d.i&&df(f,o,d.text),v=d.i,d.forward(d.len-P)}else{if(d.done&&a.done)return f?Js.createSet(o,f):Zc.create(o);throw new Error("Mismatched change set lengths")}}function YS(s,e,t=!1){let n=[],o=t?[]:null,f=new ny(s),d=new ny(e);for(let a=!1;;){if(f.done&&d.done)return o?Js.createSet(n,o):Zc.create(n);if(f.ins==0)Gr(n,f.len,0,a),f.next();else if(d.len==0&&!d.done)Gr(n,0,d.ins,a),o&&df(o,n,d.text),d.next();else{if(f.done||d.done)throw new Error("Mismatched change set lengths");{let v=Math.min(f.len2,d.len),A=n.length;if(f.ins==-1){let P=d.ins==-1?-1:d.off?0:d.ins;Gr(n,v,P,a),o&&P&&df(o,n,d.text)}else d.ins==-1?(Gr(n,f.off?0:f.len,v,a),o&&df(o,n,f.textBit(v))):(Gr(n,f.off?0:f.len,d.off?0:d.ins,a),o&&!d.off&&df(o,n,d.text));a=(f.ins>v||d.ins>=0&&d.len>v)&&(a||n.length>A),f.forward2(v),d.forward(v)}}}}class ny{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Qi.empty:e[t]}textBit(e){let{inserted:t}=this.set,n=this.i-2>>1;return n>=t.length&&!e?Qi.empty:t[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class zd{constructor(e,t,n){this.from=e,this.to=t,this.flags=n}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let n,o;return this.empty?n=o=e.mapPos(this.from,t):(n=e.mapPos(this.from,1),o=e.mapPos(this.to,-1)),n==this.from&&o==this.to?this:new zd(n,o,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return yt.range(e,t);let n=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return yt.range(this.anchor,n)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return yt.range(e.anchor,e.head)}static create(e,t,n){return new zd(e,t,n)}}class yt{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:yt.create(this.ranges.map(n=>n.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(e.ranges[n],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new yt([this.main],0)}addRange(e,t=!0){return yt.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let n=this.ranges.slice();return n[t]=e,yt.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new yt(e.ranges.map(t=>zd.fromJSON(t)),e.main)}static single(e,t=e){return new yt([yt.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,o=0;o<e.length;o++){let f=e[o];if(f.empty?f.from<=n:f.from<n)return yt.normalized(e.slice(),t);n=f.to}return new yt(e,t)}static cursor(e,t=0,n,o){return zd.create(e,e,(t==0?0:t<0?8:16)|(n==null?7:Math.min(6,n))|(o??16777215)<<6)}static range(e,t,n,o){let f=(n??16777215)<<6|(o==null?7:Math.min(6,o));return t<e?zd.create(t,e,48|f):zd.create(e,t,(t>e?8:0)|f)}static normalized(e,t=0){let n=e[t];e.sort((o,f)=>o.from-f.from),t=e.indexOf(n);for(let o=1;o<e.length;o++){let f=e[o],d=e[o-1];if(f.empty?f.from<=d.to:f.from<d.to){let a=d.from,v=Math.max(f.to,d.to);o<=t&&t--,e.splice(--o,2,f.anchor>f.head?yt.range(v,a):yt.range(a,v))}}return new yt(e,t)}}function JS(s,e){for(let t of s.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let wx=0;class Ut{constructor(e,t,n,o,f){this.combine=e,this.compareInput=t,this.compare=n,this.isStatic=o,this.id=wx++,this.default=e([]),this.extensions=typeof f=="function"?f(this):f}get reader(){return this}static define(e={}){return new Ut(e.combine||(t=>t),e.compareInput||((t,n)=>t===n),e.compare||(e.combine?(t,n)=>t===n:Sx),!!e.static,e.enables)}of(e){return new $_([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new $_(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new $_(e,this,2,t)}from(e,t){return t||(t=n=>n),this.compute([e],n=>t(n.field(e)))}}function Sx(s,e){return s==e||s.length==e.length&&s.every((t,n)=>t===e[n])}class $_{constructor(e,t,n,o){this.dependencies=e,this.facet=t,this.type=n,this.value=o,this.id=wx++}dynamicSlot(e){var t;let n=this.value,o=this.facet.compareInput,f=this.id,d=e[f]>>1,a=this.type==2,v=!1,A=!1,P=[];for(let L of this.dependencies)L=="doc"?v=!0:L=="selection"?A=!0:(((t=e[L.id])!==null&&t!==void 0?t:1)&1)==0&&P.push(e[L.id]);return{create(L){return L.values[d]=n(L),1},update(L,j){if(v&&j.docChanged||A&&(j.docChanged||j.selection)||gv(L,P)){let F=n(L);if(a?!E1(F,L.values[d],o):!o(F,L.values[d]))return L.values[d]=F,1}return 0},reconfigure:(L,j)=>{let F,K=j.config.address[f];if(K!=null){let se=c0(j,K);if(this.dependencies.every(le=>le instanceof Ut?j.facet(le)===L.facet(le):le instanceof zr?j.field(le,!1)==L.field(le,!1):!0)||(a?E1(F=n(L),se,o):o(F=n(L),se)))return L.values[d]=se,0}else F=n(L);return L.values[d]=F,1}}}}function E1(s,e,t){if(s.length!=e.length)return!1;for(let n=0;n<s.length;n++)if(!t(s[n],e[n]))return!1;return!0}function gv(s,e){let t=!1;for(let n of e)Wg(s,n)&1&&(t=!0);return t}function gA(s,e,t){let n=t.map(v=>s[v.id]),o=t.map(v=>v.type),f=n.filter(v=>!(v&1)),d=s[e.id]>>1;function a(v){let A=[];for(let P=0;P<n.length;P++){let L=c0(v,n[P]);if(o[P]==2)for(let j of L)A.push(j);else A.push(L)}return e.combine(A)}return{create(v){for(let A of n)Wg(v,A);return v.values[d]=a(v),1},update(v,A){if(!gv(v,f))return 0;let P=a(v);return e.compare(P,v.values[d])?0:(v.values[d]=P,1)},reconfigure(v,A){let P=gv(v,n),L=A.config.facets[e.id],j=A.facet(e);if(L&&!P&&Sx(t,L))return v.values[d]=j,0;let F=a(v);return e.compare(F,j)?(v.values[d]=j,0):(v.values[d]=F,1)}}}const P1=Ut.define({static:!0});class zr{constructor(e,t,n,o,f){this.id=e,this.createF=t,this.updateF=n,this.compareF=o,this.spec=f,this.provides=void 0}static define(e){let t=new zr(wx++,e.create,e.update,e.compare||((n,o)=>n===o),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(P1).find(n=>n.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:n=>(n.values[t]=this.create(n),1),update:(n,o)=>{let f=n.values[t],d=this.updateF(f,o);return this.compareF(f,d)?0:(n.values[t]=d,1)},reconfigure:(n,o)=>o.config.address[this.id]!=null?(n.values[t]=o.field(this),0):(n.values[t]=this.create(n),1)}}init(e){return[this,P1.of({field:this,create:e})]}get extension(){return this}}const Dd={lowest:4,low:3,default:2,high:1,highest:0};function Lg(s){return e=>new e2(e,s)}const Xd={highest:Lg(Dd.highest),high:Lg(Dd.high),default:Lg(Dd.default),low:Lg(Dd.low),lowest:Lg(Dd.lowest)};class e2{constructor(e,t){this.inner=e,this.prec=t}}class V0{of(e){return new yv(this,e)}reconfigure(e){return V0.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class yv{constructor(e,t){this.compartment=e,this.inner=t}}class l0{constructor(e,t,n,o,f,d){for(this.base=e,this.compartments=t,this.dynamicSlots=n,this.address=o,this.staticValues=f,this.facets=d,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,n){let o=[],f=Object.create(null),d=new Map;for(let j of yA(e,t,d))j instanceof zr?o.push(j):(f[j.facet.id]||(f[j.facet.id]=[])).push(j);let a=Object.create(null),v=[],A=[];for(let j of o)a[j.id]=A.length<<1,A.push(F=>j.slot(F));let P=n==null?void 0:n.config.facets;for(let j in f){let F=f[j],K=F[0].facet,se=P&&P[j]||[];if(F.every(le=>le.type==0))if(a[K.id]=v.length<<1|1,Sx(se,F))v.push(n.facet(K));else{let le=K.combine(F.map(ve=>ve.value));v.push(n&&K.compare(le,n.facet(K))?n.facet(K):le)}else{for(let le of F)le.type==0?(a[le.id]=v.length<<1|1,v.push(le.value)):(a[le.id]=A.length<<1,A.push(ve=>le.dynamicSlot(ve)));a[K.id]=A.length<<1,A.push(le=>gA(le,K,F))}}let L=A.map(j=>j(a));return new l0(e,d,L,a,v,f)}}function yA(s,e,t){let n=[[],[],[],[],[]],o=new Map;function f(d,a){let v=o.get(d);if(v!=null){if(v<=a)return;let A=n[v].indexOf(d);A>-1&&n[v].splice(A,1),d instanceof yv&&t.delete(d.compartment)}if(o.set(d,a),Array.isArray(d))for(let A of d)f(A,a);else if(d instanceof yv){if(t.has(d.compartment))throw new RangeError("Duplicate use of compartment in extensions");let A=e.get(d.compartment)||d.inner;t.set(d.compartment,A),f(A,a)}else if(d instanceof e2)f(d.inner,d.prec);else if(d instanceof zr)n[a].push(d),d.provides&&f(d.provides,a);else if(d instanceof $_)n[a].push(d),d.facet.extensions&&f(d.facet.extensions,Dd.default);else{let A=d.extension;if(!A)throw new Error(`Unrecognized extension value in extension set (${d}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);f(A,a)}}return f(s,Dd.default),n.reduce((d,a)=>d.concat(a))}function Wg(s,e){if(e&1)return 2;let t=e>>1,n=s.status[t];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;s.status[t]=4;let o=s.computeSlot(s,s.config.dynamicSlots[t]);return s.status[t]=2|o}function c0(s,e){return e&1?s.config.staticValues[e>>1]:s.values[e>>1]}const t2=Ut.define(),_v=Ut.define({combine:s=>s.some(e=>e),static:!0}),i2=Ut.define({combine:s=>s.length?s[0]:void 0,static:!0}),n2=Ut.define(),s2=Ut.define(),r2=Ut.define(),o2=Ut.define({combine:s=>s.length?s[0]:!1});class Qc{constructor(e,t){this.type=e,this.value=t}static define(){return new _A}}class _A{of(e){return new Qc(this,e)}}class bA{constructor(e){this.map=e}of(e){return new xi(this,e)}}class xi{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new xi(this.type,t)}is(e){return this.type==e}static define(e={}){return new bA(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let n=[];for(let o of e){let f=o.map(t);f&&n.push(f)}return n}}xi.reconfigure=xi.define();xi.appendConfig=xi.define();class er{constructor(e,t,n,o,f,d){this.startState=e,this.changes=t,this.selection=n,this.effects=o,this.annotations=f,this.scrollIntoView=d,this._doc=null,this._state=null,n&&JS(n,t.newLength),f.some(a=>a.type==er.time)||(this.annotations=f.concat(er.time.of(Date.now())))}static create(e,t,n,o,f,d){return new er(e,t,n,o,f,d)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(er.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}er.time=Qc.define();er.userEvent=Qc.define();er.addToHistory=Qc.define();er.remote=Qc.define();function vA(s,e){let t=[];for(let n=0,o=0;;){let f,d;if(n<s.length&&(o==e.length||e[o]>=s[n]))f=s[n++],d=s[n++];else if(o<e.length)f=e[o++],d=e[o++];else return t;!t.length||t[t.length-1]<f?t.push(f,d):t[t.length-1]<d&&(t[t.length-1]=d)}}function a2(s,e,t){var n;let o,f,d;return t?(o=e.changes,f=Js.empty(e.changes.length),d=s.changes.compose(e.changes)):(o=e.changes.map(s.changes),f=s.changes.mapDesc(e.changes,!0),d=s.changes.compose(o)),{changes:d,selection:e.selection?e.selection.map(f):(n=s.selection)===null||n===void 0?void 0:n.map(o),effects:xi.mapEffects(s.effects,o).concat(xi.mapEffects(e.effects,f)),annotations:s.annotations.length?s.annotations.concat(e.annotations):e.annotations,scrollIntoView:s.scrollIntoView||e.scrollIntoView}}function bv(s,e,t){let n=e.selection,o=fm(e.annotations);return e.userEvent&&(o=o.concat(er.userEvent.of(e.userEvent))),{changes:e.changes instanceof Js?e.changes:Js.of(e.changes||[],t,s.facet(i2)),selection:n&&(n instanceof yt?n:yt.single(n.anchor,n.head)),effects:fm(e.effects),annotations:o,scrollIntoView:!!e.scrollIntoView}}function l2(s,e,t){let n=bv(s,e.length?e[0]:{},s.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let f=1;f<e.length;f++){e[f].filter===!1&&(t=!1);let d=!!e[f].sequential;n=a2(n,bv(s,e[f],d?n.changes.newLength:s.doc.length),d)}let o=er.create(s,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return wA(t?xA(o):o)}function xA(s){let e=s.startState,t=!0;for(let o of e.facet(n2)){let f=o(s);if(f===!1){t=!1;break}Array.isArray(f)&&(t=t===!0?f:vA(t,f))}if(t!==!0){let o,f;if(t===!1)f=s.changes.invertedDesc,o=Js.empty(e.doc.length);else{let d=s.changes.filter(t);o=d.changes,f=d.filtered.mapDesc(d.changes).invertedDesc}s=er.create(e,o,s.selection&&s.selection.map(f),xi.mapEffects(s.effects,f),s.annotations,s.scrollIntoView)}let n=e.facet(s2);for(let o=n.length-1;o>=0;o--){let f=n[o](s);f instanceof er?s=f:Array.isArray(f)&&f.length==1&&f[0]instanceof er?s=f[0]:s=l2(e,fm(f),!1)}return s}function wA(s){let e=s.startState,t=e.facet(r2),n=s;for(let o=t.length-1;o>=0;o--){let f=t[o](s);f&&Object.keys(f).length&&(n=a2(n,bv(e,f,s.changes.newLength),!0))}return n==s?s:er.create(e,s.changes,s.selection,n.effects,n.annotations,n.scrollIntoView)}const SA=[];function fm(s){return s==null?SA:Array.isArray(s)?s:[s]}var Qn=function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s}(Qn||(Qn={}));const TA=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let vv;try{vv=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function MA(s){if(vv)return vv.test(s);for(let e=0;e<s.length;e++){let t=s[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||TA.test(t)))return!0}return!1}function CA(s){return e=>{if(!/\S/.test(e))return Qn.Space;if(MA(e))return Qn.Word;for(let t=0;t<s.length;t++)if(e.indexOf(s[t])>-1)return Qn.Word;return Qn.Other}}class Bi{constructor(e,t,n,o,f,d){this.config=e,this.doc=t,this.selection=n,this.values=o,this.status=e.statusTemplate.slice(),this.computeSlot=f,d&&(d._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)Wg(this,a<<1);this.computeSlot=null}field(e,t=!0){let n=this.config.address[e.id];if(n==null){if(t)throw new RangeError("Field is not present in this state");return}return Wg(this,n),c0(this,n)}update(...e){return l2(this,e,!0)}applyTransaction(e){let t=this.config,{base:n,compartments:o}=t;for(let a of e.effects)a.is(V0.reconfigure)?(t&&(o=new Map,t.compartments.forEach((v,A)=>o.set(A,v)),t=null),o.set(a.value.compartment,a.value.extension)):a.is(xi.reconfigure)?(t=null,n=a.value):a.is(xi.appendConfig)&&(t=null,n=fm(n).concat(a.value));let f;t?f=e.startState.values.slice():(t=l0.resolve(n,o,this),f=new Bi(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(v,A)=>A.reconfigure(v,this),null).values);let d=e.startState.facet(_v)?e.newSelection:e.newSelection.asSingle();new Bi(t,e.newDoc,d,f,(a,v)=>v.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:yt.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,n=e(t.ranges[0]),o=this.changes(n.changes),f=[n.range],d=fm(n.effects);for(let a=1;a<t.ranges.length;a++){let v=e(t.ranges[a]),A=this.changes(v.changes),P=A.map(o);for(let j=0;j<a;j++)f[j]=f[j].map(P);let L=o.mapDesc(A,!0);f.push(v.range.map(L)),o=o.compose(P),d=xi.mapEffects(d,P).concat(xi.mapEffects(fm(v.effects),L))}return{changes:o,selection:yt.create(f,t.mainIndex),effects:d}}changes(e=[]){return e instanceof Js?e:Js.of(e,this.doc.length,this.facet(Bi.lineSeparator))}toText(e){return Qi.of(e.split(this.facet(Bi.lineSeparator)||dv))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Wg(this,t),c0(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let o=e[n];o instanceof zr&&this.config.address[o.id]!=null&&(t[n]=o.spec.toJSON(this.field(e[n]),this))}return t}static fromJSON(e,t={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let o=[];if(n){for(let f in n)if(Object.prototype.hasOwnProperty.call(e,f)){let d=n[f],a=e[f];o.push(d.init(v=>d.spec.fromJSON(a,v)))}}return Bi.create({doc:e.doc,selection:yt.fromJSON(e.selection),extensions:t.extensions?o.concat([t.extensions]):o})}static create(e={}){let t=l0.resolve(e.extensions||[],new Map),n=e.doc instanceof Qi?e.doc:Qi.of((e.doc||"").split(t.staticFacet(Bi.lineSeparator)||dv)),o=e.selection?e.selection instanceof yt?e.selection:yt.single(e.selection.anchor,e.selection.head):yt.single(0);return JS(o,n.length),t.staticFacet(_v)||(o=o.asSingle()),new Bi(t,n,o,t.dynamicSlots.map(()=>null),(f,d)=>d.create(f),null)}get tabSize(){return this.facet(Bi.tabSize)}get lineBreak(){return this.facet(Bi.lineSeparator)||`
`}get readOnly(){return this.facet(o2)}phrase(e,...t){for(let n of this.facet(Bi.phrases))if(Object.prototype.hasOwnProperty.call(n,e)){e=n[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(n,o)=>{if(o=="$")return"$";let f=+(o||1);return!f||f>t.length?n:t[f-1]})),e}languageDataAt(e,t,n=-1){let o=[];for(let f of this.facet(t2))for(let d of f(this,t,n))Object.prototype.hasOwnProperty.call(d,e)&&o.push(d[e]);return o}charCategorizer(e){return CA(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:n,length:o}=this.doc.lineAt(e),f=this.charCategorizer(e),d=e-n,a=e-n;for(;d>0;){let v=Ir(t,d,!1);if(f(t.slice(v,d))!=Qn.Word)break;d=v}for(;a<o;){let v=Ir(t,a);if(f(t.slice(a,v))!=Qn.Word)break;a=v}return d==a?null:yt.range(d+n,a+n)}}Bi.allowMultipleSelections=_v;Bi.tabSize=Ut.define({combine:s=>s.length?s[0]:4});Bi.lineSeparator=i2;Bi.readOnly=o2;Bi.phrases=Ut.define({compare(s,e){let t=Object.keys(s),n=Object.keys(e);return t.length==n.length&&t.every(o=>s[o]==e[o])}});Bi.languageData=t2;Bi.changeFilter=n2;Bi.transactionFilter=s2;Bi.transactionExtender=r2;V0.reconfigure=xi.define();function Wc(s,e,t={}){let n={};for(let o of s)for(let f of Object.keys(o)){let d=o[f],a=n[f];if(a===void 0)n[f]=d;else if(!(a===d||d===void 0))if(Object.hasOwnProperty.call(t,f))n[f]=t[f](a,d);else throw new Error("Config merge conflict for field "+f)}for(let o in e)n[o]===void 0&&(n[o]=e[o]);return n}class Ud{eq(e){return this==e}range(e,t=e){return xv.create(e,t,this)}}Ud.prototype.startSide=Ud.prototype.endSide=0;Ud.prototype.point=!1;Ud.prototype.mapMode=po.TrackDel;let xv=class c2{constructor(e,t,n){this.from=e,this.to=t,this.value=n}static create(e,t,n){return new c2(e,t,n)}};function wv(s,e){return s.from-e.from||s.value.startSide-e.value.startSide}class Tx{constructor(e,t,n,o){this.from=e,this.to=t,this.value=n,this.maxPoint=o}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,o=0){let f=n?this.to:this.from;for(let d=o,a=f.length;;){if(d==a)return d;let v=d+a>>1,A=f[v]-e||(n?this.value[v].endSide:this.value[v].startSide)-t;if(v==d)return A>=0?d:a;A>=0?a=v:d=v+1}}between(e,t,n,o){for(let f=this.findIndex(t,-1e9,!0),d=this.findIndex(n,1e9,!1,f);f<d;f++)if(o(this.from[f]+e,this.to[f]+e,this.value[f])===!1)return!1}map(e,t){let n=[],o=[],f=[],d=-1,a=-1;for(let v=0;v<this.value.length;v++){let A=this.value[v],P=this.from[v]+e,L=this.to[v]+e,j,F;if(P==L){let K=t.mapPos(P,A.startSide,A.mapMode);if(K==null||(j=F=K,A.startSide!=A.endSide&&(F=t.mapPos(P,A.endSide),F<j)))continue}else if(j=t.mapPos(P,A.startSide),F=t.mapPos(L,A.endSide),j>F||j==F&&A.startSide>0&&A.endSide<=0)continue;(F-j||A.endSide-A.startSide)<0||(d<0&&(d=j),A.point&&(a=Math.max(a,F-j)),n.push(A),o.push(j-d),f.push(F-d))}return{mapped:n.length?new Tx(o,f,n,a):null,pos:d}}}class qi{constructor(e,t,n,o){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=o}static create(e,t,n,o){return new qi(e,t,n,o)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:o=0,filterTo:f=this.length}=e,d=e.filter;if(t.length==0&&!d)return this;if(n&&(t=t.slice().sort(wv)),this.isEmpty)return t.length?qi.of(t):this;let a=new u2(this,null,-1).goto(0),v=0,A=[],P=new vf;for(;a.value||v<t.length;)if(v<t.length&&(a.from-t[v].from||a.startSide-t[v].value.startSide)>=0){let L=t[v++];P.addInner(L.from,L.to,L.value)||A.push(L)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(v==t.length||this.chunkEnd(a.chunkIndex)<t[v].from)&&(!d||o>this.chunkEnd(a.chunkIndex)||f<this.chunkPos[a.chunkIndex])&&P.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!d||o>a.to||f<a.from||d(a.from,a.to,a.value))&&(P.addInner(a.from,a.to,a.value)||A.push(xv.create(a.from,a.to,a.value))),a.next());return P.finishInner(this.nextLayer.isEmpty&&!A.length?qi.empty:this.nextLayer.update({add:A,filter:d,filterFrom:o,filterTo:f}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],o=-1;for(let d=0;d<this.chunk.length;d++){let a=this.chunkPos[d],v=this.chunk[d],A=e.touchesRange(a,a+v.length);if(A===!1)o=Math.max(o,v.maxPoint),t.push(v),n.push(e.mapPos(a));else if(A===!0){let{mapped:P,pos:L}=v.map(a,e);P&&(o=Math.max(o,P.maxPoint),t.push(P),n.push(L))}}let f=this.nextLayer.map(e);return t.length==0?f:new qi(n,t,f||qi.empty,o)}between(e,t,n){if(!this.isEmpty){for(let o=0;o<this.chunk.length;o++){let f=this.chunkPos[o],d=this.chunk[o];if(t>=f&&e<=f+d.length&&d.between(f,e-f,t-f,n)===!1)return}this.nextLayer.between(e,t,n)}}iter(e=0){return sy.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return sy.from(e).goto(t)}static compare(e,t,n,o,f=-1){let d=e.filter(L=>L.maxPoint>0||!L.isEmpty&&L.maxPoint>=f),a=t.filter(L=>L.maxPoint>0||!L.isEmpty&&L.maxPoint>=f),v=O1(d,a,n),A=new Bg(d,v,f),P=new Bg(a,v,f);n.iterGaps((L,j,F)=>D1(A,L,P,j,F,o)),n.empty&&n.length==0&&D1(A,0,P,0,0,o)}static eq(e,t,n=0,o){o==null&&(o=999999999);let f=e.filter(P=>!P.isEmpty&&t.indexOf(P)<0),d=t.filter(P=>!P.isEmpty&&e.indexOf(P)<0);if(f.length!=d.length)return!1;if(!f.length)return!0;let a=O1(f,d),v=new Bg(f,a,0).goto(n),A=new Bg(d,a,0).goto(n);for(;;){if(v.to!=A.to||!Sv(v.active,A.active)||v.point&&(!A.point||!v.point.eq(A.point)))return!1;if(v.to>o)return!0;v.next(),A.next()}}static spans(e,t,n,o,f=-1){let d=new Bg(e,null,f).goto(t),a=t,v=d.openStart;for(;;){let A=Math.min(d.to,n);if(d.point){let P=d.activeForPoint(d.to),L=d.pointFrom<t?P.length+1:d.point.startSide<0?P.length:Math.min(P.length,v);o.point(a,A,d.point,P,L,d.pointRank),v=Math.min(d.openEnd(A),P.length)}else A>a&&(o.span(a,A,d.active,v),v=d.openEnd(A));if(d.to>n)return v+(d.point&&d.to>n?1:0);a=d.to,d.next()}}static of(e,t=!1){let n=new vf;for(let o of e instanceof xv?[e]:t?AA(e):e)n.add(o.from,o.to,o.value);return n.finish()}static join(e){if(!e.length)return qi.empty;let t=e[e.length-1];for(let n=e.length-2;n>=0;n--)for(let o=e[n];o!=qi.empty;o=o.nextLayer)t=new qi(o.chunkPos,o.chunk,t,Math.max(o.maxPoint,t.maxPoint));return t}}qi.empty=new qi([],[],null,-1);function AA(s){if(s.length>1)for(let e=s[0],t=1;t<s.length;t++){let n=s[t];if(wv(e,n)>0)return s.slice().sort(wv);e=n}return s}qi.empty.nextLayer=qi.empty;class vf{finishChunk(e){this.chunks.push(new Tx(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new vf)).add(e,t,n)}addInner(e,t,n){let o=e-this.lastTo||n.startSide-this.last.endSide;if(o<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return o<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner(qi.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=qi.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function O1(s,e,t){let n=new Map;for(let f of s)for(let d=0;d<f.chunk.length;d++)f.chunk[d].maxPoint<=0&&n.set(f.chunk[d],f.chunkPos[d]);let o=new Set;for(let f of e)for(let d=0;d<f.chunk.length;d++){let a=n.get(f.chunk[d]);a!=null&&(t?t.mapPos(a):a)==f.chunkPos[d]&&!(t!=null&&t.touchesRange(a,a+f.chunk[d].length))&&o.add(f.chunk[d])}return o}class u2{constructor(e,t,n,o=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=o}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let o=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(o)||this.layer.chunkEnd(this.chunkIndex)<e||o.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let o=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<o)&&this.setRangeIndex(o)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class sy{constructor(e){this.heap=e}static from(e,t=null,n=-1){let o=[];for(let f=0;f<e.length;f++)for(let d=e[f];!d.isEmpty;d=d.nextLayer)d.maxPoint>=n&&o.push(new u2(d,t,n,f));return o.length==1?o[0]:new sy(o)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let n=this.heap.length>>1;n>=0;n--)Db(this.heap,n);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let n=this.heap.length>>1;n>=0;n--)Db(this.heap,n);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Db(this.heap,0)}}}function Db(s,e){for(let t=s[e];;){let n=(e<<1)+1;if(n>=s.length)break;let o=s[n];if(n+1<s.length&&o.compare(s[n+1])>=0&&(o=s[n+1],n++),t.compare(o)<0)break;s[n]=t,s[e]=o,e=n}}class Bg{constructor(e,t,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=sy.from(e,t,n)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){__(this.active,e),__(this.activeTo,e),__(this.activeRank,e),this.minActive=R1(this.active,this.activeTo)}addActive(e){let t=0,{value:n,to:o,rank:f}=this.cursor;for(;t<this.activeRank.length&&(f-this.activeRank[t]||o-this.activeTo[t])>0;)t++;b_(this.active,t,n),b_(this.activeTo,t,o),b_(this.activeRank,t,f),e&&b_(e,t,this.cursor.from),this.minActive=R1(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let o=this.minActive;if(o>-1&&(this.activeTo[o]-this.cursor.from||this.active[o].endSide-this.cursor.startSide)<0){if(this.activeTo[o]>e){this.to=this.activeTo[o],this.endSide=this.active[o].endSide;break}this.removeActive(o),n&&__(n,o)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let f=this.cursor.value;if(!f.point)this.addActive(n),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=f,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=f.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let o=n.length-1;o>=0&&n[o]<e;o--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}}function D1(s,e,t,n,o,f){s.goto(e),t.goto(n);let d=n+o,a=n,v=n-e;for(;;){let A=s.to+v-t.to||s.endSide-t.endSide,P=A<0?s.to+v:t.to,L=Math.min(P,d);if(s.point||t.point?s.point&&t.point&&(s.point==t.point||s.point.eq(t.point))&&Sv(s.activeForPoint(s.to),t.activeForPoint(t.to))||f.comparePoint(a,L,s.point,t.point):L>a&&!Sv(s.active,t.active)&&f.compareRange(a,L,s.active,t.active),P>d)break;a=P,A<=0&&s.next(),A>=0&&t.next()}}function Sv(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!=e[t]&&!s[t].eq(e[t]))return!1;return!0}function __(s,e){for(let t=e,n=s.length-1;t<n;t++)s[t]=s[t+1];s.pop()}function b_(s,e,t){for(let n=s.length-1;n>=e;n--)s[n+1]=s[n];s[e]=t}function R1(s,e){let t=-1,n=1e9;for(let o=0;o<e.length;o++)(e[o]-n||s[o].endSide-s[t].endSide)<0&&(t=o,n=e[o]);return t}function Dm(s,e,t=s.length){let n=0;for(let o=0;o<t;)s.charCodeAt(o)==9?(n+=e-n%e,o++):(n++,o=Ir(s,o));return n}function Tv(s,e,t,n){for(let o=0,f=0;;){if(f>=e)return o;if(o==s.length)break;f+=s.charCodeAt(o)==9?t-f%t:1,o=Ir(s,o)}return n===!0?-1:s.length}const Mv="ͼ",I1=typeof Symbol>"u"?"__"+Mv:Symbol.for(Mv),Cv=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),z1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class xf{constructor(e,t){this.rules=[];let{finish:n}=t||{};function o(d){return/^@/.test(d)?[d]:d.split(/,\s*/)}function f(d,a,v,A){let P=[],L=/^@(\w+)\b/.exec(d[0]),j=L&&L[1]=="keyframes";if(L&&a==null)return v.push(d[0]+";");for(let F in a){let K=a[F];if(/&/.test(F))f(F.split(/,\s*/).map(se=>d.map(le=>se.replace(/&/,le))).reduce((se,le)=>se.concat(le)),K,v);else if(K&&typeof K=="object"){if(!L)throw new RangeError("The value of a property ("+F+") should be a primitive value.");f(o(F),K,P,j)}else K!=null&&P.push(F.replace(/_.*/,"").replace(/[A-Z]/g,se=>"-"+se.toLowerCase())+": "+K+";")}(P.length||j)&&v.push((n&&!L&&!A?d.map(n):d).join(", ")+" {"+P.join(" ")+"}")}for(let d in e)f(o(d),e[d],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=z1[I1]||1;return z1[I1]=e+1,Mv+e.toString(36)}static mount(e,t,n){let o=e[Cv],f=n&&n.nonce;o?f&&o.setNonce(f):o=new kA(e,f),o.mount(Array.isArray(t)?t:[t],e)}}let L1=new Map;class kA{constructor(e,t){let n=e.ownerDocument||e,o=n.defaultView;if(!e.head&&e.adoptedStyleSheets&&o.CSSStyleSheet){let f=L1.get(n);if(f)return e[Cv]=f;this.sheet=new o.CSSStyleSheet,L1.set(n,this)}else this.styleTag=n.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Cv]=this}mount(e,t){let n=this.sheet,o=0,f=0;for(let d=0;d<e.length;d++){let a=e[d],v=this.modules.indexOf(a);if(v<f&&v>-1&&(this.modules.splice(v,1),f--,v=-1),v==-1){if(this.modules.splice(f++,0,a),n)for(let A=0;A<a.rules.length;A++)n.insertRule(a.rules[A],o++)}else{for(;f<v;)o+=this.modules[f++].rules.length;o+=a.rules.length,f++}}if(n)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let d="";for(let v=0;v<this.modules.length;v++)d+=this.modules[v].getRules()+`
`;this.styleTag.textContent=d;let a=t.head||t;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var wf={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ry={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},EA=typeof navigator<"u"&&/Mac/.test(navigator.platform),PA=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Dr=0;Dr<10;Dr++)wf[48+Dr]=wf[96+Dr]=String(Dr);for(var Dr=1;Dr<=24;Dr++)wf[Dr+111]="F"+Dr;for(var Dr=65;Dr<=90;Dr++)wf[Dr]=String.fromCharCode(Dr+32),ry[Dr]=String.fromCharCode(Dr);for(var Rb in wf)ry.hasOwnProperty(Rb)||(ry[Rb]=wf[Rb]);function OA(s){var e=EA&&s.metaKey&&s.shiftKey&&!s.ctrlKey&&!s.altKey||PA&&s.shiftKey&&s.key&&s.key.length==1||s.key=="Unidentified",t=!e&&s.key||(s.shiftKey?ry:wf)[s.keyCode]||s.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function oy(s){let e;return s.nodeType==11?e=s.getSelection?s:s.ownerDocument:e=s,e.getSelection()}function Av(s,e){return e?s==e||s.contains(e.nodeType!=1?e.parentNode:e):!1}function X_(s,e){if(!e.anchorNode)return!1;try{return Av(s,e.anchorNode)}catch{return!1}}function xm(s){return s.nodeType==3?Hd(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function Kg(s,e,t,n){return t?B1(s,e,t,n,-1)||B1(s,e,t,n,1):!1}function qd(s){for(var e=0;;e++)if(s=s.previousSibling,!s)return e}function u0(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}function B1(s,e,t,n,o){for(;;){if(s==t&&e==n)return!0;if(e==(o<0?0:$c(s))){if(s.nodeName=="DIV")return!1;let f=s.parentNode;if(!f||f.nodeType!=1)return!1;e=qd(s)+(o<0?0:1),s=f}else if(s.nodeType==1){if(s=s.childNodes[e+(o<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;e=o<0?$c(s):0}else return!1}}function $c(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function wy(s,e){let t=e?s.left:s.right;return{left:t,right:t,top:s.top,bottom:s.bottom}}function DA(s){let e=s.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function h2(s,e){let t=e.width/s.offsetWidth,n=e.height/s.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-s.offsetWidth)<1)&&(t=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(e.height-s.offsetHeight)<1)&&(n=1),{scaleX:t,scaleY:n}}function RA(s,e,t,n,o,f,d,a){let v=s.ownerDocument,A=v.defaultView||window;for(let P=s,L=!1;P&&!L;)if(P.nodeType==1){let j,F=P==v.body,K=1,se=1;if(F)j=DA(A);else{if(/^(fixed|sticky)$/.test(getComputedStyle(P).position)&&(L=!0),P.scrollHeight<=P.clientHeight&&P.scrollWidth<=P.clientWidth){P=P.assignedSlot||P.parentNode;continue}let Be=P.getBoundingClientRect();({scaleX:K,scaleY:se}=h2(P,Be)),j={left:Be.left,right:Be.left+P.clientWidth*K,top:Be.top,bottom:Be.top+P.clientHeight*se}}let le=0,ve=0;if(o=="nearest")e.top<j.top?(ve=-(j.top-e.top+d),t>0&&e.bottom>j.bottom+ve&&(ve=e.bottom-j.bottom+ve+d)):e.bottom>j.bottom&&(ve=e.bottom-j.bottom+d,t<0&&e.top-ve<j.top&&(ve=-(j.top+ve-e.top+d)));else{let Be=e.bottom-e.top,je=j.bottom-j.top;ve=(o=="center"&&Be<=je?e.top+Be/2-je/2:o=="start"||o=="center"&&t<0?e.top-d:e.bottom-je+d)-j.top}if(n=="nearest"?e.left<j.left?(le=-(j.left-e.left+f),t>0&&e.right>j.right+le&&(le=e.right-j.right+le+f)):e.right>j.right&&(le=e.right-j.right+f,t<0&&e.left<j.left+le&&(le=-(j.left+le-e.left+f))):le=(n=="center"?e.left+(e.right-e.left)/2-(j.right-j.left)/2:n=="start"==a?e.left-f:e.right-(j.right-j.left)+f)-j.left,le||ve)if(F)A.scrollBy(le,ve);else{let Be=0,je=0;if(ve){let ze=P.scrollTop;P.scrollTop+=ve/se,je=(P.scrollTop-ze)*se}if(le){let ze=P.scrollLeft;P.scrollLeft+=le/K,Be=(P.scrollLeft-ze)*K}e={left:e.left-Be,top:e.top-je,right:e.right-Be,bottom:e.bottom-je},Be&&Math.abs(Be-le)<1&&(n="nearest"),je&&Math.abs(je-ve)<1&&(o="nearest")}if(F)break;P=P.assignedSlot||P.parentNode}else if(P.nodeType==11)P=P.host;else break}function IA(s){let e=s.ownerDocument,t,n;for(let o=s.parentNode;o&&!(o==e.body||t&&n);)if(o.nodeType==1)!n&&o.scrollHeight>o.clientHeight&&(n=o),!t&&o.scrollWidth>o.clientWidth&&(t=o),o=o.assignedSlot||o.parentNode;else if(o.nodeType==11)o=o.host;else break;return{x:t,y:n}}class zA{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:n}=e;this.set(t,Math.min(e.anchorOffset,t?$c(t):0),n,Math.min(e.focusOffset,n?$c(n):0))}set(e,t,n,o){this.anchorNode=e,this.anchorOffset=t,this.focusNode=n,this.focusOffset=o}}let Yp=null;function f2(s){if(s.setActive)return s.setActive();if(Yp)return s.focus(Yp);let e=[];for(let t=s;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(s.focus(Yp==null?{get preventScroll(){return Yp={preventScroll:!0},!0}}:void 0),!Yp){Yp=!1;for(let t=0;t<e.length;){let n=e[t++],o=e[t++],f=e[t++];n.scrollTop!=o&&(n.scrollTop=o),n.scrollLeft!=f&&(n.scrollLeft=f)}}}let N1;function Hd(s,e,t=e){let n=N1||(N1=document.createRange());return n.setEnd(s,t),n.setStart(s,e),n}function dm(s,e,t,n){let o={key:e,code:e,keyCode:t,which:t,cancelable:!0};n&&({altKey:o.altKey,ctrlKey:o.ctrlKey,shiftKey:o.shiftKey,metaKey:o.metaKey}=n);let f=new KeyboardEvent("keydown",o);f.synthetic=!0,s.dispatchEvent(f);let d=new KeyboardEvent("keyup",o);return d.synthetic=!0,s.dispatchEvent(d),f.defaultPrevented||d.defaultPrevented}function LA(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function d2(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}function BA(s,e){let t=e.focusNode,n=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=n)return!1;for(n=Math.min(n,$c(t));;)if(n){if(t.nodeType!=1)return!1;let o=t.childNodes[n-1];o.contentEditable=="false"?n--:(t=o,n=$c(t))}else{if(t==s)return!0;n=qd(t),t=t.parentNode}}function p2(s){return s.scrollTop>Math.max(1,s.scrollHeight-s.clientHeight-4)}function m2(s,e){for(let t=s,n=e;;){if(t.nodeType==3&&n>0)return{node:t,offset:n};if(t.nodeType==1&&n>0){if(t.contentEditable=="false")return null;t=t.childNodes[n-1],n=$c(t)}else if(t.parentNode&&!u0(t))n=qd(t),t=t.parentNode;else return null}}function g2(s,e){for(let t=s,n=e;;){if(t.nodeType==3&&n<t.nodeValue.length)return{node:t,offset:n};if(t.nodeType==1&&n<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[n],n=0}else if(t.parentNode&&!u0(t))n=qd(t)+1,t=t.parentNode;else return null}}class $r{constructor(e,t,n=!0){this.node=e,this.offset=t,this.precise=n}static before(e,t){return new $r(e.parentNode,qd(e),t)}static after(e,t){return new $r(e.parentNode,qd(e)+1,t)}}const Mx=[];class An{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let n of this.children){if(n==e)return t;t+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let n=this.dom,o=null,f;for(let d of this.children){if(d.flags&7){if(!d.dom&&(f=o?o.nextSibling:n.firstChild)){let a=An.get(f);(!a||!a.parent&&a.canReuseDOM(d))&&d.reuseDOM(f)}d.sync(e,t),d.flags&=-8}if(f=o?o.nextSibling:n.firstChild,t&&!t.written&&t.node==n&&f!=d.dom&&(t.written=!0),d.dom.parentNode==n)for(;f&&f!=d.dom;)f=F1(f);else n.insertBefore(d.dom,f);o=d.dom}for(f=o?o.nextSibling:n.firstChild,f&&t&&t.node==n&&(t.written=!0);f;)f=F1(f)}else if(this.flags&1)for(let n of this.children)n.flags&7&&(n.sync(e,t),n.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let n;if(e==this.dom)n=this.dom.childNodes[t];else{let o=$c(e)==0?0:t==0?-1:1;for(;;){let f=e.parentNode;if(f==this.dom)break;o==0&&f.firstChild!=f.lastChild&&(e==f.firstChild?o=-1:o=1),e=f}o<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!An.get(n);)n=n.nextSibling;if(!n)return this.length;for(let o=0,f=0;;o++){let d=this.children[o];if(d.dom==n)return f;f+=d.length+d.breakAfter}}domBoundsAround(e,t,n=0){let o=-1,f=-1,d=-1,a=-1;for(let v=0,A=n,P=n;v<this.children.length;v++){let L=this.children[v],j=A+L.length;if(A<e&&j>t)return L.domBoundsAround(e,t,A);if(j>=e&&o==-1&&(o=v,f=A),A>t&&L.dom.parentNode==this.dom){d=v,a=P;break}P=j,A=j+L.breakAfter}return{from:f,to:a<0?n+this.length:a,startDOM:(o?this.children[o-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:d<this.children.length&&d>=0?this.children[d].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,n=Mx){this.markDirty();for(let o=e;o<t;o++){let f=this.children[o];f.parent==this&&n.indexOf(f)<0&&f.destroy()}n.length<250?this.children.splice(e,t-e,...n):this.children=[].concat(this.children.slice(0,e),n,this.children.slice(t));for(let o=0;o<n.length;o++)n[o].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new y2(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,n,o,f,d){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}An.prototype.breakAfter=0;function F1(s){let e=s.nextSibling;return s.parentNode.removeChild(s),e}class y2{constructor(e,t,n){this.children=e,this.pos=t,this.i=n,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function _2(s,e,t,n,o,f,d,a,v){let{children:A}=s,P=A.length?A[e]:null,L=f.length?f[f.length-1]:null,j=L?L.breakAfter:d;if(!(e==n&&P&&!d&&!j&&f.length<2&&P.merge(t,o,f.length?L:null,t==0,a,v))){if(n<A.length){let F=A[n];F&&(o<F.length||F.breakAfter&&(L!=null&&L.breakAfter))?(e==n&&(F=F.split(o),o=0),!j&&L&&F.merge(0,o,L,!0,0,v)?f[f.length-1]=F:((o||F.children.length&&!F.children[0].length)&&F.merge(0,o,null,!1,0,v),f.push(F))):F!=null&&F.breakAfter&&(L?L.breakAfter=1:d=1),n++}for(P&&(P.breakAfter=d,t>0&&(!d&&f.length&&P.merge(t,P.length,f[0],!1,a,0)?P.breakAfter=f.shift().breakAfter:(t<P.length||P.children.length&&P.children[P.children.length-1].length==0)&&P.merge(t,P.length,null,!1,a,0),e++));e<n&&f.length;)if(A[n-1].become(f[f.length-1]))n--,f.pop(),v=f.length?0:a;else if(A[e].become(f[0]))e++,f.shift(),a=f.length?0:v;else break;!f.length&&e&&n<A.length&&!A[e-1].breakAfter&&A[n].merge(0,0,A[e-1],!1,a,v)&&e--,(e<n||f.length)&&s.replaceChildren(e,n,f)}}function b2(s,e,t,n,o,f){let d=s.childCursor(),{i:a,off:v}=d.findPos(t,1),{i:A,off:P}=d.findPos(e,-1),L=e-t;for(let j of n)L+=j.length;s.length+=L,_2(s,A,P,a,v,n,0,o,f)}let Lo=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},kv=typeof document<"u"?document:{documentElement:{style:{}}};const Ev=/Edge\/(\d+)/.exec(Lo.userAgent),v2=/MSIE \d/.test(Lo.userAgent),Pv=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Lo.userAgent),U0=!!(v2||Pv||Ev),j1=!U0&&/gecko\/(\d+)/i.test(Lo.userAgent),Ib=!U0&&/Chrome\/(\d+)/.exec(Lo.userAgent),NA="webkitFontSmoothing"in kv.documentElement.style,x2=!U0&&/Apple Computer/.test(Lo.vendor),V1=x2&&(/Mobile\/\w+/.test(Lo.userAgent)||Lo.maxTouchPoints>2);var Zt={mac:V1||/Mac/.test(Lo.platform),windows:/Win/.test(Lo.platform),linux:/Linux|X11/.test(Lo.platform),ie:U0,ie_version:v2?kv.documentMode||6:Pv?+Pv[1]:Ev?+Ev[1]:0,gecko:j1,gecko_version:j1?+(/Firefox\/(\d+)/.exec(Lo.userAgent)||[0,0])[1]:0,chrome:!!Ib,chrome_version:Ib?+Ib[1]:0,ios:V1,android:/Android\b/.test(Lo.userAgent),safari:x2,webkit_version:NA?+(/\bAppleWebKit\/(\d+)/.exec(Lo.userAgent)||[0,0])[1]:0,tabSize:kv.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const FA=256;class ec extends An{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,n){return this.flags&8||n&&(!(n instanceof ec)||this.length-(t-e)+n.length>FA||n.flags&8)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new ec(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new $r(this.dom,e)}domBoundsAround(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return jA(this.dom,e,t)}}class ih extends An{constructor(e,t=[],n=0){super(),this.mark=e,this.children=t,this.length=n;for(let o of t)o.setParent(this)}setAttrs(e){if(d2(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,n,o,f,d){return n&&(!(n instanceof ih&&n.mark.eq(this.mark))||e&&f<=0||t<this.length&&d<=0)?!1:(b2(this,e,t,n?n.children.slice():[],f-1,d-1),this.markDirty(),!0)}split(e){let t=[],n=0,o=-1,f=0;for(let a of this.children){let v=n+a.length;v>e&&t.push(n<e?a.split(e-n):a),o<0&&n>=e&&(o=f),n=v,f++}let d=this.length-e;return this.length=e,o>-1&&(this.children.length=o,this.markDirty()),new ih(this.mark,t,d)}domAtPos(e){return w2(this,e)}coordsAt(e,t){return T2(this,e,t)}}function jA(s,e,t){let n=s.nodeValue.length;e>n&&(e=n);let o=e,f=e,d=0;e==0&&t<0||e==n&&t>=0?Zt.chrome||Zt.gecko||(e?(o--,d=1):f<n&&(f++,d=-1)):t<0?o--:f<n&&f++;let a=Hd(s,o,f).getClientRects();if(!a.length)return null;let v=a[(d?d<0:t>=0)?0:a.length-1];return Zt.safari&&!d&&v.width==0&&(v=Array.prototype.find.call(a,A=>A.width)||v),d?wy(v,d<0):v||null}class pf extends An{static create(e,t,n){return new pf(e,t,n)}constructor(e,t,n){super(),this.widget=e,this.length=t,this.side=n,this.prevWidget=null}split(e){let t=pf.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,n,o,f,d){return n&&(!(n instanceof pf)||!this.widget.compare(n.widget)||e>0&&f<=0||t<this.length&&d<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}become(e){return e instanceof pf&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Qi.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,n=t&&t.state.doc,o=this.posAtStart;return n?n.slice(o,o+this.length):Qi.empty}domAtPos(e){return(this.length?e==0:this.side>0)?$r.before(this.dom):$r.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let n=this.widget.coordsAt(this.dom,e,t);if(n)return n;let o=this.dom.getClientRects(),f=null;if(!o.length)return null;let d=this.side?this.side<0:e>0;for(let a=d?o.length-1:0;f=o[a],!(e>0?a==0:a==o.length-1||f.top<f.bottom);a+=d?-1:1);return wy(f,!d)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class wm extends An{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof wm&&e.side==this.side}split(){return new wm(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?$r.before(this.dom):$r.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Qi.empty}get isHidden(){return!0}}ec.prototype.children=pf.prototype.children=wm.prototype.children=Mx;function w2(s,e){let t=s.dom,{children:n}=s,o=0;for(let f=0;o<n.length;o++){let d=n[o],a=f+d.length;if(!(a==f&&d.getSide()<=0)){if(e>f&&e<a&&d.dom.parentNode==t)return d.domAtPos(e-f);if(e<=f)break;f=a}}for(let f=o;f>0;f--){let d=n[f-1];if(d.dom.parentNode==t)return d.domAtPos(d.length)}for(let f=o;f<n.length;f++){let d=n[f];if(d.dom.parentNode==t)return d.domAtPos(0)}return new $r(t,0)}function S2(s,e,t){let n,{children:o}=s;t>0&&e instanceof ih&&o.length&&(n=o[o.length-1])instanceof ih&&n.mark.eq(e.mark)?S2(n,e.children[0],t-1):(o.push(e),e.setParent(s)),s.length+=e.length}function T2(s,e,t){let n=null,o=-1,f=null,d=-1;function a(A,P){for(let L=0,j=0;L<A.children.length&&j<=P;L++){let F=A.children[L],K=j+F.length;K>=P&&(F.children.length?a(F,P-j):(!f||f.isHidden&&t>0)&&(K>P||j==K&&F.getSide()>0)?(f=F,d=P-j):(j<P||j==K&&F.getSide()<0&&!F.isHidden)&&(n=F,o=P-j)),j=K}}a(s,e);let v=(t<0?n:f)||n||f;return v?v.coordsAt(Math.max(0,v==n?o:d),t):VA(s)}function VA(s){let e=s.dom.lastChild;if(!e)return s.dom.getBoundingClientRect();let t=xm(e);return t[t.length-1]||null}function Ov(s,e){for(let t in s)t=="class"&&e.class?e.class+=" "+s.class:t=="style"&&e.style?e.style+=";"+s.style:e[t]=s[t];return e}const U1=Object.create(null);function h0(s,e,t){if(s==e)return!0;s||(s=U1),e||(e=U1);let n=Object.keys(s),o=Object.keys(e);if(n.length-(t&&n.indexOf(t)>-1?1:0)!=o.length-(t&&o.indexOf(t)>-1?1:0))return!1;for(let f of n)if(f!=t&&(o.indexOf(f)==-1||s[f]!==e[f]))return!1;return!0}function Dv(s,e,t){let n=!1;if(e)for(let o in e)t&&o in t||(n=!0,o=="style"?s.style.cssText="":s.removeAttribute(o));if(t)for(let o in t)e&&e[o]==t[o]||(n=!0,o=="style"?s.style.cssText=t[o]:s.setAttribute(o,t[o]));return n}function UA(s){let e=Object.create(null);for(let t=0;t<s.attributes.length;t++){let n=s.attributes[t];e[n.name]=n.value}return e}class rh{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,n){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var mo=function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s}(mo||(mo={}));class ni extends Ud{constructor(e,t,n,o){super(),this.startSide=e,this.endSide=t,this.widget=n,this.spec=o}get heightRelevant(){return!1}static mark(e){return new Sy(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),n=!!e.block;return t+=n&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Sf(e,t,t,n,e.widget||null,!1)}static replace(e){let t=!!e.block,n,o;if(e.isBlockGap)n=-5e8,o=4e8;else{let{start:f,end:d}=M2(e,t);n=(f?t?-3e8:-1:5e8)-1,o=(d?t?2e8:1:-6e8)+1}return new Sf(e,n,o,t,e.widget||null,!0)}static line(e){return new Ty(e)}static set(e,t=!1){return qi.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ni.none=qi.empty;class Sy extends ni{constructor(e){let{start:t,end:n}=M2(e);super(t?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,n;return this==e||e instanceof Sy&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((n=e.attrs)===null||n===void 0?void 0:n.class))&&h0(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Sy.prototype.point=!1;class Ty extends ni{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Ty&&this.spec.class==e.spec.class&&h0(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Ty.prototype.mapMode=po.TrackBefore;Ty.prototype.point=!0;class Sf extends ni{constructor(e,t,n,o,f,d){super(t,n,f,e),this.block=o,this.isReplace=d,this.mapMode=o?t<=0?po.TrackBefore:po.TrackAfter:po.TrackDel}get type(){return this.startSide!=this.endSide?mo.WidgetRange:this.startSide<=0?mo.WidgetBefore:mo.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Sf&&qA(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Sf.prototype.point=!0;function M2(s,e=!1){let{inclusiveStart:t,inclusiveEnd:n}=s;return t==null&&(t=s.inclusive),n==null&&(n=s.inclusive),{start:t??e,end:n??e}}function qA(s,e){return s==e||!!(s&&e&&s.compare(e))}function Rv(s,e,t,n=0){let o=t.length-1;o>=0&&t[o]+n>=s?t[o]=Math.max(t[o],e):t.push(s,e)}class Us extends An{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,n,o,f,d){if(n){if(!(n instanceof Us))return!1;this.dom||n.transferDOM(this)}return o&&this.setDeco(n?n.attrs:null),b2(this,e,t,n?n.children.slice():[],f,d),!0}split(e){let t=new Us;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:n,off:o}=this.childPos(e);o&&(t.append(this.children[n].split(o),0),this.children[n].merge(o,this.children[n].length,null,!1,0,0),n++);for(let f=n;f<this.children.length;f++)t.append(this.children[f],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){h0(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){S2(this,e,t)}addLineDeco(e){let t=e.spec.attributes,n=e.spec.class;t&&(this.attrs=Ov(t,this.attrs||{})),n&&(this.attrs=Ov({class:n},this.attrs||{}))}domAtPos(e){return w2(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var n;this.dom?this.flags&4&&(d2(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Dv(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let o=this.dom.lastChild;for(;o&&An.get(o)instanceof ih;)o=o.lastChild;if(!o||!this.length||o.nodeName!="BR"&&((n=An.get(o))===null||n===void 0?void 0:n.isEditable)==!1&&(!Zt.ios||!this.children.some(f=>f instanceof ec))){let f=document.createElement("BR");f.cmIgnore=!0,this.dom.appendChild(f)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let n of this.children){if(!(n instanceof ec)||/[^ -~]/.test(n.text))return null;let o=xm(n.dom);if(o.length!=1)return null;e+=o[0].width,t=o[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let n=T2(this,e,t);if(!this.children.length&&n&&this.parent){let{heightOracle:o}=this.parent.view.viewState,f=n.bottom-n.top;if(Math.abs(f-o.lineHeight)<2&&o.textHeight<f){let d=(f-o.textHeight)/2;return{top:n.top+d,bottom:n.bottom-d,left:n.left,right:n.left}}}return n}become(e){return e instanceof Us&&this.children.length==0&&e.children.length==0&&h0(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let n=0,o=0;n<e.children.length;n++){let f=e.children[n],d=o+f.length;if(d>=t){if(f instanceof Us)return f;if(d>t)break}o=d+f.breakAfter}return null}}class eh extends An{constructor(e,t,n){super(),this.widget=e,this.length=t,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(e,t,n,o,f,d){return n&&(!(n instanceof eh)||!this.widget.compare(n.widget)||e>0&&f<=0||t<this.length&&d<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?$r.before(this.dom):$r.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let n=new eh(this.widget,t,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return Mx}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Qi.empty}domBoundsAround(){return null}become(e){return e instanceof eh&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let n=this.widget.coordsAt(this.dom,e,t);return n||(this.widget instanceof Iv?null:wy(this.dom.getBoundingClientRect(),this.length?e==0:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:n}=this.deco;return t==n?!1:e<0?t<0:n>0}}class Iv extends rh{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class Yg{constructor(e,t,n,o){this.doc=e,this.pos=t,this.end=n,this.disallowBlockEffectsFor=o,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof eh&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Us),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(v_(new wm(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof eh)&&this.getLine()}buildText(e,t,n){for(;e>0;){if(this.textOff==this.text.length){let{value:f,lineBreak:d,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(d){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=f,this.textOff=0}let o=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-n)),this.getLine().append(v_(new ec(this.text.slice(this.textOff,this.textOff+o)),t),n),this.atCursorPos=!0,this.textOff+=o,e-=o,n=0}}span(e,t,n,o){this.buildText(t-e,n,o),this.pos=t,this.openStart<0&&(this.openStart=o)}point(e,t,n,o,f,d){if(this.disallowBlockEffectsFor[d]&&n instanceof Sf){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=t-e;if(n instanceof Sf)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new eh(n.widget||Sm.block,a,n));else{let v=pf.create(n.widget||Sm.inline,a,a?0:n.startSide),A=this.atCursorPos&&!v.isEditable&&f<=o.length&&(e<t||n.startSide>0),P=!v.isEditable&&(e<t||f>o.length||n.startSide<=0),L=this.getLine();this.pendingBuffer==2&&!A&&!v.isEditable&&(this.pendingBuffer=0),this.flushBuffer(o),A&&(L.append(v_(new wm(1),o),f),f=o.length+Math.max(0,f-o.length)),L.append(v_(v,o),f),this.atCursorPos=P,this.pendingBuffer=P?e<t||f>o.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=o.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=f)}static build(e,t,n,o,f){let d=new Yg(e,t,n,f);return d.openEnd=qi.spans(o,t,n,d),d.openStart<0&&(d.openStart=d.openEnd),d.finish(d.openEnd),d}}function v_(s,e){for(let t of e)s=new ih(t,[s],s.length);return s}class Sm extends rh{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Sm.inline=new Sm("span");Sm.block=new Sm("div");var jn=function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s}(jn||(jn={}));const Zd=jn.LTR,Cx=jn.RTL;function C2(s){let e=[];for(let t=0;t<s.length;t++)e.push(1<<+s[t]);return e}const HA=C2("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ZA=C2("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),zv=Object.create(null),Lc=[];for(let s of["()","[]","{}"]){let e=s.charCodeAt(0),t=s.charCodeAt(1);zv[e]=t,zv[t]=-e}function A2(s){return s<=247?HA[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?ZA[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8204?256:64336<=s&&s<=65023?4:1}const GA=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class mf{get dir(){return this.level%2?Cx:Zd}constructor(e,t,n){this.from=e,this.to=t,this.level=n}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,n,o){let f=-1;for(let d=0;d<e.length;d++){let a=e[d];if(a.from<=t&&a.to>=t){if(a.level==n)return d;(f<0||(o!=0?o<0?a.from<t:a.to>t:e[f].level>a.level))&&(f=d)}}if(f<0)throw new RangeError("Index out of range");return f}}function k2(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++){let n=s[t],o=e[t];if(n.from!=o.from||n.to!=o.to||n.direction!=o.direction||!k2(n.inner,o.inner))return!1}return!0}const Cn=[];function $A(s,e,t,n,o){for(let f=0;f<=n.length;f++){let d=f?n[f-1].to:e,a=f<n.length?n[f].from:t,v=f?256:o;for(let A=d,P=v,L=v;A<a;A++){let j=A2(s.charCodeAt(A));j==512?j=P:j==8&&L==4&&(j=16),Cn[A]=j==4?2:j,j&7&&(L=j),P=j}for(let A=d,P=v,L=v;A<a;A++){let j=Cn[A];if(j==128)A<a-1&&P==Cn[A+1]&&P&24?j=Cn[A]=P:Cn[A]=256;else if(j==64){let F=A+1;for(;F<a&&Cn[F]==64;)F++;let K=A&&P==8||F<t&&Cn[F]==8?L==1?1:8:256;for(let se=A;se<F;se++)Cn[se]=K;A=F-1}else j==8&&L==1&&(Cn[A]=1);P=j,j&7&&(L=j)}}}function XA(s,e,t,n,o){let f=o==1?2:1;for(let d=0,a=0,v=0;d<=n.length;d++){let A=d?n[d-1].to:e,P=d<n.length?n[d].from:t;for(let L=A,j,F,K;L<P;L++)if(F=zv[j=s.charCodeAt(L)])if(F<0){for(let se=a-3;se>=0;se-=3)if(Lc[se+1]==-F){let le=Lc[se+2],ve=le&2?o:le&4?le&1?f:o:0;ve&&(Cn[L]=Cn[Lc[se]]=ve),a=se;break}}else{if(Lc.length==189)break;Lc[a++]=L,Lc[a++]=j,Lc[a++]=v}else if((K=Cn[L])==2||K==1){let se=K==o;v=se?0:1;for(let le=a-3;le>=0;le-=3){let ve=Lc[le+2];if(ve&2)break;if(se)Lc[le+2]|=2;else{if(ve&4)break;Lc[le+2]|=4}}}}}function QA(s,e,t,n){for(let o=0,f=n;o<=t.length;o++){let d=o?t[o-1].to:s,a=o<t.length?t[o].from:e;for(let v=d;v<a;){let A=Cn[v];if(A==256){let P=v+1;for(;;)if(P==a){if(o==t.length)break;P=t[o++].to,a=o<t.length?t[o].from:e}else if(Cn[P]==256)P++;else break;let L=f==1,j=(P<e?Cn[P]:n)==1,F=L==j?L?1:2:n;for(let K=P,se=o,le=se?t[se-1].to:s;K>v;)K==le&&(K=t[--se].from,le=se?t[se-1].to:s),Cn[--K]=F;v=P}else f=A,v++}}}function Lv(s,e,t,n,o,f,d){let a=n%2?2:1;if(n%2==o%2)for(let v=e,A=0;v<t;){let P=!0,L=!1;if(A==f.length||v<f[A].from){let se=Cn[v];se!=a&&(P=!1,L=se==16)}let j=!P&&a==1?[]:null,F=P?n:n+1,K=v;e:for(;;)if(A<f.length&&K==f[A].from){if(L)break e;let se=f[A];if(!P)for(let le=se.to,ve=A+1;;){if(le==t)break e;if(ve<f.length&&f[ve].from==le)le=f[ve++].to;else{if(Cn[le]==a)break e;break}}if(A++,j)j.push(se);else{se.from>v&&d.push(new mf(v,se.from,F));let le=se.direction==Zd!=!(F%2);Bv(s,le?n+1:n,o,se.inner,se.from,se.to,d),v=se.to}K=se.to}else{if(K==t||(P?Cn[K]!=a:Cn[K]==a))break;K++}j?Lv(s,v,K,n+1,o,j,d):v<K&&d.push(new mf(v,K,F)),v=K}else for(let v=t,A=f.length;v>e;){let P=!0,L=!1;if(!A||v>f[A-1].to){let se=Cn[v-1];se!=a&&(P=!1,L=se==16)}let j=!P&&a==1?[]:null,F=P?n:n+1,K=v;e:for(;;)if(A&&K==f[A-1].to){if(L)break e;let se=f[--A];if(!P)for(let le=se.from,ve=A;;){if(le==e)break e;if(ve&&f[ve-1].to==le)le=f[--ve].from;else{if(Cn[le-1]==a)break e;break}}if(j)j.push(se);else{se.to<v&&d.push(new mf(se.to,v,F));let le=se.direction==Zd!=!(F%2);Bv(s,le?n+1:n,o,se.inner,se.from,se.to,d),v=se.from}K=se.from}else{if(K==e||(P?Cn[K-1]!=a:Cn[K-1]==a))break;K--}j?Lv(s,K,v,n+1,o,j,d):K<v&&d.push(new mf(K,v,F)),v=K}}function Bv(s,e,t,n,o,f,d){let a=e%2?2:1;$A(s,o,f,n,a),XA(s,o,f,n,a),QA(o,f,n,a),Lv(s,o,f,e,t,n,d)}function WA(s,e,t){if(!s)return[new mf(0,0,e==Cx?1:0)];if(e==Zd&&!t.length&&!GA.test(s))return E2(s.length);if(t.length)for(;s.length>Cn.length;)Cn[Cn.length]=256;let n=[],o=e==Zd?0:1;return Bv(s,o,o,t,0,s.length,n),n}function E2(s){return[new mf(0,s,0)]}let P2="";function KA(s,e,t,n,o){var f;let d=n.head-s.from,a=mf.find(e,d,(f=n.bidiLevel)!==null&&f!==void 0?f:-1,n.assoc),v=e[a],A=v.side(o,t);if(d==A){let j=a+=o?1:-1;if(j<0||j>=e.length)return null;v=e[a=j],d=v.side(!o,t),A=v.side(o,t)}let P=Ir(s.text,d,v.forward(o,t));(P<v.from||P>v.to)&&(P=A),P2=s.text.slice(Math.min(d,P),Math.max(d,P));let L=a==(o?e.length-1:0)?null:e[a+(o?1:-1)];return L&&P==A&&L.level+(o?0:1)<v.level?yt.cursor(L.side(!o,t)+s.from,L.forward(o,t)?1:-1,L.level):yt.cursor(P+s.from,v.forward(o,t)?-1:1,v.level)}function YA(s,e,t){for(let n=e;n<t;n++){let o=A2(s.charCodeAt(n));if(o==1)return Zd;if(o==2||o==4)return Cx}return Zd}const O2=Ut.define(),D2=Ut.define(),R2=Ut.define(),I2=Ut.define(),Nv=Ut.define(),z2=Ut.define(),L2=Ut.define(),Ax=Ut.define(),kx=Ut.define(),B2=Ut.define({combine:s=>s.some(e=>e)}),N2=Ut.define({combine:s=>s.some(e=>e)}),F2=Ut.define();class pm{constructor(e,t="nearest",n="nearest",o=5,f=5,d=!1){this.range=e,this.y=t,this.x=n,this.yMargin=o,this.xMargin=f,this.isSnapshot=d}map(e){return e.empty?this:new pm(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new pm(yt.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const x_=xi.define({map:(s,e)=>s.map(e)}),j2=xi.define();function Fo(s,e,t){let n=s.facet(I2);n.length?n[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const hf=Ut.define({combine:s=>s.length?s[0]:!0});let JA=0;const qg=Ut.define();class ks{constructor(e,t,n,o,f){this.id=e,this.create=t,this.domEventHandlers=n,this.domEventObservers=o,this.extension=f(this)}static define(e,t){const{eventHandlers:n,eventObservers:o,provide:f,decorations:d}=t||{};return new ks(JA++,e,n,o,a=>{let v=[qg.of(a)];return d&&v.push(ay.of(A=>{let P=A.plugin(a);return P?d(P):ni.none})),f&&v.push(f(a)),v})}static fromClass(e,t){return ks.define(n=>new e(n),t)}}class zb{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(n){if(Fo(t.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Fo(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(n){Fo(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const V2=Ut.define(),Ex=Ut.define(),ay=Ut.define(),U2=Ut.define(),Px=Ut.define(),q2=Ut.define();function q1(s,e){let t=s.state.facet(q2);if(!t.length)return t;let n=t.map(f=>f instanceof Function?f(s):f),o=[];return qi.spans(n,e.from,e.to,{point(){},span(f,d,a,v){let A=f-e.from,P=d-e.from,L=o;for(let j=a.length-1;j>=0;j--,v--){let F=a[j].spec.bidiIsolate,K;if(F==null&&(F=YA(e.text,A,P)),v>0&&L.length&&(K=L[L.length-1]).to==A&&K.direction==F)K.to=P,L=K.inner;else{let se={from:A,to:P,direction:F,inner:[]};L.push(se),L=se.inner}}}}),o}const H2=Ut.define();function Z2(s){let e=0,t=0,n=0,o=0;for(let f of s.state.facet(H2)){let d=f(s);d&&(d.left!=null&&(e=Math.max(e,d.left)),d.right!=null&&(t=Math.max(t,d.right)),d.top!=null&&(n=Math.max(n,d.top)),d.bottom!=null&&(o=Math.max(o,d.bottom)))}return{left:e,right:t,top:n,bottom:o}}const Hg=Ut.define();class al{constructor(e,t,n,o){this.fromA=e,this.toA=t,this.fromB=n,this.toB=o}join(e){return new al(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,n=this;for(;t>0;t--){let o=e[t-1];if(!(o.fromA>n.toA)){if(o.toA<n.fromA)break;n=n.join(o),e.splice(t-1,1)}}return e.splice(t,0,n),e}static extendWithRanges(e,t){if(t.length==0)return e;let n=[];for(let o=0,f=0,d=0,a=0;;o++){let v=o==e.length?null:e[o],A=d-a,P=v?v.fromB:1e9;for(;f<t.length&&t[f]<P;){let L=t[f],j=t[f+1],F=Math.max(a,L),K=Math.min(P,j);if(F<=K&&new al(F+A,K+A,F,K).addToSet(n),j>P)break;f+=2}if(!v)return n;new al(v.fromA,v.toA,v.fromB,v.toB).addToSet(n),d=v.toA,a=v.toB}}}class f0{constructor(e,t,n){this.view=e,this.state=t,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=Js.empty(this.startState.doc.length);for(let f of n)this.changes=this.changes.compose(f.changes);let o=[];this.changes.iterChangedRanges((f,d,a,v)=>o.push(new al(f,d,a,v))),this.changedRanges=o}static create(e,t,n){return new f0(e,t,n)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class H1 extends An{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=ni.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Us],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new al(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let n=e.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:A,toA:P})=>P<this.minWidthFrom||A>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let o=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?o=this.domChanged.newSel.head:!ok(e.changes,this.hasComposition)&&!e.selectionSet&&(o=e.state.selection.main.head));let f=o>-1?tk(this.view,e.changes,o):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:A,to:P}=this.hasComposition;n=new al(A,P,e.changes.mapPos(A,-1),e.changes.mapPos(P,1)).addToSet(n.slice())}this.hasComposition=f?{from:f.range.fromB,to:f.range.toB}:null,(Zt.ie||Zt.chrome)&&!f&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let d=this.decorations,a=this.updateDeco(),v=sk(d,a,e.changes);return n=al.extendWithRanges(n,v),!(this.flags&7)&&n.length==0?!1:(this.updateInner(n,e.startState.doc.length,f),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,n);let{observer:o}=this.view;o.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let d=Zt.chrome||Zt.ios?{node:o.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,d),this.flags&=-8,d&&(d.written||o.selectionRange.focusNode!=d.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(d=>d.flags&=-9);let f=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let d of this.children)d instanceof eh&&d.widget instanceof Iv&&f.push(d.dom);o.updateGaps(f)}updateChildren(e,t,n){let o=n?n.range.addToSet(e.slice()):e,f=this.childCursor(t);for(let d=o.length-1;;d--){let a=d>=0?o[d]:null;if(!a)break;let{fromA:v,toA:A,fromB:P,toB:L}=a,j,F,K,se;if(n&&n.range.fromB<L&&n.range.toB>P){let ze=Yg.build(this.view.state.doc,P,n.range.fromB,this.decorations,this.dynamicDecorationMap),ke=Yg.build(this.view.state.doc,n.range.toB,L,this.decorations,this.dynamicDecorationMap);F=ze.breakAtStart,K=ze.openStart,se=ke.openEnd;let Se=this.compositionView(n);ke.breakAtStart?Se.breakAfter=1:ke.content.length&&Se.merge(Se.length,Se.length,ke.content[0],!1,ke.openStart,0)&&(Se.breakAfter=ke.content[0].breakAfter,ke.content.shift()),ze.content.length&&Se.merge(0,0,ze.content[ze.content.length-1],!0,0,ze.openEnd)&&ze.content.pop(),j=ze.content.concat(Se).concat(ke.content)}else({content:j,breakAtStart:F,openStart:K,openEnd:se}=Yg.build(this.view.state.doc,P,L,this.decorations,this.dynamicDecorationMap));let{i:le,off:ve}=f.findPos(A,1),{i:Be,off:je}=f.findPos(v,-1);_2(this,Be,je,le,ve,j,F,K,se)}n&&this.fixCompositionDOM(n)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let n of t.effects)n.is(j2)&&(this.editContextFormatting=n.value)}compositionView(e){let t=new ec(e.text.nodeValue);t.flags|=8;for(let{deco:o}of e.marks)t=new ih(o,[t],t.length);let n=new Us;return n.append(t,0),n}fixCompositionDOM(e){let t=(f,d)=>{d.flags|=8|(d.children.some(v=>v.flags&7)?1:0),this.markedForComposition.add(d);let a=An.get(f);a&&a!=d&&(a.dom=null),d.setDOM(f)},n=this.childPos(e.range.fromB,1),o=this.children[n.i];t(e.line,o);for(let f=e.marks.length-1;f>=-1;f--)n=o.childPos(n.off,1),o=o.children[n.i],t(f>=0?e.marks[f].node:e.text,o)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,o=n==this.dom,f=!o&&X_(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(o||t||f))return;let d=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,v=this.moveToLine(this.domAtPos(a.anchor)),A=a.empty?v:this.moveToLine(this.domAtPos(a.head));if(Zt.gecko&&a.empty&&!this.hasComposition&&ek(v)){let L=document.createTextNode("");this.view.observer.ignore(()=>v.node.insertBefore(L,v.node.childNodes[v.offset]||null)),v=A=new $r(L,0),d=!0}let P=this.view.observer.selectionRange;(d||!P.focusNode||(!Kg(v.node,v.offset,P.anchorNode,P.anchorOffset)||!Kg(A.node,A.offset,P.focusNode,P.focusOffset))&&!this.suppressWidgetCursorChange(P,a))&&(this.view.observer.ignore(()=>{Zt.android&&Zt.chrome&&this.dom.contains(P.focusNode)&&rk(P.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let L=oy(this.view.root);if(L)if(a.empty){if(Zt.gecko){let j=ik(v.node,v.offset);if(j&&j!=3){let F=(j==1?m2:g2)(v.node,v.offset);F&&(v=new $r(F.node,F.offset))}}L.collapse(v.node,v.offset),a.bidiLevel!=null&&L.caretBidiLevel!==void 0&&(L.caretBidiLevel=a.bidiLevel)}else if(L.extend){L.collapse(v.node,v.offset);try{L.extend(A.node,A.offset)}catch{}}else{let j=document.createRange();a.anchor>a.head&&([v,A]=[A,v]),j.setEnd(A.node,A.offset),j.setStart(v.node,v.offset),L.removeAllRanges(),L.addRange(j)}f&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(v,A)),this.impreciseAnchor=v.precise?null:new $r(P.anchorNode,P.anchorOffset),this.impreciseHead=A.precise?null:new $r(P.focusNode,P.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Kg(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,n=oy(e.root),{anchorNode:o,anchorOffset:f}=e.observer.selectionRange;if(!n||!t.empty||!t.assoc||!n.modify)return;let d=Us.find(this,t.head);if(!d)return;let a=d.posAtStart;if(t.head==a||t.head==a+d.length)return;let v=this.coordsAt(t.head,-1),A=this.coordsAt(t.head,1);if(!v||!A||v.bottom>A.top)return;let P=this.domAtPos(t.head+t.assoc);n.collapse(P.node,P.offset),n.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let L=e.observer.selectionRange;e.docView.posFromDOM(L.anchorNode,L.anchorOffset)!=t.from&&n.collapse(o,f)}moveToLine(e){let t=this.dom,n;if(e.node!=t)return e;for(let o=e.offset;!n&&o<t.childNodes.length;o++){let f=An.get(t.childNodes[o]);f instanceof Us&&(n=f.domAtPos(0))}for(let o=e.offset-1;!n&&o>=0;o--){let f=An.get(t.childNodes[o]);f instanceof Us&&(n=f.domAtPos(f.length))}return n?new $r(n.node,n.offset,!0):e}nearest(e){for(let t=e;t;){let n=An.get(t);if(n&&n.rootView==this)return n;t=t.parentNode}return null}posFromDOM(e,t){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,t)+n.posAtStart}domAtPos(e){let{i:t,off:n}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let o=this.children[t];if(n<o.length||o instanceof Us)break;t++,n=0}return this.children[t].domAtPos(n)}coordsAt(e,t){let n=null,o=0;for(let f=this.length,d=this.children.length-1;d>=0;d--){let a=this.children[d],v=f-a.breakAfter,A=v-a.length;if(v<e)break;if(A<=e&&(A<e||a.covers(-1))&&(v>e||a.covers(1))&&(!n||a instanceof Us&&!(n instanceof Us&&t>=0)))n=a,o=A;else if(n&&A==e&&v==e&&a instanceof eh&&Math.abs(t)<2){if(a.deco.startSide<0)break;d&&(n=null)}f=A}return n?n.coordsAt(e-o,t):null}coordsForChar(e){let{i:t,off:n}=this.childPos(e,1),o=this.children[t];if(!(o instanceof Us))return null;for(;o.children.length;){let{i:a,off:v}=o.childPos(n,1);for(;;a++){if(a==o.children.length)return null;if((o=o.children[a]).length)break}n=v}if(!(o instanceof ec))return null;let f=Ir(o.text,n);if(f==n)return null;let d=Hd(o.dom,n,f).getClientRects();for(let a=0;a<d.length;a++){let v=d[a];if(a==d.length-1||v.top<v.bottom&&v.left<v.right)return v}return null}measureVisibleLineHeights(e){let t=[],{from:n,to:o}=e,f=this.view.contentDOM.clientWidth,d=f>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,v=this.view.textDirection==jn.LTR;for(let A=0,P=0;P<this.children.length;P++){let L=this.children[P],j=A+L.length;if(j>o)break;if(A>=n){let F=L.dom.getBoundingClientRect();if(t.push(F.height),d){let K=L.dom.lastChild,se=K?xm(K):[];if(se.length){let le=se[se.length-1],ve=v?le.right-F.left:F.right-le.left;ve>a&&(a=ve,this.minWidth=f,this.minWidthFrom=A,this.minWidthTo=j)}}}A=j+L.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?jn.RTL:jn.LTR}measureTextSize(){for(let f of this.children)if(f instanceof Us){let d=f.measureTextSize();if(d)return d}let e=document.createElement("div"),t,n,o;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let f=xm(e.firstChild)[0];t=e.getBoundingClientRect().height,n=f?f.width/27:7,o=f?f.height:t,e.remove()}),{lineHeight:t,charWidth:n,textHeight:o}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new y2(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let n=0,o=0;;o++){let f=o==t.viewports.length?null:t.viewports[o],d=f?f.from-1:this.length;if(d>n){let a=(t.lineBlockAt(d).bottom-t.lineBlockAt(n).top)/this.view.scaleY;e.push(ni.replace({widget:new Iv(a),block:!0,inclusive:!0,isBlockGap:!0}).range(n,d))}if(!f)break;n=f.to+1}return ni.set(e)}updateDeco(){let e=1,t=this.view.state.facet(ay).map(f=>(this.dynamicDecorationMap[e++]=typeof f=="function")?f(this.view):f),n=!1,o=this.view.state.facet(U2).map((f,d)=>{let a=typeof f=="function";return a&&(n=!0),a?f(this.view):f});for(o.length&&(this.dynamicDecorationMap[e++]=n,t.push(qi.join(o))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let A=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=A.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let A of this.view.state.facet(F2))try{if(A(this.view,e.range,e))return!0}catch(P){Fo(this.view.state,P,"scroll handler")}let{range:t}=e,n=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),o;if(!n)return;!t.empty&&(o=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(n={left:Math.min(n.left,o.left),top:Math.min(n.top,o.top),right:Math.max(n.right,o.right),bottom:Math.max(n.bottom,o.bottom)});let f=Z2(this.view),d={left:n.left-f.left,top:n.top-f.top,right:n.right+f.right,bottom:n.bottom+f.bottom},{offsetWidth:a,offsetHeight:v}=this.view.scrollDOM;RA(this.view.scrollDOM,d,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,v),-v),this.view.textDirection==jn.LTR)}}function ek(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}function G2(s,e){let t=s.observer.selectionRange;if(!t.focusNode)return null;let n=m2(t.focusNode,t.focusOffset),o=g2(t.focusNode,t.focusOffset),f=n||o;if(o&&n&&o.node!=n.node){let a=An.get(o.node);if(!a||a instanceof ec&&a.text!=o.node.nodeValue)f=o;else if(s.docView.lastCompositionAfterCursor){let v=An.get(n.node);!v||v instanceof ec&&v.text!=n.node.nodeValue||(f=o)}}if(s.docView.lastCompositionAfterCursor=f!=n,!f)return null;let d=e-f.offset;return{from:d,to:d+f.node.nodeValue.length,node:f.node}}function tk(s,e,t){let n=G2(s,t);if(!n)return null;let{node:o,from:f,to:d}=n,a=o.nodeValue;if(/[\n\r]/.test(a)||s.state.doc.sliceString(n.from,n.to)!=a)return null;let v=e.invertedDesc,A=new al(v.mapPos(f),v.mapPos(d),f,d),P=[];for(let L=o.parentNode;;L=L.parentNode){let j=An.get(L);if(j instanceof ih)P.push({node:L,deco:j.mark});else{if(j instanceof Us||L.nodeName=="DIV"&&L.parentNode==s.contentDOM)return{range:A,text:o,marks:P,line:L};if(L!=s.contentDOM)P.push({node:L,deco:new Sy({inclusive:!0,attributes:UA(L),tagName:L.tagName.toLowerCase()})});else return null}}}function ik(s,e){return s.nodeType!=1?0:(e&&s.childNodes[e-1].contentEditable=="false"?1:0)|(e<s.childNodes.length&&s.childNodes[e].contentEditable=="false"?2:0)}let nk=class{constructor(){this.changes=[]}compareRange(e,t){Rv(e,t,this.changes)}comparePoint(e,t){Rv(e,t,this.changes)}};function sk(s,e,t){let n=new nk;return qi.compare(s,e,t,n),n.changes}function rk(s,e){for(let t=s;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function ok(s,e){let t=!1;return e&&s.iterChangedRanges((n,o)=>{n<e.to&&o>e.from&&(t=!0)}),t}function ak(s,e,t=1){let n=s.charCategorizer(e),o=s.doc.lineAt(e),f=e-o.from;if(o.length==0)return yt.cursor(e);f==0?t=1:f==o.length&&(t=-1);let d=f,a=f;t<0?d=Ir(o.text,f,!1):a=Ir(o.text,f);let v=n(o.text.slice(d,a));for(;d>0;){let A=Ir(o.text,d,!1);if(n(o.text.slice(A,d))!=v)break;d=A}for(;a<o.length;){let A=Ir(o.text,a);if(n(o.text.slice(a,A))!=v)break;a=A}return yt.range(d+o.from,a+o.from)}function lk(s,e){return e.left>s?e.left-s:Math.max(0,s-e.right)}function ck(s,e){return e.top>s?e.top-s:Math.max(0,s-e.bottom)}function Lb(s,e){return s.top<e.bottom-1&&s.bottom>e.top+1}function Z1(s,e){return e<s.top?{top:e,left:s.left,right:s.right,bottom:s.bottom}:s}function G1(s,e){return e>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:e}:s}function Fv(s,e,t){let n,o,f,d,a=!1,v,A,P,L;for(let K=s.firstChild;K;K=K.nextSibling){let se=xm(K);for(let le=0;le<se.length;le++){let ve=se[le];o&&Lb(o,ve)&&(ve=Z1(G1(ve,o.bottom),o.top));let Be=lk(e,ve),je=ck(t,ve);if(Be==0&&je==0)return K.nodeType==3?$1(K,e,t):Fv(K,e,t);if(!n||d>je||d==je&&f>Be){n=K,o=ve,f=Be,d=je;let ze=je?t<ve.top?-1:1:Be?e<ve.left?-1:1:0;a=!ze||(ze>0?le<se.length-1:le>0)}Be==0?t>ve.bottom&&(!P||P.bottom<ve.bottom)?(v=K,P=ve):t<ve.top&&(!L||L.top>ve.top)&&(A=K,L=ve):P&&Lb(P,ve)?P=G1(P,ve.bottom):L&&Lb(L,ve)&&(L=Z1(L,ve.top))}}if(P&&P.bottom>=t?(n=v,o=P):L&&L.top<=t&&(n=A,o=L),!n)return{node:s,offset:0};let j=Math.max(o.left,Math.min(o.right,e));if(n.nodeType==3)return $1(n,j,t);if(a&&n.contentEditable!="false")return Fv(n,j,t);let F=Array.prototype.indexOf.call(s.childNodes,n)+(e>=(o.left+o.right)/2?1:0);return{node:s,offset:F}}function $1(s,e,t){let n=s.nodeValue.length,o=-1,f=1e9,d=0;for(let a=0;a<n;a++){let v=Hd(s,a,a+1).getClientRects();for(let A=0;A<v.length;A++){let P=v[A];if(P.top==P.bottom)continue;d||(d=e-P.left);let L=(P.top>t?P.top-t:t-P.bottom)-1;if(P.left-1<=e&&P.right+1>=e&&L<f){let j=e>=(P.left+P.right)/2,F=j;if((Zt.chrome||Zt.gecko)&&Hd(s,a).getBoundingClientRect().left==P.right&&(F=!j),L<=0)return{node:s,offset:a+(F?1:0)};o=a+(F?1:0),f=L}}}return{node:s,offset:o>-1?o:d>0?s.nodeValue.length:0}}function $2(s,e,t,n=-1){var o,f;let d=s.contentDOM.getBoundingClientRect(),a=d.top+s.viewState.paddingTop,v,{docHeight:A}=s.viewState,{x:P,y:L}=e,j=L-a;if(j<0)return 0;if(j>A)return s.state.doc.length;for(let ze=s.viewState.heightOracle.textHeight/2,ke=!1;v=s.elementAtHeight(j),v.type!=mo.Text;)for(;j=n>0?v.bottom+ze:v.top-ze,!(j>=0&&j<=A);){if(ke)return t?null:0;ke=!0,n=-n}L=a+j;let F=v.from;if(F<s.viewport.from)return s.viewport.from==0?0:t?null:X1(s,d,v,P,L);if(F>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:t?null:X1(s,d,v,P,L);let K=s.dom.ownerDocument,se=s.root.elementFromPoint?s.root:K,le=se.elementFromPoint(P,L);le&&!s.contentDOM.contains(le)&&(le=null),le||(P=Math.max(d.left+1,Math.min(d.right-1,P)),le=se.elementFromPoint(P,L),le&&!s.contentDOM.contains(le)&&(le=null));let ve,Be=-1;if(le&&((o=s.docView.nearest(le))===null||o===void 0?void 0:o.isEditable)!=!1){if(K.caretPositionFromPoint){let ze=K.caretPositionFromPoint(P,L);ze&&({offsetNode:ve,offset:Be}=ze)}else if(K.caretRangeFromPoint){let ze=K.caretRangeFromPoint(P,L);ze&&({startContainer:ve,startOffset:Be}=ze,(!s.contentDOM.contains(ve)||Zt.safari&&uk(ve,Be,P)||Zt.chrome&&hk(ve,Be,P))&&(ve=void 0))}ve&&(Be=Math.min($c(ve),Be))}if(!ve||!s.docView.dom.contains(ve)){let ze=Us.find(s.docView,F);if(!ze)return j>v.top+v.height/2?v.to:v.from;({node:ve,offset:Be}=Fv(ze.dom,P,L))}let je=s.docView.nearest(ve);if(!je)return null;if(je.isWidget&&((f=je.dom)===null||f===void 0?void 0:f.nodeType)==1){let ze=je.dom.getBoundingClientRect();return e.y<ze.top||e.y<=ze.bottom&&e.x<=(ze.left+ze.right)/2?je.posAtStart:je.posAtEnd}else return je.localPosFromDOM(ve,Be)+je.posAtStart}function X1(s,e,t,n,o){let f=Math.round((n-e.left)*s.defaultCharacterWidth);if(s.lineWrapping&&t.height>s.defaultLineHeight*1.5){let a=s.viewState.heightOracle.textHeight,v=Math.floor((o-t.top-(s.defaultLineHeight-a)*.5)/a);f+=v*s.viewState.heightOracle.lineLength}let d=s.state.sliceDoc(t.from,t.to);return t.from+Tv(d,f,s.state.tabSize)}function uk(s,e,t){let n;if(s.nodeType!=3||e!=(n=s.nodeValue.length))return!1;for(let o=s.nextSibling;o;o=o.nextSibling)if(o.nodeType!=1||o.nodeName!="BR")return!1;return Hd(s,n-1,n).getBoundingClientRect().left>t}function hk(s,e,t){if(e!=0)return!1;for(let o=s;;){let f=o.parentNode;if(!f||f.nodeType!=1||f.firstChild!=o)return!1;if(f.classList.contains("cm-line"))break;o=f}let n=s.nodeType==1?s.getBoundingClientRect():Hd(s,0,Math.max(s.nodeValue.length,1)).getBoundingClientRect();return t-n.left>5}function jv(s,e){let t=s.lineBlockAt(e);if(Array.isArray(t.type)){for(let n of t.type)if(n.to>e||n.to==e&&(n.to==t.to||n.type==mo.Text))return n}return t}function fk(s,e,t,n){let o=jv(s,e.head),f=!n||o.type!=mo.Text||!(s.lineWrapping||o.widgetLineBreaks)?null:s.coordsAtPos(e.assoc<0&&e.head>o.from?e.head-1:e.head);if(f){let d=s.dom.getBoundingClientRect(),a=s.textDirectionAt(o.from),v=s.posAtCoords({x:t==(a==jn.LTR)?d.right-1:d.left+1,y:(f.top+f.bottom)/2});if(v!=null)return yt.cursor(v,t?-1:1)}return yt.cursor(t?o.to:o.from,t?-1:1)}function Q1(s,e,t,n){let o=s.state.doc.lineAt(e.head),f=s.bidiSpans(o),d=s.textDirectionAt(o.from);for(let a=e,v=null;;){let A=KA(o,f,d,a,t),P=P2;if(!A){if(o.number==(t?s.state.doc.lines:1))return a;P=`
`,o=s.state.doc.line(o.number+(t?1:-1)),f=s.bidiSpans(o),A=s.visualLineSide(o,!t)}if(v){if(!v(P))return a}else{if(!n)return A;v=n(P)}a=A}}function dk(s,e,t){let n=s.state.charCategorizer(e),o=n(t);return f=>{let d=n(f);return o==Qn.Space&&(o=d),o==d}}function pk(s,e,t,n){let o=e.head,f=t?1:-1;if(o==(t?s.state.doc.length:0))return yt.cursor(o,e.assoc);let d=e.goalColumn,a,v=s.contentDOM.getBoundingClientRect(),A=s.coordsAtPos(o,e.assoc||-1),P=s.documentTop;if(A)d==null&&(d=A.left-v.left),a=f<0?A.top:A.bottom;else{let F=s.viewState.lineBlockAt(o);d==null&&(d=Math.min(v.right-v.left,s.defaultCharacterWidth*(o-F.from))),a=(f<0?F.top:F.bottom)+P}let L=v.left+d,j=n??s.viewState.heightOracle.textHeight>>1;for(let F=0;;F+=10){let K=a+(j+F)*f,se=$2(s,{x:L,y:K},!1,f);if(K<v.top||K>v.bottom||(f<0?se<o:se>o)){let le=s.docView.coordsForChar(se),ve=!le||K<le.top?-1:1;return yt.cursor(se,ve,void 0,d)}}}function Q_(s,e,t){for(;;){let n=0;for(let o of s)o.between(e-1,e+1,(f,d,a)=>{if(e>f&&e<d){let v=n||t||(e-f<d-e?-1:1);e=v<0?f:d,n=v}});if(!n)return e}}function Bb(s,e,t){let n=Q_(s.state.facet(Px).map(o=>o(s)),t.from,e.head>t.from?-1:1);return n==t.from?t:yt.cursor(n,n<t.from?1:-1)}const Zg="￿";class mk{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Bi.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Zg}readRange(e,t){if(!e)return this;let n=e.parentNode;for(let o=e;;){this.findPointBefore(n,o);let f=this.text.length;this.readNode(o);let d=o.nextSibling;if(d==t)break;let a=An.get(o),v=An.get(d);(a&&v?a.breakAfter:(a?a.breakAfter:u0(o))||u0(d)&&(o.nodeName!="BR"||o.cmIgnore)&&this.text.length>f)&&this.lineBreak(),o=d}return this.findPointBefore(n,t),this}readTextNode(e){let t=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,t.length));for(let n=0,o=this.lineSeparator?null:/\r\n?|\n/g;;){let f=-1,d=1,a;if(this.lineSeparator?(f=t.indexOf(this.lineSeparator,n),d=this.lineSeparator.length):(a=o.exec(t))&&(f=a.index,d=a[0].length),this.append(t.slice(n,f<0?t.length:f)),f<0)break;if(this.lineBreak(),d>1)for(let v of this.points)v.node==e&&v.pos>this.text.length&&(v.pos-=d-1);n=f+d}}readNode(e){if(e.cmIgnore)return;let t=An.get(e),n=t&&t.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let o=n.iter();!o.next().done;)o.lineBreak?this.lineBreak():this.append(o.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==t&&(n.pos=this.text.length)}findPointInside(e,t){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+(gk(e,n.node,n.offset)?t:0))}}function gk(s,e,t){for(;;){if(!e||t<$c(e))return!1;if(e==s)return!0;t=qd(e)+1,e=e.parentNode}}class W1{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class yk{constructor(e,t,n,o){this.typeOver=o,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:f,impreciseAnchor:d}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,n,0))){let a=f||d?[]:vk(e),v=new mk(a,e.state);v.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=v.text,this.newSel=xk(a,this.bounds.from)}else{let a=e.observer.selectionRange,v=f&&f.node==a.focusNode&&f.offset==a.focusOffset||!Av(e.contentDOM,a.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(a.focusNode,a.focusOffset),A=d&&d.node==a.anchorNode&&d.offset==a.anchorOffset||!Av(e.contentDOM,a.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(a.anchorNode,a.anchorOffset),P=e.viewport;if((Zt.ios||Zt.chrome)&&e.state.selection.main.empty&&v!=A&&(P.from>0||P.to<e.state.doc.length)){let L=Math.min(v,A),j=Math.max(v,A),F=P.from-L,K=P.to-j;(F==0||F==1||L==0)&&(K==0||K==-1||j==e.state.doc.length)&&(v=0,A=e.state.doc.length)}this.newSel=yt.single(A,v)}}}function X2(s,e){let t,{newSel:n}=e,o=s.state.selection.main,f=s.inputState.lastKeyTime>Date.now()-100?s.inputState.lastKeyCode:-1;if(e.bounds){let{from:d,to:a}=e.bounds,v=o.from,A=null;(f===8||Zt.android&&e.text.length<a-d)&&(v=o.to,A="end");let P=bk(s.state.doc.sliceString(d,a,Zg),e.text,v-d,A);P&&(Zt.chrome&&f==13&&P.toB==P.from+2&&e.text.slice(P.from,P.toB)==Zg+Zg&&P.toB--,t={from:d+P.from,to:d+P.toA,insert:Qi.of(e.text.slice(P.from,P.toB).split(Zg))})}else n&&(!s.hasFocus&&s.state.facet(hf)||n.main.eq(o))&&(n=null);if(!t&&!n)return!1;if(!t&&e.typeOver&&!o.empty&&n&&n.main.empty?t={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:t&&t.from>=o.from&&t.to<=o.to&&(t.from!=o.from||t.to!=o.to)&&o.to-o.from-(t.to-t.from)<=4?t={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,t.from).append(t.insert).append(s.state.doc.slice(t.to,o.to))}:(Zt.mac||Zt.android)&&t&&t.from==t.to&&t.from==o.head-1&&/^\. ?$/.test(t.insert.toString())&&s.contentDOM.getAttribute("autocorrect")=="off"?(n&&t.insert.length==2&&(n=yt.single(n.main.anchor-1,n.main.head-1)),t={from:o.from,to:o.to,insert:Qi.of([" "])}):Zt.chrome&&t&&t.from==t.to&&t.from==o.head&&t.insert.toString()==`
 `&&s.lineWrapping&&(n&&(n=yt.single(n.main.anchor-1,n.main.head-1)),t={from:o.from,to:o.to,insert:Qi.of([" "])}),t)return Ox(s,t,n,f);if(n&&!n.main.eq(o)){let d=!1,a="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(d=!0),a=s.inputState.lastSelectionOrigin),s.dispatch({selection:n,scrollIntoView:d,userEvent:a}),!0}else return!1}function Ox(s,e,t,n=-1){if(Zt.ios&&s.inputState.flushIOSKey(e))return!0;let o=s.state.selection.main;if(Zt.android&&(e.to==o.to&&(e.from==o.from||e.from==o.from-1&&s.state.sliceDoc(e.from,o.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&dm(s.contentDOM,"Enter",13)||(e.from==o.from-1&&e.to==o.to&&e.insert.length==0||n==8&&e.insert.length<e.to-e.from&&e.to>o.head)&&dm(s.contentDOM,"Backspace",8)||e.from==o.from&&e.to==o.to+1&&e.insert.length==0&&dm(s.contentDOM,"Delete",46)))return!0;let f=e.insert.toString();s.inputState.composing>=0&&s.inputState.composing++;let d,a=()=>d||(d=_k(s,e,t));return s.state.facet(z2).some(v=>v(s,e.from,e.to,f,a))||s.dispatch(a()),!0}function _k(s,e,t){let n,o=s.state,f=o.selection.main;if(e.from>=f.from&&e.to<=f.to&&e.to-e.from>=(f.to-f.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&s.inputState.composing<0){let a=f.from<e.from?o.sliceDoc(f.from,e.from):"",v=f.to>e.to?o.sliceDoc(e.to,f.to):"";n=o.replaceSelection(s.state.toText(a+e.insert.sliceString(0,void 0,s.state.lineBreak)+v))}else{let a=o.changes(e),v=t&&t.main.to<=a.newLength?t.main:void 0;if(o.selection.ranges.length>1&&s.inputState.composing>=0&&e.to<=f.to&&e.to>=f.to-10){let A=s.state.sliceDoc(e.from,e.to),P,L=t&&G2(s,t.main.head);if(L){let K=e.insert.length-(e.to-e.from);P={from:L.from,to:L.to-K}}else P=s.state.doc.lineAt(f.head);let j=f.to-e.to,F=f.to-f.from;n=o.changeByRange(K=>{if(K.from==f.from&&K.to==f.to)return{changes:a,range:v||K.map(a)};let se=K.to-j,le=se-A.length;if(K.to-K.from!=F||s.state.sliceDoc(le,se)!=A||K.to>=P.from&&K.from<=P.to)return{range:K};let ve=o.changes({from:le,to:se,insert:e.insert}),Be=K.to-f.to;return{changes:ve,range:v?yt.range(Math.max(0,v.anchor+Be),Math.max(0,v.head+Be)):K.map(ve)}})}else n={changes:a,selection:v&&o.selection.replaceRange(v)}}let d="input.type";return(s.composing||s.inputState.compositionPendingChange&&s.inputState.compositionEndedAt>Date.now()-50)&&(s.inputState.compositionPendingChange=!1,d+=".compose",s.inputState.compositionFirstChange&&(d+=".start",s.inputState.compositionFirstChange=!1)),o.update(n,{userEvent:d,scrollIntoView:!0})}function bk(s,e,t,n){let o=Math.min(s.length,e.length),f=0;for(;f<o&&s.charCodeAt(f)==e.charCodeAt(f);)f++;if(f==o&&s.length==e.length)return null;let d=s.length,a=e.length;for(;d>0&&a>0&&s.charCodeAt(d-1)==e.charCodeAt(a-1);)d--,a--;if(n=="end"){let v=Math.max(0,f-Math.min(d,a));t-=d+v-f}if(d<f&&s.length<e.length){let v=t<=f&&t>=d?f-t:0;f-=v,a=f+(a-d),d=f}else if(a<f){let v=t<=f&&t>=a?f-t:0;f-=v,d=f+(d-a),a=f}return{from:f,toA:d,toB:a}}function vk(s){let e=[];if(s.root.activeElement!=s.contentDOM)return e;let{anchorNode:t,anchorOffset:n,focusNode:o,focusOffset:f}=s.observer.selectionRange;return t&&(e.push(new W1(t,n)),(o!=t||f!=n)&&e.push(new W1(o,f))),e}function xk(s,e){if(s.length==0)return null;let t=s[0].pos,n=s.length==2?s[1].pos:t;return t>-1&&n>-1?yt.single(t+e,n+e):null}class wk{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Zt.safari&&e.contentDOM.addEventListener("input",()=>null),Zt.gecko&&Nk(e.contentDOM.ownerDocument)}handleEvent(e){!Pk(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,t){let n=this.handlers[e];if(n){for(let o of n.observers)o(this.view,t);for(let o of n.handlers){if(t.defaultPrevented)break;if(o(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=Sk(e),n=this.handlers,o=this.view.contentDOM;for(let f in t)if(f!="scroll"){let d=!t[f].handlers.length,a=n[f];a&&d!=!a.handlers.length&&(o.removeEventListener(f,this.handleEvent),a=null),a||o.addEventListener(f,this.handleEvent,{passive:d})}for(let f in n)f!="scroll"&&!t[f]&&o.removeEventListener(f,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&W2.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Zt.android&&Zt.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return Zt.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=Q2.find(n=>n.keyCode==e.keyCode))&&!e.ctrlKey||Tk.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,dm(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:Zt.safari&&!Zt.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function K1(s,e){return(t,n)=>{try{return e.call(s,n,t)}catch(o){Fo(t.state,o)}}}function Sk(s){let e=Object.create(null);function t(n){return e[n]||(e[n]={observers:[],handlers:[]})}for(let n of s){let o=n.spec;if(o&&o.domEventHandlers)for(let f in o.domEventHandlers){let d=o.domEventHandlers[f];d&&t(f).handlers.push(K1(n.value,d))}if(o&&o.domEventObservers)for(let f in o.domEventObservers){let d=o.domEventObservers[f];d&&t(f).observers.push(K1(n.value,d))}}for(let n in tc)t(n).handlers.push(tc[n]);for(let n in ul)t(n).observers.push(ul[n]);return e}const Q2=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Tk="dthko",W2=[16,17,18,20,91,92,224,225],w_=6;function S_(s){return Math.max(0,s)*.7+8}function Mk(s,e){return Math.max(Math.abs(s.clientX-e.clientX),Math.abs(s.clientY-e.clientY))}class Ck{constructor(e,t,n,o){this.view=e,this.startEvent=t,this.style=n,this.mustSelect=o,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=IA(e.contentDOM),this.atoms=e.state.facet(Px).map(d=>d(e));let f=e.contentDOM.ownerDocument;f.addEventListener("mousemove",this.move=this.move.bind(this)),f.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Bi.allowMultipleSelections)&&Ak(e,t),this.dragging=Ek(e,t)&&J2(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Mk(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,n=0,o=0,f=0,d=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:o,right:d}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:f,bottom:a}=this.scrollParents.y.getBoundingClientRect());let v=Z2(this.view);e.clientX-v.left<=o+w_?t=-S_(o-e.clientX):e.clientX+v.right>=d-w_&&(t=S_(e.clientX-d)),e.clientY-v.top<=f+w_?n=-S_(f-e.clientY):e.clientY+v.bottom>=a-w_&&(n=S_(e.clientY-a)),this.setScrollSpeed(t,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let n=0;n<e.ranges.length;n++){let o=e.ranges[n],f=null;if(o.empty){let d=Q_(this.atoms,o.from,0);d!=o.from&&(f=yt.cursor(d,-1))}else{let d=Q_(this.atoms,o.from,-1),a=Q_(this.atoms,o.to,1);(d!=o.from||a!=o.to)&&(f=yt.range(o.from==o.anchor?d:a,o.from==o.head?d:a))}f&&(t||(t=e.ranges.slice()),t[n]=f)}return t?yt.create(t,e.mainIndex):e}select(e){let{view:t}=this,n=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!n.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Ak(s,e){let t=s.state.facet(O2);return t.length?t[0](e):Zt.mac?e.metaKey:e.ctrlKey}function kk(s,e){let t=s.state.facet(D2);return t.length?t[0](e):Zt.mac?!e.altKey:!e.ctrlKey}function Ek(s,e){let{main:t}=s.state.selection;if(t.empty)return!1;let n=oy(s.root);if(!n||n.rangeCount==0)return!0;let o=n.getRangeAt(0).getClientRects();for(let f=0;f<o.length;f++){let d=o[f];if(d.left<=e.clientX&&d.right>=e.clientX&&d.top<=e.clientY&&d.bottom>=e.clientY)return!0}return!1}function Pk(s,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,n;t!=s.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(n=An.get(t))&&n.ignoreEvent(e))return!1;return!0}const tc=Object.create(null),ul=Object.create(null),K2=Zt.ie&&Zt.ie_version<15||Zt.ios&&Zt.webkit_version<604;function Ok(s){let e=s.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{s.focus(),t.remove(),Y2(s,t.value)},50)}function q0(s,e,t){for(let n of s.facet(e))t=n(t,s);return t}function Y2(s,e){e=q0(s.state,Ax,e);let{state:t}=s,n,o=1,f=t.toText(e),d=f.lines==t.selection.ranges.length;if(Vv!=null&&t.selection.ranges.every(v=>v.empty)&&Vv==f.toString()){let v=-1;n=t.changeByRange(A=>{let P=t.doc.lineAt(A.from);if(P.from==v)return{range:A};v=P.from;let L=t.toText((d?f.line(o++).text:e)+t.lineBreak);return{changes:{from:P.from,insert:L},range:yt.cursor(A.from+L.length)}})}else d?n=t.changeByRange(v=>{let A=f.line(o++);return{changes:{from:v.from,to:v.to,insert:A.text},range:yt.cursor(v.from+A.length)}}):n=t.replaceSelection(f);s.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}ul.scroll=s=>{s.inputState.lastScrollTop=s.scrollDOM.scrollTop,s.inputState.lastScrollLeft=s.scrollDOM.scrollLeft};tc.keydown=(s,e)=>(s.inputState.setSelectionOrigin("select"),e.keyCode==27&&s.inputState.tabFocusMode!=0&&(s.inputState.tabFocusMode=Date.now()+2e3),!1);ul.touchstart=(s,e)=>{s.inputState.lastTouchTime=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};ul.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};tc.mousedown=(s,e)=>{if(s.observer.flush(),s.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let n of s.state.facet(R2))if(t=n(s,e),t)break;if(!t&&e.button==0&&(t=Ik(s,e)),t){let n=!s.hasFocus;s.inputState.startMouseSelection(new Ck(s,e,t,n)),n&&s.observer.ignore(()=>{f2(s.contentDOM);let f=s.root.activeElement;f&&!f.contains(s.contentDOM)&&f.blur()});let o=s.inputState.mouseSelection;if(o)return o.start(e),o.dragging===!1}return!1};function Y1(s,e,t,n){if(n==1)return yt.cursor(e,t);if(n==2)return ak(s.state,e,t);{let o=Us.find(s.docView,e),f=s.state.doc.lineAt(o?o.posAtEnd:e),d=o?o.posAtStart:f.from,a=o?o.posAtEnd:f.to;return a<s.state.doc.length&&a==f.to&&a++,yt.range(d,a)}}let J1=(s,e,t)=>e>=t.top&&e<=t.bottom&&s>=t.left&&s<=t.right;function Dk(s,e,t,n){let o=Us.find(s.docView,e);if(!o)return 1;let f=e-o.posAtStart;if(f==0)return 1;if(f==o.length)return-1;let d=o.coordsAt(f,-1);if(d&&J1(t,n,d))return-1;let a=o.coordsAt(f,1);return a&&J1(t,n,a)?1:d&&d.bottom>=n?-1:1}function ew(s,e){let t=s.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Dk(s,t,e.clientX,e.clientY)}}const Rk=Zt.ie&&Zt.ie_version<=11;let tw=null,iw=0,nw=0;function J2(s){if(!Rk)return s.detail;let e=tw,t=nw;return tw=s,nw=Date.now(),iw=!e||t>Date.now()-400&&Math.abs(e.clientX-s.clientX)<2&&Math.abs(e.clientY-s.clientY)<2?(iw+1)%3:1}function Ik(s,e){let t=ew(s,e),n=J2(e),o=s.state.selection;return{update(f){f.docChanged&&(t.pos=f.changes.mapPos(t.pos),o=o.map(f.changes))},get(f,d,a){let v=ew(s,f),A,P=Y1(s,v.pos,v.bias,n);if(t.pos!=v.pos&&!d){let L=Y1(s,t.pos,t.bias,n),j=Math.min(L.from,P.from),F=Math.max(L.to,P.to);P=j<P.from?yt.range(j,F):yt.range(F,j)}return d?o.replaceRange(o.main.extend(P.from,P.to)):a&&n==1&&o.ranges.length>1&&(A=zk(o,v.pos))?A:a?o.addRange(P):yt.create([P])}}}function zk(s,e){for(let t=0;t<s.ranges.length;t++){let{from:n,to:o}=s.ranges[t];if(n<=e&&o>=e)return yt.create(s.ranges.slice(0,t).concat(s.ranges.slice(t+1)),s.mainIndex==t?0:s.mainIndex-(s.mainIndex>t?1:0))}return null}tc.dragstart=(s,e)=>{let{selection:{main:t}}=s.state;if(e.target.draggable){let o=s.docView.nearest(e.target);if(o&&o.isWidget){let f=o.posAtStart,d=f+o.length;(f>=t.to||d<=t.from)&&(t=yt.range(f,d))}}let{inputState:n}=s;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",q0(s.state,kx,s.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};tc.dragend=s=>(s.inputState.draggedContent=null,!1);function sw(s,e,t,n){if(t=q0(s.state,Ax,t),!t)return;let o=s.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:f}=s.inputState,d=n&&f&&kk(s,e)?{from:f.from,to:f.to}:null,a={from:o,insert:t},v=s.state.changes(d?[d,a]:a);s.focus(),s.dispatch({changes:v,selection:{anchor:v.mapPos(o,-1),head:v.mapPos(o,1)},userEvent:d?"move.drop":"input.drop"}),s.inputState.draggedContent=null}tc.drop=(s,e)=>{if(!e.dataTransfer)return!1;if(s.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let n=Array(t.length),o=0,f=()=>{++o==t.length&&sw(s,e,n.filter(d=>d!=null).join(s.state.lineBreak),!1)};for(let d=0;d<t.length;d++){let a=new FileReader;a.onerror=f,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(n[d]=a.result),f()},a.readAsText(t[d])}return!0}else{let n=e.dataTransfer.getData("Text");if(n)return sw(s,e,n,!0),!0}return!1};tc.paste=(s,e)=>{if(s.state.readOnly)return!0;s.observer.flush();let t=K2?null:e.clipboardData;return t?(Y2(s,t.getData("text/plain")||t.getData("text/uri-list")),!0):(Ok(s),!1)};function Lk(s,e){let t=s.dom.parentNode;if(!t)return;let n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),s.focus()},50)}function Bk(s){let e=[],t=[],n=!1;for(let o of s.selection.ranges)o.empty||(e.push(s.sliceDoc(o.from,o.to)),t.push(o));if(!e.length){let o=-1;for(let{from:f}of s.selection.ranges){let d=s.doc.lineAt(f);d.number>o&&(e.push(d.text),t.push({from:d.from,to:Math.min(s.doc.length,d.to+1)})),o=d.number}n=!0}return{text:q0(s,kx,e.join(s.lineBreak)),ranges:t,linewise:n}}let Vv=null;tc.copy=tc.cut=(s,e)=>{let{text:t,ranges:n,linewise:o}=Bk(s.state);if(!t&&!o)return!1;Vv=o?t:null,e.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let f=K2?null:e.clipboardData;return f?(f.clearData(),f.setData("text/plain",t),!0):(Lk(s,t),!1)};const eT=Qc.define();function tT(s,e){let t=[];for(let n of s.facet(L2)){let o=n(s,e);o&&t.push(o)}return t?s.update({effects:t,annotations:eT.of(!0)}):null}function iT(s){setTimeout(()=>{let e=s.hasFocus;if(e!=s.inputState.notifiedFocused){let t=tT(s.state,e);t?s.dispatch(t):s.update([])}},10)}ul.focus=s=>{s.inputState.lastFocusTime=Date.now(),!s.scrollDOM.scrollTop&&(s.inputState.lastScrollTop||s.inputState.lastScrollLeft)&&(s.scrollDOM.scrollTop=s.inputState.lastScrollTop,s.scrollDOM.scrollLeft=s.inputState.lastScrollLeft),iT(s)};ul.blur=s=>{s.observer.clearSelectionRange(),iT(s)};ul.compositionstart=ul.compositionupdate=s=>{s.observer.editContext||(s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0))};ul.compositionend=s=>{s.observer.editContext||(s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionPendingKey=!0,s.inputState.compositionPendingChange=s.observer.pendingRecords().length>0,s.inputState.compositionFirstChange=null,Zt.chrome&&Zt.android?s.observer.flushSoon():s.inputState.compositionPendingChange?Promise.resolve().then(()=>s.observer.flush()):setTimeout(()=>{s.inputState.composing<0&&s.docView.hasComposition&&s.update([])},50))};ul.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};tc.beforeinput=(s,e)=>{var t,n;if(e.inputType=="insertReplacementText"&&s.observer.editContext){let f=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),d=e.getTargetRanges();if(f&&d.length){let a=d[0],v=s.posAtDOM(a.startContainer,a.startOffset),A=s.posAtDOM(a.endContainer,a.endOffset);return Ox(s,{from:v,to:A,insert:s.state.toText(f)},null),!0}}let o;if(Zt.chrome&&Zt.android&&(o=Q2.find(f=>f.inputType==e.inputType))&&(s.observer.delayAndroidKey(o.key,o.keyCode),o.key=="Backspace"||o.key=="Delete")){let f=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var d;(((d=window.visualViewport)===null||d===void 0?void 0:d.height)||0)>f+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}return Zt.ios&&e.inputType=="deleteContentForward"&&s.observer.flushSoon(),Zt.safari&&e.inputType=="insertText"&&s.inputState.composing>=0&&setTimeout(()=>ul.compositionend(s,e),20),!1};const rw=new Set;function Nk(s){rw.has(s)||(rw.add(s),s.addEventListener("copy",()=>{}),s.addEventListener("cut",()=>{}))}const ow=["pre-wrap","normal","pre-line","break-spaces"];let Tm=!1;function aw(){Tm=!1}class Fk{constructor(e){this.lineWrapping=e,this.doc=Qi.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let n=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((t-e-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return ow.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let n=0;n<e.length;n++){let o=e[n];o<0?n++:this.heightSamples[Math.floor(o*10)]||(t=!0,this.heightSamples[Math.floor(o*10)]=!0)}return t}refresh(e,t,n,o,f,d){let a=ow.indexOf(e)>-1,v=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=t,this.charWidth=n,this.textHeight=o,this.lineLength=f,v){this.heightSamples={};for(let A=0;A<d.length;A++){let P=d[A];P<0?A++:this.heightSamples[Math.floor(P*10)]=!0}}return v}}class jk{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Uc{constructor(e,t,n,o,f){this.from=e,this.length=t,this.top=n,this.height=o,this._content=f}get type(){return typeof this._content=="number"?mo.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Sf?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new Uc(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Fn=function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s}(Fn||(Fn={}));const W_=.001;class go{constructor(e,t,n=2){this.length=e,this.height=t,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>W_&&(Tm=!0),this.height=e)}replace(e,t,n){return go.of(n)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,n,o){let f=this,d=n.doc;for(let a=o.length-1;a>=0;a--){let{fromA:v,toA:A,fromB:P,toB:L}=o[a],j=f.lineAt(v,Fn.ByPosNoHeight,n.setDoc(t),0,0),F=j.to>=A?j:f.lineAt(A,Fn.ByPosNoHeight,n,0,0);for(L+=F.to-A,A=F.to;a>0&&j.from<=o[a-1].toA;)v=o[a-1].fromA,P=o[a-1].fromB,a--,v<j.from&&(j=f.lineAt(v,Fn.ByPosNoHeight,n,0,0));P+=j.from-v,v=j.from;let K=Dx.build(n.setDoc(d),e,P,L);f=d0(f,f.replace(v,A,K))}return f.updateHeight(n,0)}static empty(){return new _a(0,0)}static of(e){if(e.length==1)return e[0];let t=0,n=e.length,o=0,f=0;for(;;)if(t==n)if(o>f*2){let a=e[t-1];a.break?e.splice(--t,1,a.left,null,a.right):e.splice(--t,1,a.left,a.right),n+=1+a.break,o-=a.size}else if(f>o*2){let a=e[n];a.break?e.splice(n,1,a.left,null,a.right):e.splice(n,1,a.left,a.right),n+=2+a.break,f-=a.size}else break;else if(o<f){let a=e[t++];a&&(o+=a.size)}else{let a=e[--n];a&&(f+=a.size)}let d=0;return e[t-1]==null?(d=1,t--):e[t]==null&&(d=1,n++),new Vk(go.of(e.slice(0,t)),d,go.of(e.slice(n)))}}function d0(s,e){return s==e?s:(s.constructor!=e.constructor&&(Tm=!0),e)}go.prototype.size=1;class nT extends go{constructor(e,t,n){super(e,t),this.deco=n}blockAt(e,t,n,o){return new Uc(o,this.length,n,this.height,this.deco||0)}lineAt(e,t,n,o,f){return this.blockAt(0,n,o,f)}forEachLine(e,t,n,o,f,d){e<=f+this.length&&t>=f&&d(this.blockAt(0,n,o,f))}updateHeight(e,t=0,n=!1,o){return o&&o.from<=t&&o.more&&this.setHeight(o.heights[o.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class _a extends nT{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,n,o){return new Uc(o,this.length,n,this.height,this.breaks)}replace(e,t,n){let o=n[0];return n.length==1&&(o instanceof _a||o instanceof Pr&&o.flags&4)&&Math.abs(this.length-o.length)<10?(o instanceof Pr?o=new _a(o.length,this.height):o.height=this.height,this.outdated||(o.outdated=!1),o):go.of(n)}updateHeight(e,t=0,n=!1,o){return o&&o.from<=t&&o.more?this.setHeight(o.heights[o.index++]):(n||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Pr extends go{constructor(e){super(e,0)}heightMetrics(e,t){let n=e.doc.lineAt(t).number,o=e.doc.lineAt(t+this.length).number,f=o-n+1,d,a=0;if(e.lineWrapping){let v=Math.min(this.height,e.lineHeight*f);d=v/f,this.length>f+1&&(a=(this.height-v)/(this.length-f-1))}else d=this.height/f;return{firstLine:n,lastLine:o,perLine:d,perChar:a}}blockAt(e,t,n,o){let{firstLine:f,lastLine:d,perLine:a,perChar:v}=this.heightMetrics(t,o);if(t.lineWrapping){let A=o+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-n)/this.height))*this.length)),P=t.doc.lineAt(A),L=a+P.length*v,j=Math.max(n,e-L/2);return new Uc(P.from,P.length,j,L,0)}else{let A=Math.max(0,Math.min(d-f,Math.floor((e-n)/a))),{from:P,length:L}=t.doc.line(f+A);return new Uc(P,L,n+a*A,a,0)}}lineAt(e,t,n,o,f){if(t==Fn.ByHeight)return this.blockAt(e,n,o,f);if(t==Fn.ByPosNoHeight){let{from:F,to:K}=n.doc.lineAt(e);return new Uc(F,K-F,0,0,0)}let{firstLine:d,perLine:a,perChar:v}=this.heightMetrics(n,f),A=n.doc.lineAt(e),P=a+A.length*v,L=A.number-d,j=o+a*L+v*(A.from-f-L);return new Uc(A.from,A.length,Math.max(o,Math.min(j,o+this.height-P)),P,0)}forEachLine(e,t,n,o,f,d){e=Math.max(e,f),t=Math.min(t,f+this.length);let{firstLine:a,perLine:v,perChar:A}=this.heightMetrics(n,f);for(let P=e,L=o;P<=t;){let j=n.doc.lineAt(P);if(P==e){let K=j.number-a;L+=v*K+A*(e-f-K)}let F=v+A*j.length;d(new Uc(j.from,j.length,L,F,0)),L+=F,P=j.to+1}}replace(e,t,n){let o=this.length-t;if(o>0){let f=n[n.length-1];f instanceof Pr?n[n.length-1]=new Pr(f.length+o):n.push(null,new Pr(o-1))}if(e>0){let f=n[0];f instanceof Pr?n[0]=new Pr(e+f.length):n.unshift(new Pr(e-1),null)}return go.of(n)}decomposeLeft(e,t){t.push(new Pr(e-1),null)}decomposeRight(e,t){t.push(null,new Pr(this.length-e-1))}updateHeight(e,t=0,n=!1,o){let f=t+this.length;if(o&&o.from<=t+this.length&&o.more){let d=[],a=Math.max(t,o.from),v=-1;for(o.from>t&&d.push(new Pr(o.from-t-1).updateHeight(e,t));a<=f&&o.more;){let P=e.doc.lineAt(a).length;d.length&&d.push(null);let L=o.heights[o.index++];v==-1?v=L:Math.abs(L-v)>=W_&&(v=-2);let j=new _a(P,L);j.outdated=!1,d.push(j),a+=P+1}a<=f&&d.push(null,new Pr(f-a).updateHeight(e,a));let A=go.of(d);return(v<0||Math.abs(A.height-this.height)>=W_||Math.abs(v-this.heightMetrics(e,t).perLine)>=W_)&&(Tm=!0),d0(this,A)}else(n||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class Vk extends go{constructor(e,t,n){super(e.length+t+n.length,e.height+n.height,t|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,t,n,o){let f=n+this.left.height;return e<f?this.left.blockAt(e,t,n,o):this.right.blockAt(e,t,f,o+this.left.length+this.break)}lineAt(e,t,n,o,f){let d=o+this.left.height,a=f+this.left.length+this.break,v=t==Fn.ByHeight?e<d:e<a,A=v?this.left.lineAt(e,t,n,o,f):this.right.lineAt(e,t,n,d,a);if(this.break||(v?A.to<a:A.from>a))return A;let P=t==Fn.ByPosNoHeight?Fn.ByPosNoHeight:Fn.ByPos;return v?A.join(this.right.lineAt(a,P,n,d,a)):this.left.lineAt(a,P,n,o,f).join(A)}forEachLine(e,t,n,o,f,d){let a=o+this.left.height,v=f+this.left.length+this.break;if(this.break)e<v&&this.left.forEachLine(e,t,n,o,f,d),t>=v&&this.right.forEachLine(e,t,n,a,v,d);else{let A=this.lineAt(v,Fn.ByPos,n,o,f);e<A.from&&this.left.forEachLine(e,A.from-1,n,o,f,d),A.to>=e&&A.from<=t&&d(A),t>A.to&&this.right.forEachLine(A.to+1,t,n,a,v,d)}}replace(e,t,n){let o=this.left.length+this.break;if(t<o)return this.balanced(this.left.replace(e,t,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-o,t-o,n));let f=[];e>0&&this.decomposeLeft(e,f);let d=f.length;for(let a of n)f.push(a);if(e>0&&lw(f,d-1),t<this.length){let a=f.length;this.decomposeRight(t,f),lw(f,a)}return go.of(f)}decomposeLeft(e,t){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(n++,e>=n&&t.push(null)),e>n&&this.right.decomposeLeft(e-n,t)}decomposeRight(e,t){let n=this.left.length,o=n+this.break;if(e>=o)return this.right.decomposeRight(e-o,t);e<n&&this.left.decomposeRight(e,t),this.break&&e<o&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?go.of(this.break?[e,null,t]:[e,t]):(this.left=d0(this.left,e),this.right=d0(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,n=!1,o){let{left:f,right:d}=this,a=t+f.length+this.break,v=null;return o&&o.from<=t+f.length&&o.more?v=f=f.updateHeight(e,t,n,o):f.updateHeight(e,t,n),o&&o.from<=a+d.length&&o.more?v=d=d.updateHeight(e,a,n,o):d.updateHeight(e,a,n),v?this.balanced(f,d):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function lw(s,e){let t,n;s[e]==null&&(t=s[e-1])instanceof Pr&&(n=s[e+1])instanceof Pr&&s.splice(e-1,3,new Pr(t.length+1+n.length))}const Uk=5;class Dx{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let n=Math.min(t,this.lineEnd),o=this.nodes[this.nodes.length-1];o instanceof _a?o.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new _a(n-this.pos,-1)),this.writtenTo=n,t>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,n){if(e<t||n.heightRelevant){let o=n.widget?n.widget.estimatedHeight:0,f=n.widget?n.widget.lineBreaks:0;o<0&&(o=this.oracle.lineHeight);let d=t-e;n.block?this.addBlock(new nT(d,o,n)):(d||f||o>=Uk)&&this.addLineDeco(o,f,d)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new _a(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let n=new Pr(t-e);return this.oracle.doc.lineAt(e).to==t&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof _a)return e;let t=new _a(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,n){let o=this.ensureLine();o.length+=n,o.collapsed+=n,o.widgetHeight=Math.max(o.widgetHeight,e),o.breaks+=t,this.writtenTo=this.pos=this.pos+n}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof _a)&&!this.isCovered?this.nodes.push(new _a(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let o of this.nodes)o instanceof _a&&o.updateHeight(this.oracle,n),n+=o?o.length:1;return this.nodes}static build(e,t,n,o){let f=new Dx(n,e);return qi.spans(t,n,o,f,0),f.finish(n)}}function qk(s,e,t){let n=new Hk;return qi.compare(s,e,t,n,0),n.changes}class Hk{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,n,o){(e<t||n&&n.heightRelevant||o&&o.heightRelevant)&&Rv(e,t,this.changes,5)}}function Zk(s,e){let t=s.getBoundingClientRect(),n=s.ownerDocument,o=n.defaultView||window,f=Math.max(0,t.left),d=Math.min(o.innerWidth,t.right),a=Math.max(0,t.top),v=Math.min(o.innerHeight,t.bottom);for(let A=s.parentNode;A&&A!=n.body;)if(A.nodeType==1){let P=A,L=window.getComputedStyle(P);if((P.scrollHeight>P.clientHeight||P.scrollWidth>P.clientWidth)&&L.overflow!="visible"){let j=P.getBoundingClientRect();f=Math.max(f,j.left),d=Math.min(d,j.right),a=Math.max(a,j.top),v=Math.min(A==s.parentNode?o.innerHeight:v,j.bottom)}A=L.position=="absolute"||L.position=="fixed"?P.offsetParent:P.parentNode}else if(A.nodeType==11)A=A.host;else break;return{left:f-t.left,right:Math.max(f,d)-t.left,top:a-(t.top+e),bottom:Math.max(a,v)-(t.top+e)}}function Gk(s,e){let t=s.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Nb{constructor(e,t,n,o){this.from=e,this.to=t,this.size=n,this.displaySize=o}static same(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let o=e[n],f=t[n];if(o.from!=f.from||o.to!=f.to||o.size!=f.size)return!1}return!0}draw(e,t){return ni.replace({widget:new $k(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class $k extends rh{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class cw{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=uw,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=jn.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Ex).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new Fk(t),this.stateDeco=e.facet(ay).filter(n=>typeof n!="function"),this.heightMap=go.empty().applyChanges(this.stateDeco,Qi.empty,this.heightOracle.setDoc(e.doc),[new al(0,0,0,e.doc.length)]);for(let n=0;n<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());n++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ni.set(this.lineGaps.map(n=>n.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let n=0;n<=1;n++){let o=n?t.head:t.anchor;if(!e.some(({from:f,to:d})=>o>=f&&o<=d)){let{from:f,to:d}=this.lineBlockAt(o);e.push(new T_(f,d))}}return this.viewports=e.sort((n,o)=>n.from-o.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?uw:new Rx(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Gg(e,this.scaler))})}update(e,t=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(ay).filter(P=>typeof P!="function");let o=e.changedRanges,f=al.extendWithRanges(o,qk(n,this.stateDeco,e?e.changes:Js.empty(this.state.doc.length))),d=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);aw(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),f),(this.heightMap.height!=d||Tm)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let v=f.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<v.from||t.range.head>v.to)||!this.viewportIsAppropriate(v))&&(v=this.getViewport(0,t));let A=v.from!=this.viewport.from||v.to!=this.viewport.to;this.viewport=v,e.flags|=this.updateForViewport(),(A||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(N2)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,n=window.getComputedStyle(t),o=this.heightOracle,f=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?jn.RTL:jn.LTR;let d=this.heightOracle.mustRefreshForWrapping(f),a=t.getBoundingClientRect(),v=d||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let A=0,P=0;if(a.width&&a.height){let{scaleX:ze,scaleY:ke}=h2(t,a);(ze>.005&&Math.abs(this.scaleX-ze)>.005||ke>.005&&Math.abs(this.scaleY-ke)>.005)&&(this.scaleX=ze,this.scaleY=ke,A|=8,d=v=!0)}let L=(parseInt(n.paddingTop)||0)*this.scaleY,j=(parseInt(n.paddingBottom)||0)*this.scaleY;(this.paddingTop!=L||this.paddingBottom!=j)&&(this.paddingTop=L,this.paddingBottom=j,A|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(o.lineWrapping&&(v=!0),this.editorWidth=e.scrollDOM.clientWidth,A|=8);let F=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=F&&(this.scrollAnchorHeight=-1,this.scrollTop=F),this.scrolledToBottom=p2(e.scrollDOM);let K=(this.printing?Gk:Zk)(t,this.paddingTop),se=K.top-this.pixelViewport.top,le=K.bottom-this.pixelViewport.bottom;this.pixelViewport=K;let ve=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(ve!=this.inView&&(this.inView=ve,ve&&(v=!0)),!this.inView&&!this.scrollTarget)return 0;let Be=a.width;if((this.contentDOMWidth!=Be||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,A|=8),v){let ze=e.docView.measureVisibleLineHeights(this.viewport);if(o.mustRefreshForHeights(ze)&&(d=!0),d||o.lineWrapping&&Math.abs(Be-this.contentDOMWidth)>o.charWidth){let{lineHeight:ke,charWidth:Se,textHeight:Fe}=e.docView.measureTextSize();d=ke>0&&o.refresh(f,ke,Se,Fe,Be/Se,ze),d&&(e.docView.minWidth=0,A|=8)}se>0&&le>0?P=Math.max(se,le):se<0&&le<0&&(P=Math.min(se,le)),aw();for(let ke of this.viewports){let Se=ke.from==this.viewport.from?ze:e.docView.measureVisibleLineHeights(ke);this.heightMap=(d?go.empty().applyChanges(this.stateDeco,Qi.empty,this.heightOracle,[new al(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(o,0,d,new jk(ke.from,Se))}Tm&&(A|=2)}let je=!this.viewportIsAppropriate(this.viewport,P)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return je&&(A&2&&(A|=this.updateScaler()),this.viewport=this.getViewport(P,this.scrollTarget),A|=this.updateForViewport()),(A&2||je)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(d?[]:this.lineGaps,e)),A|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),A}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),o=this.heightMap,f=this.heightOracle,{visibleTop:d,visibleBottom:a}=this,v=new T_(o.lineAt(d-n*1e3,Fn.ByHeight,f,0,0).from,o.lineAt(a+(1-n)*1e3,Fn.ByHeight,f,0,0).to);if(t){let{head:A}=t.range;if(A<v.from||A>v.to){let P=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),L=o.lineAt(A,Fn.ByPos,f,0,0),j;t.y=="center"?j=(L.top+L.bottom)/2-P/2:t.y=="start"||t.y=="nearest"&&A<v.from?j=L.top:j=L.bottom-P,v=new T_(o.lineAt(j-1e3/2,Fn.ByHeight,f,0,0).from,o.lineAt(j+P+1e3/2,Fn.ByHeight,f,0,0).to)}}return v}mapViewport(e,t){let n=t.mapPos(e.from,-1),o=t.mapPos(e.to,1);return new T_(this.heightMap.lineAt(n,Fn.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(o,Fn.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},n=0){if(!this.inView)return!0;let{top:o}=this.heightMap.lineAt(e,Fn.ByPos,this.heightOracle,0,0),{bottom:f}=this.heightMap.lineAt(t,Fn.ByPos,this.heightOracle,0,0),{visibleTop:d,visibleBottom:a}=this;return(e==0||o<=d-Math.max(10,Math.min(-n,250)))&&(t==this.state.doc.length||f>=a+Math.max(10,Math.min(n,250)))&&o>d-2*1e3&&f<a+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let n=[];for(let o of e)t.touchesRange(o.from,o.to)||n.push(new Nb(t.mapPos(o.from),t.mapPos(o.to),o.size,o.displaySize));return n}ensureLineGaps(e,t){let n=this.heightOracle.lineWrapping,o=n?1e4:2e3,f=o>>1,d=o<<1;if(this.defaultTextDirection!=jn.LTR&&!n)return[];let a=[],v=(P,L,j,F)=>{if(L-P<f)return;let K=this.state.selection.main,se=[K.from];K.empty||se.push(K.to);for(let ve of se)if(ve>P&&ve<L){v(P,ve-10,j,F),v(ve+10,L,j,F);return}let le=Qk(e,ve=>ve.from>=j.from&&ve.to<=j.to&&Math.abs(ve.from-P)<f&&Math.abs(ve.to-L)<f&&!se.some(Be=>ve.from<Be&&ve.to>Be));if(!le){if(L<j.to&&t&&n&&t.visibleRanges.some(je=>je.from<=L&&je.to>=L)){let je=t.moveToLineBoundary(yt.cursor(L),!1,!0).head;je>P&&(L=je)}let ve=this.gapSize(j,P,L,F),Be=n||ve<2e6?ve:2e6;le=new Nb(P,L,ve,Be)}a.push(le)},A=P=>{if(P.length<d||P.type!=mo.Text)return;let L=Xk(P.from,P.to,this.stateDeco);if(L.total<d)return;let j=this.scrollTarget?this.scrollTarget.range.head:null,F,K;if(n){let se=o/this.heightOracle.lineLength*this.heightOracle.lineHeight,le,ve;if(j!=null){let Be=C_(L,j),je=((this.visibleBottom-this.visibleTop)/2+se)/P.height;le=Be-je,ve=Be+je}else le=(this.visibleTop-P.top-se)/P.height,ve=(this.visibleBottom-P.top+se)/P.height;F=M_(L,le),K=M_(L,ve)}else{let se=L.total*this.heightOracle.charWidth,le=o*this.heightOracle.charWidth,ve=0;if(se>2e6)for(let Se of e)Se.from>=P.from&&Se.from<P.to&&Se.size!=Se.displaySize&&Se.from*this.heightOracle.charWidth+ve<this.pixelViewport.left&&(ve=Se.size-Se.displaySize);let Be=this.pixelViewport.left+ve,je=this.pixelViewport.right+ve,ze,ke;if(j!=null){let Se=C_(L,j),Fe=((je-Be)/2+le)/se;ze=Se-Fe,ke=Se+Fe}else ze=(Be-le)/se,ke=(je+le)/se;F=M_(L,ze),K=M_(L,ke)}F>P.from&&v(P.from,F,P,L),K<P.to&&v(K,P.to,P,L)};for(let P of this.viewportLines)Array.isArray(P.type)?P.type.forEach(A):A(P);return a}gapSize(e,t,n,o){let f=C_(o,n)-C_(o,t);return this.heightOracle.lineWrapping?e.height*f:o.total*this.heightOracle.charWidth*f}updateLineGaps(e){Nb.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ni.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];qi.spans(e,this.viewport.from,this.viewport.to,{span(o,f){t.push({from:o,to:f})},point(){}},20);let n=t.length!=this.visibleRanges.length||this.visibleRanges.some((o,f)=>o.from!=t[f].from||o.to!=t[f].to);return this.visibleRanges=t,n?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Gg(this.heightMap.lineAt(e,Fn.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Gg(this.heightMap.lineAt(this.scaler.fromDOM(e),Fn.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Gg(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class T_{constructor(e,t){this.from=e,this.to=t}}function Xk(s,e,t){let n=[],o=s,f=0;return qi.spans(t,s,e,{span(){},point(d,a){d>o&&(n.push({from:o,to:d}),f+=d-o),o=a}},20),o<e&&(n.push({from:o,to:e}),f+=e-o),{total:f,ranges:n}}function M_({total:s,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let n=Math.floor(s*t);for(let o=0;;o++){let{from:f,to:d}=e[o],a=d-f;if(n<=a)return f+n;n-=a}}function C_(s,e){let t=0;for(let{from:n,to:o}of s.ranges){if(e<=o){t+=e-n;break}t+=o-n}return t/s.total}function Qk(s,e){for(let t of s)if(e(t))return t}const uw={toDOM(s){return s},fromDOM(s){return s},scale:1,eq(s){return s==this}};class Rx{constructor(e,t,n){let o=0,f=0,d=0;this.viewports=n.map(({from:a,to:v})=>{let A=t.lineAt(a,Fn.ByPos,e,0,0).top,P=t.lineAt(v,Fn.ByPos,e,0,0).bottom;return o+=P-A,{from:a,to:v,top:A,bottom:P,domTop:0,domBottom:0}}),this.scale=(7e6-o)/(t.height-o);for(let a of this.viewports)a.domTop=d+(a.top-f)*this.scale,d=a.domBottom=a.domTop+(a.bottom-a.top),f=a.bottom}toDOM(e){for(let t=0,n=0,o=0;;t++){let f=t<this.viewports.length?this.viewports[t]:null;if(!f||e<f.top)return o+(e-n)*this.scale;if(e<=f.bottom)return f.domTop+(e-f.top);n=f.bottom,o=f.domBottom}}fromDOM(e){for(let t=0,n=0,o=0;;t++){let f=t<this.viewports.length?this.viewports[t]:null;if(!f||e<f.domTop)return n+(e-o)/this.scale;if(e<=f.domBottom)return f.top+(e-f.domTop);n=f.bottom,o=f.domBottom}}eq(e){return e instanceof Rx?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,n)=>t.from==e.viewports[n].from&&t.to==e.viewports[n].to):!1}}function Gg(s,e){if(e.scale==1)return s;let t=e.toDOM(s.top),n=e.toDOM(s.bottom);return new Uc(s.from,s.length,t,n-t,Array.isArray(s._content)?s._content.map(o=>Gg(o,e)):s._content)}const A_=Ut.define({combine:s=>s.join(" ")}),Uv=Ut.define({combine:s=>s.indexOf(!0)>-1}),qv=xf.newName(),sT=xf.newName(),rT=xf.newName(),oT={"&light":"."+sT,"&dark":"."+rT};function Hv(s,e,t){return new xf(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,o=>{if(o=="&")return s;if(!t||!t[o])throw new RangeError(`Unsupported selector: ${o}`);return t[o]}):s+" "+n}})}const Wk=Hv("."+qv,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},oT),Kk={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Fb=Zt.ie&&Zt.ie_version<=11;class Yk{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new zA,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let n of t)this.queue.push(n);(Zt.ie&&Zt.ie_version<=11||Zt.ios&&e.composing)&&t.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&e.constructor.EDIT_CONTEXT!==!1&&!(Zt.chrome&&Zt.chrome_version<126)&&(this.editContext=new eE(e),e.state.facet(hf)&&(e.contentDOM.editContext=this.editContext.editContext)),Fb&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,n)=>t!=e[n]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,o=this.selectionRange;if(n.state.facet(hf)?n.root.activeElement!=this.dom:!X_(this.dom,o))return;let f=o.anchorNode&&n.docView.nearest(o.anchorNode);if(f&&f.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(Zt.ie&&Zt.ie_version<=11||Zt.android&&Zt.chrome)&&!n.state.selection.main.empty&&o.focusNode&&Kg(o.focusNode,o.focusOffset,o.anchorNode,o.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=oy(e.root);if(!t)return!1;let n=Zt.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&Jk(this.view,t)||t;if(!n||this.selectionRange.eq(n))return!1;let o=X_(this.dom,n);return o&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&BA(this.dom,n)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(n),o&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let n=this.dom;n;)if(n.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=t)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Kk),Fb&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Fb&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var n;if(!this.delayedAndroidKey){let o=()=>{let f=this.delayedAndroidKey;f&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=f.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&f.force&&dm(this.dom,f.key,f.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(o)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,n=-1,o=!1;for(let f of e){let d=this.readMutation(f);d&&(d.typeOver&&(o=!0),t==-1?{from:t,to:n}=d:(t=Math.min(d.from,t),n=Math.max(d.to,n)))}return{from:t,to:n,typeOver:o}}readChange(){let{from:e,to:t,typeOver:n}=this.processRecords(),o=this.selectionChanged&&X_(this.dom,this.selectionRange);if(e<0&&!o)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let f=new yk(this.view,e,t,n);return this.view.docView.domChanged={newSel:f.newSel?f.newSel.main:null},f}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let n=this.view.state,o=X2(this.view,t);return this.view.state==n&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),o}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let n=hw(t,e.previousSibling||e.target.previousSibling,-1),o=hw(t,e.nextSibling||e.target.nextSibling,1);return{from:n?t.posAfter(n):t.posAtStart,to:o?t.posBefore(o):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(hf)!=e.state.facet(hf)&&(e.view.contentDOM.editContext=e.state.facet(hf)?this.editContext.editContext:null))}destroy(){var e,t,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect();for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function hw(s,e,t){for(;e;){let n=An.get(e);if(n&&n.parent==s)return n;let o=e.parentNode;e=o!=s.dom?o:t>0?e.nextSibling:e.previousSibling}return null}function fw(s,e){let t=e.startContainer,n=e.startOffset,o=e.endContainer,f=e.endOffset,d=s.docView.domAtPos(s.state.selection.main.anchor);return Kg(d.node,d.offset,o,f)&&([t,n,o,f]=[o,f,t,n]),{anchorNode:t,anchorOffset:n,focusNode:o,focusOffset:f}}function Jk(s,e){if(e.getComposedRanges){let o=e.getComposedRanges(s.root)[0];if(o)return fw(s,o)}let t=null;function n(o){o.preventDefault(),o.stopImmediatePropagation(),t=o.getTargetRanges()[0]}return s.contentDOM.addEventListener("beforeinput",n,!0),s.dom.ownerDocument.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",n,!0),t?fw(s,t):null}class eE{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=n=>{let{anchor:o}=e.state.selection.main,f={from:this.toEditorPos(n.updateRangeStart),to:this.toEditorPos(n.updateRangeEnd),insert:Qi.of(n.text.split(`
`))};f.from==this.from&&o<this.from?f.from=o:f.to==this.to&&o>this.to&&(f.to=o),!(f.from==f.to&&!f.insert.length)&&(this.pendingContextChange=f,e.state.readOnly||Ox(e,f,yt.single(this.toEditorPos(n.selectionStart),this.toEditorPos(n.selectionEnd))),this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)))},this.handlers.characterboundsupdate=n=>{let o=[],f=null;for(let d=this.toEditorPos(n.rangeStart),a=this.toEditorPos(n.rangeEnd);d<a;d++){let v=e.coordsForChar(d);f=v&&new DOMRect(v.left,v.top,v.right-v.left,v.bottom-v.top)||f||new DOMRect,o.push(f)}t.updateCharacterBounds(n.rangeStart,o)},this.handlers.textformatupdate=n=>{let o=[];for(let f of n.getTextFormats()){let d=f.underlineStyle,a=f.underlineThickness;if(d!="None"&&a!="None"){let v=`text-decoration: underline ${d=="Dashed"?"dashed ":d=="Squiggle"?"wavy ":""}${a=="Thin"?1:2}px`;o.push(ni.mark({attributes:{style:v}}).range(this.toEditorPos(f.rangeStart),this.toEditorPos(f.rangeEnd)))}}e.dispatch({effects:j2.of(ni.set(o))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{e.inputState.composing=-1,e.inputState.compositionFirstChange=null};for(let n in this.handlers)t.addEventListener(n,this.handlers[n]);this.measureReq={read:n=>{this.editContext.updateControlBounds(n.contentDOM.getBoundingClientRect());let o=oy(n.root);o&&o.rangeCount&&this.editContext.updateSelectionBounds(o.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,n=!1,o=this.pendingContextChange;return e.changes.iterChanges((f,d,a,v,A)=>{if(n)return;let P=A.length-(d-f);if(o&&d>=o.to)if(o.from==f&&o.to==d&&o.insert.eq(A)){o=this.pendingContextChange=null,t+=P,this.to+=P;return}else o=null,this.revertPending(e.state);if(f+=t,d+=t,d<=this.from)this.from+=P,this.to+=P;else if(f<this.to){if(f<this.from||d>this.to||this.to-this.from+A.length>3e4){n=!0;return}this.editContext.updateText(this.toContextPos(f),this.toContextPos(d),A.toString()),this.to+=P}t+=P}),o&&!n&&this.revertPending(e.state),!n}update(e){let t=this.pendingContextChange;!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.resetRange(e.state),this.editContext.updateText(0,this.editContext.text.length,e.state.doc.sliceString(this.from,this.to)),this.setSelection(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,n=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),o=this.toContextPos(t.head);(this.editContext.selectionStart!=n||this.editContext.selectionEnd!=o)&&this.editContext.updateSelection(n,o)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e){return e+this.from}toContextPos(e){return e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Bt{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:n}=e;this.dispatchTransactions=e.dispatchTransactions||n&&(o=>o.forEach(f=>n(f,this)))||(o=>this.update(o)),this.dispatch=this.dispatch.bind(this),this._root=e.root||LA(e.parent)||document,this.viewState=new cw(e.state||Bi.create(e)),e.scrollTo&&e.scrollTo.is(x_)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(qg).map(o=>new zb(o));for(let o of this.plugins)o.update(this);this.observer=new Yk(this),this.inputState=new wk(this),this.inputState.ensureHandlers(this.plugins),this.docView=new H1(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof er?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,n=!1,o,f=this.state;for(let j of e){if(j.startState!=f)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");f=j.state}if(this.destroyed){this.viewState.state=f;return}let d=this.hasFocus,a=0,v=null;e.some(j=>j.annotation(eT))?(this.inputState.notifiedFocused=d,a=1):d!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=d,v=tT(f,d),v||(a=1));let A=this.observer.delayedAndroidKey,P=null;if(A?(this.observer.clearDelayedAndroidKey(),P=this.observer.readChange(),(P&&!this.state.doc.eq(f.doc)||!this.state.selection.eq(f.selection))&&(P=null)):this.observer.clear(),f.facet(Bi.phrases)!=this.state.facet(Bi.phrases))return this.setState(f);o=f0.create(this,f,e),o.flags|=a;let L=this.viewState.scrollTarget;try{this.updateState=2;for(let j of e){if(L&&(L=L.map(j.changes)),j.scrollIntoView){let{main:F}=j.state.selection;L=new pm(F.empty?F:yt.cursor(F.head,F.head>F.anchor?-1:1))}for(let F of j.effects)F.is(x_)&&(L=F.value.clip(this.state))}this.viewState.update(o,L),this.bidiCache=p0.update(this.bidiCache,o.changes),o.empty||(this.updatePlugins(o),this.inputState.update(o)),t=this.docView.update(o),this.state.facet(Hg)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(j=>j.isUserEvent("select.pointer")))}finally{this.updateState=0}if(o.startState.facet(A_)!=o.state.facet(A_)&&(this.viewState.mustMeasureContent=!0),(t||n||L||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!o.empty)for(let j of this.state.facet(Nv))try{j(o)}catch(F){Fo(this.state,F,"update listener")}(v||P)&&Promise.resolve().then(()=>{v&&this.state==v.startState&&this.dispatch(v),P&&!X2(this,P)&&A.force&&dm(this.contentDOM,A.key,A.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new cw(e),this.plugins=e.facet(qg).map(n=>new zb(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new H1(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(qg),n=e.state.facet(qg);if(t!=n){let o=[];for(let f of n){let d=t.indexOf(f);if(d<0)o.push(new zb(f));else{let a=this.plugins[d];a.mustUpdate=e,o.push(a)}}for(let f of this.plugins)f.mustUpdate!=e&&f.destroy(this);this.plugins=o,this.pluginMap.clear()}else for(let o of this.plugins)o.mustUpdate=e;for(let o=0;o<this.plugins.length;o++)this.plugins[o].update(this);t!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(n){Fo(this.state,n,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,n=this.scrollDOM,o=n.scrollTop*this.scaleY,{scrollAnchorPos:f,scrollAnchorHeight:d}=this.viewState;Math.abs(o-this.viewState.scrollTop)>1&&(d=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(d<0)if(p2(n))f=-1,d=this.viewState.heightMap.height;else{let F=this.viewState.scrollAnchorAt(o);f=F.from,d=F.top}this.updateState=1;let v=this.viewState.measure(this);if(!v&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let A=[];v&4||([this.measureRequests,A]=[A,this.measureRequests]);let P=A.map(F=>{try{return F.read(this)}catch(K){return Fo(this.state,K),dw}}),L=f0.create(this,this.state,[]),j=!1;L.flags|=v,t?t.flags|=v:t=L,this.updateState=2,L.empty||(this.updatePlugins(L),this.inputState.update(L),this.updateAttrs(),j=this.docView.update(L),j&&this.docViewUpdate());for(let F=0;F<A.length;F++)if(P[F]!=dw)try{let K=A[F];K.write&&K.write(P[F],this)}catch(K){Fo(this.state,K)}if(j&&this.docView.updateSelection(!0),!L.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,d=-1;continue}else{let K=(f<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(f).top)-d;if(K>1||K<-1){o=o+K,n.scrollTop=o/this.scaleY,d=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let a of this.state.facet(Nv))a(t)}get themeClasses(){return qv+" "+(this.state.facet(Uv)?rT:sT)+" "+this.state.facet(A_)}updateAttrs(){let e=pw(this,V2,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(hf)?"true":"false",class:"cm-content",style:`${Zt.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),pw(this,Ex,t);let n=this.observer.ignore(()=>{let o=Dv(this.contentDOM,this.contentAttrs,t),f=Dv(this.dom,this.editorAttrs,e);return o||f});return this.editorAttrs=e,this.contentAttrs=t,n}showAnnouncements(e){let t=!0;for(let n of e)for(let o of n.effects)if(o.is(Bt.announce)){t&&(this.announceDOM.textContent=""),t=!1;let f=this.announceDOM.appendChild(document.createElement("div"));f.textContent=o.value}}mountStyles(){this.styleModules=this.state.facet(Hg);let e=this.state.facet(Bt.cspNonce);xf.mount(this.root,this.styleModules.concat(Wk).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(n=>n.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,n){return Bb(this,e,Q1(this,e,t,n))}moveByGroup(e,t){return Bb(this,e,Q1(this,e,t,n=>dk(this,e.head,n)))}visualLineSide(e,t){let n=this.bidiSpans(e),o=this.textDirectionAt(e.from),f=n[t?n.length-1:0];return yt.cursor(f.side(t,o)+e.from,f.forward(!t,o)?1:-1)}moveToLineBoundary(e,t,n=!0){return fk(this,e,t,n)}moveVertically(e,t,n){return Bb(this,e,pk(this,e,t,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),$2(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let n=this.docView.coordsAt(e,t);if(!n||n.left==n.right)return n;let o=this.state.doc.lineAt(e),f=this.bidiSpans(o),d=f[mf.find(f,e-o.from,-1,t)];return wy(n,d.dir==jn.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(B2)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>tE)return E2(e.length);let t=this.textDirectionAt(e.from),n;for(let f of this.bidiCache)if(f.from==e.from&&f.dir==t&&(f.fresh||k2(f.isolates,n=q1(this,e))))return f.order;n||(n=q1(this,e));let o=WA(e.text,t,n);return this.bidiCache.push(new p0(e.from,e.to,t,n,!0,o)),o}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Zt.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{f2(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return x_.of(new pm(typeof e=="number"?yt.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,n=this.viewState.scrollAnchorAt(e);return x_.of(new pm(yt.cursor(n.from),"start","start",n.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ks.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return ks.define(()=>({}),{eventObservers:e})}static theme(e,t){let n=xf.newName(),o=[A_.of(n),Hg.of(Hv(`.${n}`,e))];return t&&t.dark&&o.push(Uv.of(!0)),o}static baseTheme(e){return Xd.lowest(Hg.of(Hv("."+qv,e,oT)))}static findFromDOM(e){var t;let n=e.querySelector(".cm-content"),o=n&&An.get(n)||An.get(e);return((t=o==null?void 0:o.rootView)===null||t===void 0?void 0:t.view)||null}}Bt.styleModule=Hg;Bt.inputHandler=z2;Bt.clipboardInputFilter=Ax;Bt.clipboardOutputFilter=kx;Bt.scrollHandler=F2;Bt.focusChangeEffect=L2;Bt.perLineTextDirection=B2;Bt.exceptionSink=I2;Bt.updateListener=Nv;Bt.editable=hf;Bt.mouseSelectionStyle=R2;Bt.dragMovesSelection=D2;Bt.clickAddsSelectionRange=O2;Bt.decorations=ay;Bt.outerDecorations=U2;Bt.atomicRanges=Px;Bt.bidiIsolatedRanges=q2;Bt.scrollMargins=H2;Bt.darkTheme=Uv;Bt.cspNonce=Ut.define({combine:s=>s.length?s[0]:""});Bt.contentAttributes=Ex;Bt.editorAttributes=V2;Bt.lineWrapping=Bt.contentAttributes.of({class:"cm-lineWrapping"});Bt.announce=xi.define();const tE=4096,dw={};class p0{constructor(e,t,n,o,f,d){this.from=e,this.to=t,this.dir=n,this.isolates=o,this.fresh=f,this.order=d}static update(e,t){if(t.empty&&!e.some(f=>f.fresh))return e;let n=[],o=e.length?e[e.length-1].dir:jn.LTR;for(let f=Math.max(0,e.length-10);f<e.length;f++){let d=e[f];d.dir==o&&!t.touchesRange(d.from,d.to)&&n.push(new p0(t.mapPos(d.from,1),t.mapPos(d.to,-1),d.dir,d.isolates,!1,d.order))}return n}}function pw(s,e,t){for(let n=s.state.facet(e),o=n.length-1;o>=0;o--){let f=n[o],d=typeof f=="function"?f(s):f;d&&Ov(d,t)}return t}const iE=Zt.mac?"mac":Zt.windows?"win":Zt.linux?"linux":"key";function nE(s,e){const t=s.split(/-(?!$)/);let n=t[t.length-1];n=="Space"&&(n=" ");let o,f,d,a;for(let v=0;v<t.length-1;++v){const A=t[v];if(/^(cmd|meta|m)$/i.test(A))a=!0;else if(/^a(lt)?$/i.test(A))o=!0;else if(/^(c|ctrl|control)$/i.test(A))f=!0;else if(/^s(hift)?$/i.test(A))d=!0;else if(/^mod$/i.test(A))e=="mac"?a=!0:f=!0;else throw new Error("Unrecognized modifier name: "+A)}return o&&(n="Alt-"+n),f&&(n="Ctrl-"+n),a&&(n="Meta-"+n),d&&(n="Shift-"+n),n}function k_(s,e,t){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),t!==!1&&e.shiftKey&&(s="Shift-"+s),s}const sE=Xd.default(Bt.domEventHandlers({keydown(s,e){return lT(aT(e.state),s,e,"editor")}})),H0=Ut.define({enables:sE}),mw=new WeakMap;function aT(s){let e=s.facet(H0),t=mw.get(e);return t||mw.set(e,t=aE(e.reduce((n,o)=>n.concat(o),[]))),t}function rE(s,e,t){return lT(aT(s.state),e,s,t)}let ff=null;const oE=4e3;function aE(s,e=iE){let t=Object.create(null),n=Object.create(null),o=(d,a)=>{let v=n[d];if(v==null)n[d]=a;else if(v!=a)throw new Error("Key binding "+d+" is used both as a regular binding and as a multi-stroke prefix")},f=(d,a,v,A,P)=>{var L,j;let F=t[d]||(t[d]=Object.create(null)),K=a.split(/ (?!$)/).map(ve=>nE(ve,e));for(let ve=1;ve<K.length;ve++){let Be=K.slice(0,ve).join(" ");o(Be,!0),F[Be]||(F[Be]={preventDefault:!0,stopPropagation:!1,run:[je=>{let ze=ff={view:je,prefix:Be,scope:d};return setTimeout(()=>{ff==ze&&(ff=null)},oE),!0}]})}let se=K.join(" ");o(se,!1);let le=F[se]||(F[se]={preventDefault:!1,stopPropagation:!1,run:((j=(L=F._any)===null||L===void 0?void 0:L.run)===null||j===void 0?void 0:j.slice())||[]});v&&le.run.push(v),A&&(le.preventDefault=!0),P&&(le.stopPropagation=!0)};for(let d of s){let a=d.scope?d.scope.split(" "):["editor"];if(d.any)for(let A of a){let P=t[A]||(t[A]=Object.create(null));P._any||(P._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:L}=d;for(let j in P)P[j].run.push(F=>L(F,Zv))}let v=d[e]||d.key;if(v)for(let A of a)f(A,v,d.run,d.preventDefault,d.stopPropagation),d.shift&&f(A,"Shift-"+v,d.shift,d.preventDefault,d.stopPropagation)}return t}let Zv=null;function lT(s,e,t,n){Zv=e;let o=OA(e),f=Or(o,0),d=rl(f)==o.length&&o!=" ",a="",v=!1,A=!1,P=!1;ff&&ff.view==t&&ff.scope==n&&(a=ff.prefix+" ",W2.indexOf(e.keyCode)<0&&(A=!0,ff=null));let L=new Set,j=le=>{if(le){for(let ve of le.run)if(!L.has(ve)&&(L.add(ve),ve(t)))return le.stopPropagation&&(P=!0),!0;le.preventDefault&&(le.stopPropagation&&(P=!0),A=!0)}return!1},F=s[n],K,se;return F&&(j(F[a+k_(o,e,!d)])?v=!0:d&&(e.altKey||e.metaKey||e.ctrlKey)&&!(Zt.windows&&e.ctrlKey&&e.altKey)&&(K=wf[e.keyCode])&&K!=o?(j(F[a+k_(K,e,!0)])||e.shiftKey&&(se=ry[e.keyCode])!=o&&se!=K&&j(F[a+k_(se,e,!1)]))&&(v=!0):d&&e.shiftKey&&j(F[a+k_(o,e,!0)])&&(v=!0),!v&&j(F._any)&&(v=!0)),A&&(v=!0),v&&P&&e.stopPropagation(),Zv=null,v}class My{constructor(e,t,n,o,f){this.className=e,this.left=t,this.top=n,this.width=o,this.height=f}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,n){if(n.empty){let o=e.coordsAtPos(n.head,n.assoc||1);if(!o)return[];let f=cT(e);return[new My(t,o.left-f.left,o.top-f.top,null,o.bottom-o.top)]}else return lE(e,t,n)}}function cT(s){let e=s.scrollDOM.getBoundingClientRect();return{left:(s.textDirection==jn.LTR?e.left:e.right-s.scrollDOM.clientWidth*s.scaleX)-s.scrollDOM.scrollLeft*s.scaleX,top:e.top-s.scrollDOM.scrollTop*s.scaleY}}function gw(s,e,t,n){let o=s.coordsAtPos(e,t*2);if(!o)return n;let f=s.dom.getBoundingClientRect(),d=(o.top+o.bottom)/2,a=s.posAtCoords({x:f.left+1,y:d}),v=s.posAtCoords({x:f.right-1,y:d});return a==null||v==null?n:{from:Math.max(n.from,Math.min(a,v)),to:Math.min(n.to,Math.max(a,v))}}function lE(s,e,t){if(t.to<=s.viewport.from||t.from>=s.viewport.to)return[];let n=Math.max(t.from,s.viewport.from),o=Math.min(t.to,s.viewport.to),f=s.textDirection==jn.LTR,d=s.contentDOM,a=d.getBoundingClientRect(),v=cT(s),A=d.querySelector(".cm-line"),P=A&&window.getComputedStyle(A),L=a.left+(P?parseInt(P.paddingLeft)+Math.min(0,parseInt(P.textIndent)):0),j=a.right-(P?parseInt(P.paddingRight):0),F=jv(s,n),K=jv(s,o),se=F.type==mo.Text?F:null,le=K.type==mo.Text?K:null;if(se&&(s.lineWrapping||F.widgetLineBreaks)&&(se=gw(s,n,1,se)),le&&(s.lineWrapping||K.widgetLineBreaks)&&(le=gw(s,o,-1,le)),se&&le&&se.from==le.from&&se.to==le.to)return Be(je(t.from,t.to,se));{let ke=se?je(t.from,null,se):ze(F,!1),Se=le?je(null,t.to,le):ze(K,!0),Fe=[];return(se||F).to<(le||K).from-(se&&le?1:0)||F.widgetLineBreaks>1&&ke.bottom+s.defaultLineHeight/2<Se.top?Fe.push(ve(L,ke.bottom,j,Se.top)):ke.bottom<Se.top&&s.elementAtHeight((ke.bottom+Se.top)/2).type==mo.Text&&(ke.bottom=Se.top=(ke.bottom+Se.top)/2),Be(ke).concat(Fe).concat(Be(Se))}function ve(ke,Se,Fe,He){return new My(e,ke-v.left,Se-v.top-.01,Fe-ke,He-Se+.01)}function Be({top:ke,bottom:Se,horizontal:Fe}){let He=[];for(let gt=0;gt<Fe.length;gt+=2)He.push(ve(Fe[gt],ke,Fe[gt+1],Se));return He}function je(ke,Se,Fe){let He=1e9,gt=-1e9,Et=[];function Mt(Ft,ei,Xe,dt,_t){let qt=s.coordsAtPos(Ft,Ft==Fe.to?-2:2),xe=s.coordsAtPos(Xe,Xe==Fe.from?2:-2);!qt||!xe||(He=Math.min(qt.top,xe.top,He),gt=Math.max(qt.bottom,xe.bottom,gt),_t==jn.LTR?Et.push(f&&ei?L:qt.left,f&&dt?j:xe.right):Et.push(!f&&dt?L:xe.left,!f&&ei?j:qt.right))}let ht=ke??Fe.from,Gt=Se??Fe.to;for(let Ft of s.visibleRanges)if(Ft.to>ht&&Ft.from<Gt)for(let ei=Math.max(Ft.from,ht),Xe=Math.min(Ft.to,Gt);;){let dt=s.state.doc.lineAt(ei);for(let _t of s.bidiSpans(dt)){let qt=_t.from+dt.from,xe=_t.to+dt.from;if(qt>=Xe)break;xe>ei&&Mt(Math.max(qt,ei),ke==null&&qt<=ht,Math.min(xe,Xe),Se==null&&xe>=Gt,_t.dir)}if(ei=dt.to+1,ei>=Xe)break}return Et.length==0&&Mt(ht,ke==null,Gt,Se==null,s.textDirection),{top:He,bottom:gt,horizontal:Et}}function ze(ke,Se){let Fe=a.top+(Se?ke.top:ke.bottom);return{top:Fe,bottom:Fe,horizontal:[]}}}function cE(s,e){return s.constructor==e.constructor&&s.eq(e)}class uE{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(K_)!=e.state.facet(K_)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,n=e.facet(K_);for(;t<n.length&&n[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,n)=>!cE(t,this.drawn[n]))){let t=this.dom.firstChild,n=0;for(let o of e)o.update&&t&&o.constructor&&this.drawn[n].constructor&&o.update(t,this.drawn[n])?(t=t.nextSibling,n++):this.dom.insertBefore(o.draw(),t);for(;t;){let o=t.nextSibling;t.remove(),t=o}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const K_=Ut.define();function uT(s){return[ks.define(e=>new uE(e,s)),K_.of(s)]}const hT=!Zt.ios,ly=Ut.define({combine(s){return Wc(s,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function hE(s={}){return[ly.of(s),fE,dE,pE,N2.of(!0)]}function fT(s){return s.startState.facet(ly)!=s.state.facet(ly)}const fE=uT({above:!0,markers(s){let{state:e}=s,t=e.facet(ly),n=[];for(let o of e.selection.ranges){let f=o==e.selection.main;if(o.empty?!f||hT:t.drawRangeCursor){let d=f?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",a=o.empty?o:yt.cursor(o.head,o.head>o.anchor?-1:1);for(let v of My.forRange(s,d,a))n.push(v)}}return n},update(s,e){s.transactions.some(n=>n.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=fT(s);return t&&yw(s.state,e),s.docChanged||s.selectionSet||t},mount(s,e){yw(e.state,s)},class:"cm-cursorLayer"});function yw(s,e){e.style.animationDuration=s.facet(ly).cursorBlinkRate+"ms"}const dE=uT({above:!1,markers(s){return s.state.selection.ranges.map(e=>e.empty?[]:My.forRange(s,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(s,e){return s.docChanged||s.selectionSet||s.viewportChanged||fT(s)},class:"cm-selectionLayer"}),Gv={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};hT&&(Gv[".cm-line"].caretColor=Gv[".cm-content"].caretColor="transparent !important");const pE=Xd.highest(Bt.theme(Gv)),dT=xi.define({map(s,e){return s==null?null:e.mapPos(s)}}),$g=zr.define({create(){return null},update(s,e){return s!=null&&(s=e.changes.mapPos(s)),e.effects.reduce((t,n)=>n.is(dT)?n.value:t,s)}}),mE=ks.fromClass(class{constructor(s){this.view=s,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(s){var e;let t=s.state.field($g);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(s.startState.field($g)!=t||s.docChanged||s.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:s}=this,e=s.state.field($g),t=e!=null&&s.coordsAtPos(e);if(!t)return null;let n=s.scrollDOM.getBoundingClientRect();return{left:t.left-n.left+s.scrollDOM.scrollLeft*s.scaleX,top:t.top-n.top+s.scrollDOM.scrollTop*s.scaleY,height:t.bottom-t.top}}drawCursor(s){if(this.cursor){let{scaleX:e,scaleY:t}=this.view;s?(this.cursor.style.left=s.left/e+"px",this.cursor.style.top=s.top/t+"px",this.cursor.style.height=s.height/t+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(s){this.view.state.field($g)!=s&&this.view.dispatch({effects:dT.of(s)})}},{eventObservers:{dragover(s){this.setDropPos(this.view.posAtCoords({x:s.clientX,y:s.clientY}))},dragleave(s){(s.target==this.view.contentDOM||!this.view.contentDOM.contains(s.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function gE(){return[$g,mE]}function _w(s,e,t,n,o){e.lastIndex=0;for(let f=s.iterRange(t,n),d=t,a;!f.next().done;d+=f.value.length)if(!f.lineBreak)for(;a=e.exec(f.value);)o(d+a.index,a)}function yE(s,e){let t=s.visibleRanges;if(t.length==1&&t[0].from==s.viewport.from&&t[0].to==s.viewport.to)return t;let n=[];for(let{from:o,to:f}of t)o=Math.max(s.state.doc.lineAt(o).from,o-e),f=Math.min(s.state.doc.lineAt(f).to,f+e),n.length&&n[n.length-1].to>=o?n[n.length-1].to=f:n.push({from:o,to:f});return n}class _E{constructor(e){const{regexp:t,decoration:n,decorate:o,boundary:f,maxLength:d=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,o)this.addMatch=(a,v,A,P)=>o(P,A,A+a[0].length,a,v);else if(typeof n=="function")this.addMatch=(a,v,A,P)=>{let L=n(a,v,A);L&&P(A,A+a[0].length,L)};else if(n)this.addMatch=(a,v,A,P)=>P(A,A+a[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=f,this.maxLength=d}createDeco(e){let t=new vf,n=t.add.bind(t);for(let{from:o,to:f}of yE(e,this.maxLength))_w(e.state.doc,this.regexp,o,f,(d,a)=>this.addMatch(a,e,d,n));return t.finish()}updateDeco(e,t){let n=1e9,o=-1;return e.docChanged&&e.changes.iterChanges((f,d,a,v)=>{v>e.view.viewport.from&&a<e.view.viewport.to&&(n=Math.min(a,n),o=Math.max(v,o))}),e.viewportChanged||o-n>1e3?this.createDeco(e.view):o>-1?this.updateRange(e.view,t.map(e.changes),n,o):t}updateRange(e,t,n,o){for(let f of e.visibleRanges){let d=Math.max(f.from,n),a=Math.min(f.to,o);if(a>d){let v=e.state.doc.lineAt(d),A=v.to<a?e.state.doc.lineAt(a):v,P=Math.max(f.from,v.from),L=Math.min(f.to,A.to);if(this.boundary){for(;d>v.from;d--)if(this.boundary.test(v.text[d-1-v.from])){P=d;break}for(;a<A.to;a++)if(this.boundary.test(A.text[a-A.from])){L=a;break}}let j=[],F,K=(se,le,ve)=>j.push(ve.range(se,le));if(v==A)for(this.regexp.lastIndex=P-v.from;(F=this.regexp.exec(v.text))&&F.index<L-v.from;)this.addMatch(F,e,F.index+v.from,K);else _w(e.state.doc,this.regexp,P,L,(se,le)=>this.addMatch(le,e,se,K));t=t.update({filterFrom:P,filterTo:L,filter:(se,le)=>se<P||le>L,add:j})}}return t}}const $v=/x/.unicode!=null?"gu":"g",bE=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,$v),vE={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let jb=null;function xE(){var s;if(jb==null&&typeof document<"u"&&document.body){let e=document.body.style;jb=((s=e.tabSize)!==null&&s!==void 0?s:e.MozTabSize)!=null}return jb||!1}const Y_=Ut.define({combine(s){let e=Wc(s,{render:null,specialChars:bE,addSpecialChars:null});return(e.replaceTabs=!xE())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,$v)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,$v)),e}});function wE(s={}){return[Y_.of(s),SE()]}let bw=null;function SE(){return bw||(bw=ks.fromClass(class{constructor(s){this.view=s,this.decorations=ni.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(s.state.facet(Y_)),this.decorations=this.decorator.createDeco(s)}makeDecorator(s){return new _E({regexp:s.specialChars,decoration:(e,t,n)=>{let{doc:o}=t.state,f=Or(e[0],0);if(f==9){let d=o.lineAt(n),a=t.state.tabSize,v=Dm(d.text,a,n-d.from);return ni.replace({widget:new AE((a-v%a)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[f]||(this.decorationCache[f]=ni.replace({widget:new CE(s,f)}))},boundary:s.replaceTabs?void 0:/[^]/})}update(s){let e=s.state.facet(Y_);s.startState.facet(Y_)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(s.view)):this.decorations=this.decorator.updateDeco(s,this.decorations)}},{decorations:s=>s.decorations}))}const TE="•";function ME(s){return s>=32?TE:s==10?"␤":String.fromCharCode(9216+s)}class CE extends rh{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=ME(this.code),n=e.state.phrase("Control character")+" "+(vE[this.code]||"0x"+this.code.toString(16)),o=this.options.render&&this.options.render(this.code,n,t);if(o)return o;let f=document.createElement("span");return f.textContent=t,f.title=n,f.setAttribute("aria-label",n),f.className="cm-specialChar",f}ignoreEvent(){return!1}}class AE extends rh{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function kE(){return PE}const EE=ni.line({class:"cm-activeLine"}),PE=ks.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.docChanged||s.selectionSet)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=-1,t=[];for(let n of s.state.selection.ranges){let o=s.lineBlockAt(n.head);o.from>e&&(t.push(EE.range(o.from)),e=o.from)}return ni.set(t)}},{decorations:s=>s.decorations});class OE extends rh{constructor(e){super(),this.content=e}toDOM(e){let t=document.createElement("span");return t.className="cm-placeholder",t.style.pointerEvents="none",t.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(e):this.content.cloneNode(!0)),typeof this.content=="string"?t.setAttribute("aria-label","placeholder "+this.content):t.setAttribute("aria-hidden","true"),t}coordsAt(e){let t=e.firstChild?xm(e.firstChild):[];if(!t.length)return null;let n=window.getComputedStyle(e.parentNode),o=wy(t[0],n.direction!="rtl"),f=parseInt(n.lineHeight);return o.bottom-o.top>f*1.5?{left:o.left,right:o.right,top:o.top,bottom:o.top+f}:o}ignoreEvent(){return!1}}function DE(s){return ks.fromClass(class{constructor(e){this.view=e,this.placeholder=s?ni.set([ni.widget({widget:new OE(s),side:1}).range(0)]):ni.none}get decorations(){return this.view.state.doc.length?ni.none:this.placeholder}},{decorations:e=>e.decorations})}const Xv=2e3;function RE(s,e,t){let n=Math.min(e.line,t.line),o=Math.max(e.line,t.line),f=[];if(e.off>Xv||t.off>Xv||e.col<0||t.col<0){let d=Math.min(e.off,t.off),a=Math.max(e.off,t.off);for(let v=n;v<=o;v++){let A=s.doc.line(v);A.length<=a&&f.push(yt.range(A.from+d,A.to+a))}}else{let d=Math.min(e.col,t.col),a=Math.max(e.col,t.col);for(let v=n;v<=o;v++){let A=s.doc.line(v),P=Tv(A.text,d,s.tabSize,!0);if(P<0)f.push(yt.cursor(A.to));else{let L=Tv(A.text,a,s.tabSize);f.push(yt.range(A.from+P,A.from+L))}}}return f}function IE(s,e){let t=s.coordsAtPos(s.viewport.from);return t?Math.round(Math.abs((t.left-e)/s.defaultCharacterWidth)):-1}function vw(s,e){let t=s.posAtCoords({x:e.clientX,y:e.clientY},!1),n=s.state.doc.lineAt(t),o=t-n.from,f=o>Xv?-1:o==n.length?IE(s,e.clientX):Dm(n.text,s.state.tabSize,t-n.from);return{line:n.number,col:f,off:o}}function zE(s,e){let t=vw(s,e),n=s.state.selection;return t?{update(o){if(o.docChanged){let f=o.changes.mapPos(o.startState.doc.line(t.line).from),d=o.state.doc.lineAt(f);t={line:d.number,col:t.col,off:Math.min(t.off,d.length)},n=n.map(o.changes)}},get(o,f,d){let a=vw(s,o);if(!a)return n;let v=RE(s.state,t,a);return v.length?d?yt.create(v.concat(n.ranges)):yt.create(v):n}}:null}function LE(s){let e=t=>t.altKey&&t.button==0;return Bt.mouseSelectionStyle.of((t,n)=>e(n)?zE(t,n):null)}const BE={Alt:[18,s=>!!s.altKey],Control:[17,s=>!!s.ctrlKey],Shift:[16,s=>!!s.shiftKey],Meta:[91,s=>!!s.metaKey]},NE={style:"cursor: crosshair"};function FE(s={}){let[e,t]=BE[s.key||"Alt"],n=ks.fromClass(class{constructor(o){this.view=o,this.isDown=!1}set(o){this.isDown!=o&&(this.isDown=o,this.view.update([]))}},{eventObservers:{keydown(o){this.set(o.keyCode==e||t(o))},keyup(o){(o.keyCode==e||!t(o))&&this.set(!1)},mousemove(o){this.set(t(o))}}});return[n,Bt.contentAttributes.of(o=>{var f;return!((f=o.plugin(n))===null||f===void 0)&&f.isDown?NE:null})]}const Ng="-10000px";class pT{constructor(e,t,n,o){this.facet=t,this.createTooltipView=n,this.removeTooltipView=o,this.input=e.state.facet(t),this.tooltips=this.input.filter(d=>d);let f=null;this.tooltipViews=this.tooltips.map(d=>f=n(d,f))}update(e,t){var n;let o=e.state.facet(this.facet),f=o.filter(v=>v);if(o===this.input){for(let v of this.tooltipViews)v.update&&v.update(e);return!1}let d=[],a=t?[]:null;for(let v=0;v<f.length;v++){let A=f[v],P=-1;if(A){for(let L=0;L<this.tooltips.length;L++){let j=this.tooltips[L];j&&j.create==A.create&&(P=L)}if(P<0)d[v]=this.createTooltipView(A,v?d[v-1]:null),a&&(a[v]=!!A.above);else{let L=d[v]=this.tooltipViews[P];a&&(a[v]=t[P]),L.update&&L.update(e)}}}for(let v of this.tooltipViews)d.indexOf(v)<0&&(this.removeTooltipView(v),(n=v.destroy)===null||n===void 0||n.call(v));return t&&(a.forEach((v,A)=>t[A]=v),t.length=a.length),this.input=o,this.tooltips=f,this.tooltipViews=d,!0}}function jE(s){let{win:e}=s;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const Vb=Ut.define({combine:s=>{var e,t,n;return{position:Zt.ios?"absolute":((e=s.find(o=>o.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=s.find(o=>o.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((n=s.find(o=>o.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||jE}}}),xw=new WeakMap,Ix=ks.fromClass(class{constructor(s){this.view=s,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=s.state.facet(Vb);this.position=e.position,this.parent=e.parent,this.classes=s.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new pT(s,zx,(t,n)=>this.createTooltip(t,n),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),s.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let s of this.manager.tooltipViews)this.intersectionObserver.observe(s.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(s){s.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(s,this.above);e&&this.observeIntersection();let t=e||s.geometryChanged,n=s.state.facet(Vb);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let o of this.manager.tooltipViews)o.dom.style.position=this.position;t=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let o of this.manager.tooltipViews)this.container.appendChild(o.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(s,e){let t=s.create(this.view),n=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),s.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let o=document.createElement("div");o.className="cm-tooltip-arrow",t.dom.appendChild(o)}return t.dom.style.position=this.position,t.dom.style.top=Ng,t.dom.style.left="0px",this.container.insertBefore(t.dom,n),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var s,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let n of this.manager.tooltipViews)n.dom.remove(),(s=n.destroy)===null||s===void 0||s.call(n);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let s=this.view.dom.getBoundingClientRect(),e=1,t=1,n=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:o}=this.manager.tooltipViews[0];if(Zt.gecko)n=o.offsetParent!=this.container.ownerDocument.body;else if(o.style.top==Ng&&o.style.left=="0px"){let f=o.getBoundingClientRect();n=Math.abs(f.top+1e4)>1||Math.abs(f.left)>1}}if(n||this.position=="absolute")if(this.parent){let o=this.parent.getBoundingClientRect();o.width&&o.height&&(e=o.width/this.parent.offsetWidth,t=o.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);return{editor:s,parent:this.parent?this.container.getBoundingClientRect():s,pos:this.manager.tooltips.map((o,f)=>{let d=this.manager.tooltipViews[f];return d.getCoords?d.getCoords(o.pos):this.view.coordsAtPos(o.pos)}),size:this.manager.tooltipViews.map(({dom:o})=>o.getBoundingClientRect()),space:this.view.state.facet(Vb).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:n}}writeMeasure(s){var e;if(s.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{editor:t,space:n,scaleX:o,scaleY:f}=s,d=[];for(let a=0;a<this.manager.tooltips.length;a++){let v=this.manager.tooltips[a],A=this.manager.tooltipViews[a],{dom:P}=A,L=s.pos[a],j=s.size[a];if(!L||L.bottom<=Math.max(t.top,n.top)||L.top>=Math.min(t.bottom,n.bottom)||L.right<Math.max(t.left,n.left)-.1||L.left>Math.min(t.right,n.right)+.1){P.style.top=Ng;continue}let F=v.arrow?A.dom.querySelector(".cm-tooltip-arrow"):null,K=F?7:0,se=j.right-j.left,le=(e=xw.get(A))!==null&&e!==void 0?e:j.bottom-j.top,ve=A.offset||UE,Be=this.view.textDirection==jn.LTR,je=j.width>n.right-n.left?Be?n.left:n.right-j.width:Be?Math.max(n.left,Math.min(L.left-(F?14:0)+ve.x,n.right-se)):Math.min(Math.max(n.left,L.left-se+(F?14:0)-ve.x),n.right-se),ze=this.above[a];!v.strictSide&&(ze?L.top-(j.bottom-j.top)-ve.y<n.top:L.bottom+(j.bottom-j.top)+ve.y>n.bottom)&&ze==n.bottom-L.bottom>L.top-n.top&&(ze=this.above[a]=!ze);let ke=(ze?L.top-n.top:n.bottom-L.bottom)-K;if(ke<le&&A.resize!==!1){if(ke<this.view.defaultLineHeight){P.style.top=Ng;continue}xw.set(A,le),P.style.height=(le=ke)/f+"px"}else P.style.height&&(P.style.height="");let Se=ze?L.top-le-K-ve.y:L.bottom+K+ve.y,Fe=je+se;if(A.overlap!==!0)for(let He of d)He.left<Fe&&He.right>je&&He.top<Se+le&&He.bottom>Se&&(Se=ze?He.top-le-2-K:He.bottom+K+2);if(this.position=="absolute"?(P.style.top=(Se-s.parent.top)/f+"px",P.style.left=(je-s.parent.left)/o+"px"):(P.style.top=Se/f+"px",P.style.left=je/o+"px"),F){let He=L.left+(Be?ve.x:-ve.x)-(je+14-7);F.style.left=He/o+"px"}A.overlap!==!0&&d.push({left:je,top:Se,right:Fe,bottom:Se+le}),P.classList.toggle("cm-tooltip-above",ze),P.classList.toggle("cm-tooltip-below",!ze),A.positioned&&A.positioned(s.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let s of this.manager.tooltipViews)s.dom.style.top=Ng}},{eventObservers:{scroll(){this.maybeMeasure()}}}),VE=Bt.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),UE={x:0,y:0},zx=Ut.define({enables:[Ix,VE]}),m0=Ut.define({combine:s=>s.reduce((e,t)=>e.concat(t),[])});class Z0{static create(e){return new Z0(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new pT(e,m0,(t,n)=>this.createHostedView(t,n),t=>t.dom.remove())}createHostedView(e,t){let n=e.create(this.view);return n.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(n.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&n.mount&&n.mount(this.view),n}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)(e=t.destroy)===null||e===void 0||e.call(t)}passProp(e){let t;for(let n of this.manager.tooltipViews){let o=n[e];if(o!==void 0){if(t===void 0)t=o;else if(t!==o)return}}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const qE=zx.compute([m0],s=>{let e=s.facet(m0);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.map(t=>{var n;return(n=t.end)!==null&&n!==void 0?n:t.pos})),create:Z0.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class HE{constructor(e,t,n,o,f){this.view=e,this.source=t,this.field=n,this.setHover=o,this.hoverTime=f,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,n=e.docView.nearest(t.target);if(!n)return;let o,f=1;if(n instanceof pf)o=n.posAtStart;else{if(o=e.posAtCoords(t),o==null)return;let a=e.coordsAtPos(o);if(!a||t.y<a.top||t.y>a.bottom||t.x<a.left-e.defaultCharacterWidth||t.x>a.right+e.defaultCharacterWidth)return;let v=e.bidiSpans(e.state.doc.lineAt(o)).find(P=>P.from<=o&&P.to>=o),A=v&&v.dir==jn.RTL?-1:1;f=t.x<a.left?-A:A}let d=this.source(e,o,f);if(d!=null&&d.then){let a=this.pending={pos:o};d.then(v=>{this.pending==a&&(this.pending=null,v&&!(Array.isArray(v)&&!v.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(v)?v:[v])}))},v=>Fo(e.state,v,"hover tooltip"))}else d&&!(Array.isArray(d)&&!d.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(d)?d:[d])})}get tooltip(){let e=this.view.plugin(Ix),t=e?e.manager.tooltips.findIndex(n=>n.create==Z0.create):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,n;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:o,tooltip:f}=this;if(o.length&&f&&!ZE(f.dom,e)||this.pending){let{pos:d}=o[0]||this.pending,a=(n=(t=o[0])===null||t===void 0?void 0:t.end)!==null&&n!==void 0?n:d;(d==a?this.view.posAtCoords(this.lastMove)!=d:!GE(this.view,d,a,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:n}=this;n&&n.dom.contains(e.relatedTarget)?this.watchTooltipLeave(n.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=n=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(n.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const E_=4;function ZE(s,e){let{left:t,right:n,top:o,bottom:f}=s.getBoundingClientRect(),d;if(d=s.querySelector(".cm-tooltip-arrow")){let a=d.getBoundingClientRect();o=Math.min(a.top,o),f=Math.max(a.bottom,f)}return e.clientX>=t-E_&&e.clientX<=n+E_&&e.clientY>=o-E_&&e.clientY<=f+E_}function GE(s,e,t,n,o,f){let d=s.scrollDOM.getBoundingClientRect(),a=s.documentTop+s.documentPadding.top+s.contentHeight;if(d.left>n||d.right<n||d.top>o||Math.min(d.bottom,a)<o)return!1;let v=s.posAtCoords({x:n,y:o},!1);return v>=e&&v<=t}function $E(s,e={}){let t=xi.define(),n=zr.define({create(){return[]},update(o,f){if(o.length&&(e.hideOnChange&&(f.docChanged||f.selection)?o=[]:e.hideOn&&(o=o.filter(d=>!e.hideOn(f,d))),f.docChanged)){let d=[];for(let a of o){let v=f.changes.mapPos(a.pos,-1,po.TrackDel);if(v!=null){let A=Object.assign(Object.create(null),a);A.pos=v,A.end!=null&&(A.end=f.changes.mapPos(A.end)),d.push(A)}}o=d}for(let d of f.effects)d.is(t)&&(o=d.value),d.is(XE)&&(o=[]);return o},provide:o=>m0.from(o)});return{active:n,extension:[n,ks.define(o=>new HE(o,s,n,t,e.hoverTime||300)),qE]}}function mT(s,e){let t=s.plugin(Ix);if(!t)return null;let n=t.manager.tooltips.indexOf(e);return n<0?null:t.manager.tooltipViews[n]}const XE=xi.define(),ww=Ut.define({combine(s){let e,t;for(let n of s)e=e||n.topContainer,t=t||n.bottomContainer;return{topContainer:e,bottomContainer:t}}});function cy(s,e){let t=s.plugin(gT),n=t?t.specs.indexOf(e):-1;return n>-1?t.panels[n]:null}const gT=ks.fromClass(class{constructor(s){this.input=s.state.facet(uy),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(s));let e=s.state.facet(ww);this.top=new P_(s,!0,e.topContainer),this.bottom=new P_(s,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(s){let e=s.state.facet(ww);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new P_(s.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new P_(s.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=s.state.facet(uy);if(t!=this.input){let n=t.filter(v=>v),o=[],f=[],d=[],a=[];for(let v of n){let A=this.specs.indexOf(v),P;A<0?(P=v(s.view),a.push(P)):(P=this.panels[A],P.update&&P.update(s)),o.push(P),(P.top?f:d).push(P)}this.specs=n,this.panels=o,this.top.sync(f),this.bottom.sync(d);for(let v of a)v.dom.classList.add("cm-panel"),v.mount&&v.mount()}else for(let n of this.panels)n.update&&n.update(s)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:s=>Bt.scrollMargins.of(e=>{let t=e.plugin(s);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class P_{constructor(e,t,n){this.view=e,this.top=t,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Sw(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Sw(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Sw(s){let e=s.nextSibling;return s.remove(),e}const uy=Ut.define({enables:gT});class nh extends Ud{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}nh.prototype.elementClass="";nh.prototype.toDOM=void 0;nh.prototype.mapMode=po.TrackBefore;nh.prototype.startSide=nh.prototype.endSide=-1;nh.prototype.point=!0;const J_=Ut.define(),QE=Ut.define(),WE={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>qi.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Jg=Ut.define();function KE(s){return[yT(),Jg.of(Object.assign(Object.assign({},WE),s))]}const Tw=Ut.define({combine:s=>s.some(e=>e)});function yT(s){return[YE]}const YE=ks.fromClass(class{constructor(s){this.view=s,this.prevViewport=s.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=s.state.facet(Jg).map(e=>new Cw(s,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!s.state.facet(Tw),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),s.scrollDOM.insertBefore(this.dom,s.contentDOM)}update(s){if(this.updateGutters(s)){let e=this.prevViewport,t=s.view.viewport,n=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(n<(t.to-t.from)*.8)}s.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(Tw)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=s.view.viewport}syncGutters(s){let e=this.dom.nextSibling;s&&this.dom.remove();let t=qi.iter(this.view.state.facet(J_),this.view.viewport.from),n=[],o=this.gutters.map(f=>new JE(f,this.view.viewport,-this.view.documentPadding.top));for(let f of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(f.type)){let d=!0;for(let a of f.type)if(a.type==mo.Text&&d){Qv(t,n,a.from);for(let v of o)v.line(this.view,a,n);d=!1}else if(a.widget)for(let v of o)v.widget(this.view,a)}else if(f.type==mo.Text){Qv(t,n,f.from);for(let d of o)d.line(this.view,f,n)}else if(f.widget)for(let d of o)d.widget(this.view,f);for(let f of o)f.finish();s&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(s){let e=s.startState.facet(Jg),t=s.state.facet(Jg),n=s.docChanged||s.heightChanged||s.viewportChanged||!qi.eq(s.startState.facet(J_),s.state.facet(J_),s.view.viewport.from,s.view.viewport.to);if(e==t)for(let o of this.gutters)o.update(s)&&(n=!0);else{n=!0;let o=[];for(let f of t){let d=e.indexOf(f);d<0?o.push(new Cw(this.view,f)):(this.gutters[d].update(s),o.push(this.gutters[d]))}for(let f of this.gutters)f.dom.remove(),o.indexOf(f)<0&&f.destroy();for(let f of o)this.dom.appendChild(f.dom);this.gutters=o}return n}destroy(){for(let s of this.gutters)s.destroy();this.dom.remove()}},{provide:s=>Bt.scrollMargins.of(e=>{let t=e.plugin(s);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==jn.LTR?{left:t.dom.offsetWidth*e.scaleX}:{right:t.dom.offsetWidth*e.scaleX}})});function Mw(s){return Array.isArray(s)?s:[s]}function Qv(s,e,t){for(;s.value&&s.from<=t;)s.from==t&&e.push(s.value),s.next()}class JE{constructor(e,t,n){this.gutter=e,this.height=n,this.i=0,this.cursor=qi.iter(e.markers,t.from)}addElement(e,t,n){let{gutter:o}=this,f=(t.top-this.height)/e.scaleY,d=t.height/e.scaleY;if(this.i==o.elements.length){let a=new _T(e,d,f,n);o.elements.push(a),o.dom.appendChild(a.dom)}else o.elements[this.i].update(e,d,f,n);this.height=t.bottom,this.i++}line(e,t,n){let o=[];Qv(this.cursor,o,t.from),n.length&&(o=o.concat(n));let f=this.gutter.config.lineMarker(e,t,o);f&&o.unshift(f);let d=this.gutter;o.length==0&&!d.config.renderEmptyElements||this.addElement(e,t,o)}widget(e,t){let n=this.gutter.config.widgetMarker(e,t.widget,t),o=n?[n]:null;for(let f of e.state.facet(QE)){let d=f(e,t.widget,t);d&&(o||(o=[])).push(d)}o&&this.addElement(e,t,o)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Cw{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in t.domEventHandlers)this.dom.addEventListener(n,o=>{let f=o.target,d;if(f!=this.dom&&this.dom.contains(f)){for(;f.parentNode!=this.dom;)f=f.parentNode;let v=f.getBoundingClientRect();d=(v.top+v.bottom)/2}else d=o.clientY;let a=e.lineBlockAtHeight(d-e.documentTop);t.domEventHandlers[n](e,a,o)&&o.preventDefault()});this.markers=Mw(t.markers(e)),t.initialSpacer&&(this.spacer=new _T(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Mw(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let o=this.config.updateSpacer(this.spacer.markers[0],e);o!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[o])}let n=e.view.viewport;return!qi.eq(this.markers,t,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class _T{constructor(e,t,n,o){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,n,o)}update(e,t,n,o){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),eP(this.markers,o)||this.setMarkers(e,o)}setMarkers(e,t){let n="cm-gutterElement",o=this.dom.firstChild;for(let f=0,d=0;;){let a=d,v=f<t.length?t[f++]:null,A=!1;if(v){let P=v.elementClass;P&&(n+=" "+P);for(let L=d;L<this.markers.length;L++)if(this.markers[L].compare(v)){a=L,A=!0;break}}else a=this.markers.length;for(;d<a;){let P=this.markers[d++];if(P.toDOM){P.destroy(o);let L=o.nextSibling;o.remove(),o=L}}if(!v)break;v.toDOM&&(A?o=o.nextSibling:this.dom.insertBefore(v.toDOM(e),o)),A&&d++}this.dom.className=n,this.markers=t}destroy(){this.setMarkers(null,[])}}function eP(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(!s[t].compare(e[t]))return!1;return!0}const tP=Ut.define(),iP=Ut.define(),sm=Ut.define({combine(s){return Wc(s,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let n=Object.assign({},e);for(let o in t){let f=n[o],d=t[o];n[o]=f?(a,v,A)=>f(a,v,A)||d(a,v,A):d}return n}})}});class Ub extends nh{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function qb(s,e){return s.state.facet(sm).formatNumber(e,s.state)}const nP=Jg.compute([sm],s=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(tP)},lineMarker(e,t,n){return n.some(o=>o.toDOM)?null:new Ub(qb(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,n)=>{for(let o of e.state.facet(iP)){let f=o(e,t,n);if(f)return f}return null},lineMarkerChange:e=>e.startState.facet(sm)!=e.state.facet(sm),initialSpacer(e){return new Ub(qb(e,Aw(e.state.doc.lines)))},updateSpacer(e,t){let n=qb(t.view,Aw(t.view.state.doc.lines));return n==e.number?e:new Ub(n)},domEventHandlers:s.facet(sm).domEventHandlers}));function sP(s={}){return[sm.of(s),yT(),nP]}function Aw(s){let e=9;for(;e<s;)e=e*10+9;return e}const rP=new class extends nh{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},oP=J_.compute(["selection"],s=>{let e=[],t=-1;for(let n of s.selection.ranges){let o=s.doc.lineAt(n.head).from;o>t&&(t=o,e.push(rP.range(o)))}return qi.of(e)});function aP(){return oP}const bT=1024;let lP=0;class Hb{constructor(e,t){this.from=e,this.to=t}}class ki{constructor(e={}){this.id=lP++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Vo.match(e)),t=>{let n=e(t);return n===void 0?null:[this,n]}}}ki.closedBy=new ki({deserialize:s=>s.split(" ")});ki.openedBy=new ki({deserialize:s=>s.split(" ")});ki.group=new ki({deserialize:s=>s.split(" ")});ki.isolate=new ki({deserialize:s=>{if(s&&s!="rtl"&&s!="ltr"&&s!="auto")throw new RangeError("Invalid value for isolate: "+s);return s||"auto"}});ki.contextHash=new ki({perNode:!0});ki.lookAhead=new ki({perNode:!0});ki.mounted=new ki({perNode:!0});class g0{constructor(e,t,n){this.tree=e,this.overlay=t,this.parser=n}static get(e){return e&&e.props&&e.props[ki.mounted.id]}}const cP=Object.create(null);class Vo{constructor(e,t,n,o=0){this.name=e,this.props=t,this.id=n,this.flags=o}static define(e){let t=e.props&&e.props.length?Object.create(null):cP,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),o=new Vo(e.name||"",t,e.id,n);if(e.props){for(let f of e.props)if(Array.isArray(f)||(f=f(o)),f){if(f[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[f[0].id]=f[1]}}return o}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(ki.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let n in e)for(let o of n.split(" "))t[o]=e[n];return n=>{for(let o=n.prop(ki.group),f=-1;f<(o?o.length:0);f++){let d=t[f<0?n.name:o[f]];if(d)return d}}}}Vo.none=new Vo("",Object.create(null),0,8);class Lx{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let n of this.types){let o=null;for(let f of e){let d=f(n);d&&(o||(o=Object.assign({},n.props)),o[d[0].id]=d[1])}t.push(o?new Vo(n.name,o,n.id,n.flags):n)}return new Lx(t)}}const O_=new WeakMap,kw=new WeakMap;var _r;(function(s){s[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays"})(_r||(_r={}));class qs{constructor(e,t,n,o,f){if(this.type=e,this.children=t,this.positions=n,this.length=o,this.props=null,f&&f.length){this.props=Object.create(null);for(let[d,a]of f)this.props[typeof d=="number"?d:d.id]=a}}toString(){let e=g0.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let n of this.children){let o=n.toString();o&&(t&&(t+=","),t+=o)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Kv(this.topNode,e)}cursorAt(e,t=0,n=0){let o=O_.get(this)||this.topNode,f=new Kv(o);return f.moveTo(e,t),O_.set(this,f._tree),f}get topNode(){return new ll(this,0,0,null)}resolve(e,t=0){let n=hy(O_.get(this)||this.topNode,e,t,!1);return O_.set(this,n),n}resolveInner(e,t=0){let n=hy(kw.get(this)||this.topNode,e,t,!0);return kw.set(this,n),n}resolveStack(e,t=0){return fP(this,e,t)}iterate(e){let{enter:t,leave:n,from:o=0,to:f=this.length}=e,d=e.mode||0,a=(d&_r.IncludeAnonymous)>0;for(let v=this.cursor(d|_r.IncludeAnonymous);;){let A=!1;if(v.from<=f&&v.to>=o&&(!a&&v.type.isAnonymous||t(v)!==!1)){if(v.firstChild())continue;A=!0}for(;A&&n&&(a||!v.type.isAnonymous)&&n(v),!v.nextSibling();){if(!v.parent())return;A=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Fx(Vo.none,this.children,this.positions,0,this.children.length,0,this.length,(t,n,o)=>new qs(this.type,t,n,o,this.propValues),e.makeTree||((t,n,o)=>new qs(Vo.none,t,n,o)))}static build(e){return dP(e)}}qs.empty=new qs(Vo.none,[],[],0);class Bx{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Bx(this.buffer,this.index)}}class Tf{constructor(e,t,n){this.buffer=e,this.length=t,this.set=n}get type(){return Vo.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],n=this.buffer[e+3],o=this.set.types[t],f=o.name;if(/\W/.test(f)&&!o.isError&&(f=JSON.stringify(f)),e+=4,n==e)return f;let d=[];for(;e<n;)d.push(this.childString(e)),e=this.buffer[e+3];return f+"("+d.join(",")+")"}findChild(e,t,n,o,f){let{buffer:d}=this,a=-1;for(let v=e;v!=t&&!(vT(f,o,d[v+1],d[v+2])&&(a=v,n>0));v=d[v+3]);return a}slice(e,t,n){let o=this.buffer,f=new Uint16Array(t-e),d=0;for(let a=e,v=0;a<t;){f[v++]=o[a++],f[v++]=o[a++]-n;let A=f[v++]=o[a++]-n;f[v++]=o[a++]-e,d=Math.max(d,A)}return new Tf(f,d,this.set)}}function vT(s,e,t,n){switch(s){case-2:return t<e;case-1:return n>=e&&t<e;case 0:return t<e&&n>e;case 1:return t<=e&&n>e;case 2:return n>e;case 4:return!0}}function hy(s,e,t,n){for(var o;s.from==s.to||(t<1?s.from>=e:s.from>e)||(t>-1?s.to<=e:s.to<e);){let d=!n&&s instanceof ll&&s.index<0?null:s.parent;if(!d)return s;s=d}let f=n?0:_r.IgnoreOverlays;if(n)for(let d=s,a=d.parent;a;d=a,a=d.parent)d instanceof ll&&d.index<0&&((o=a.enter(e,t,f))===null||o===void 0?void 0:o.from)!=d.from&&(s=a);for(;;){let d=s.enter(e,t,f);if(!d)return s;s=d}}class xT{cursor(e=0){return new Kv(this,e)}getChild(e,t=null,n=null){let o=Ew(this,e,t,n);return o.length?o[0]:null}getChildren(e,t=null,n=null){return Ew(this,e,t,n)}resolve(e,t=0){return hy(this,e,t,!1)}resolveInner(e,t=0){return hy(this,e,t,!0)}matchContext(e){return Wv(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),n=this;for(;t;){let o=t.lastChild;if(!o||o.to!=t.to)break;o.type.isError&&o.from==o.to?(n=t,t=o.prevSibling):t=o}return n}get node(){return this}get next(){return this.parent}}class ll extends xT{constructor(e,t,n,o){super(),this._tree=e,this.from=t,this.index=n,this._parent=o}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,n,o,f=0){for(let d=this;;){for(let{children:a,positions:v}=d._tree,A=t>0?a.length:-1;e!=A;e+=t){let P=a[e],L=v[e]+d.from;if(vT(o,n,L,L+P.length)){if(P instanceof Tf){if(f&_r.ExcludeBuffers)continue;let j=P.findChild(0,P.buffer.length,t,n-L,o);if(j>-1)return new gf(new uP(d,P,e,L),null,j)}else if(f&_r.IncludeAnonymous||!P.type.isAnonymous||Nx(P)){let j;if(!(f&_r.IgnoreMounts)&&(j=g0.get(P))&&!j.overlay)return new ll(j.tree,L,e,d);let F=new ll(P,L,e,d);return f&_r.IncludeAnonymous||!F.type.isAnonymous?F:F.nextChild(t<0?P.children.length-1:0,t,n,o)}}}if(f&_r.IncludeAnonymous||!d.type.isAnonymous||(d.index>=0?e=d.index+t:e=t<0?-1:d._parent._tree.children.length,d=d._parent,!d))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,n=0){let o;if(!(n&_r.IgnoreOverlays)&&(o=g0.get(this._tree))&&o.overlay){let f=e-this.from;for(let{from:d,to:a}of o.overlay)if((t>0?d<=f:d<f)&&(t<0?a>=f:a>f))return new ll(o.tree,o.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Ew(s,e,t,n){let o=s.cursor(),f=[];if(!o.firstChild())return f;if(t!=null){for(let d=!1;!d;)if(d=o.type.is(t),!o.nextSibling())return f}for(;;){if(n!=null&&o.type.is(n))return f;if(o.type.is(e)&&f.push(o.node),!o.nextSibling())return n==null?f:[]}}function Wv(s,e,t=e.length-1){for(let n=s;t>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[t]&&e[t]!=n.name)return!1;t--}}return!0}class uP{constructor(e,t,n,o){this.parent=e,this.buffer=t,this.index=n,this.start=o}}class gf extends xT{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,n){super(),this.context=e,this._parent=t,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}child(e,t,n){let{buffer:o}=this.context,f=o.findChild(this.index+4,o.buffer[this.index+3],e,t-this.context.start,n);return f<0?null:new gf(this.context,this,f)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,n=0){if(n&_r.ExcludeBuffers)return null;let{buffer:o}=this.context,f=o.findChild(this.index+4,o.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return f<0?null:new gf(this.context,this,f)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new gf(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new gf(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:n}=this.context,o=this.index+4,f=n.buffer[this.index+3];if(f>o){let d=n.buffer[this.index+1];e.push(n.slice(o,f,d)),t.push(0)}return new qs(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function wT(s){if(!s.length)return null;let e=0,t=s[0];for(let f=1;f<s.length;f++){let d=s[f];(d.from>t.from||d.to<t.to)&&(t=d,e=f)}let n=t instanceof ll&&t.index<0?null:t.parent,o=s.slice();return n?o[e]=n:o.splice(e,1),new hP(o,t)}class hP{constructor(e,t){this.heads=e,this.node=t}get next(){return wT(this.heads)}}function fP(s,e,t){let n=s.resolveInner(e,t),o=null;for(let f=n instanceof ll?n:n.context.parent;f;f=f.parent)if(f.index<0){let d=f.parent;(o||(o=[n])).push(d.resolve(e,t)),f=d}else{let d=g0.get(f.tree);if(d&&d.overlay&&d.overlay[0].from<=e&&d.overlay[d.overlay.length-1].to>=e){let a=new ll(d.tree,d.overlay[0].from+f.from,-1,f);(o||(o=[n])).push(hy(a,e,t,!1))}}return o?wT(o):n}class Kv{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof ll)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:n,buffer:o}=this.buffer;return this.type=t||o.set.types[o.buffer[e]],this.from=n+o.buffer[e+1],this.to=n+o.buffer[e+2],!0}yield(e){return e?e instanceof ll?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,n,this.mode));let{buffer:o}=this.buffer,f=o.findChild(this.index+4,o.buffer[this.index+3],e,t-this.buffer.start,n);return f<0?!1:(this.stack.push(this.index),this.yieldBuf(f))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,n=this.mode){return this.buffer?n&_r.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&_r.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&_r.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,n=this.stack.length-1;if(e<0){let o=n<0?0:this.stack[n]+4;if(this.index!=o)return this.yieldBuf(t.findChild(o,this.index,-1,0,4))}else{let o=t.buffer[this.index+3];if(o<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(o)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,n,{buffer:o}=this;if(o){if(e>0){if(this.index<o.buffer.buffer.length)return!1}else for(let f=0;f<this.index;f++)if(o.buffer.buffer[f+3]<this.index)return!1;({index:t,parent:n}=o)}else({index:t,_parent:n}=this._tree);for(;n;{index:t,_parent:n}=n)if(t>-1)for(let f=t+e,d=e<0?-1:n._tree.children.length;f!=d;f+=e){let a=n._tree.children[f];if(this.mode&_r.IncludeAnonymous||a instanceof Tf||!a.type.isAnonymous||Nx(a))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer)e:for(let o=this.index,f=this.stack.length;f>=0;){for(let d=e;d;d=d._parent)if(d.index==o){if(o==this.index)return d;t=d,n=f+1;break e}o=this.stack[--f]}for(let o=n;o<this.stack.length;o++)t=new gf(this.buffer,t,this.stack[o]);return this.bufferNode=new gf(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let n=0;;){let o=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(o=!0)}for(;;){if(o&&t&&t(this),o=this.type.isAnonymous,!n)return;if(this.nextSibling())break;this.parent(),n--,o=!0}}}matchContext(e){if(!this.buffer)return Wv(this.node.parent,e);let{buffer:t}=this.buffer,{types:n}=t.set;for(let o=e.length-1,f=this.stack.length-1;o>=0;f--){if(f<0)return Wv(this._tree,e,o);let d=n[t.buffer[this.stack[f]]];if(!d.isAnonymous){if(e[o]&&e[o]!=d.name)return!1;o--}}return!0}}function Nx(s){return s.children.some(e=>e instanceof Tf||!e.type.isAnonymous||Nx(e))}function dP(s){var e;let{buffer:t,nodeSet:n,maxBufferLength:o=bT,reused:f=[],minRepeatType:d=n.types.length}=s,a=Array.isArray(t)?new Bx(t,t.length):t,v=n.types,A=0,P=0;function L(ke,Se,Fe,He,gt,Et){let{id:Mt,start:ht,end:Gt,size:Ft}=a,ei=P,Xe=A;for(;Ft<0;)if(a.next(),Ft==-1){let ot=f[Mt];Fe.push(ot),He.push(ht-ke);return}else if(Ft==-3){A=Mt;return}else if(Ft==-4){P=Mt;return}else throw new RangeError(`Unrecognized record size: ${Ft}`);let dt=v[Mt],_t,qt,xe=ht-ke;if(Gt-ht<=o&&(qt=le(a.pos-Se,gt))){let ot=new Uint16Array(qt.size-qt.skip),xt=a.pos-qt.size,Tt=ot.length;for(;a.pos>xt;)Tt=ve(qt.start,ot,Tt);_t=new Tf(ot,Gt-qt.start,n),xe=qt.start-ke}else{let ot=a.pos-Ft;a.next();let xt=[],Tt=[],Rt=Mt>=d?Mt:-1,Jt=0,Nt=Gt;for(;a.pos>ot;)Rt>=0&&a.id==Rt&&a.size>=0?(a.end<=Nt-o&&(K(xt,Tt,ht,Jt,a.end,Nt,Rt,ei,Xe),Jt=xt.length,Nt=a.end),a.next()):Et>2500?j(ht,ot,xt,Tt):L(ht,ot,xt,Tt,Rt,Et+1);if(Rt>=0&&Jt>0&&Jt<xt.length&&K(xt,Tt,ht,Jt,ht,Nt,Rt,ei,Xe),xt.reverse(),Tt.reverse(),Rt>-1&&Jt>0){let Ei=F(dt,Xe);_t=Fx(dt,xt,Tt,0,xt.length,0,Gt-ht,Ei,Ei)}else _t=se(dt,xt,Tt,Gt-ht,ei-Gt,Xe)}Fe.push(_t),He.push(xe)}function j(ke,Se,Fe,He){let gt=[],Et=0,Mt=-1;for(;a.pos>Se;){let{id:ht,start:Gt,end:Ft,size:ei}=a;if(ei>4)a.next();else{if(Mt>-1&&Gt<Mt)break;Mt<0&&(Mt=Ft-o),gt.push(ht,Gt,Ft),Et++,a.next()}}if(Et){let ht=new Uint16Array(Et*4),Gt=gt[gt.length-2];for(let Ft=gt.length-3,ei=0;Ft>=0;Ft-=3)ht[ei++]=gt[Ft],ht[ei++]=gt[Ft+1]-Gt,ht[ei++]=gt[Ft+2]-Gt,ht[ei++]=ei;Fe.push(new Tf(ht,gt[2]-Gt,n)),He.push(Gt-ke)}}function F(ke,Se){return(Fe,He,gt)=>{let Et=0,Mt=Fe.length-1,ht,Gt;if(Mt>=0&&(ht=Fe[Mt])instanceof qs){if(!Mt&&ht.type==ke&&ht.length==gt)return ht;(Gt=ht.prop(ki.lookAhead))&&(Et=He[Mt]+ht.length+Gt)}return se(ke,Fe,He,gt,Et,Se)}}function K(ke,Se,Fe,He,gt,Et,Mt,ht,Gt){let Ft=[],ei=[];for(;ke.length>He;)Ft.push(ke.pop()),ei.push(Se.pop()+Fe-gt);ke.push(se(n.types[Mt],Ft,ei,Et-gt,ht-Et,Gt)),Se.push(gt-Fe)}function se(ke,Se,Fe,He,gt,Et,Mt){if(Et){let ht=[ki.contextHash,Et];Mt=Mt?[ht].concat(Mt):[ht]}if(gt>25){let ht=[ki.lookAhead,gt];Mt=Mt?[ht].concat(Mt):[ht]}return new qs(ke,Se,Fe,He,Mt)}function le(ke,Se){let Fe=a.fork(),He=0,gt=0,Et=0,Mt=Fe.end-o,ht={size:0,start:0,skip:0};e:for(let Gt=Fe.pos-ke;Fe.pos>Gt;){let Ft=Fe.size;if(Fe.id==Se&&Ft>=0){ht.size=He,ht.start=gt,ht.skip=Et,Et+=4,He+=4,Fe.next();continue}let ei=Fe.pos-Ft;if(Ft<0||ei<Gt||Fe.start<Mt)break;let Xe=Fe.id>=d?4:0,dt=Fe.start;for(Fe.next();Fe.pos>ei;){if(Fe.size<0)if(Fe.size==-3)Xe+=4;else break e;else Fe.id>=d&&(Xe+=4);Fe.next()}gt=dt,He+=Ft,Et+=Xe}return(Se<0||He==ke)&&(ht.size=He,ht.start=gt,ht.skip=Et),ht.size>4?ht:void 0}function ve(ke,Se,Fe){let{id:He,start:gt,end:Et,size:Mt}=a;if(a.next(),Mt>=0&&He<d){let ht=Fe;if(Mt>4){let Gt=a.pos-(Mt-4);for(;a.pos>Gt;)Fe=ve(ke,Se,Fe)}Se[--Fe]=ht,Se[--Fe]=Et-ke,Se[--Fe]=gt-ke,Se[--Fe]=He}else Mt==-3?A=He:Mt==-4&&(P=He);return Fe}let Be=[],je=[];for(;a.pos>0;)L(s.start||0,s.bufferStart||0,Be,je,-1,0);let ze=(e=s.length)!==null&&e!==void 0?e:Be.length?je[0]+Be[0].length:0;return new qs(v[s.topID],Be.reverse(),je.reverse(),ze)}const Pw=new WeakMap;function e0(s,e){if(!s.isAnonymous||e instanceof Tf||e.type!=s)return 1;let t=Pw.get(e);if(t==null){t=1;for(let n of e.children){if(n.type!=s||!(n instanceof qs)){t=1;break}t+=e0(s,n)}Pw.set(e,t)}return t}function Fx(s,e,t,n,o,f,d,a,v){let A=0;for(let K=n;K<o;K++)A+=e0(s,e[K]);let P=Math.ceil(A*1.5/8),L=[],j=[];function F(K,se,le,ve,Be){for(let je=le;je<ve;){let ze=je,ke=se[je],Se=e0(s,K[je]);for(je++;je<ve;je++){let Fe=e0(s,K[je]);if(Se+Fe>=P)break;Se+=Fe}if(je==ze+1){if(Se>P){let Fe=K[ze];F(Fe.children,Fe.positions,0,Fe.children.length,se[ze]+Be);continue}L.push(K[ze])}else{let Fe=se[je-1]+K[je-1].length-ke;L.push(Fx(s,K,se,ze,je,ke,Fe,null,v))}j.push(ke+Be-f)}}return F(e,t,n,o,0),(a||v)(L,j,d)}class Vd{constructor(e,t,n,o,f=!1,d=!1){this.from=e,this.to=t,this.tree=n,this.offset=o,this.open=(f?1:0)|(d?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],n=!1){let o=[new Vd(0,e.length,e,0,!1,n)];for(let f of t)f.to>e.length&&o.push(f);return o}static applyChanges(e,t,n=128){if(!t.length)return e;let o=[],f=1,d=e.length?e[0]:null;for(let a=0,v=0,A=0;;a++){let P=a<t.length?t[a]:null,L=P?P.fromA:1e9;if(L-v>=n)for(;d&&d.from<L;){let j=d;if(v>=j.from||L<=j.to||A){let F=Math.max(j.from,v)-A,K=Math.min(j.to,L)-A;j=F>=K?null:new Vd(F,K,j.tree,j.offset+A,a>0,!!P)}if(j&&o.push(j),d.to>L)break;d=f<e.length?e[f++]:null}if(!P)break;v=P.toA,A=P.toA-P.toB}return o}}let ST=class{startParse(e,t,n){return typeof e=="string"&&(e=new pP(e)),n=n?n.length?n.map(o=>new Hb(o.from,o.to)):[new Hb(0,0)]:[new Hb(0,e.length)],this.createParse(e,t||[],n)}parse(e,t,n){let o=this.startParse(e,t,n);for(;;){let f=o.advance();if(f)return f}}};class pP{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new ki({perNode:!0});let mP=0,Ku=class Yv{constructor(e,t,n,o){this.name=e,this.set=t,this.base=n,this.modified=o,this.id=mP++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let n=typeof e=="string"?e:"?";if(e instanceof Yv&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let o=new Yv(n,[],null,[]);if(o.set.push(o),t)for(let f of t.set)o.set.push(f);return o}static defineModifier(e){let t=new y0(e);return n=>n.modified.indexOf(t)>-1?n:y0.get(n.base||n,n.modified.concat(t).sort((o,f)=>o.id-f.id))}},gP=0;class y0{constructor(e){this.name=e,this.instances=[],this.id=gP++}static get(e,t){if(!t.length)return e;let n=t[0].instances.find(a=>a.base==e&&yP(t,a.modified));if(n)return n;let o=[],f=new Ku(e.name,o,e,t);for(let a of t)a.instances.push(f);let d=_P(t);for(let a of e.set)if(!a.modified.length)for(let v of d)o.push(y0.get(a,v));return f}}function yP(s,e){return s.length==e.length&&s.every((t,n)=>t==e[n])}function _P(s){let e=[[]];for(let t=0;t<s.length;t++)for(let n=0,o=e.length;n<o;n++)e.push(e[n].concat(s[t]));return e.sort((t,n)=>n.length-t.length)}function TT(s){let e=Object.create(null);for(let t in s){let n=s[t];Array.isArray(n)||(n=[n]);for(let o of t.split(" "))if(o){let f=[],d=2,a=o;for(let L=0;;){if(a=="..."&&L>0&&L+3==o.length){d=1;break}let j=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!j)throw new RangeError("Invalid path: "+o);if(f.push(j[0]=="*"?"":j[0][0]=='"'?JSON.parse(j[0]):j[0]),L+=j[0].length,L==o.length)break;let F=o[L++];if(L==o.length&&F=="!"){d=0;break}if(F!="/")throw new RangeError("Invalid path: "+o);a=o.slice(L)}let v=f.length-1,A=f[v];if(!A)throw new RangeError("Invalid path: "+o);let P=new _0(n,d,v>0?f.slice(0,v):null);e[A]=P.sort(e[A])}}return MT.add(e)}const MT=new ki;class _0{constructor(e,t,n,o){this.tags=e,this.mode=t,this.context=n,this.next=o}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}_0.empty=new _0([],2,null);function CT(s,e){let t=Object.create(null);for(let f of s)if(!Array.isArray(f.tag))t[f.tag.id]=f.class;else for(let d of f.tag)t[d.id]=f.class;let{scope:n,all:o=null}=e||{};return{style:f=>{let d=o;for(let a of f)for(let v of a.set){let A=t[v.id];if(A){d=d?d+" "+A:A;break}}return d},scope:n}}function bP(s,e){let t=null;for(let n of s){let o=n.style(e);o&&(t=t?t+" "+o:o)}return t}function vP(s,e,t,n=0,o=s.length){let f=new xP(n,Array.isArray(e)?e:[e],t);f.highlightRange(s.cursor(),n,o,"",f.highlighters),f.flush(o)}class xP{constructor(e,t,n){this.at=e,this.highlighters=t,this.span=n,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,n,o,f){let{type:d,from:a,to:v}=e;if(a>=n||v<=t)return;d.isTop&&(f=this.highlighters.filter(F=>!F.scope||F.scope(d)));let A=o,P=wP(e)||_0.empty,L=bP(f,P.tags);if(L&&(A&&(A+=" "),A+=L,P.mode==1&&(o+=(o?" ":"")+L)),this.startSpan(Math.max(t,a),A),P.opaque)return;let j=e.tree&&e.tree.prop(ki.mounted);if(j&&j.overlay){let F=e.node.enter(j.overlay[0].from+a,1),K=this.highlighters.filter(le=>!le.scope||le.scope(j.tree.type)),se=e.firstChild();for(let le=0,ve=a;;le++){let Be=le<j.overlay.length?j.overlay[le]:null,je=Be?Be.from+a:v,ze=Math.max(t,ve),ke=Math.min(n,je);if(ze<ke&&se)for(;e.from<ke&&(this.highlightRange(e,ze,ke,o,f),this.startSpan(Math.min(ke,e.to),A),!(e.to>=je||!e.nextSibling())););if(!Be||je>n)break;ve=Be.to+a,ve>t&&(this.highlightRange(F.cursor(),Math.max(t,Be.from+a),Math.min(n,ve),"",K),this.startSpan(Math.min(n,ve),A))}se&&e.parent()}else if(e.firstChild()){j&&(o="");do if(!(e.to<=t)){if(e.from>=n)break;this.highlightRange(e,t,n,o,f),this.startSpan(Math.min(n,e.to),A)}while(e.nextSibling());e.parent()}}}function wP(s){let e=s.type.prop(MT);for(;e&&e.context&&!s.matchContext(e.context);)e=e.next;return e||null}const Dt=Ku.define,D_=Dt(),lf=Dt(),Ow=Dt(lf),Dw=Dt(lf),cf=Dt(),R_=Dt(cf),Zb=Dt(cf),Fc=Dt(),Od=Dt(Fc),Bc=Dt(),Nc=Dt(),Jv=Dt(),Fg=Dt(Jv),I_=Dt(),me={comment:D_,lineComment:Dt(D_),blockComment:Dt(D_),docComment:Dt(D_),name:lf,variableName:Dt(lf),typeName:Ow,tagName:Dt(Ow),propertyName:Dw,attributeName:Dt(Dw),className:Dt(lf),labelName:Dt(lf),namespace:Dt(lf),macroName:Dt(lf),literal:cf,string:R_,docString:Dt(R_),character:Dt(R_),attributeValue:Dt(R_),number:Zb,integer:Dt(Zb),float:Dt(Zb),bool:Dt(cf),regexp:Dt(cf),escape:Dt(cf),color:Dt(cf),url:Dt(cf),keyword:Bc,self:Dt(Bc),null:Dt(Bc),atom:Dt(Bc),unit:Dt(Bc),modifier:Dt(Bc),operatorKeyword:Dt(Bc),controlKeyword:Dt(Bc),definitionKeyword:Dt(Bc),moduleKeyword:Dt(Bc),operator:Nc,derefOperator:Dt(Nc),arithmeticOperator:Dt(Nc),logicOperator:Dt(Nc),bitwiseOperator:Dt(Nc),compareOperator:Dt(Nc),updateOperator:Dt(Nc),definitionOperator:Dt(Nc),typeOperator:Dt(Nc),controlOperator:Dt(Nc),punctuation:Jv,separator:Dt(Jv),bracket:Fg,angleBracket:Dt(Fg),squareBracket:Dt(Fg),paren:Dt(Fg),brace:Dt(Fg),content:Fc,heading:Od,heading1:Dt(Od),heading2:Dt(Od),heading3:Dt(Od),heading4:Dt(Od),heading5:Dt(Od),heading6:Dt(Od),contentSeparator:Dt(Fc),list:Dt(Fc),quote:Dt(Fc),emphasis:Dt(Fc),strong:Dt(Fc),link:Dt(Fc),monospace:Dt(Fc),strikethrough:Dt(Fc),inserted:Dt(),deleted:Dt(),changed:Dt(),invalid:Dt(),meta:I_,documentMeta:Dt(I_),annotation:Dt(I_),processingInstruction:Dt(I_),definition:Ku.defineModifier("definition"),constant:Ku.defineModifier("constant"),function:Ku.defineModifier("function"),standard:Ku.defineModifier("standard"),local:Ku.defineModifier("local"),special:Ku.defineModifier("special")};for(let s in me){let e=me[s];e instanceof Ku&&(e.name=s)}CT([{tag:me.link,class:"tok-link"},{tag:me.heading,class:"tok-heading"},{tag:me.emphasis,class:"tok-emphasis"},{tag:me.strong,class:"tok-strong"},{tag:me.keyword,class:"tok-keyword"},{tag:me.atom,class:"tok-atom"},{tag:me.bool,class:"tok-bool"},{tag:me.url,class:"tok-url"},{tag:me.labelName,class:"tok-labelName"},{tag:me.inserted,class:"tok-inserted"},{tag:me.deleted,class:"tok-deleted"},{tag:me.literal,class:"tok-literal"},{tag:me.string,class:"tok-string"},{tag:me.number,class:"tok-number"},{tag:[me.regexp,me.escape,me.special(me.string)],class:"tok-string2"},{tag:me.variableName,class:"tok-variableName"},{tag:me.local(me.variableName),class:"tok-variableName tok-local"},{tag:me.definition(me.variableName),class:"tok-variableName tok-definition"},{tag:me.special(me.variableName),class:"tok-variableName2"},{tag:me.definition(me.propertyName),class:"tok-propertyName tok-definition"},{tag:me.typeName,class:"tok-typeName"},{tag:me.namespace,class:"tok-namespace"},{tag:me.className,class:"tok-className"},{tag:me.macroName,class:"tok-macroName"},{tag:me.propertyName,class:"tok-propertyName"},{tag:me.operator,class:"tok-operator"},{tag:me.comment,class:"tok-comment"},{tag:me.meta,class:"tok-meta"},{tag:me.invalid,class:"tok-invalid"},{tag:me.punctuation,class:"tok-punctuation"}]);var Gb;const rm=new ki;function SP(s){return Ut.define({combine:s?e=>e.concat(s):void 0})}const TP=new ki;class Jl{constructor(e,t,n=[],o=""){this.data=e,this.name=o,Bi.prototype.hasOwnProperty("tree")||Object.defineProperty(Bi.prototype,"tree",{get(){return Qr(this)}}),this.parser=t,this.extension=[Mf.of(this),Bi.languageData.of((f,d,a)=>{let v=Rw(f,d,a),A=v.type.prop(rm);if(!A)return[];let P=f.facet(A),L=v.type.prop(TP);if(L){let j=v.resolve(d-v.from,a);for(let F of L)if(F.test(j,f)){let K=f.facet(F.facet);return F.type=="replace"?K:K.concat(P)}}return P})].concat(n)}isActiveAt(e,t,n=-1){return Rw(e,t,n).type.prop(rm)==this.data}findRegions(e){let t=e.facet(Mf);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let n=[],o=(f,d)=>{if(f.prop(rm)==this.data){n.push({from:d,to:d+f.length});return}let a=f.prop(ki.mounted);if(a){if(a.tree.prop(rm)==this.data){if(a.overlay)for(let v of a.overlay)n.push({from:v.from+d,to:v.to+d});else n.push({from:d,to:d+f.length});return}else if(a.overlay){let v=n.length;if(o(a.tree,a.overlay[0].from+d),n.length>v)return}}for(let v=0;v<f.children.length;v++){let A=f.children[v];A instanceof qs&&o(A,f.positions[v]+d)}};return o(Qr(e),0),n}get allowsNesting(){return!0}}Jl.setState=xi.define();function Rw(s,e,t){let n=s.facet(Mf),o=Qr(s).topNode;if(!n||n.allowsNesting)for(let f=o;f;f=f.enter(e,t,_r.ExcludeBuffers))f.type.isTop&&(o=f);return o}class b0 extends Jl{constructor(e,t,n){super(e,t,[],n),this.parser=t}static define(e){let t=SP(e.languageData);return new b0(t,e.parser.configure({props:[rm.add(n=>n.isTop?t:void 0)]}),e.name)}configure(e,t){return new b0(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function Qr(s){let e=s.field(Jl.state,!1);return e?e.tree:qs.empty}class MP{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let n=this.cursorPos-this.string.length;return e<n||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-n,t-n)}}let jg=null;class v0{constructor(e,t,n=[],o,f,d,a,v){this.parser=e,this.state=t,this.fragments=n,this.tree=o,this.treeLen=f,this.viewport=d,this.skipped=a,this.scheduleOn=v,this.parse=null,this.tempSkipped=[]}static create(e,t,n){return new v0(e,t,[],qs.empty,0,n,[],null)}startParse(){return this.parser.startParse(new MP(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=qs.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let o=Date.now()+e;e=()=>Date.now()>o}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let o=this.parse.advance();if(o)if(this.fragments=this.withoutTempSkipped(Vd.addTree(o,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=o,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Vd.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=jg;jg=this;try{return e()}finally{jg=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Iw(e,t.from,t.to);return e}changes(e,t){let{fragments:n,tree:o,treeLen:f,viewport:d,skipped:a}=this;if(this.takeTree(),!e.empty){let v=[];if(e.iterChangedRanges((A,P,L,j)=>v.push({fromA:A,toA:P,fromB:L,toB:j})),n=Vd.applyChanges(n,v),o=qs.empty,f=0,d={from:e.mapPos(d.from,-1),to:e.mapPos(d.to,1)},this.skipped.length){a=[];for(let A of this.skipped){let P=e.mapPos(A.from,1),L=e.mapPos(A.to,-1);P<L&&a.push({from:P,to:L})}}}return new v0(this.parser,t,n,o,f,d,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:o,to:f}=this.skipped[n];o<e.to&&f>e.from&&(this.fragments=Iw(this.fragments,o,f),this.skipped.splice(n--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends ST{createParse(t,n,o){let f=o[0].from,d=o[o.length-1].to;return{parsedPos:f,advance(){let v=jg;if(v){for(let A of o)v.tempSkipped.push(A);e&&(v.scheduleOn=v.scheduleOn?Promise.all([v.scheduleOn,e]):e)}return this.parsedPos=d,new qs(Vo.none,[],[],d-f)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return jg}}function Iw(s,e,t){return Vd.applyChanges(s,[{fromA:e,toA:t,fromB:e,toB:t}])}class Mm{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,n)||t.takeTree(),new Mm(t)}static init(e){let t=Math.min(3e3,e.doc.length),n=v0.create(e.facet(Mf).parser,e,{from:0,to:t});return n.work(20,t)||n.takeTree(),new Mm(n)}}Jl.state=zr.define({create:Mm.init,update(s,e){for(let t of e.effects)if(t.is(Jl.setState))return t.value;return e.startState.facet(Mf)!=e.state.facet(Mf)?Mm.init(e.state):s.apply(e)}});let AT=s=>{let e=setTimeout(()=>s(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(AT=s=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(s,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const $b=typeof navigator<"u"&&(!((Gb=navigator.scheduling)===null||Gb===void 0)&&Gb.isInputPending)?()=>navigator.scheduling.isInputPending():null,CP=ks.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Jl.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Jl.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=AT(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:o}}=this.view,f=n.field(Jl.state);if(f.tree==f.context.tree&&f.context.isDone(o+1e5))return;let d=Date.now()+Math.min(this.chunkBudget,100,e&&!$b?Math.max(25,e.timeRemaining()-5):1e9),a=f.context.treeLen<o&&n.doc.length>o+1e3,v=f.context.work(()=>$b&&$b()||Date.now()>d,o+(a?0:1e5));this.chunkBudget-=Date.now()-t,(v||this.chunkBudget<=0)&&(f.context.takeTree(),this.view.dispatch({effects:Jl.setState.of(new Mm(f.context))})),this.chunkBudget>0&&!(v&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(f.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Fo(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Mf=Ut.define({combine(s){return s.length?s[0]:null},enables:s=>[Jl.state,CP,Bt.contentAttributes.compute([s],e=>{let t=e.facet(s);return t&&t.name?{"data-language":t.name}:{}})]});class AP{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const kP=Ut.define(),G0=Ut.define({combine:s=>{if(!s.length)return"  ";let e=s[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return e}});function x0(s){let e=s.facet(G0);return e.charCodeAt(0)==9?s.tabSize*e.length:e.length}function fy(s,e){let t="",n=s.tabSize,o=s.facet(G0)[0];if(o=="	"){for(;e>=n;)t+="	",e-=n;o=" "}for(let f=0;f<e;f++)t+=o;return t}function jx(s,e){s instanceof Bi&&(s=new $0(s));for(let n of s.state.facet(kP)){let o=n(s,e);if(o!==void 0)return o}let t=Qr(s.state);return t.length>=e?EP(s,t,e):null}class $0{constructor(e,t={}){this.state=e,this.options=t,this.unit=x0(e)}lineAt(e,t=1){let n=this.state.doc.lineAt(e),{simulateBreak:o,simulateDoubleBreak:f}=this.options;return o!=null&&o>=n.from&&o<=n.to?f&&o==e?{text:"",from:e}:(t<0?o<e:o<=e)?{text:n.text.slice(o-n.from),from:o}:{text:n.text.slice(0,o-n.from),from:n.from}:n}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:o}=this.lineAt(e,t);return n.slice(e-o,Math.min(n.length,e+100-o))}column(e,t=1){let{text:n,from:o}=this.lineAt(e,t),f=this.countColumn(n,e-o),d=this.options.overrideIndentation?this.options.overrideIndentation(o):-1;return d>-1&&(f+=d-this.countColumn(n,n.search(/\S|$/))),f}countColumn(e,t=e.length){return Dm(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:n,from:o}=this.lineAt(e,t),f=this.options.overrideIndentation;if(f){let d=f(o);if(d>-1)return d}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const kT=new ki;function EP(s,e,t){let n=e.resolveStack(t),o=n.node.enterUnfinishedNodesBefore(t);if(o!=n.node){let f=[];for(let d=o;d!=n.node;d=d.parent)f.push(d);for(let d=f.length-1;d>=0;d--)n={node:f[d],next:n}}return ET(n,s,t)}function ET(s,e,t){for(let n=s;n;n=n.next){let o=OP(n.node);if(o)return o(Vx.create(e,t,n))}return 0}function PP(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function OP(s){let e=s.type.prop(kT);if(e)return e;let t=s.firstChild,n;if(t&&(n=t.type.prop(ki.closedBy))){let o=s.lastChild,f=o&&n.indexOf(o.name)>-1;return d=>PT(d,!0,1,void 0,f&&!PP(d)?o.from:void 0)}return s.parent==null?DP:null}function DP(){return 0}class Vx extends $0{constructor(e,t,n){super(e.state,e.options),this.base=e,this.pos=t,this.context=n}get node(){return this.context.node}static create(e,t,n){return new Vx(e,t,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let n=e.resolve(t.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(RP(n,e))break;t=this.state.doc.lineAt(n.from)}return this.lineIndent(t.from)}continue(){return ET(this.context.next,this.base,this.pos)}}function RP(s,e){for(let t=e;t;t=t.parent)if(s==t)return!0;return!1}function IP(s){let e=s.node,t=e.childAfter(e.from),n=e.lastChild;if(!t)return null;let o=s.options.simulateBreak,f=s.state.doc.lineAt(t.from),d=o==null||o<=f.from?f.to:Math.min(f.to,o);for(let a=t.to;;){let v=e.childAfter(a);if(!v||v==n)return null;if(!v.type.isSkipped){if(v.from>=d)return null;let A=/^ */.exec(f.text.slice(t.to-f.from))[0].length;return{from:t.from,to:t.to+A}}a=v.to}}function zw({closing:s,align:e=!0,units:t=1}){return n=>PT(n,e,t,s)}function PT(s,e,t,n,o){let f=s.textAfter,d=f.match(/^\s*/)[0].length,a=n&&f.slice(d,d+n.length)==n||o==s.pos+d,v=e?IP(s):null;return v?a?s.column(v.from):s.column(v.to):s.baseIndent+(a?0:s.unit*t)}const zP=200;function LP(){return Bi.transactionFilter.of(s=>{if(!s.docChanged||!s.isUserEvent("input.type")&&!s.isUserEvent("input.complete"))return s;let e=s.startState.languageDataAt("indentOnInput",s.startState.selection.main.head);if(!e.length)return s;let t=s.newDoc,{head:n}=s.newSelection.main,o=t.lineAt(n);if(n>o.from+zP)return s;let f=t.sliceString(o.from,n);if(!e.some(A=>A.test(f)))return s;let{state:d}=s,a=-1,v=[];for(let{head:A}of d.selection.ranges){let P=d.doc.lineAt(A);if(P.from==a)continue;a=P.from;let L=jx(d,P.from);if(L==null)continue;let j=/^\s*/.exec(P.text)[0],F=fy(d,L);j!=F&&v.push({from:P.from,to:P.from+j.length,insert:F})}return v.length?[s,{changes:v,sequential:!0}]:s})}const BP=Ut.define(),OT=new ki;function NP(s){let e=s.firstChild,t=s.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?s.to:t.from}:null}function FP(s,e,t){let n=Qr(s);if(n.length<t)return null;let o=n.resolveStack(t,1),f=null;for(let d=o;d;d=d.next){let a=d.node;if(a.to<=t||a.from>t)continue;if(f&&a.from<e)break;let v=a.type.prop(OT);if(v&&(a.to<n.length-50||n.length==s.doc.length||!jP(a))){let A=v(a,s);A&&A.from<=t&&A.from>=e&&A.to>t&&(f=A)}}return f}function jP(s){let e=s.lastChild;return e&&e.to==s.to&&e.type.isError}function w0(s,e,t){for(let n of s.facet(BP)){let o=n(s,e,t);if(o)return o}return FP(s,e,t)}function DT(s,e){let t=e.mapPos(s.from,1),n=e.mapPos(s.to,-1);return t>=n?void 0:{from:t,to:n}}const X0=xi.define({map:DT}),Cy=xi.define({map:DT});function RT(s){let e=[];for(let{head:t}of s.state.selection.ranges)e.some(n=>n.from<=t&&n.to>=t)||e.push(s.lineBlockAt(t));return e}const Gd=zr.define({create(){return ni.none},update(s,e){s=s.map(e.changes);for(let t of e.effects)if(t.is(X0)&&!VP(s,t.value.from,t.value.to)){let{preparePlaceholder:n}=e.state.facet(LT),o=n?ni.replace({widget:new XP(n(e.state,t.value))}):Lw;s=s.update({add:[o.range(t.value.from,t.value.to)]})}else t.is(Cy)&&(s=s.update({filter:(n,o)=>t.value.from!=n||t.value.to!=o,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:n}=e.selection.main;s.between(n,n,(o,f)=>{o<n&&f>n&&(t=!0)}),t&&(s=s.update({filterFrom:n,filterTo:n,filter:(o,f)=>f<=n||o>=n}))}return s},provide:s=>Bt.decorations.from(s),toJSON(s,e){let t=[];return s.between(0,e.doc.length,(n,o)=>{t.push(n,o)}),t},fromJSON(s){if(!Array.isArray(s)||s.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<s.length;){let n=s[t++],o=s[t++];if(typeof n!="number"||typeof o!="number")throw new RangeError("Invalid JSON for fold state");e.push(Lw.range(n,o))}return ni.set(e,!0)}});function S0(s,e,t){var n;let o=null;return(n=s.field(Gd,!1))===null||n===void 0||n.between(e,t,(f,d)=>{(!o||o.from>f)&&(o={from:f,to:d})}),o}function VP(s,e,t){let n=!1;return s.between(e,e,(o,f)=>{o==e&&f==t&&(n=!0)}),n}function IT(s,e){return s.field(Gd,!1)?e:e.concat(xi.appendConfig.of(BT()))}const UP=s=>{for(let e of RT(s)){let t=w0(s.state,e.from,e.to);if(t)return s.dispatch({effects:IT(s.state,[X0.of(t),zT(s,t)])}),!0}return!1},qP=s=>{if(!s.state.field(Gd,!1))return!1;let e=[];for(let t of RT(s)){let n=S0(s.state,t.from,t.to);n&&e.push(Cy.of(n),zT(s,n,!1))}return e.length&&s.dispatch({effects:e}),e.length>0};function zT(s,e,t=!0){let n=s.state.doc.lineAt(e.from).number,o=s.state.doc.lineAt(e.to).number;return Bt.announce.of(`${s.state.phrase(t?"Folded lines":"Unfolded lines")} ${n} ${s.state.phrase("to")} ${o}.`)}const HP=s=>{let{state:e}=s,t=[];for(let n=0;n<e.doc.length;){let o=s.lineBlockAt(n),f=w0(e,o.from,o.to);f&&t.push(X0.of(f)),n=(f?s.lineBlockAt(f.to):o).to+1}return t.length&&s.dispatch({effects:IT(s.state,t)}),!!t.length},ZP=s=>{let e=s.state.field(Gd,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,s.state.doc.length,(n,o)=>{t.push(Cy.of({from:n,to:o}))}),s.dispatch({effects:t}),!0},GP=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:UP},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:qP},{key:"Ctrl-Alt-[",run:HP},{key:"Ctrl-Alt-]",run:ZP}],$P={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},LT=Ut.define({combine(s){return Wc(s,$P)}});function BT(s){return[Gd,KP]}function NT(s,e){let{state:t}=s,n=t.facet(LT),o=d=>{let a=s.lineBlockAt(s.posAtDOM(d.target)),v=S0(s.state,a.from,a.to);v&&s.dispatch({effects:Cy.of(v)}),d.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(s,o,e);let f=document.createElement("span");return f.textContent=n.placeholderText,f.setAttribute("aria-label",t.phrase("folded code")),f.title=t.phrase("unfold"),f.className="cm-foldPlaceholder",f.onclick=o,f}const Lw=ni.replace({widget:new class extends rh{toDOM(s){return NT(s,null)}}});class XP extends rh{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return NT(e,this.value)}}const QP={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Xb extends nh{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function WP(s={}){let e=Object.assign(Object.assign({},QP),s),t=new Xb(e,!0),n=new Xb(e,!1),o=ks.fromClass(class{constructor(d){this.from=d.viewport.from,this.markers=this.buildMarkers(d)}update(d){(d.docChanged||d.viewportChanged||d.startState.facet(Mf)!=d.state.facet(Mf)||d.startState.field(Gd,!1)!=d.state.field(Gd,!1)||Qr(d.startState)!=Qr(d.state)||e.foldingChanged(d))&&(this.markers=this.buildMarkers(d.view))}buildMarkers(d){let a=new vf;for(let v of d.viewportLineBlocks){let A=S0(d.state,v.from,v.to)?n:w0(d.state,v.from,v.to)?t:null;A&&a.add(v.from,v.from,A)}return a.finish()}}),{domEventHandlers:f}=e;return[o,KE({class:"cm-foldGutter",markers(d){var a;return((a=d.plugin(o))===null||a===void 0?void 0:a.markers)||qi.empty},initialSpacer(){return new Xb(e,!1)},domEventHandlers:Object.assign(Object.assign({},f),{click:(d,a,v)=>{if(f.click&&f.click(d,a,v))return!0;let A=S0(d.state,a.from,a.to);if(A)return d.dispatch({effects:Cy.of(A)}),!0;let P=w0(d.state,a.from,a.to);return P?(d.dispatch({effects:X0.of(P)}),!0):!1}})}),BT()]}const KP=Bt.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Rm{constructor(e,t){this.specs=e;let n;function o(a){let v=xf.newName();return(n||(n=Object.create(null)))["."+v]=a,v}const f=typeof t.all=="string"?t.all:t.all?o(t.all):void 0,d=t.scope;this.scope=d instanceof Jl?a=>a.prop(rm)==d.data:d?a=>a==d:void 0,this.style=CT(e.map(a=>({tag:a.tag,class:a.class||o(Object.assign({},a,{tag:null}))})),{all:f}).style,this.module=n?new xf(n):null,this.themeType=t.themeType}static define(e,t){return new Rm(e,t||{})}}const ex=Ut.define(),FT=Ut.define({combine(s){return s.length?[s[0]]:null}});function Qb(s){let e=s.facet(ex);return e.length?e:s.facet(FT)}function Ux(s,e){let t=[JP],n;return s instanceof Rm&&(s.module&&t.push(Bt.styleModule.of(s.module)),n=s.themeType),e!=null&&e.fallback?t.push(FT.of(s)):n?t.push(ex.computeN([Bt.darkTheme],o=>o.facet(Bt.darkTheme)==(n=="dark")?[s]:[])):t.push(ex.of(s)),t}class YP{constructor(e){this.markCache=Object.create(null),this.tree=Qr(e.state),this.decorations=this.buildDeco(e,Qb(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=Qr(e.state),n=Qb(e.state),o=n!=Qb(e.startState),{viewport:f}=e.view,d=e.changes.mapPos(this.decoratedTo,1);t.length<f.to&&!o&&t.type==this.tree.type&&d>=f.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=d):(t!=this.tree||e.viewportChanged||o)&&(this.tree=t,this.decorations=this.buildDeco(e.view,n),this.decoratedTo=f.to)}buildDeco(e,t){if(!t||!this.tree.length)return ni.none;let n=new vf;for(let{from:o,to:f}of e.visibleRanges)vP(this.tree,t,(d,a,v)=>{n.add(d,a,this.markCache[v]||(this.markCache[v]=ni.mark({class:v})))},o,f);return n.finish()}}const JP=Xd.high(ks.fromClass(YP,{decorations:s=>s.decorations})),eO=Rm.define([{tag:me.meta,color:"#404740"},{tag:me.link,textDecoration:"underline"},{tag:me.heading,textDecoration:"underline",fontWeight:"bold"},{tag:me.emphasis,fontStyle:"italic"},{tag:me.strong,fontWeight:"bold"},{tag:me.strikethrough,textDecoration:"line-through"},{tag:me.keyword,color:"#708"},{tag:[me.atom,me.bool,me.url,me.contentSeparator,me.labelName],color:"#219"},{tag:[me.literal,me.inserted],color:"#164"},{tag:[me.string,me.deleted],color:"#a11"},{tag:[me.regexp,me.escape,me.special(me.string)],color:"#e40"},{tag:me.definition(me.variableName),color:"#00f"},{tag:me.local(me.variableName),color:"#30a"},{tag:[me.typeName,me.namespace],color:"#085"},{tag:me.className,color:"#167"},{tag:[me.special(me.variableName),me.macroName],color:"#256"},{tag:me.definition(me.propertyName),color:"#00c"},{tag:me.comment,color:"#940"},{tag:me.invalid,color:"#f00"}]),tO=Bt.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),jT=1e4,VT="()[]{}",UT=Ut.define({combine(s){return Wc(s,{afterCursor:!0,brackets:VT,maxScanDistance:jT,renderMatch:sO})}}),iO=ni.mark({class:"cm-matchingBracket"}),nO=ni.mark({class:"cm-nonmatchingBracket"});function sO(s){let e=[],t=s.matched?iO:nO;return e.push(t.range(s.start.from,s.start.to)),s.end&&e.push(t.range(s.end.from,s.end.to)),e}const rO=zr.define({create(){return ni.none},update(s,e){if(!e.docChanged&&!e.selection)return s;let t=[],n=e.state.facet(UT);for(let o of e.state.selection.ranges){if(!o.empty)continue;let f=qc(e.state,o.head,-1,n)||o.head>0&&qc(e.state,o.head-1,1,n)||n.afterCursor&&(qc(e.state,o.head,1,n)||o.head<e.state.doc.length&&qc(e.state,o.head+1,-1,n));f&&(t=t.concat(n.renderMatch(f,e.state)))}return ni.set(t,!0)},provide:s=>Bt.decorations.from(s)}),oO=[rO,tO];function aO(s={}){return[UT.of(s),oO]}const lO=new ki;function tx(s,e,t){let n=s.prop(e<0?ki.openedBy:ki.closedBy);if(n)return n;if(s.name.length==1){let o=t.indexOf(s.name);if(o>-1&&o%2==(e<0?1:0))return[t[o+e]]}return null}function ix(s){let e=s.type.prop(lO);return e?e(s.node):s}function qc(s,e,t,n={}){let o=n.maxScanDistance||jT,f=n.brackets||VT,d=Qr(s),a=d.resolveInner(e,t);for(let v=a;v;v=v.parent){let A=tx(v.type,t,f);if(A&&v.from<v.to){let P=ix(v);if(P&&(t>0?e>=P.from&&e<P.to:e>P.from&&e<=P.to))return cO(s,e,t,v,P,A,f)}}return uO(s,e,t,d,a.type,o,f)}function cO(s,e,t,n,o,f,d){let a=n.parent,v={from:o.from,to:o.to},A=0,P=a==null?void 0:a.cursor();if(P&&(t<0?P.childBefore(n.from):P.childAfter(n.to)))do if(t<0?P.to<=n.from:P.from>=n.to){if(A==0&&f.indexOf(P.type.name)>-1&&P.from<P.to){let L=ix(P);return{start:v,end:L?{from:L.from,to:L.to}:void 0,matched:!0}}else if(tx(P.type,t,d))A++;else if(tx(P.type,-t,d)){if(A==0){let L=ix(P);return{start:v,end:L&&L.from<L.to?{from:L.from,to:L.to}:void 0,matched:!1}}A--}}while(t<0?P.prevSibling():P.nextSibling());return{start:v,matched:!1}}function uO(s,e,t,n,o,f,d){let a=t<0?s.sliceDoc(e-1,e):s.sliceDoc(e,e+1),v=d.indexOf(a);if(v<0||v%2==0!=t>0)return null;let A={from:t<0?e-1:e,to:t>0?e+1:e},P=s.doc.iterRange(e,t>0?s.doc.length:0),L=0;for(let j=0;!P.next().done&&j<=f;){let F=P.value;t<0&&(j+=F.length);let K=e+j*t;for(let se=t>0?0:F.length-1,le=t>0?F.length:-1;se!=le;se+=t){let ve=d.indexOf(F[se]);if(!(ve<0||n.resolveInner(K+se,1).type!=o))if(ve%2==0==t>0)L++;else{if(L==1)return{start:A,end:{from:K+se,to:K+se+1},matched:ve>>1==v>>1};L--}}t>0&&(j+=F.length)}return P.done?{start:A,matched:!1}:null}const hO=Object.create(null),Bw=[Vo.none],Nw=[],Fw=Object.create(null),fO=Object.create(null);for(let[s,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])fO[s]=dO(hO,e);function Wb(s,e){Nw.indexOf(s)>-1||(Nw.push(s),console.warn(e))}function dO(s,e){let t=[];for(let a of e.split(" ")){let v=[];for(let A of a.split(".")){let P=s[A]||me[A];P?typeof P=="function"?v.length?v=v.map(P):Wb(A,`Modifier ${A} used at start of tag`):v.length?Wb(A,`Tag ${A} used as modifier`):v=Array.isArray(P)?P:[P]:Wb(A,`Unknown highlighting tag ${A}`)}for(let A of v)t.push(A)}if(!t.length)return 0;let n=e.replace(/ /g,"_"),o=n+" "+t.map(a=>a.id),f=Fw[o];if(f)return f.id;let d=Fw[o]=Vo.define({id:Bw.length,name:n,props:[TT({[n]:t})]});return Bw.push(d),d.id}jn.RTL,jn.LTR;const pO=s=>{let{state:e}=s,t=e.doc.lineAt(e.selection.main.from),n=Hx(s.state,t.from);return n.line?mO(s):n.block?yO(s):!1};function qx(s,e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let o=s(e,t);return o?(n(t.update(o)),!0):!1}}const mO=qx(vO,0),gO=qx(qT,0),yO=qx((s,e)=>qT(s,e,bO(e)),0);function Hx(s,e){let t=s.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const Vg=50;function _O(s,{open:e,close:t},n,o){let f=s.sliceDoc(n-Vg,n),d=s.sliceDoc(o,o+Vg),a=/\s*$/.exec(f)[0].length,v=/^\s*/.exec(d)[0].length,A=f.length-a;if(f.slice(A-e.length,A)==e&&d.slice(v,v+t.length)==t)return{open:{pos:n-a,margin:a&&1},close:{pos:o+v,margin:v&&1}};let P,L;o-n<=2*Vg?P=L=s.sliceDoc(n,o):(P=s.sliceDoc(n,n+Vg),L=s.sliceDoc(o-Vg,o));let j=/^\s*/.exec(P)[0].length,F=/\s*$/.exec(L)[0].length,K=L.length-F-t.length;return P.slice(j,j+e.length)==e&&L.slice(K,K+t.length)==t?{open:{pos:n+j+e.length,margin:/\s/.test(P.charAt(j+e.length))?1:0},close:{pos:o-F-t.length,margin:/\s/.test(L.charAt(K-1))?1:0}}:null}function bO(s){let e=[];for(let t of s.selection.ranges){let n=s.doc.lineAt(t.from),o=t.to<=n.to?n:s.doc.lineAt(t.to);o.from>n.from&&o.from==t.to&&(o=t.to==n.to+1?n:s.doc.lineAt(t.to-1));let f=e.length-1;f>=0&&e[f].to>n.from?e[f].to=o.to:e.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:o.to})}return e}function qT(s,e,t=e.selection.ranges){let n=t.map(f=>Hx(e,f.from).block);if(!n.every(f=>f))return null;let o=t.map((f,d)=>_O(e,n[d],f.from,f.to));if(s!=2&&!o.every(f=>f))return{changes:e.changes(t.map((f,d)=>o[d]?[]:[{from:f.from,insert:n[d].open+" "},{from:f.to,insert:" "+n[d].close}]))};if(s!=1&&o.some(f=>f)){let f=[];for(let d=0,a;d<o.length;d++)if(a=o[d]){let v=n[d],{open:A,close:P}=a;f.push({from:A.pos-v.open.length,to:A.pos+A.margin},{from:P.pos-P.margin,to:P.pos+v.close.length})}return{changes:f}}return null}function vO(s,e,t=e.selection.ranges){let n=[],o=-1;for(let{from:f,to:d}of t){let a=n.length,v=1e9,A=Hx(e,f).line;if(A){for(let P=f;P<=d;){let L=e.doc.lineAt(P);if(L.from>o&&(f==d||d>L.from)){o=L.from;let j=/^\s*/.exec(L.text)[0].length,F=j==L.length,K=L.text.slice(j,j+A.length)==A?j:-1;j<L.text.length&&j<v&&(v=j),n.push({line:L,comment:K,token:A,indent:j,empty:F,single:!1})}P=L.to+1}if(v<1e9)for(let P=a;P<n.length;P++)n[P].indent<n[P].line.text.length&&(n[P].indent=v);n.length==a+1&&(n[a].single=!0)}}if(s!=2&&n.some(f=>f.comment<0&&(!f.empty||f.single))){let f=[];for(let{line:a,token:v,indent:A,empty:P,single:L}of n)(L||!P)&&f.push({from:a.from+A,insert:v+" "});let d=e.changes(f);return{changes:d,selection:e.selection.map(d,1)}}else if(s!=1&&n.some(f=>f.comment>=0)){let f=[];for(let{line:d,comment:a,token:v}of n)if(a>=0){let A=d.from+a,P=A+v.length;d.text[P-d.from]==" "&&P++,f.push({from:A,to:P})}return{changes:f}}return null}const nx=Qc.define(),xO=Qc.define(),wO=Ut.define(),HT=Ut.define({combine(s){return Wc(s,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(n,o)=>e(n,o)||t(n,o)})}}),ZT=zr.define({create(){return Hc.empty},update(s,e){let t=e.state.facet(HT),n=e.annotation(nx);if(n){let v=jo.fromTransaction(e,n.selection),A=n.side,P=A==0?s.undone:s.done;return v?P=T0(P,P.length,t.minDepth,v):P=XT(P,e.startState.selection),new Hc(A==0?n.rest:P,A==0?P:n.rest)}let o=e.annotation(xO);if((o=="full"||o=="before")&&(s=s.isolate()),e.annotation(er.addToHistory)===!1)return e.changes.empty?s:s.addMapping(e.changes.desc);let f=jo.fromTransaction(e),d=e.annotation(er.time),a=e.annotation(er.userEvent);return f?s=s.addChanges(f,d,a,t,e):e.selection&&(s=s.addSelection(e.startState.selection,d,a,t.newGroupDelay)),(o=="full"||o=="after")&&(s=s.isolate()),s},toJSON(s){return{done:s.done.map(e=>e.toJSON()),undone:s.undone.map(e=>e.toJSON())}},fromJSON(s){return new Hc(s.done.map(jo.fromJSON),s.undone.map(jo.fromJSON))}});function SO(s={}){return[ZT,HT.of(s),Bt.domEventHandlers({beforeinput(e,t){let n=e.inputType=="historyUndo"?GT:e.inputType=="historyRedo"?sx:null;return n?(e.preventDefault(),n(t)):!1}})]}function Q0(s,e){return function({state:t,dispatch:n}){if(!e&&t.readOnly)return!1;let o=t.field(ZT,!1);if(!o)return!1;let f=o.pop(s,t,e);return f?(n(f),!0):!1}}const GT=Q0(0,!1),sx=Q0(1,!1),TO=Q0(0,!0),MO=Q0(1,!0);class jo{constructor(e,t,n,o,f){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=o,this.selectionsAfter=f}setSelAfter(e){return new jo(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(e){return new jo(e.changes&&Js.fromJSON(e.changes),[],e.mapped&&Zc.fromJSON(e.mapped),e.startSelection&&yt.fromJSON(e.startSelection),e.selectionsAfter.map(yt.fromJSON))}static fromTransaction(e,t){let n=ol;for(let o of e.startState.facet(wO)){let f=o(e);f.length&&(n=n.concat(f))}return!n.length&&e.changes.empty?null:new jo(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,ol)}static selection(e){return new jo(void 0,ol,void 0,void 0,e)}}function T0(s,e,t,n){let o=e+1>t+20?e-t-1:0,f=s.slice(o,e);return f.push(n),f}function CO(s,e){let t=[],n=!1;return s.iterChangedRanges((o,f)=>t.push(o,f)),e.iterChangedRanges((o,f,d,a)=>{for(let v=0;v<t.length;){let A=t[v++],P=t[v++];a>=A&&d<=P&&(n=!0)}}),n}function AO(s,e){return s.ranges.length==e.ranges.length&&s.ranges.filter((t,n)=>t.empty!=e.ranges[n].empty).length===0}function $T(s,e){return s.length?e.length?s.concat(e):s:e}const ol=[],kO=200;function XT(s,e){if(s.length){let t=s[s.length-1],n=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-kO));return n.length&&n[n.length-1].eq(e)?s:(n.push(e),T0(s,s.length-1,1e9,t.setSelAfter(n)))}else return[jo.selection([e])]}function EO(s){let e=s[s.length-1],t=s.slice();return t[s.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Kb(s,e){if(!s.length)return s;let t=s.length,n=ol;for(;t;){let o=PO(s[t-1],e,n);if(o.changes&&!o.changes.empty||o.effects.length){let f=s.slice(0,t);return f[t-1]=o,f}else e=o.mapped,t--,n=o.selectionsAfter}return n.length?[jo.selection(n)]:ol}function PO(s,e,t){let n=$T(s.selectionsAfter.length?s.selectionsAfter.map(a=>a.map(e)):ol,t);if(!s.changes)return jo.selection(n);let o=s.changes.map(e),f=e.mapDesc(s.changes,!0),d=s.mapped?s.mapped.composeDesc(f):f;return new jo(o,xi.mapEffects(s.effects,e),d,s.startSelection.map(f),n)}const OO=/^(input\.type|delete)($|\.)/;class Hc{constructor(e,t,n=0,o=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=o}isolate(){return this.prevTime?new Hc(this.done,this.undone):this}addChanges(e,t,n,o,f){let d=this.done,a=d[d.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!n||OO.test(n))&&(!a.selectionsAfter.length&&t-this.prevTime<o.newGroupDelay&&o.joinToEvent(f,CO(a.changes,e.changes))||n=="input.type.compose")?d=T0(d,d.length-1,o.minDepth,new jo(e.changes.compose(a.changes),$T(xi.mapEffects(e.effects,a.changes),a.effects),a.mapped,a.startSelection,ol)):d=T0(d,d.length,o.minDepth,e),new Hc(d,ol,t,n)}addSelection(e,t,n,o){let f=this.done.length?this.done[this.done.length-1].selectionsAfter:ol;return f.length>0&&t-this.prevTime<o&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&AO(f[f.length-1],e)?this:new Hc(XT(this.done,e),this.undone,t,n)}addMapping(e){return new Hc(Kb(this.done,e),Kb(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let o=e==0?this.done:this.undone;if(o.length==0)return null;let f=o[o.length-1],d=f.selectionsAfter[0]||t.selection;if(n&&f.selectionsAfter.length)return t.update({selection:f.selectionsAfter[f.selectionsAfter.length-1],annotations:nx.of({side:e,rest:EO(o),selection:d}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(f.changes){let a=o.length==1?ol:o.slice(0,o.length-1);return f.mapped&&(a=Kb(a,f.mapped)),t.update({changes:f.changes,selection:f.startSelection,effects:f.effects,annotations:nx.of({side:e,rest:a,selection:d}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Hc.empty=new Hc(ol,ol);const DO=[{key:"Mod-z",run:GT,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:sx,preventDefault:!0},{linux:"Ctrl-Shift-z",run:sx,preventDefault:!0},{key:"Mod-u",run:TO,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:MO,preventDefault:!0}];function Im(s,e){return yt.create(s.ranges.map(e),s.mainIndex)}function Kc(s,e){return s.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function ic({state:s,dispatch:e},t){let n=Im(s.selection,t);return n.eq(s.selection,!0)?!1:(e(Kc(s,n)),!0)}function W0(s,e){return yt.cursor(e?s.to:s.from)}function QT(s,e){return ic(s,t=>t.empty?s.moveByChar(t,e):W0(t,e))}function Wr(s){return s.textDirectionAt(s.state.selection.main.head)==jn.LTR}const WT=s=>QT(s,!Wr(s)),KT=s=>QT(s,Wr(s));function YT(s,e){return ic(s,t=>t.empty?s.moveByGroup(t,e):W0(t,e))}const RO=s=>YT(s,!Wr(s)),IO=s=>YT(s,Wr(s));function zO(s,e,t){if(e.type.prop(t))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(s.sliceDoc(e.from,e.to)))||e.firstChild}function K0(s,e,t){let n=Qr(s).resolveInner(e.head),o=t?ki.closedBy:ki.openedBy;for(let v=e.head;;){let A=t?n.childAfter(v):n.childBefore(v);if(!A)break;zO(s,A,o)?n=A:v=t?A.to:A.from}let f=n.type.prop(o),d,a;return f&&(d=t?qc(s,n.from,1):qc(s,n.to,-1))&&d.matched?a=t?d.end.to:d.end.from:a=t?n.to:n.from,yt.cursor(a,t?-1:1)}const LO=s=>ic(s,e=>K0(s.state,e,!Wr(s))),BO=s=>ic(s,e=>K0(s.state,e,Wr(s)));function JT(s,e){return ic(s,t=>{if(!t.empty)return W0(t,e);let n=s.moveVertically(t,e);return n.head!=t.head?n:s.moveToLineBoundary(t,e)})}const eM=s=>JT(s,!1),tM=s=>JT(s,!0);function iM(s){let e=s.scrollDOM.clientHeight<s.scrollDOM.scrollHeight-2,t=0,n=0,o;if(e){for(let f of s.state.facet(Bt.scrollMargins)){let d=f(s);d!=null&&d.top&&(t=Math.max(d==null?void 0:d.top,t)),d!=null&&d.bottom&&(n=Math.max(d==null?void 0:d.bottom,n))}o=s.scrollDOM.clientHeight-t-n}else o=(s.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:n,selfScroll:e,height:Math.max(s.defaultLineHeight,o-5)}}function nM(s,e){let t=iM(s),{state:n}=s,o=Im(n.selection,d=>d.empty?s.moveVertically(d,e,t.height):W0(d,e));if(o.eq(n.selection))return!1;let f;if(t.selfScroll){let d=s.coordsAtPos(n.selection.main.head),a=s.scrollDOM.getBoundingClientRect(),v=a.top+t.marginTop,A=a.bottom-t.marginBottom;d&&d.top>v&&d.bottom<A&&(f=Bt.scrollIntoView(o.main.head,{y:"start",yMargin:d.top-v}))}return s.dispatch(Kc(n,o),{effects:f}),!0}const jw=s=>nM(s,!1),rx=s=>nM(s,!0);function kf(s,e,t){let n=s.lineBlockAt(e.head),o=s.moveToLineBoundary(e,t);if(o.head==e.head&&o.head!=(t?n.to:n.from)&&(o=s.moveToLineBoundary(e,t,!1)),!t&&o.head==n.from&&n.length){let f=/^\s*/.exec(s.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;f&&e.head!=n.from+f&&(o=yt.cursor(n.from+f))}return o}const NO=s=>ic(s,e=>kf(s,e,!0)),FO=s=>ic(s,e=>kf(s,e,!1)),jO=s=>ic(s,e=>kf(s,e,!Wr(s))),VO=s=>ic(s,e=>kf(s,e,Wr(s))),UO=s=>ic(s,e=>yt.cursor(s.lineBlockAt(e.head).from,1)),qO=s=>ic(s,e=>yt.cursor(s.lineBlockAt(e.head).to,-1));function HO(s,e,t){let n=!1,o=Im(s.selection,f=>{let d=qc(s,f.head,-1)||qc(s,f.head,1)||f.head>0&&qc(s,f.head-1,1)||f.head<s.doc.length&&qc(s,f.head+1,-1);if(!d||!d.end)return f;n=!0;let a=d.start.from==f.head?d.end.to:d.end.from;return yt.cursor(a)});return n?(e(Kc(s,o)),!0):!1}const ZO=({state:s,dispatch:e})=>HO(s,e);function fl(s,e){let t=Im(s.state.selection,n=>{let o=e(n);return yt.range(n.anchor,o.head,o.goalColumn,o.bidiLevel||void 0)});return t.eq(s.state.selection)?!1:(s.dispatch(Kc(s.state,t)),!0)}function sM(s,e){return fl(s,t=>s.moveByChar(t,e))}const rM=s=>sM(s,!Wr(s)),oM=s=>sM(s,Wr(s));function aM(s,e){return fl(s,t=>s.moveByGroup(t,e))}const GO=s=>aM(s,!Wr(s)),$O=s=>aM(s,Wr(s)),XO=s=>fl(s,e=>K0(s.state,e,!Wr(s))),QO=s=>fl(s,e=>K0(s.state,e,Wr(s)));function lM(s,e){return fl(s,t=>s.moveVertically(t,e))}const cM=s=>lM(s,!1),uM=s=>lM(s,!0);function hM(s,e){return fl(s,t=>s.moveVertically(t,e,iM(s).height))}const Vw=s=>hM(s,!1),Uw=s=>hM(s,!0),WO=s=>fl(s,e=>kf(s,e,!0)),KO=s=>fl(s,e=>kf(s,e,!1)),YO=s=>fl(s,e=>kf(s,e,!Wr(s))),JO=s=>fl(s,e=>kf(s,e,Wr(s))),eD=s=>fl(s,e=>yt.cursor(s.lineBlockAt(e.head).from)),tD=s=>fl(s,e=>yt.cursor(s.lineBlockAt(e.head).to)),qw=({state:s,dispatch:e})=>(e(Kc(s,{anchor:0})),!0),Hw=({state:s,dispatch:e})=>(e(Kc(s,{anchor:s.doc.length})),!0),Zw=({state:s,dispatch:e})=>(e(Kc(s,{anchor:s.selection.main.anchor,head:0})),!0),Gw=({state:s,dispatch:e})=>(e(Kc(s,{anchor:s.selection.main.anchor,head:s.doc.length})),!0),iD=({state:s,dispatch:e})=>(e(s.update({selection:{anchor:0,head:s.doc.length},userEvent:"select"})),!0),nD=({state:s,dispatch:e})=>{let t=Y0(s).map(({from:n,to:o})=>yt.range(n,Math.min(o+1,s.doc.length)));return e(s.update({selection:yt.create(t),userEvent:"select"})),!0},sD=({state:s,dispatch:e})=>{let t=Im(s.selection,n=>{let o=Qr(s),f=o.resolveStack(n.from,1);if(n.empty){let d=o.resolveStack(n.from,-1);d.node.from>=f.node.from&&d.node.to<=f.node.to&&(f=d)}for(let d=f;d;d=d.next){let{node:a}=d;if((a.from<n.from&&a.to>=n.to||a.to>n.to&&a.from<=n.from)&&d.next)return yt.range(a.to,a.from)}return n});return t.eq(s.selection)?!1:(e(Kc(s,t)),!0)},rD=({state:s,dispatch:e})=>{let t=s.selection,n=null;return t.ranges.length>1?n=yt.create([t.main]):t.main.empty||(n=yt.create([yt.cursor(t.main.head)])),n?(e(Kc(s,n)),!0):!1};function Ay(s,e){if(s.state.readOnly)return!1;let t="delete.selection",{state:n}=s,o=n.changeByRange(f=>{let{from:d,to:a}=f;if(d==a){let v=e(f);v<d?(t="delete.backward",v=z_(s,v,!1)):v>d&&(t="delete.forward",v=z_(s,v,!0)),d=Math.min(d,v),a=Math.max(a,v)}else d=z_(s,d,!1),a=z_(s,a,!0);return d==a?{range:f}:{changes:{from:d,to:a},range:yt.cursor(d,d<f.head?-1:1)}});return o.changes.empty?!1:(s.dispatch(n.update(o,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?Bt.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function z_(s,e,t){if(s instanceof Bt)for(let n of s.state.facet(Bt.atomicRanges).map(o=>o(s)))n.between(e,e,(o,f)=>{o<e&&f>e&&(e=t?f:o)});return e}const fM=(s,e,t)=>Ay(s,n=>{let o=n.from,{state:f}=s,d=f.doc.lineAt(o),a,v;if(t&&!e&&o>d.from&&o<d.from+200&&!/[^ \t]/.test(a=d.text.slice(0,o-d.from))){if(a[a.length-1]=="	")return o-1;let A=Dm(a,f.tabSize),P=A%x0(f)||x0(f);for(let L=0;L<P&&a[a.length-1-L]==" ";L++)o--;v=o}else v=Ir(d.text,o-d.from,e,e)+d.from,v==o&&d.number!=(e?f.doc.lines:1)?v+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(d.text.slice(v-d.from,o-d.from))&&(v=Ir(d.text,v-d.from,!1,!1)+d.from);return v}),ox=s=>fM(s,!1,!0),dM=s=>fM(s,!0,!1),pM=(s,e)=>Ay(s,t=>{let n=t.head,{state:o}=s,f=o.doc.lineAt(n),d=o.charCategorizer(n);for(let a=null;;){if(n==(e?f.to:f.from)){n==t.head&&f.number!=(e?o.doc.lines:1)&&(n+=e?1:-1);break}let v=Ir(f.text,n-f.from,e)+f.from,A=f.text.slice(Math.min(n,v)-f.from,Math.max(n,v)-f.from),P=d(A);if(a!=null&&P!=a)break;(A!=" "||n!=t.head)&&(a=P),n=v}return n}),mM=s=>pM(s,!1),oD=s=>pM(s,!0),aD=s=>Ay(s,e=>{let t=s.lineBlockAt(e.head).to;return e.head<t?t:Math.min(s.state.doc.length,e.head+1)}),lD=s=>Ay(s,e=>{let t=s.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),cD=s=>Ay(s,e=>{let t=s.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(s.state.doc.length,e.head+1)}),uD=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let t=s.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:Qi.of(["",""])},range:yt.cursor(n.from)}));return e(s.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},hD=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let t=s.changeByRange(n=>{if(!n.empty||n.from==0||n.from==s.doc.length)return{range:n};let o=n.from,f=s.doc.lineAt(o),d=o==f.from?o-1:Ir(f.text,o-f.from,!1)+f.from,a=o==f.to?o+1:Ir(f.text,o-f.from,!0)+f.from;return{changes:{from:d,to:a,insert:s.doc.slice(o,a).append(s.doc.slice(d,o))},range:yt.cursor(a)}});return t.changes.empty?!1:(e(s.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Y0(s){let e=[],t=-1;for(let n of s.selection.ranges){let o=s.doc.lineAt(n.from),f=s.doc.lineAt(n.to);if(!n.empty&&n.to==f.from&&(f=s.doc.lineAt(n.to-1)),t>=o.number){let d=e[e.length-1];d.to=f.to,d.ranges.push(n)}else e.push({from:o.from,to:f.to,ranges:[n]});t=f.number+1}return e}function gM(s,e,t){if(s.readOnly)return!1;let n=[],o=[];for(let f of Y0(s)){if(t?f.to==s.doc.length:f.from==0)continue;let d=s.doc.lineAt(t?f.to+1:f.from-1),a=d.length+1;if(t){n.push({from:f.to,to:d.to},{from:f.from,insert:d.text+s.lineBreak});for(let v of f.ranges)o.push(yt.range(Math.min(s.doc.length,v.anchor+a),Math.min(s.doc.length,v.head+a)))}else{n.push({from:d.from,to:f.from},{from:f.to,insert:s.lineBreak+d.text});for(let v of f.ranges)o.push(yt.range(v.anchor-a,v.head-a))}}return n.length?(e(s.update({changes:n,scrollIntoView:!0,selection:yt.create(o,s.selection.mainIndex),userEvent:"move.line"})),!0):!1}const fD=({state:s,dispatch:e})=>gM(s,e,!1),dD=({state:s,dispatch:e})=>gM(s,e,!0);function yM(s,e,t){if(s.readOnly)return!1;let n=[];for(let o of Y0(s))t?n.push({from:o.from,insert:s.doc.slice(o.from,o.to)+s.lineBreak}):n.push({from:o.to,insert:s.lineBreak+s.doc.slice(o.from,o.to)});return e(s.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const pD=({state:s,dispatch:e})=>yM(s,e,!1),mD=({state:s,dispatch:e})=>yM(s,e,!0),gD=s=>{if(s.state.readOnly)return!1;let{state:e}=s,t=e.changes(Y0(e).map(({from:o,to:f})=>(o>0?o--:f<e.doc.length&&f++,{from:o,to:f}))),n=Im(e.selection,o=>{let f;if(s.lineWrapping){let d=s.lineBlockAt(o.head),a=s.coordsAtPos(o.head,o.assoc||1);a&&(f=d.bottom+s.documentTop-a.bottom+s.defaultLineHeight/2)}return s.moveVertically(o,!0,f)}).map(t);return s.dispatch({changes:t,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function yD(s,e){if(/\(\)|\[\]|\{\}/.test(s.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=Qr(s).resolveInner(e),n=t.childBefore(e),o=t.childAfter(e),f;return n&&o&&n.to<=e&&o.from>=e&&(f=n.type.prop(ki.closedBy))&&f.indexOf(o.name)>-1&&s.doc.lineAt(n.to).from==s.doc.lineAt(o.from).from&&!/\S/.test(s.sliceDoc(n.to,o.from))?{from:n.to,to:o.from}:null}const $w=_M(!1),_D=_M(!0);function _M(s){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>{let{from:f,to:d}=o,a=e.doc.lineAt(f),v=!s&&f==d&&yD(e,f);s&&(f=d=(d<=a.to?a:e.doc.lineAt(d)).to);let A=new $0(e,{simulateBreak:f,simulateDoubleBreak:!!v}),P=jx(A,f);for(P==null&&(P=Dm(/^\s*/.exec(e.doc.lineAt(f).text)[0],e.tabSize));d<a.to&&/\s/.test(a.text[d-a.from]);)d++;v?{from:f,to:d}=v:f>a.from&&f<a.from+100&&!/\S/.test(a.text.slice(0,f))&&(f=a.from);let L=["",fy(e,P)];return v&&L.push(fy(e,A.lineIndent(a.from,-1))),{changes:{from:f,to:d,insert:Qi.of(L)},range:yt.cursor(f+1+L[1].length)}});return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function Zx(s,e){let t=-1;return s.changeByRange(n=>{let o=[];for(let d=n.from;d<=n.to;){let a=s.doc.lineAt(d);a.number>t&&(n.empty||n.to>a.from)&&(e(a,o,n),t=a.number),d=a.to+1}let f=s.changes(o);return{changes:o,range:yt.range(f.mapPos(n.anchor,1),f.mapPos(n.head,1))}})}const bD=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let t=Object.create(null),n=new $0(s,{overrideIndentation:f=>{let d=t[f];return d??-1}}),o=Zx(s,(f,d,a)=>{let v=jx(n,f.from);if(v==null)return;/\S/.test(f.text)||(v=0);let A=/^\s*/.exec(f.text)[0],P=fy(s,v);(A!=P||a.from<f.from+A.length)&&(t[f.from]=v,d.push({from:f.from,to:f.from+A.length,insert:P}))});return o.changes.empty||e(s.update(o,{userEvent:"indent"})),!0},bM=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(Zx(s,(t,n)=>{n.push({from:t.from,insert:s.facet(G0)})}),{userEvent:"input.indent"})),!0),vM=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(Zx(s,(t,n)=>{let o=/^\s*/.exec(t.text)[0];if(!o)return;let f=Dm(o,s.tabSize),d=0,a=fy(s,Math.max(0,f-x0(s)));for(;d<o.length&&d<a.length&&o.charCodeAt(d)==a.charCodeAt(d);)d++;n.push({from:t.from+d,to:t.from+o.length,insert:a.slice(d)})}),{userEvent:"delete.dedent"})),!0),vD=s=>(s.setTabFocusMode(),!0),xD=[{key:"Ctrl-b",run:WT,shift:rM,preventDefault:!0},{key:"Ctrl-f",run:KT,shift:oM},{key:"Ctrl-p",run:eM,shift:cM},{key:"Ctrl-n",run:tM,shift:uM},{key:"Ctrl-a",run:UO,shift:eD},{key:"Ctrl-e",run:qO,shift:tD},{key:"Ctrl-d",run:dM},{key:"Ctrl-h",run:ox},{key:"Ctrl-k",run:aD},{key:"Ctrl-Alt-h",run:mM},{key:"Ctrl-o",run:uD},{key:"Ctrl-t",run:hD},{key:"Ctrl-v",run:rx}],wD=[{key:"ArrowLeft",run:WT,shift:rM,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:RO,shift:GO,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:jO,shift:YO,preventDefault:!0},{key:"ArrowRight",run:KT,shift:oM,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:IO,shift:$O,preventDefault:!0},{mac:"Cmd-ArrowRight",run:VO,shift:JO,preventDefault:!0},{key:"ArrowUp",run:eM,shift:cM,preventDefault:!0},{mac:"Cmd-ArrowUp",run:qw,shift:Zw},{mac:"Ctrl-ArrowUp",run:jw,shift:Vw},{key:"ArrowDown",run:tM,shift:uM,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Hw,shift:Gw},{mac:"Ctrl-ArrowDown",run:rx,shift:Uw},{key:"PageUp",run:jw,shift:Vw},{key:"PageDown",run:rx,shift:Uw},{key:"Home",run:FO,shift:KO,preventDefault:!0},{key:"Mod-Home",run:qw,shift:Zw},{key:"End",run:NO,shift:WO,preventDefault:!0},{key:"Mod-End",run:Hw,shift:Gw},{key:"Enter",run:$w,shift:$w},{key:"Mod-a",run:iD},{key:"Backspace",run:ox,shift:ox},{key:"Delete",run:dM},{key:"Mod-Backspace",mac:"Alt-Backspace",run:mM},{key:"Mod-Delete",mac:"Alt-Delete",run:oD},{mac:"Mod-Backspace",run:lD},{mac:"Mod-Delete",run:cD}].concat(xD.map(s=>({mac:s.key,run:s.run,shift:s.shift}))),SD=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:LO,shift:XO},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:BO,shift:QO},{key:"Alt-ArrowUp",run:fD},{key:"Shift-Alt-ArrowUp",run:pD},{key:"Alt-ArrowDown",run:dD},{key:"Shift-Alt-ArrowDown",run:mD},{key:"Escape",run:rD},{key:"Mod-Enter",run:_D},{key:"Alt-l",mac:"Ctrl-l",run:nD},{key:"Mod-i",run:sD,preventDefault:!0},{key:"Mod-[",run:vM},{key:"Mod-]",run:bM},{key:"Mod-Alt-\\",run:bD},{key:"Shift-Mod-k",run:gD},{key:"Shift-Mod-\\",run:ZO},{key:"Mod-/",run:pO},{key:"Alt-A",run:gO},{key:"Ctrl-m",mac:"Shift-Alt-m",run:vD}].concat(wD),TD={key:"Tab",run:bM,shift:vM};function Dn(){var s=arguments[0];typeof s=="string"&&(s=document.createElement(s));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=t[n];typeof o=="string"?s.setAttribute(n,o):o!=null&&(s[n]=o)}e++}for(;e<arguments.length;e++)xM(s,arguments[e]);return s}function xM(s,e){if(typeof e=="string")s.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)s.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)xM(s,e[t]);else throw new RangeError("Unsupported child node: "+e)}const Xw=typeof String.prototype.normalize=="function"?s=>s.normalize("NFKD"):s=>s;class Cm{constructor(e,t,n=0,o=e.length,f,d){this.test=d,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,o),this.bufferStart=n,this.normalize=f?a=>f(Xw(a)):Xw,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Or(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=xx(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=rl(e);let o=this.normalize(t);for(let f=0,d=n;;f++){let a=o.charCodeAt(f),v=this.match(a,d,this.bufferPos+this.bufferStart);if(f==o.length-1){if(v)return this.value=v,this;break}d==n&&f<t.length&&t.charCodeAt(f)==a&&d++}}}match(e,t,n){let o=null;for(let f=0;f<this.matches.length;f+=2){let d=this.matches[f],a=!1;this.query.charCodeAt(d)==e&&(d==this.query.length-1?o={from:this.matches[f+1],to:n}:(this.matches[f]++,a=!0)),a||(this.matches.splice(f,2),f-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?o={from:t,to:n}:this.matches.push(1,t)),o&&this.test&&!this.test(o.from,o.to,this.buffer,this.bufferStart)&&(o=null),o}}typeof Symbol<"u"&&(Cm.prototype[Symbol.iterator]=function(){return this});const wM={from:-1,to:-1,match:/.*/.exec("")},Gx="gm"+(/x/.unicode==null?"":"u");class SM{constructor(e,t,n,o=0,f=e.length){if(this.text=e,this.to=f,this.curLine="",this.done=!1,this.value=wM,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new TM(e,t,n,o,f);this.re=new RegExp(t,Gx+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=e.iter();let d=e.lineAt(o);this.curLineStart=d.from,this.matchPos=M0(e,o),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,o=n+t[0].length;if(this.matchPos=M0(this.text,o+(n==o?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<o||n>this.value.to)&&(!this.test||this.test(n,o,t)))return this.value={from:n,to:o,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Yb=new WeakMap;class mm{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,n){let o=Yb.get(e);if(!o||o.from>=n||o.to<=t){let a=new mm(t,e.sliceString(t,n));return Yb.set(e,a),a}if(o.from==t&&o.to==n)return o;let{text:f,from:d}=o;return d>t&&(f=e.sliceString(t,d)+f,d=t),o.to<n&&(f+=e.sliceString(o.to,n)),Yb.set(e,new mm(d,f)),new mm(t,f.slice(t-d,n-d))}}class TM{constructor(e,t,n,o,f){this.text=e,this.to=f,this.done=!1,this.value=wM,this.matchPos=M0(e,o),this.re=new RegExp(t,Gx+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=mm.get(e,o,this.chunkEnd(o+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let n=this.flat.from+t.index,o=n+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,o,t)))return this.value={from:n,to:o,match:t},this.matchPos=M0(this.text,o+(n==o?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=mm.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(SM.prototype[Symbol.iterator]=TM.prototype[Symbol.iterator]=function(){return this});function MD(s){try{return new RegExp(s,Gx),!0}catch{return!1}}function M0(s,e){if(e>=s.length)return e;let t=s.lineAt(e),n;for(;e<t.to&&(n=t.text.charCodeAt(e-t.from))>=56320&&n<57344;)e++;return e}function ax(s){let e=String(s.state.doc.lineAt(s.state.selection.main.head).number),t=Dn("input",{class:"cm-textfield",name:"line",value:e}),n=Dn("form",{class:"cm-gotoLine",onkeydown:f=>{f.keyCode==27?(f.preventDefault(),s.dispatch({effects:C0.of(!1)}),s.focus()):f.keyCode==13&&(f.preventDefault(),o())},onsubmit:f=>{f.preventDefault(),o()}},Dn("label",s.state.phrase("Go to line"),": ",t)," ",Dn("button",{class:"cm-button",type:"submit"},s.state.phrase("go")));function o(){let f=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!f)return;let{state:d}=s,a=d.doc.lineAt(d.selection.main.head),[,v,A,P,L]=f,j=P?+P.slice(1):0,F=A?+A:a.number;if(A&&L){let le=F/100;v&&(le=le*(v=="-"?-1:1)+a.number/d.doc.lines),F=Math.round(d.doc.lines*le)}else A&&v&&(F=F*(v=="-"?-1:1)+a.number);let K=d.doc.line(Math.max(1,Math.min(d.doc.lines,F))),se=yt.cursor(K.from+Math.max(0,Math.min(j,K.length)));s.dispatch({effects:[C0.of(!1),Bt.scrollIntoView(se.from,{y:"center"})],selection:se}),s.focus()}return{dom:n}}const C0=xi.define(),Qw=zr.define({create(){return!0},update(s,e){for(let t of e.effects)t.is(C0)&&(s=t.value);return s},provide:s=>uy.from(s,e=>e?ax:null)}),CD=s=>{let e=cy(s,ax);if(!e){let t=[C0.of(!0)];s.state.field(Qw,!1)==null&&t.push(xi.appendConfig.of([Qw,AD])),s.dispatch({effects:t}),e=cy(s,ax)}return e&&e.dom.querySelector("input").select(),!0},AD=Bt.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),kD={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},ED=Ut.define({combine(s){return Wc(s,kD,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function PD(s){return[zD,ID]}const OD=ni.mark({class:"cm-selectionMatch"}),DD=ni.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Ww(s,e,t,n){return(t==0||s(e.sliceDoc(t-1,t))!=Qn.Word)&&(n==e.doc.length||s(e.sliceDoc(n,n+1))!=Qn.Word)}function RD(s,e,t,n){return s(e.sliceDoc(t,t+1))==Qn.Word&&s(e.sliceDoc(n-1,n))==Qn.Word}const ID=ks.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.selectionSet||s.docChanged||s.viewportChanged)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=s.state.facet(ED),{state:t}=s,n=t.selection;if(n.ranges.length>1)return ni.none;let o=n.main,f,d=null;if(o.empty){if(!e.highlightWordAroundCursor)return ni.none;let v=t.wordAt(o.head);if(!v)return ni.none;d=t.charCategorizer(o.head),f=t.sliceDoc(v.from,v.to)}else{let v=o.to-o.from;if(v<e.minSelectionLength||v>200)return ni.none;if(e.wholeWords){if(f=t.sliceDoc(o.from,o.to),d=t.charCategorizer(o.head),!(Ww(d,t,o.from,o.to)&&RD(d,t,o.from,o.to)))return ni.none}else if(f=t.sliceDoc(o.from,o.to),!f)return ni.none}let a=[];for(let v of s.visibleRanges){let A=new Cm(t.doc,f,v.from,v.to);for(;!A.next().done;){let{from:P,to:L}=A.value;if((!d||Ww(d,t,P,L))&&(o.empty&&P<=o.from&&L>=o.to?a.push(DD.range(P,L)):(P>=o.to||L<=o.from)&&a.push(OD.range(P,L)),a.length>e.maxMatches))return ni.none}}return ni.set(a)}},{decorations:s=>s.decorations}),zD=Bt.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),LD=({state:s,dispatch:e})=>{let{selection:t}=s,n=yt.create(t.ranges.map(o=>s.wordAt(o.head)||yt.cursor(o.head)),t.mainIndex);return n.eq(t)?!1:(e(s.update({selection:n})),!0)};function BD(s,e){let{main:t,ranges:n}=s.selection,o=s.wordAt(t.head),f=o&&o.from==t.from&&o.to==t.to;for(let d=!1,a=new Cm(s.doc,e,n[n.length-1].to);;)if(a.next(),a.done){if(d)return null;a=new Cm(s.doc,e,0,Math.max(0,n[n.length-1].from-1)),d=!0}else{if(d&&n.some(v=>v.from==a.value.from))continue;if(f){let v=s.wordAt(a.value.from);if(!v||v.from!=a.value.from||v.to!=a.value.to)continue}return a.value}}const ND=({state:s,dispatch:e})=>{let{ranges:t}=s.selection;if(t.some(f=>f.from===f.to))return LD({state:s,dispatch:e});let n=s.sliceDoc(t[0].from,t[0].to);if(s.selection.ranges.some(f=>s.sliceDoc(f.from,f.to)!=n))return!1;let o=BD(s,n);return o?(e(s.update({selection:s.selection.addRange(yt.range(o.from,o.to),!1),effects:Bt.scrollIntoView(o.to)})),!0):!1},zm=Ut.define({combine(s){return Wc(s,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new WD(e),scrollToMatch:e=>Bt.scrollIntoView(e)})}});class MM{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||MD(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new UD(this):new jD(this)}getCursor(e,t=0,n){let o=e.doc?e:Bi.create({doc:e});return n==null&&(n=o.doc.length),this.regexp?im(this,o,t,n):tm(this,o,t,n)}}class CM{constructor(e){this.spec=e}}function tm(s,e,t,n){return new Cm(e.doc,s.unquoted,t,n,s.caseSensitive?void 0:o=>o.toLowerCase(),s.wholeWord?FD(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function FD(s,e){return(t,n,o,f)=>((f>t||f+o.length<n)&&(f=Math.max(0,t-2),o=s.sliceString(f,Math.min(s.length,n+2))),(e(A0(o,t-f))!=Qn.Word||e(k0(o,t-f))!=Qn.Word)&&(e(k0(o,n-f))!=Qn.Word||e(A0(o,n-f))!=Qn.Word))}class jD extends CM{constructor(e){super(e)}nextMatch(e,t,n){let o=tm(this.spec,e,n,e.doc.length).nextOverlapping();return o.done&&(o=tm(this.spec,e,0,t).nextOverlapping()),o.done?null:o.value}prevMatchInRange(e,t,n){for(let o=n;;){let f=Math.max(t,o-1e4-this.spec.unquoted.length),d=tm(this.spec,e,f,o),a=null;for(;!d.nextOverlapping().done;)a=d.value;if(a)return a;if(f==t)return null;o-=1e4}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let n=tm(this.spec,e,0,e.doc.length),o=[];for(;!n.next().done;){if(o.length>=t)return null;o.push(n.value)}return o}highlight(e,t,n,o){let f=tm(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!f.next().done;)o(f.value.from,f.value.to)}}function im(s,e,t,n){return new SM(e.doc,s.search,{ignoreCase:!s.caseSensitive,test:s.wholeWord?VD(e.charCategorizer(e.selection.main.head)):void 0},t,n)}function A0(s,e){return s.slice(Ir(s,e,!1),e)}function k0(s,e){return s.slice(e,Ir(s,e))}function VD(s){return(e,t,n)=>!n[0].length||(s(A0(n.input,n.index))!=Qn.Word||s(k0(n.input,n.index))!=Qn.Word)&&(s(k0(n.input,n.index+n[0].length))!=Qn.Word||s(A0(n.input,n.index+n[0].length))!=Qn.Word)}class UD extends CM{nextMatch(e,t,n){let o=im(this.spec,e,n,e.doc.length).next();return o.done&&(o=im(this.spec,e,0,t).next()),o.done?null:o.value}prevMatchInRange(e,t,n){for(let o=1;;o++){let f=Math.max(t,n-o*1e4),d=im(this.spec,e,f,n),a=null;for(;!d.next().done;)a=d.value;if(a&&(f==t||a.from>f+10))return a;if(f==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(t,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:t)}matchAll(e,t){let n=im(this.spec,e,0,e.doc.length),o=[];for(;!n.next().done;){if(o.length>=t)return null;o.push(n.value)}return o}highlight(e,t,n,o){let f=im(this.spec,e,Math.max(0,t-250),Math.min(n+250,e.doc.length));for(;!f.next().done;)o(f.value.from,f.value.to)}}const dy=xi.define(),$x=xi.define(),yf=zr.define({create(s){return new Jb(lx(s).create(),null)},update(s,e){for(let t of e.effects)t.is(dy)?s=new Jb(t.value.create(),s.panel):t.is($x)&&(s=new Jb(s.query,t.value?Xx:null));return s},provide:s=>uy.from(s,e=>e.panel)});class Jb{constructor(e,t){this.query=e,this.panel=t}}const qD=ni.mark({class:"cm-searchMatch"}),HD=ni.mark({class:"cm-searchMatch cm-searchMatch-selected"}),ZD=ks.fromClass(class{constructor(s){this.view=s,this.decorations=this.highlight(s.state.field(yf))}update(s){let e=s.state.field(yf);(e!=s.startState.field(yf)||s.docChanged||s.selectionSet||s.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:s,panel:e}){if(!e||!s.spec.valid)return ni.none;let{view:t}=this,n=new vf;for(let o=0,f=t.visibleRanges,d=f.length;o<d;o++){let{from:a,to:v}=f[o];for(;o<d-1&&v>f[o+1].from-2*250;)v=f[++o].to;s.highlight(t.state,a,v,(A,P)=>{let L=t.state.selection.ranges.some(j=>j.from==A&&j.to==P);n.add(A,P,L?HD:qD)})}return n.finish()}},{decorations:s=>s.decorations});function ky(s){return e=>{let t=e.state.field(yf,!1);return t&&t.query.spec.valid?s(e,t):EM(e)}}const E0=ky((s,{query:e})=>{let{to:t}=s.state.selection.main,n=e.nextMatch(s.state,t,t);if(!n)return!1;let o=yt.single(n.from,n.to),f=s.state.facet(zm);return s.dispatch({selection:o,effects:[Qx(s,n),f.scrollToMatch(o.main,s)],userEvent:"select.search"}),kM(s),!0}),P0=ky((s,{query:e})=>{let{state:t}=s,{from:n}=t.selection.main,o=e.prevMatch(t,n,n);if(!o)return!1;let f=yt.single(o.from,o.to),d=s.state.facet(zm);return s.dispatch({selection:f,effects:[Qx(s,o),d.scrollToMatch(f.main,s)],userEvent:"select.search"}),kM(s),!0}),GD=ky((s,{query:e})=>{let t=e.matchAll(s.state,1e3);return!t||!t.length?!1:(s.dispatch({selection:yt.create(t.map(n=>yt.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),$D=({state:s,dispatch:e})=>{let t=s.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:n,to:o}=t.main,f=[],d=0;for(let a=new Cm(s.doc,s.sliceDoc(n,o));!a.next().done;){if(f.length>1e3)return!1;a.value.from==n&&(d=f.length),f.push(yt.range(a.value.from,a.value.to))}return e(s.update({selection:yt.create(f,d),userEvent:"select.search.matches"})),!0},Kw=ky((s,{query:e})=>{let{state:t}=s,{from:n,to:o}=t.selection.main;if(t.readOnly)return!1;let f=e.nextMatch(t,n,n);if(!f)return!1;let d=[],a,v,A=[];if(f.from==n&&f.to==o&&(v=t.toText(e.getReplacement(f)),d.push({from:f.from,to:f.to,insert:v}),f=e.nextMatch(t,f.from,f.to),A.push(Bt.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(n).number)+"."))),f){let P=d.length==0||d[0].from>=f.to?0:f.to-f.from-v.length;a=yt.single(f.from-P,f.to-P),A.push(Qx(s,f)),A.push(t.facet(zm).scrollToMatch(a.main,s))}return s.dispatch({changes:d,selection:a,effects:A,userEvent:"input.replace"}),!0}),XD=ky((s,{query:e})=>{if(s.state.readOnly)return!1;let t=e.matchAll(s.state,1e9).map(o=>{let{from:f,to:d}=o;return{from:f,to:d,insert:e.getReplacement(o)}});if(!t.length)return!1;let n=s.state.phrase("replaced $ matches",t.length)+".";return s.dispatch({changes:t,effects:Bt.announce.of(n),userEvent:"input.replace.all"}),!0});function Xx(s){return s.state.facet(zm).createPanel(s)}function lx(s,e){var t,n,o,f,d;let a=s.selection.main,v=a.empty||a.to>a.from+100?"":s.sliceDoc(a.from,a.to);if(e&&!v)return e;let A=s.facet(zm);return new MM({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:A.literal)?v:v.replace(/\n/g,"\\n"),caseSensitive:(n=e==null?void 0:e.caseSensitive)!==null&&n!==void 0?n:A.caseSensitive,literal:(o=e==null?void 0:e.literal)!==null&&o!==void 0?o:A.literal,regexp:(f=e==null?void 0:e.regexp)!==null&&f!==void 0?f:A.regexp,wholeWord:(d=e==null?void 0:e.wholeWord)!==null&&d!==void 0?d:A.wholeWord})}function AM(s){let e=cy(s,Xx);return e&&e.dom.querySelector("[main-field]")}function kM(s){let e=AM(s);e&&e==s.root.activeElement&&e.select()}const EM=s=>{let e=s.state.field(yf,!1);if(e&&e.panel){let t=AM(s);if(t&&t!=s.root.activeElement){let n=lx(s.state,e.query.spec);n.valid&&s.dispatch({effects:dy.of(n)}),t.focus(),t.select()}}else s.dispatch({effects:[$x.of(!0),e?dy.of(lx(s.state,e.query.spec)):xi.appendConfig.of(YD)]});return!0},PM=s=>{let e=s.state.field(yf,!1);if(!e||!e.panel)return!1;let t=cy(s,Xx);return t&&t.dom.contains(s.root.activeElement)&&s.focus(),s.dispatch({effects:$x.of(!1)}),!0},QD=[{key:"Mod-f",run:EM,scope:"editor search-panel"},{key:"F3",run:E0,shift:P0,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:E0,shift:P0,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:PM,scope:"editor search-panel"},{key:"Mod-Shift-l",run:$D},{key:"Mod-Alt-g",run:CD},{key:"Mod-d",run:ND,preventDefault:!0}];class WD{constructor(e){this.view=e;let t=this.query=e.state.field(yf).query.spec;this.commit=this.commit.bind(this),this.searchField=Dn("input",{value:t.search,placeholder:ga(e,"Find"),"aria-label":ga(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Dn("input",{value:t.replace,placeholder:ga(e,"Replace"),"aria-label":ga(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Dn("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Dn("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Dn("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function n(o,f,d){return Dn("button",{class:"cm-button",name:o,onclick:f,type:"button"},d)}this.dom=Dn("div",{onkeydown:o=>this.keydown(o),class:"cm-search"},[this.searchField,n("next",()=>E0(e),[ga(e,"next")]),n("prev",()=>P0(e),[ga(e,"previous")]),n("select",()=>GD(e),[ga(e,"all")]),Dn("label",null,[this.caseField,ga(e,"match case")]),Dn("label",null,[this.reField,ga(e,"regexp")]),Dn("label",null,[this.wordField,ga(e,"by word")]),...e.state.readOnly?[]:[Dn("br"),this.replaceField,n("replace",()=>Kw(e),[ga(e,"replace")]),n("replaceAll",()=>XD(e),[ga(e,"replace all")])],Dn("button",{name:"close",onclick:()=>PM(e),"aria-label":ga(e,"close"),type:"button"},["×"])])}commit(){let e=new MM({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:dy.of(e)}))}keydown(e){rE(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?P0:E0)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Kw(this.view))}update(e){for(let t of e.transactions)for(let n of t.effects)n.is(dy)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(zm).top}}function ga(s,e){return s.state.phrase(e)}const L_=30,B_=/[\s\.,:;?!]/;function Qx(s,{from:e,to:t}){let n=s.state.doc.lineAt(e),o=s.state.doc.lineAt(t).to,f=Math.max(n.from,e-L_),d=Math.min(o,t+L_),a=s.state.sliceDoc(f,d);if(f!=n.from){for(let v=0;v<L_;v++)if(!B_.test(a[v+1])&&B_.test(a[v])){a=a.slice(v);break}}if(d!=o){for(let v=a.length-1;v>a.length-L_;v--)if(!B_.test(a[v-1])&&B_.test(a[v])){a=a.slice(0,v);break}}return Bt.announce.of(`${s.state.phrase("current match")}. ${a} ${s.state.phrase("on line")} ${n.number}.`)}const KD=Bt.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),YD=[yf,Xd.low(ZD),KD];class OM{constructor(e,t,n,o){this.state=e,this.pos=t,this.explicit=n,this.view=o,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=Qr(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),n=Math.max(t.from,this.pos-250),o=t.text.slice(n-t.from,this.pos-t.from),f=o.search(DM(e,!1));return f<0?null:{from:n+f,to:this.pos,text:o.slice(f)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,n){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),n&&n.onDocChange&&(this.abortOnDocChange=!0))}}function Yw(s){let e=Object.keys(s).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function JD(s){let e=Object.create(null),t=Object.create(null);for(let{label:o}of s){e[o[0]]=!0;for(let f=1;f<o.length;f++)t[o[f]]=!0}let n=Yw(e)+Yw(t)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function eR(s){let e=s.map(o=>typeof o=="string"?{label:o}:o),[t,n]=e.every(o=>/^\w+$/.test(o.label))?[/\w*$/,/\w+$/]:JD(e);return o=>{let f=o.matchBefore(n);return f||o.explicit?{from:f?f.from:o.pos,options:e,validFor:t}:null}}class Jw{constructor(e,t,n,o){this.completion=e,this.source=t,this.match=n,this.score=o}}function _f(s){return s.selection.main.from}function DM(s,e){var t;let{source:n}=s,o=e&&n[0]!="^",f=n[n.length-1]!="$";return!o&&!f?s:new RegExp(`${o?"^":""}(?:${n})${f?"$":""}`,(t=s.flags)!==null&&t!==void 0?t:s.ignoreCase?"i":"")}const RM=Qc.define();function tR(s,e,t,n){let{main:o}=s.selection,f=t-o.from,d=n-o.from;return Object.assign(Object.assign({},s.changeByRange(a=>{if(a!=o&&t!=n&&s.sliceDoc(a.from+f,a.from+d)!=s.sliceDoc(t,n))return{range:a};let v=s.toText(e);return{changes:{from:a.from+f,to:n==o.from?a.to:a.from+d,insert:v},range:yt.cursor(a.from+f+v.length)}})),{scrollIntoView:!0,userEvent:"input.complete"})}const eS=new WeakMap;function iR(s){if(!Array.isArray(s))return s;let e=eS.get(s);return e||eS.set(s,e=eR(s)),e}const O0=xi.define(),py=xi.define();class nR{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let n=Or(e,t),o=rl(n);this.chars.push(n);let f=e.slice(t,t+o),d=f.toUpperCase();this.folded.push(Or(d==f?f.toLowerCase():d,0)),t+=o}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:n,any:o,precise:f,byWord:d}=this;if(t.length==1){let Be=Or(e,0),je=rl(Be),ze=je==e.length?0:-100;if(Be!=t[0])if(Be==n[0])ze+=-200;else return null;return this.ret(ze,[0,je])}let a=e.indexOf(this.pattern);if(a==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let v=t.length,A=0;if(a<0){for(let Be=0,je=Math.min(e.length,200);Be<je&&A<v;){let ze=Or(e,Be);(ze==t[A]||ze==n[A])&&(o[A++]=Be),Be+=rl(ze)}if(A<v)return null}let P=0,L=0,j=!1,F=0,K=-1,se=-1,le=/[a-z]/.test(e),ve=!0;for(let Be=0,je=Math.min(e.length,200),ze=0;Be<je&&L<v;){let ke=Or(e,Be);a<0&&(P<v&&ke==t[P]&&(f[P++]=Be),F<v&&(ke==t[F]||ke==n[F]?(F==0&&(K=Be),se=Be+1,F++):F=0));let Se,Fe=ke<255?ke>=48&&ke<=57||ke>=97&&ke<=122?2:ke>=65&&ke<=90?1:0:(Se=xx(ke))!=Se.toLowerCase()?1:Se!=Se.toUpperCase()?2:0;(!Be||Fe==1&&le||ze==0&&Fe!=0)&&(t[L]==ke||n[L]==ke&&(j=!0)?d[L++]=Be:d.length&&(ve=!1)),ze=Fe,Be+=rl(ke)}return L==v&&d[0]==0&&ve?this.result(-100+(j?-200:0),d,e):F==v&&K==0?this.ret(-200-e.length+(se==e.length?0:-100),[0,se]):a>-1?this.ret(-700-e.length,[a,a+this.pattern.length]):F==v?this.ret(-900-e.length,[K,se]):L==v?this.result(-100+(j?-200:0)+-700+(ve?0:-1100),d,e):t.length==2?null:this.result((o[0]?-700:0)+-200+-1100,o,e)}result(e,t,n){let o=[],f=0;for(let d of t){let a=d+(this.astral?rl(Or(n,d)):1);f&&o[f-1]==d?o[f-1]=a:(o[f++]=d,o[f++]=a)}return this.ret(e-n.length,o)}}class sR{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),n=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return n==null?null:(this.matched=[0,t.length],this.score=n+(e.length==this.pattern.length?0:-100),this)}}const Rr=Ut.define({combine(s){return Wc(s,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:rR,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>n=>tS(e(n),t(n)),optionClass:(e,t)=>n=>tS(e(n),t(n)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function tS(s,e){return s?e?s+" "+e:s:e}function rR(s,e,t,n,o,f){let d=s.textDirection==jn.RTL,a=d,v=!1,A="top",P,L,j=e.left-o.left,F=o.right-e.right,K=n.right-n.left,se=n.bottom-n.top;if(a&&j<Math.min(K,F)?a=!1:!a&&F<Math.min(K,j)&&(a=!0),K<=(a?j:F))P=Math.max(o.top,Math.min(t.top,o.bottom-se))-e.top,L=Math.min(400,a?j:F);else{v=!0,L=Math.min(400,(d?e.right:o.right-e.left)-30);let Be=o.bottom-e.bottom;Be>=se||Be>e.top?P=t.bottom-e.top:(A="bottom",P=e.bottom-t.top)}let le=(e.bottom-e.top)/f.offsetHeight,ve=(e.right-e.left)/f.offsetWidth;return{style:`${A}: ${P/le}px; max-width: ${L/ve}px`,class:"cm-completionInfo-"+(v?d?"left-narrow":"right-narrow":a?"left":"right")}}function oR(s){let e=s.addToOptions.slice();return s.icons&&e.push({render(t){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),t.type&&n.classList.add(...t.type.split(/\s+/g).map(o=>"cm-completionIcon-"+o)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(t,n,o,f){let d=document.createElement("span");d.className="cm-completionLabel";let a=t.displayLabel||t.label,v=0;for(let A=0;A<f.length;){let P=f[A++],L=f[A++];P>v&&d.appendChild(document.createTextNode(a.slice(v,P)));let j=d.appendChild(document.createElement("span"));j.appendChild(document.createTextNode(a.slice(P,L))),j.className="cm-completionMatchedText",v=L}return v<a.length&&d.appendChild(document.createTextNode(a.slice(v))),d},position:50},{render(t){if(!t.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=t.detail,n},position:80}),e.sort((t,n)=>t.position-n.position).map(t=>t.render)}function ev(s,e,t){if(s<=t)return{from:0,to:s};if(e<0&&(e=0),e<=s>>1){let o=Math.floor(e/t);return{from:o*t,to:(o+1)*t}}let n=Math.floor((s-e)/t);return{from:s-(n+1)*t,to:s-n*t}}class aR{constructor(e,t,n){this.view=e,this.stateField=t,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:v=>this.placeInfo(v),key:this},this.space=null,this.currentClass="";let o=e.state.field(t),{options:f,selected:d}=o.open,a=e.state.facet(Rr);this.optionContent=oR(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=ev(f.length,d,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",v=>{let{options:A}=e.state.field(t).open;for(let P=v.target,L;P&&P!=this.dom;P=P.parentNode)if(P.nodeName=="LI"&&(L=/-(\d+)$/.exec(P.id))&&+L[1]<A.length){this.applyCompletion(e,A[+L[1]]),v.preventDefault();return}}),this.dom.addEventListener("focusout",v=>{let A=e.state.field(this.stateField,!1);A&&A.tooltip&&e.state.facet(Rr).closeOnBlur&&v.relatedTarget!=e.contentDOM&&e.dispatch({effects:py.of(null)})}),this.showOptions(f,o.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let n=e.state.field(this.stateField),o=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),n!=o){let{options:f,selected:d,disabled:a}=n.open;(!o.open||o.open.options!=f)&&(this.range=ev(f.length,d,e.state.facet(Rr).maxRenderedOptions),this.showOptions(f,n.id)),this.updateSel(),a!=((t=o.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let n of this.currentClass.split(" "))n&&this.dom.classList.remove(n);for(let n of t.split(" "))n&&this.dom.classList.add(n);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=ev(t.options.length,t.selected,this.view.state.facet(Rr).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:o}=n;if(!o)return;let f=typeof o=="string"?document.createTextNode(o):o(n);if(!f)return;"then"in f?f.then(d=>{d&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(d,n)}).catch(d=>Fo(this.view.state,d,"completion info")):this.addInfoPane(f,n)}}addInfoPane(e,t){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",e.nodeType!=null)n.appendChild(e),this.infoDestroy=null;else{let{dom:o,destroy:f}=e;n.appendChild(o),this.infoDestroy=f||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let n=this.list.firstChild,o=this.range.from;n;n=n.nextSibling,o++)n.nodeName!="LI"||!n.id?o--:o==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),t=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return t&&cR(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),o=e.getBoundingClientRect(),f=this.space;if(!f){let d=this.dom.ownerDocument.defaultView||window;f={left:0,top:0,right:d.innerWidth,bottom:d.innerHeight}}return o.top>Math.min(f.bottom,t.bottom)-10||o.bottom<Math.max(f.top,t.top)+10?null:this.view.state.facet(Rr).positionInfo(this.view,t,o,n,f,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,n){const o=document.createElement("ul");o.id=t,o.setAttribute("role","listbox"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-label",this.view.state.phrase("Completions"));let f=null;for(let d=n.from;d<n.to;d++){let{completion:a,match:v}=e[d],{section:A}=a;if(A){let j=typeof A=="string"?A:A.name;if(j!=f&&(d>n.from||n.from==0))if(f=j,typeof A!="string"&&A.header)o.appendChild(A.header(A));else{let F=o.appendChild(document.createElement("completion-section"));F.textContent=j}}const P=o.appendChild(document.createElement("li"));P.id=t+"-"+d,P.setAttribute("role","option");let L=this.optionClass(a);L&&(P.className=L);for(let j of this.optionContent){let F=j(a,this.view.state,this.view,v);F&&P.appendChild(F)}}return n.from&&o.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&o.classList.add("cm-completionListIncompleteBottom"),o}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function lR(s,e){return t=>new aR(t,s,e)}function cR(s,e){let t=s.getBoundingClientRect(),n=e.getBoundingClientRect(),o=t.height/s.offsetHeight;n.top<t.top?s.scrollTop-=(t.top-n.top)/o:n.bottom>t.bottom&&(s.scrollTop+=(n.bottom-t.bottom)/o)}function iS(s){return(s.boost||0)*100+(s.apply?10:0)+(s.info?5:0)+(s.type?1:0)}function uR(s,e){let t=[],n=null,o=A=>{t.push(A);let{section:P}=A.completion;if(P){n||(n=[]);let L=typeof P=="string"?P:P.name;n.some(j=>j.name==L)||n.push(typeof P=="string"?{name:L}:P)}},f=e.facet(Rr);for(let A of s)if(A.hasResult()){let P=A.result.getMatch;if(A.result.filter===!1)for(let L of A.result.options)o(new Jw(L,A.source,P?P(L):[],1e9-t.length));else{let L=e.sliceDoc(A.from,A.to),j,F=f.filterStrict?new sR(L):new nR(L);for(let K of A.result.options)if(j=F.match(K.label)){let se=K.displayLabel?P?P(K,j.matched):[]:j.matched;o(new Jw(K,A.source,se,j.score+(K.boost||0)))}}}if(n){let A=Object.create(null),P=0,L=(j,F)=>{var K,se;return((K=j.rank)!==null&&K!==void 0?K:1e9)-((se=F.rank)!==null&&se!==void 0?se:1e9)||(j.name<F.name?-1:1)};for(let j of n.sort(L))P-=1e5,A[j.name]=P;for(let j of t){let{section:F}=j.completion;F&&(j.score+=A[typeof F=="string"?F:F.name])}}let d=[],a=null,v=f.compareCompletions;for(let A of t.sort((P,L)=>L.score-P.score||v(P.completion,L.completion))){let P=A.completion;!a||a.label!=P.label||a.detail!=P.detail||a.type!=null&&P.type!=null&&a.type!=P.type||a.apply!=P.apply||a.boost!=P.boost?d.push(A):iS(A.completion)>iS(a)&&(d[d.length-1]=A),a=A.completion}return d}class om{constructor(e,t,n,o,f,d){this.options=e,this.attrs=t,this.tooltip=n,this.timestamp=o,this.selected=f,this.disabled=d}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new om(this.options,nS(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,n,o,f){let d=uR(e,t);if(!d.length)return o&&e.some(v=>v.state==1)?new om(o.options,o.attrs,o.tooltip,o.timestamp,o.selected,!0):null;let a=t.facet(Rr).selectOnOpen?0:-1;if(o&&o.selected!=a&&o.selected!=-1){let v=o.options[o.selected].completion;for(let A=0;A<d.length;A++)if(d[A].completion==v){a=A;break}}return new om(d,nS(n,a),{pos:e.reduce((v,A)=>A.hasResult()?Math.min(v,A.from):v,1e8),create:gR,above:f.aboveCursor},o?o.timestamp:Date.now(),a,!1)}map(e){return new om(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class D0{constructor(e,t,n){this.active=e,this.id=t,this.open=n}static start(){return new D0(pR,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,n=t.facet(Rr),f=(n.override||t.languageDataAt("autocomplete",_f(t)).map(iR)).map(a=>(this.active.find(A=>A.source==a)||new ba(a,this.active.some(A=>A.state!=0)?1:0)).update(e,n));f.length==this.active.length&&f.every((a,v)=>a==this.active[v])&&(f=this.active);let d=this.open;d&&e.docChanged&&(d=d.map(e.changes)),e.selection||f.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!hR(f,this.active)?d=om.build(f,t,this.id,d,n):d&&d.disabled&&!f.some(a=>a.state==1)&&(d=null),!d&&f.every(a=>a.state!=1)&&f.some(a=>a.hasResult())&&(f=f.map(a=>a.hasResult()?new ba(a.source,0):a));for(let a of e.effects)a.is(LM)&&(d=d&&d.setSelected(a.value,this.id));return f==this.active&&d==this.open?this:new D0(f,this.id,d)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?fR:dR}}function hR(s,e){if(s==e)return!0;for(let t=0,n=0;;){for(;t<s.length&&!s[t].hasResult;)t++;for(;n<e.length&&!e[n].hasResult;)n++;let o=t==s.length,f=n==e.length;if(o||f)return o==f;if(s[t++].result!=e[n++].result)return!1}}const fR={"aria-autocomplete":"list"},dR={};function nS(s,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":s};return e>-1&&(t["aria-activedescendant"]=s+"-"+e),t}const pR=[];function IM(s,e){if(s.isUserEvent("input.complete")){let n=s.annotation(RM);if(n&&e.activateOnCompletion(n))return 12}let t=s.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:s.isUserEvent("delete.backward")?2:s.selection?8:s.docChanged?16:0}class ba{constructor(e,t,n=-1){this.source=e,this.state=t,this.explicitPos=n}hasResult(){return!1}update(e,t){let n=IM(e,t),o=this;(n&8||n&16&&this.touches(e))&&(o=new ba(o.source,0)),n&4&&o.state==0&&(o=new ba(this.source,1)),o=o.updateFor(e,n);for(let f of e.effects)if(f.is(O0))o=new ba(o.source,1,f.value?_f(e.state):-1);else if(f.is(py))o=new ba(o.source,0);else if(f.is(zM))for(let d of f.value)d.source==o.source&&(o=d);return o}updateFor(e,t){return this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new ba(this.source,this.state,e.mapPos(this.explicitPos))}touches(e){return e.changes.touchesRange(_f(e.state))}}class gm extends ba{constructor(e,t,n,o,f){super(e,2,t),this.result=n,this.from=o,this.to=f}hasResult(){return!0}updateFor(e,t){var n;if(!(t&3))return this.map(e.changes);let o=this.result;o.map&&!e.changes.empty&&(o=o.map(o,e.changes));let f=e.changes.mapPos(this.from),d=e.changes.mapPos(this.to,1),a=_f(e.state);if((this.explicitPos<0?a<=f:a<this.from)||a>d||!o||t&2&&_f(e.startState)==this.from)return new ba(this.source,t&4?1:0);let v=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return mR(o.validFor,e.state,f,d)?new gm(this.source,v,o,f,d):o.update&&(o=o.update(o,f,d,new OM(e.state,a,v>=0)))?new gm(this.source,v,o,o.from,(n=o.to)!==null&&n!==void 0?n:_f(e.state)):new ba(this.source,1,v)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new gm(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new ba(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function mR(s,e,t,n){if(!s)return!1;let o=e.sliceDoc(t,n);return typeof s=="function"?s(o,t,n,e):DM(s,!0).test(o)}const zM=xi.define({map(s,e){return s.map(t=>t.map(e))}}),LM=xi.define(),Bo=zr.define({create(){return D0.start()},update(s,e){return s.update(e)},provide:s=>[zx.from(s,e=>e.tooltip),Bt.contentAttributes.from(s,e=>e.attrs)]});function Wx(s,e){const t=e.completion.apply||e.completion.label;let n=s.state.field(Bo).active.find(o=>o.source==e.source);return n instanceof gm?(typeof t=="string"?s.dispatch(Object.assign(Object.assign({},tR(s.state,t,n.from,n.to)),{annotations:RM.of(e.completion)})):t(s,e.completion,n.from,n.to),!0):!1}const gR=lR(Bo,Wx);function N_(s,e="option"){return t=>{let n=t.state.field(Bo,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<t.state.facet(Rr).interactionDelay)return!1;let o=1,f;e=="page"&&(f=mT(t,n.open.tooltip))&&(o=Math.max(2,Math.floor(f.dom.offsetHeight/f.dom.querySelector("li").offsetHeight)-1));let{length:d}=n.open.options,a=n.open.selected>-1?n.open.selected+o*(s?1:-1):s?0:d-1;return a<0?a=e=="page"?0:d-1:a>=d&&(a=e=="page"?d-1:0),t.dispatch({effects:LM.of(a)}),!0}}const yR=s=>{let e=s.state.field(Bo,!1);return s.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<s.state.facet(Rr).interactionDelay?!1:Wx(s,e.open.options[e.open.selected])},sS=s=>s.state.field(Bo,!1)?(s.dispatch({effects:O0.of(!0)}),!0):!1,_R=s=>{let e=s.state.field(Bo,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(s.dispatch({effects:py.of(null)}),!0)};class bR{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const vR=50,xR=1e3,wR=ks.fromClass(class{constructor(s){this.view=s,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of s.state.field(Bo).active)e.state==1&&this.startQuery(e)}update(s){let e=s.state.field(Bo),t=s.state.facet(Rr);if(!s.selectionSet&&!s.docChanged&&s.startState.field(Bo)==e)return;let n=s.transactions.some(f=>{let d=IM(f,t);return d&8||(f.selection||f.docChanged)&&!(d&3)});for(let f=0;f<this.running.length;f++){let d=this.running[f];if(n||d.context.abortOnDocChange&&s.docChanged||d.updates.length+s.transactions.length>vR&&Date.now()-d.time>xR){for(let a of d.context.abortListeners)try{a()}catch(v){Fo(this.view.state,v)}d.context.abortListeners=null,this.running.splice(f--,1)}else d.updates.push(...s.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),s.transactions.some(f=>f.effects.some(d=>d.is(O0)))&&(this.pendingStart=!0);let o=this.pendingStart?50:t.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(f=>f.state==1&&!this.running.some(d=>d.active.source==f.source))?setTimeout(()=>this.startUpdate(),o):-1,this.composing!=0)for(let f of s.transactions)f.isUserEvent("input.type")?this.composing=2:this.composing==2&&f.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:s}=this.view,e=s.field(Bo);for(let t of e.active)t.state==1&&!this.running.some(n=>n.active.source==t.source)&&this.startQuery(t)}startQuery(s){let{state:e}=this.view,t=_f(e),n=new OM(e,t,s.explicitPos==t,this.view),o=new bR(s,n);this.running.push(o),Promise.resolve(s.source(n)).then(f=>{o.context.aborted||(o.done=f||null,this.scheduleAccept())},f=>{this.view.dispatch({effects:py.of(null)}),Fo(this.view.state,f)})}scheduleAccept(){this.running.every(s=>s.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Rr).updateSyncTime))}accept(){var s;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(Rr);for(let n=0;n<this.running.length;n++){let o=this.running[n];if(o.done===void 0)continue;if(this.running.splice(n--,1),o.done){let d=new gm(o.active.source,o.active.explicitPos,o.done,o.done.from,(s=o.done.to)!==null&&s!==void 0?s:_f(o.updates.length?o.updates[0].startState:this.view.state));for(let a of o.updates)d=d.update(a,t);if(d.hasResult()){e.push(d);continue}}let f=this.view.state.field(Bo).active.find(d=>d.source==o.active.source);if(f&&f.state==1)if(o.done==null){let d=new ba(o.active.source,0);for(let a of o.updates)d=d.update(a,t);d.state!=1&&e.push(d)}else this.startQuery(f)}e.length&&this.view.dispatch({effects:zM.of(e)})}},{eventHandlers:{blur(s){let e=this.view.state.field(Bo,!1);if(e&&e.tooltip&&this.view.state.facet(Rr).closeOnBlur){let t=e.open&&mT(this.view,e.open.tooltip);(!t||!t.dom.contains(s.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:py.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:O0.of(!1)}),20),this.composing=0}}}),SR=typeof navigator=="object"&&/Win/.test(navigator.platform),TR=Xd.highest(Bt.domEventHandlers({keydown(s,e){let t=e.state.field(Bo,!1);if(!t||!t.open||t.open.disabled||t.open.selected<0||s.key.length>1||s.ctrlKey&&!(SR&&s.altKey)||s.metaKey)return!1;let n=t.open.options[t.open.selected],o=t.active.find(d=>d.source==n.source),f=n.completion.commitCharacters||o.result.commitCharacters;return f&&f.indexOf(s.key)>-1&&Wx(e,n),!1}})),MR=Bt.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),my={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Ld=xi.define({map(s,e){let t=e.mapPos(s,-1,po.TrackAfter);return t??void 0}}),Kx=new class extends Ud{};Kx.startSide=1;Kx.endSide=-1;const BM=zr.define({create(){return qi.empty},update(s,e){if(s=s.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);s=s.update({filter:n=>n>=t.from&&n<=t.to})}for(let t of e.effects)t.is(Ld)&&(s=s.update({add:[Kx.range(t.value,t.value+1)]}));return s}});function CR(){return[kR,BM]}const tv="()[]{}<>";function NM(s){for(let e=0;e<tv.length;e+=2)if(tv.charCodeAt(e)==s)return tv.charAt(e+1);return xx(s<128?s:s+1)}function FM(s,e){return s.languageDataAt("closeBrackets",e)[0]||my}const AR=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),kR=Bt.inputHandler.of((s,e,t,n)=>{if((AR?s.composing:s.compositionStarted)||s.state.readOnly)return!1;let o=s.state.selection.main;if(n.length>2||n.length==2&&rl(Or(n,0))==1||e!=o.from||t!=o.to)return!1;let f=OR(s.state,n);return f?(s.dispatch(f),!0):!1}),ER=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let n=FM(s,s.selection.main.head).brackets||my.brackets,o=null,f=s.changeByRange(d=>{if(d.empty){let a=DR(s.doc,d.head);for(let v of n)if(v==a&&J0(s.doc,d.head)==NM(Or(v,0)))return{changes:{from:d.head-v.length,to:d.head+v.length},range:yt.cursor(d.head-v.length)}}return{range:o=d}});return o||e(s.update(f,{scrollIntoView:!0,userEvent:"delete.backward"})),!o},PR=[{key:"Backspace",run:ER}];function OR(s,e){let t=FM(s,s.selection.main.head),n=t.brackets||my.brackets;for(let o of n){let f=NM(Or(o,0));if(e==o)return f==o?zR(s,o,n.indexOf(o+o+o)>-1,t):RR(s,o,f,t.before||my.before);if(e==f&&jM(s,s.selection.main.from))return IR(s,o,f)}return null}function jM(s,e){let t=!1;return s.field(BM).between(0,s.doc.length,n=>{n==e&&(t=!0)}),t}function J0(s,e){let t=s.sliceString(e,e+2);return t.slice(0,rl(Or(t,0)))}function DR(s,e){let t=s.sliceString(e-2,e);return rl(Or(t,0))==t.length?t:t.slice(1)}function RR(s,e,t,n){let o=null,f=s.changeByRange(d=>{if(!d.empty)return{changes:[{insert:e,from:d.from},{insert:t,from:d.to}],effects:Ld.of(d.to+e.length),range:yt.range(d.anchor+e.length,d.head+e.length)};let a=J0(s.doc,d.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:e+t,from:d.head},effects:Ld.of(d.head+e.length),range:yt.cursor(d.head+e.length)}:{range:o=d}});return o?null:s.update(f,{scrollIntoView:!0,userEvent:"input.type"})}function IR(s,e,t){let n=null,o=s.changeByRange(f=>f.empty&&J0(s.doc,f.head)==t?{changes:{from:f.head,to:f.head+t.length,insert:t},range:yt.cursor(f.head+t.length)}:n={range:f});return n?null:s.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function zR(s,e,t,n){let o=n.stringPrefixes||my.stringPrefixes,f=null,d=s.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:e,from:a.to}],effects:Ld.of(a.to+e.length),range:yt.range(a.anchor+e.length,a.head+e.length)};let v=a.head,A=J0(s.doc,v),P;if(A==e){if(rS(s,v))return{changes:{insert:e+e,from:v},effects:Ld.of(v+e.length),range:yt.cursor(v+e.length)};if(jM(s,v)){let j=t&&s.sliceDoc(v,v+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:v,to:v+j.length,insert:j},range:yt.cursor(v+j.length)}}}else{if(t&&s.sliceDoc(v-2*e.length,v)==e+e&&(P=oS(s,v-2*e.length,o))>-1&&rS(s,P))return{changes:{insert:e+e+e+e,from:v},effects:Ld.of(v+e.length),range:yt.cursor(v+e.length)};if(s.charCategorizer(v)(A)!=Qn.Word&&oS(s,v,o)>-1&&!LR(s,v,e,o))return{changes:{insert:e+e,from:v},effects:Ld.of(v+e.length),range:yt.cursor(v+e.length)}}return{range:f=a}});return f?null:s.update(d,{scrollIntoView:!0,userEvent:"input.type"})}function rS(s,e){let t=Qr(s).resolveInner(e+1);return t.parent&&t.from==e}function LR(s,e,t,n){let o=Qr(s).resolveInner(e,-1),f=n.reduce((d,a)=>Math.max(d,a.length),0);for(let d=0;d<5;d++){let a=s.sliceDoc(o.from,Math.min(o.to,o.from+t.length+f)),v=a.indexOf(t);if(!v||v>-1&&n.indexOf(a.slice(0,v))>-1){let P=o.firstChild;for(;P&&P.from==o.from&&P.to-P.from>t.length+v;){if(s.sliceDoc(P.to-t.length,P.to)==t)return!1;P=P.firstChild}return!0}let A=o.to==e&&o.parent;if(!A)break;o=A}return!1}function oS(s,e,t){let n=s.charCategorizer(e);if(n(s.sliceDoc(e-1,e))!=Qn.Word)return e;for(let o of t){let f=e-o.length;if(s.sliceDoc(f,e)==o&&n(s.sliceDoc(f-1,f))!=Qn.Word)return f}return-1}function BR(s={}){return[TR,Bo,Rr.of(s),wR,NR,MR]}const VM=[{key:"Ctrl-Space",run:sS},{mac:"Alt-`",run:sS},{key:"Escape",run:_R},{key:"ArrowDown",run:N_(!0)},{key:"ArrowUp",run:N_(!1)},{key:"PageDown",run:N_(!0,"page")},{key:"PageUp",run:N_(!1,"page")},{key:"Enter",run:yR}],NR=Xd.highest(H0.computeN([Rr],s=>s.facet(Rr).defaultKeymap?[VM]:[]));class FR{constructor(e,t,n){this.from=e,this.to=t,this.diagnostic=n}}class Rd{constructor(e,t,n){this.diagnostics=e,this.panel=t,this.selected=n}static init(e,t,n){let o=e,f=n.facet(gy).markerFilter;f&&(o=f(o,n));let d=ni.set(o.map(a=>a.from==a.to||a.from==a.to-1&&n.doc.lineAt(a.from).to==a.from?ni.widget({widget:new XR(a),diagnostic:a}).range(a.from):ni.mark({attributes:{class:"cm-lintRange cm-lintRange-"+a.severity+(a.markClass?" "+a.markClass:"")},diagnostic:a}).range(a.from,a.to)),!0);return new Rd(d,t,Am(d))}}function Am(s,e=null,t=0){let n=null;return s.between(t,1e9,(o,f,{spec:d})=>{if(!(e&&d.diagnostic!=e))return n=new FR(o,f,d.diagnostic),!1}),n}function jR(s,e){let t=e.pos,n=e.end||t,o=s.state.facet(gy).hideOn(s,t,n);if(o!=null)return o;let f=s.startState.doc.lineAt(e.pos);return!!(s.effects.some(d=>d.is(UM))||s.changes.touchesRange(f.from,Math.max(f.to,n)))}function VR(s,e){return s.field(xa,!1)?e:e.concat(xi.appendConfig.of(KR))}const UM=xi.define(),Yx=xi.define(),qM=xi.define(),xa=zr.define({create(){return new Rd(ni.none,null,null)},update(s,e){if(e.docChanged&&s.diagnostics.size){let t=s.diagnostics.map(e.changes),n=null,o=s.panel;if(s.selected){let f=e.changes.mapPos(s.selected.from,1);n=Am(t,s.selected.diagnostic,f)||Am(t,null,f)}!t.size&&o&&e.state.facet(gy).autoPanel&&(o=null),s=new Rd(t,o,n)}for(let t of e.effects)if(t.is(UM)){let n=e.state.facet(gy).autoPanel?t.value.length?yy.open:null:s.panel;s=Rd.init(t.value,n,e.state)}else t.is(Yx)?s=new Rd(s.diagnostics,t.value?yy.open:null,s.selected):t.is(qM)&&(s=new Rd(s.diagnostics,s.panel,t.value));return s},provide:s=>[uy.from(s,e=>e.panel),Bt.decorations.from(s,e=>e.diagnostics)]}),UR=ni.mark({class:"cm-lintRange cm-lintRange-active"});function qR(s,e,t){let{diagnostics:n}=s.state.field(xa),o=[],f=2e8,d=0;n.between(e-(t<0?1:0),e+(t>0?1:0),(v,A,{spec:P})=>{e>=v&&e<=A&&(v==A||(e>v||t>0)&&(e<A||t<0))&&(o.push(P.diagnostic),f=Math.min(v,f),d=Math.max(A,d))});let a=s.state.facet(gy).tooltipFilter;return a&&(o=a(o,s.state)),o.length?{pos:f,end:d,above:s.state.doc.lineAt(f).to<d,create(){return{dom:HR(s,o)}}}:null}function HR(s,e){return Dn("ul",{class:"cm-tooltip-lint"},e.map(t=>ZM(s,t,!1)))}const ZR=s=>{let e=s.state.field(xa,!1);(!e||!e.panel)&&s.dispatch({effects:VR(s.state,[Yx.of(!0)])});let t=cy(s,yy.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},aS=s=>{let e=s.state.field(xa,!1);return!e||!e.panel?!1:(s.dispatch({effects:Yx.of(!1)}),!0)},GR=s=>{let e=s.state.field(xa,!1);if(!e)return!1;let t=s.state.selection.main,n=e.diagnostics.iter(t.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==t.from&&n.to==t.to)?!1:(s.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},$R=[{key:"Mod-Shift-m",run:ZR,preventDefault:!0},{key:"F8",run:GR}],gy=Ut.define({combine(s){return Object.assign({sources:s.map(e=>e.source).filter(e=>e!=null)},Wc(s.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,t)=>e?t?n=>e(n)||t(n):e:t}))}});function HM(s){let e=[];if(s)e:for(let{name:t}of s){for(let n=0;n<t.length;n++){let o=t[n];if(/[a-zA-Z]/.test(o)&&!e.some(f=>f.toLowerCase()==o.toLowerCase())){e.push(o);continue e}}e.push("")}return e}function ZM(s,e,t){var n;let o=t?HM(e.actions):[];return Dn("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Dn("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(s):e.message),(n=e.actions)===null||n===void 0?void 0:n.map((f,d)=>{let a=!1,v=j=>{if(j.preventDefault(),a)return;a=!0;let F=Am(s.state.field(xa).diagnostics,e);F&&f.apply(s,F.from,F.to)},{name:A}=f,P=o[d]?A.indexOf(o[d]):-1,L=P<0?A:[A.slice(0,P),Dn("u",A.slice(P,P+1)),A.slice(P+1)];return Dn("button",{type:"button",class:"cm-diagnosticAction",onclick:v,onmousedown:v,"aria-label":` Action: ${A}${P<0?"":` (access key "${o[d]})"`}.`},L)}),e.source&&Dn("div",{class:"cm-diagnosticSource"},e.source))}class XR extends rh{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return Dn("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class lS{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=ZM(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class yy{constructor(e){this.view=e,this.items=[];let t=o=>{if(o.keyCode==27)aS(this.view),this.view.focus();else if(o.keyCode==38||o.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(o.keyCode==40||o.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(o.keyCode==36)this.moveSelection(0);else if(o.keyCode==35)this.moveSelection(this.items.length-1);else if(o.keyCode==13)this.view.focus();else if(o.keyCode>=65&&o.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:f}=this.items[this.selectedIndex],d=HM(f.actions);for(let a=0;a<d.length;a++)if(d[a].toUpperCase().charCodeAt(0)==o.keyCode){let v=Am(this.view.state.field(xa).diagnostics,f);v&&f.actions[a].apply(e,v.from,v.to)}}else return;o.preventDefault()},n=o=>{for(let f=0;f<this.items.length;f++)this.items[f].dom.contains(o.target)&&this.moveSelection(f)};this.list=Dn("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:n}),this.dom=Dn("div",{class:"cm-panel-lint"},this.list,Dn("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>aS(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(xa).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(xa),n=0,o=!1,f=null;for(e.between(0,this.view.state.doc.length,(d,a,{spec:v})=>{let A=-1,P;for(let L=n;L<this.items.length;L++)if(this.items[L].diagnostic==v.diagnostic){A=L;break}A<0?(P=new lS(this.view,v.diagnostic),this.items.splice(n,0,P),o=!0):(P=this.items[A],A>n&&(this.items.splice(n,A-n),o=!0)),t&&P.diagnostic==t.diagnostic?P.dom.hasAttribute("aria-selected")||(P.dom.setAttribute("aria-selected","true"),f=P):P.dom.hasAttribute("aria-selected")&&P.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)o=!0,this.items.pop();this.items.length==0&&(this.items.push(new lS(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),o=!0),f?(this.list.setAttribute("aria-activedescendant",f.id),this.view.requestMeasure({key:this,read:()=>({sel:f.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:d,panel:a})=>{let v=a.height/this.list.offsetHeight;d.top<a.top?this.list.scrollTop-=(a.top-d.top)/v:d.bottom>a.bottom&&(this.list.scrollTop+=(d.bottom-a.bottom)/v)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),o&&this.sync()}sync(){let e=this.list.firstChild;function t(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)t();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(xa),n=Am(t.diagnostics,this.items[e].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:qM.of(n)})}static open(e){return new yy(e)}}function QR(s,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(s)}</svg>')`}function F_(s){return QR(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${s}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const WR=Bt.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:F_("#d11")},".cm-lintRange-warning":{backgroundImage:F_("orange")},".cm-lintRange-info":{backgroundImage:F_("#999")},".cm-lintRange-hint":{backgroundImage:F_("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),KR=[xa,Bt.decorations.compute([xa],s=>{let{selected:e,panel:t}=s.field(xa);return!e||!t||e.from==e.to?ni.none:ni.set([UR.range(e.from,e.to)])}),$E(qR,{hideOn:jR}),WR];var cS=function(e){e===void 0&&(e={});var{crosshairCursor:t=!1}=e,n=[];e.closeBracketsKeymap!==!1&&(n=n.concat(PR)),e.defaultKeymap!==!1&&(n=n.concat(SD)),e.searchKeymap!==!1&&(n=n.concat(QD)),e.historyKeymap!==!1&&(n=n.concat(DO)),e.foldKeymap!==!1&&(n=n.concat(GP)),e.completionKeymap!==!1&&(n=n.concat(VM)),e.lintKeymap!==!1&&(n=n.concat($R));var o=[];return e.lineNumbers!==!1&&o.push(sP()),e.highlightActiveLineGutter!==!1&&o.push(aP()),e.highlightSpecialChars!==!1&&o.push(wE()),e.history!==!1&&o.push(SO()),e.foldGutter!==!1&&o.push(WP()),e.drawSelection!==!1&&o.push(hE()),e.dropCursor!==!1&&o.push(gE()),e.allowMultipleSelections!==!1&&o.push(Bi.allowMultipleSelections.of(!0)),e.indentOnInput!==!1&&o.push(LP()),e.syntaxHighlighting!==!1&&o.push(Ux(eO,{fallback:!0})),e.bracketMatching!==!1&&o.push(aO()),e.closeBrackets!==!1&&o.push(CR()),e.autocompletion!==!1&&o.push(BR()),e.rectangularSelection!==!1&&o.push(LE()),t!==!1&&o.push(FE()),e.highlightActiveLine!==!1&&o.push(kE()),e.highlightSelectionMatches!==!1&&o.push(PD()),e.tabSize&&typeof e.tabSize=="number"&&o.push(G0.of(" ".repeat(e.tabSize))),o.concat([H0.of(n.flat())]).filter(Boolean)};const YR="#e5c07b",uS="#e06c75",JR="#56b6c2",eI="#ffffff",t0="#abb2bf",cx="#7d8799",tI="#61afef",iI="#98c379",hS="#d19a66",nI="#c678dd",sI="#21252b",fS="#2c313a",dS="#282c34",iv="#353a42",rI="#3E4451",pS="#528bff",oI=Bt.theme({"&":{color:t0,backgroundColor:dS},".cm-content":{caretColor:pS},".cm-cursor, .cm-dropCursor":{borderLeftColor:pS},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:rI},".cm-panels":{backgroundColor:sI,color:t0},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:dS,color:cx,border:"none"},".cm-activeLineGutter":{backgroundColor:fS},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:iv},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:iv,borderBottomColor:iv},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:fS,color:t0}}},{dark:!0}),aI=Rm.define([{tag:me.keyword,color:nI},{tag:[me.name,me.deleted,me.character,me.propertyName,me.macroName],color:uS},{tag:[me.function(me.variableName),me.labelName],color:tI},{tag:[me.color,me.constant(me.name),me.standard(me.name)],color:hS},{tag:[me.definition(me.name),me.separator],color:t0},{tag:[me.typeName,me.className,me.number,me.changed,me.annotation,me.modifier,me.self,me.namespace],color:YR},{tag:[me.operator,me.operatorKeyword,me.url,me.escape,me.regexp,me.link,me.special(me.string)],color:JR},{tag:[me.meta,me.comment],color:cx},{tag:me.strong,fontWeight:"bold"},{tag:me.emphasis,fontStyle:"italic"},{tag:me.strikethrough,textDecoration:"line-through"},{tag:me.link,color:cx,textDecoration:"underline"},{tag:me.heading,fontWeight:"bold",color:uS},{tag:[me.atom,me.bool,me.special(me.variableName)],color:hS},{tag:[me.processingInstruction,me.string,me.inserted],color:iI},{tag:me.invalid,color:eI}]),lI=[oI,Ux(aI)];var cI=Bt.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),uI=function(e){e===void 0&&(e={});var{indentWithTab:t=!0,editable:n=!0,readOnly:o=!1,theme:f="light",placeholder:d="",basicSetup:a=!0}=e,v=[];switch(t&&v.unshift(H0.of([TD])),a&&(typeof a=="boolean"?v.unshift(cS()):v.unshift(cS(a))),d&&v.unshift(DE(d)),f){case"light":v.push(cI);break;case"dark":v.push(lI);break;case"none":break;default:v.push(f);break}return n===!1&&v.push(Bt.editable.of(!1)),o&&v.push(Bi.readOnly.of(!0)),[...v]},hI=s=>({line:s.state.doc.lineAt(s.state.selection.main.from),lineCount:s.state.doc.lines,lineBreak:s.state.lineBreak,length:s.state.doc.length,readOnly:s.state.readOnly,tabSize:s.state.tabSize,selection:s.state.selection,selectionAsSingle:s.state.selection.asSingle().main,ranges:s.state.selection.ranges,selectionCode:s.state.sliceDoc(s.state.selection.main.from,s.state.selection.main.to),selections:s.state.selection.ranges.map(e=>s.state.sliceDoc(e.from,e.to)),selectedText:s.state.selection.ranges.some(e=>!e.empty)}),mS=Qc.define(),fI=[];function dI(s){var{value:e,selection:t,onChange:n,onStatistics:o,onCreateEditor:f,onUpdate:d,extensions:a=fI,autoFocus:v,theme:A="light",height:P=null,minHeight:L=null,maxHeight:j=null,width:F=null,minWidth:K=null,maxWidth:se=null,placeholder:le="",editable:ve=!0,readOnly:Be=!1,indentWithTab:je=!0,basicSetup:ze=!0,root:ke,initialState:Se}=s,[Fe,He]=Ot.useState(),[gt,Et]=Ot.useState(),[Mt,ht]=Ot.useState(),Gt=Bt.theme({"&":{height:P,minHeight:L,maxHeight:j,width:F,minWidth:K,maxWidth:se},"& .cm-scroller":{height:"100% !important"}}),Ft=Bt.updateListener.of(dt=>{if(dt.docChanged&&typeof n=="function"&&!dt.transactions.some(xe=>xe.annotation(mS))){var _t=dt.state.doc,qt=_t.toString();n(qt,dt)}o&&o(hI(dt))}),ei=uI({theme:A,editable:ve,readOnly:Be,placeholder:le,indentWithTab:je,basicSetup:ze}),Xe=[Ft,Gt,...ei];return d&&typeof d=="function"&&Xe.push(Bt.updateListener.of(d)),Xe=Xe.concat(a),Ot.useLayoutEffect(()=>{if(Fe&&!Mt){var dt={doc:e,selection:t,extensions:Xe},_t=Se?Bi.fromJSON(Se.json,dt,Se.fields):Bi.create(dt);if(ht(_t),!gt){var qt=new Bt({state:_t,parent:Fe,root:ke});Et(qt),f&&f(qt,_t)}}return()=>{gt&&(ht(void 0),Et(void 0))}},[Fe,Mt]),Ot.useEffect(()=>{s.container&&He(s.container)},[s.container]),Ot.useEffect(()=>()=>{gt&&(gt.destroy(),Et(void 0))},[gt]),Ot.useEffect(()=>{v&&gt&&gt.focus()},[v,gt]),Ot.useEffect(()=>{gt&&gt.dispatch({effects:xi.reconfigure.of(Xe)})},[A,a,P,L,j,F,K,se,le,ve,Be,je,ze,n,d]),Ot.useEffect(()=>{if(e!==void 0){var dt=gt?gt.state.doc.toString():"";gt&&e!==dt&&gt.dispatch({changes:{from:0,to:dt.length,insert:e||""},annotations:[mS.of(!0)]})}},[e,gt]),{state:Mt,setState:ht,view:gt,setView:Et,container:Fe,setContainer:He}}var pI=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],GM=Ot.forwardRef((s,e)=>{var{className:t,value:n="",selection:o,extensions:f=[],onChange:d,onStatistics:a,onCreateEditor:v,onUpdate:A,autoFocus:P,theme:L="light",height:j,minHeight:F,maxHeight:K,width:se,minWidth:le,maxWidth:ve,basicSetup:Be,placeholder:je,indentWithTab:ze,editable:ke,readOnly:Se,root:Fe,initialState:He}=s,gt=hA(s,pI),Et=Ot.useRef(null),{state:Mt,view:ht,container:Gt,setContainer:Ft}=dI({root:Fe,value:n,autoFocus:P,theme:L,height:j,minHeight:F,maxHeight:K,width:se,minWidth:le,maxWidth:ve,basicSetup:Be,placeholder:je,indentWithTab:ze,editable:ke,readOnly:Se,selection:o,onChange:d,onStatistics:a,onCreateEditor:v,onUpdate:A,extensions:f,initialState:He});Ot.useImperativeHandle(e,()=>({editor:Et.current,state:Mt,view:ht}),[Et,Gt,Mt,ht]);var ei=Ot.useCallback(dt=>{Et.current=dt,Ft(dt)},[Ft]);if(typeof n!="string")throw new Error("value must be typeof string but got "+typeof n);var Xe=typeof L=="string"?"cm-theme-"+L:"cm-theme";return wn.jsx("div",iy({ref:ei,className:""+Xe+(t?" "+t:"")},gt))});GM.displayName="CodeMirror";var $M=s=>{var{theme:e,settings:t={},styles:n=[]}=s,o={".cm-gutters":{}},f={};t.background&&(f.backgroundColor=t.background),t.backgroundImage&&(f.backgroundImage=t.backgroundImage),t.foreground&&(f.color=t.foreground),t.fontSize&&(f.fontSize=t.fontSize),(t.background||t.foreground)&&(o["&"]=f),t.fontFamily&&(o["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(o[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(o[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(o[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(o[".cm-content"]={caretColor:t.caret},o[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var d={};t.gutterActiveForeground&&(d.color=t.gutterActiveForeground),t.lineHighlight&&(o[".cm-activeLine"]={backgroundColor:t.lineHighlight},d.backgroundColor=t.lineHighlight),o[".cm-activeLineGutter"]=d,t.selection&&(o["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(o["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var a=Bt.theme(o,{dark:e==="dark"}),v=Rm.define(n),A=[a,Ux(v)];return A},mI={background:"#ffffff",foreground:"#383a42",caret:"#000",selection:"#add6ff",selectionMatch:"#a8ac94",lineHighlight:"#99999926",gutterBackground:"#fff",gutterForeground:"#237893",gutterActiveForeground:"#0b216f",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},gI=[{tag:[me.keyword,me.operatorKeyword,me.modifier,me.color,me.constant(me.name),me.standard(me.name),me.standard(me.tagName),me.special(me.brace),me.atom,me.bool,me.special(me.variableName)],color:"#0000ff"},{tag:[me.moduleKeyword,me.controlKeyword],color:"#af00db"},{tag:[me.name,me.deleted,me.character,me.macroName,me.propertyName,me.variableName,me.labelName,me.definition(me.name)],color:"#0070c1"},{tag:me.heading,fontWeight:"bold",color:"#0070c1"},{tag:[me.typeName,me.className,me.tagName,me.number,me.changed,me.annotation,me.self,me.namespace],color:"#267f99"},{tag:[me.function(me.variableName),me.function(me.propertyName)],color:"#795e26"},{tag:[me.number],color:"#098658"},{tag:[me.operator,me.punctuation,me.separator,me.url,me.escape,me.regexp],color:"#383a42"},{tag:[me.regexp],color:"#af00db"},{tag:[me.special(me.string),me.processingInstruction,me.string,me.inserted],color:"#a31515"},{tag:[me.angleBracket],color:"#383a42"},{tag:me.strong,fontWeight:"bold"},{tag:me.emphasis,fontStyle:"italic"},{tag:me.strikethrough,textDecoration:"line-through"},{tag:[me.meta,me.comment],color:"#008000"},{tag:me.link,color:"#4078f2",textDecoration:"underline"},{tag:me.invalid,color:"#e45649"}];function yI(s){var{theme:e="light",settings:t={},styles:n=[]}={};return $M({theme:e,settings:iy({},mI,t),styles:[...gI,...n]})}yI();var _I={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'},bI=[{tag:[me.keyword,me.operatorKeyword,me.modifier,me.color,me.constant(me.name),me.standard(me.name),me.standard(me.tagName),me.special(me.brace),me.atom,me.bool,me.special(me.variableName)],color:"#569cd6"},{tag:[me.controlKeyword,me.moduleKeyword],color:"#c586c0"},{tag:[me.name,me.deleted,me.character,me.macroName,me.propertyName,me.variableName,me.labelName,me.definition(me.name)],color:"#9cdcfe"},{tag:me.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[me.typeName,me.className,me.tagName,me.number,me.changed,me.annotation,me.self,me.namespace],color:"#4ec9b0"},{tag:[me.function(me.variableName),me.function(me.propertyName)],color:"#dcdcaa"},{tag:[me.number],color:"#b5cea8"},{tag:[me.operator,me.punctuation,me.separator,me.url,me.escape,me.regexp],color:"#d4d4d4"},{tag:[me.regexp],color:"#d16969"},{tag:[me.special(me.string),me.processingInstruction,me.string,me.inserted],color:"#ce9178"},{tag:[me.angleBracket],color:"#808080"},{tag:me.strong,fontWeight:"bold"},{tag:me.emphasis,fontStyle:"italic"},{tag:me.strikethrough,textDecoration:"line-through"},{tag:[me.meta,me.comment],color:"#6a9955"},{tag:me.link,color:"#6a9955",textDecoration:"underline"},{tag:me.invalid,color:"#ff0000"}];function vI(s){var{theme:e="dark",settings:t={},styles:n=[]}={};return $M({theme:e,settings:iy({},_I,t),styles:[...bI,...n]})}var xI=vI(),gS={};class R0{constructor(e,t,n,o,f,d,a,v,A,P=0,L){this.p=e,this.stack=t,this.state=n,this.reducePos=o,this.pos=f,this.score=d,this.buffer=a,this.bufferBase=v,this.curContext=A,this.lookAhead=P,this.parent=L}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,n=0){let o=e.parser.context;return new R0(e,[],t,n,n,0,[],0,o?new yS(o,o.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let n=e>>19,o=e&65535,{parser:f}=this.p,d=this.reducePos<this.pos-25;d&&this.setLookAhead(this.pos);let a=f.dynamicPrecedence(o);if(a&&(this.score+=a),n==0){this.pushState(f.getGoto(this.state,o,!0),this.reducePos),o<f.minRepeatTerm&&this.storeNode(o,this.reducePos,this.reducePos,d?8:4,!0),this.reduceContext(o,this.reducePos);return}let v=this.stack.length-(n-1)*3-(e&262144?6:0),A=v?this.stack[v-2]:this.p.ranges[0].from,P=this.reducePos-A;P>=2e3&&!(!((t=this.p.parser.nodeSet.types[o])===null||t===void 0)&&t.isAnonymous)&&(A==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=P):this.p.lastBigReductionSize<P&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=A,this.p.lastBigReductionSize=P));let L=v?this.stack[v-1]:0,j=this.bufferBase+this.buffer.length-L;if(o<f.minRepeatTerm||e&131072){let F=f.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(o,A,F,j+4,!0)}if(e&262144)this.state=this.stack[v];else{let F=this.stack[v-3];this.state=f.getGoto(F,o,!0)}for(;this.stack.length>v;)this.stack.pop();this.reduceContext(o,A)}storeNode(e,t,n,o=4,f=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let d=this,a=this.buffer.length;if(a==0&&d.parent&&(a=d.bufferBase-d.parent.bufferBase,d=d.parent),a>0&&d.buffer[a-4]==0&&d.buffer[a-1]>-1){if(t==n)return;if(d.buffer[a-2]>=t){d.buffer[a-2]=n;return}}}if(!f||this.pos==n)this.buffer.push(e,t,n,o);else{let d=this.buffer.length;if(d>0&&this.buffer[d-4]!=0){let a=!1;for(let v=d;v>0&&this.buffer[v-2]>n;v-=4)if(this.buffer[v-1]>=0){a=!0;break}if(a)for(;d>0&&this.buffer[d-2]>n;)this.buffer[d]=this.buffer[d-4],this.buffer[d+1]=this.buffer[d-3],this.buffer[d+2]=this.buffer[d-2],this.buffer[d+3]=this.buffer[d-1],d-=4,o>4&&(o-=4)}this.buffer[d]=e,this.buffer[d+1]=t,this.buffer[d+2]=n,this.buffer[d+3]=o}}shift(e,t,n,o){if(e&131072)this.pushState(e&65535,this.pos);else if((e&262144)==0){let f=e,{parser:d}=this.p;(o>this.pos||t<=d.maxNode)&&(this.pos=o,d.stateFlag(f,1)||(this.reducePos=o)),this.pushState(f,n),this.shiftContext(t,n),t<=d.maxNode&&this.buffer.push(t,n,o,4)}else this.pos=o,this.shiftContext(t,n),t<=this.p.parser.maxNode&&this.buffer.push(t,n,o,4)}apply(e,t,n,o){e&65536?this.reduce(e):this.shift(e,t,n,o)}useNode(e,t){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=e)&&(this.p.reused.push(e),n++);let o=this.pos;this.reducePos=this.pos=o+e.length,this.pushState(t,o),this.buffer.push(n,o,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let n=e.buffer.slice(t),o=e.bufferBase+t;for(;e&&o==e.bufferBase;)e=e.parent;return new R0(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,o,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let n=e<=this.p.parser.maxNode;n&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,n?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new wI(this);;){let n=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(n==0)return!1;if((n&65536)==0)return!0;t.reduce(n)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let o=[];for(let f=0,d;f<t.length;f+=2)(d=t[f+1])!=this.state&&this.p.parser.hasAction(d,e)&&o.push(t[f],d);if(this.stack.length<120)for(let f=0;o.length<8&&f<t.length;f+=2){let d=t[f+1];o.some((a,v)=>v&1&&a==d)||o.push(t[f],d)}t=o}let n=[];for(let o=0;o<t.length&&n.length<4;o+=2){let f=t[o+1];if(f==this.state)continue;let d=this.split();d.pushState(f,this.pos),d.storeNode(0,d.pos,d.pos,4,!0),d.shiftContext(t[o],this.pos),d.reducePos=this.pos,d.score-=200,n.push(d)}return n}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if((t&65536)==0)return!1;if(!e.validAction(this.state,t)){let n=t>>19,o=t&65535,f=this.stack.length-n*3;if(f<0||e.getGoto(this.stack[f],o,!1)<0){let d=this.findForcedReduction();if(d==null)return!1;t=d}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],n=(o,f)=>{if(!t.includes(o))return t.push(o),e.allActions(o,d=>{if(!(d&393216))if(d&65536){let a=(d>>19)-f;if(a>1){let v=d&65535,A=this.stack.length-a*3;if(A>=0&&e.getGoto(this.stack[A],v,!1)>=0)return a<<19|65536|v}}else{let a=n(d,f+1);if(a!=null)return a}})};return n(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new yS(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class yS{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class wI{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,n=e>>19;n==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(n-1)*3;let o=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=o}}class I0{constructor(e,t,n){this.stack=e,this.pos=t,this.index=n,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new I0(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new I0(this.stack,this.pos,this.index)}}function j_(s,e=Uint16Array){if(typeof s!="string")return s;let t=null;for(let n=0,o=0;n<s.length;){let f=0;for(;;){let d=s.charCodeAt(n++),a=!1;if(d==126){f=65535;break}d>=92&&d--,d>=34&&d--;let v=d-32;if(v>=46&&(v-=46,a=!0),f+=v,a)break;f*=46}t?t[o++]=f:t=new e(f)}return t}class i0{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const _S=new i0;class SI{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=_S,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let n=this.range,o=this.rangeIndex,f=this.pos+e;for(;f<n.from;){if(!o)return null;let d=this.ranges[--o];f-=n.from-d.to,n=d}for(;t<0?f>n.to:f>=n.to;){if(o==this.ranges.length-1)return null;let d=this.ranges[++o];f+=d.from-n.to,n=d}return f}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,n,o;if(t>=0&&t<this.chunk.length)n=this.pos+e,o=this.chunk.charCodeAt(t);else{let f=this.resolveOffset(e,1);if(f==null)return-1;if(n=f,n>=this.chunk2Pos&&n<this.chunk2Pos+this.chunk2.length)o=this.chunk2.charCodeAt(n-this.chunk2Pos);else{let d=this.rangeIndex,a=this.range;for(;a.to<=n;)a=this.ranges[++d];this.chunk2=this.input.chunk(this.chunk2Pos=n),n+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-n)),o=this.chunk2.charCodeAt(0)}}return n>=this.token.lookAhead&&(this.token.lookAhead=n+1),o}acceptToken(e,t=0){let n=t?this.resolveOffset(t,-1):this.pos;if(n==null||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=n}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=_S,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let n="";for(let o of this.ranges){if(o.from>=t)break;o.to>e&&(n+=this.input.read(Math.max(o.from,e),Math.min(o.to,t)))}return n}}class ym{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:n}=t.p;TI(this.data,e,t,this.id,n.data,n.tokenPrecTable)}}ym.prototype.contextual=ym.prototype.fallback=ym.prototype.extend=!1;ym.prototype.fallback=ym.prototype.extend=!1;class eb{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function TI(s,e,t,n,o,f){let d=0,a=1<<n,{dialect:v}=t.p.parser;e:for(;(a&s[d])!=0;){let A=s[d+1];for(let F=d+3;F<A;F+=2)if((s[F+1]&a)>0){let K=s[F];if(v.allows(K)&&(e.token.value==-1||e.token.value==K||MI(K,e.token.value,o,f))){e.acceptToken(K);break}}let P=e.next,L=0,j=s[d+2];if(e.next<0&&j>L&&s[A+j*3-3]==65535){d=s[A+j*3-1];continue e}for(;L<j;){let F=L+j>>1,K=A+F+(F<<1),se=s[K],le=s[K+1]||65536;if(P<se)j=F;else if(P>=le)L=F+1;else{d=s[K+2],e.advance();continue e}}break}}function bS(s,e,t){for(let n=e,o;(o=s[n])!=65535;n++)if(o==t)return n-e;return-1}function MI(s,e,t,n){let o=bS(t,n,e);return o<0||bS(t,n,s)<o}const ya=typeof process<"u"&&gS&&/\bparse\b/.test(gS.LOG);let nv=null;function vS(s,e,t){let n=s.cursor(_r.IncludeAnonymous);for(n.moveTo(e);;)if(!(t<0?n.childBefore(e):n.childAfter(e)))for(;;){if((t<0?n.to<e:n.from>e)&&!n.type.isError)return t<0?Math.max(0,Math.min(n.to-1,e-25)):Math.min(s.length,Math.max(n.from+1,e+25));if(t<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return t<0?0:s.length}}class CI{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?vS(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?vS(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let n=this.trees[t],o=this.index[t];if(o==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let f=n.children[o],d=this.start[t]+n.positions[o];if(d>e)return this.nextStart=d,null;if(f instanceof qs){if(d==e){if(d<this.safeFrom)return null;let a=d+f.length;if(a<=this.safeTo){let v=f.prop(ki.lookAhead);if(!v||a+v<this.fragment.to)return f}}this.index[t]++,d+f.length>=Math.max(this.safeFrom,e)&&(this.trees.push(f),this.start.push(d),this.index.push(0))}else this.index[t]++,this.nextStart=d+f.length}}}class AI{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(n=>new i0)}getActions(e){let t=0,n=null,{parser:o}=e.p,{tokenizers:f}=o,d=o.stateSlot(e.state,3),a=e.curContext?e.curContext.hash:0,v=0;for(let A=0;A<f.length;A++){if((1<<A&d)==0)continue;let P=f[A],L=this.tokens[A];if(!(n&&!P.fallback)&&((P.contextual||L.start!=e.pos||L.mask!=d||L.context!=a)&&(this.updateCachedToken(L,P,e),L.mask=d,L.context=a),L.lookAhead>L.end+25&&(v=Math.max(L.lookAhead,v)),L.value!=0)){let j=t;if(L.extended>-1&&(t=this.addActions(e,L.extended,L.end,t)),t=this.addActions(e,L.value,L.end,t),!P.extend&&(n=L,t>j))break}}for(;this.actions.length>t;)this.actions.pop();return v&&e.setLookAhead(v),!n&&e.pos==this.stream.end&&(n=new i0,n.value=e.p.parser.eofTerm,n.start=n.end=e.pos,t=this.addActions(e,n.value,n.end,t)),this.mainToken=n,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new i0,{pos:n,p:o}=e;return t.start=n,t.end=Math.min(n+1,o.stream.end),t.value=n==o.stream.end?o.parser.eofTerm:0,t}updateCachedToken(e,t,n){let o=this.stream.clipPos(n.pos);if(t.token(this.stream.reset(o,e),n),e.value>-1){let{parser:f}=n.p;for(let d=0;d<f.specialized.length;d++)if(f.specialized[d]==e.value){let a=f.specializers[d](this.stream.read(e.start,e.end),n);if(a>=0&&n.p.parser.dialect.allows(a>>1)){(a&1)==0?e.value=a>>1:e.extended=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(o+1)}putAction(e,t,n,o){for(let f=0;f<o;f+=3)if(this.actions[f]==e)return o;return this.actions[o++]=e,this.actions[o++]=t,this.actions[o++]=n,o}addActions(e,t,n,o){let{state:f}=e,{parser:d}=e.p,{data:a}=d;for(let v=0;v<2;v++)for(let A=d.stateSlot(f,v?2:1);;A+=3){if(a[A]==65535)if(a[A+1]==1)A=Yu(a,A+2);else{o==0&&a[A+1]==2&&(o=this.putAction(Yu(a,A+2),t,n,o));break}a[A]==t&&(o=this.putAction(Yu(a,A+1),t,n,o))}return o}}class kI{constructor(e,t,n,o){this.parser=e,this.input=t,this.ranges=o,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new SI(t,o),this.tokens=new AI(e,this.stream),this.topTerm=e.top[1];let{from:f}=o[0];this.stacks=[R0.start(this,e.top[0],f)],this.fragments=n.length&&this.stream.end-f>e.bufferLength*4?new CI(n,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,n=this.stacks=[],o,f;if(this.bigReductionCount>300&&e.length==1){let[d]=e;for(;d.forceReduce()&&d.stack.length&&d.stack[d.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let d=0;d<e.length;d++){let a=e[d];for(;;){if(this.tokens.mainToken=null,a.pos>t)n.push(a);else{if(this.advanceStack(a,n,e))continue;{o||(o=[],f=[]),o.push(a);let v=this.tokens.getMainToken(a);f.push(v.value,v.end)}}break}}if(!n.length){let d=o&&OI(o);if(d)return ya&&console.log("Finish with "+this.stackID(d)),this.stackToTree(d);if(this.parser.strict)throw ya&&o&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&o){let d=this.stoppedAt!=null&&o[0].pos>this.stoppedAt?o[0]:this.runRecovery(o,f,n);if(d)return ya&&console.log("Force-finish "+this.stackID(d)),this.stackToTree(d.forceAll())}if(this.recovering){let d=this.recovering==1?1:this.recovering*3;if(n.length>d)for(n.sort((a,v)=>v.score-a.score);n.length>d;)n.pop();n.some(a=>a.reducePos>t)&&this.recovering--}else if(n.length>1){e:for(let d=0;d<n.length-1;d++){let a=n[d];for(let v=d+1;v<n.length;v++){let A=n[v];if(a.sameState(A)||a.buffer.length>500&&A.buffer.length>500)if((a.score-A.score||a.buffer.length-A.buffer.length)>0)n.splice(v--,1);else{n.splice(d--,1);continue e}}}n.length>12&&n.splice(12,n.length-12)}this.minStackPos=n[0].pos;for(let d=1;d<n.length;d++)n[d].pos<this.minStackPos&&(this.minStackPos=n[d].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,n){let o=e.pos,{parser:f}=this,d=ya?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&o>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let A=e.curContext&&e.curContext.tracker.strict,P=A?e.curContext.hash:0;for(let L=this.fragments.nodeAt(o);L;){let j=this.parser.nodeSet.types[L.type.id]==L.type?f.getGoto(e.state,L.type.id):-1;if(j>-1&&L.length&&(!A||(L.prop(ki.contextHash)||0)==P))return e.useNode(L,j),ya&&console.log(d+this.stackID(e)+` (via reuse of ${f.getName(L.type.id)})`),!0;if(!(L instanceof qs)||L.children.length==0||L.positions[0]>0)break;let F=L.children[0];if(F instanceof qs&&L.positions[0]==0)L=F;else break}}let a=f.stateSlot(e.state,4);if(a>0)return e.reduce(a),ya&&console.log(d+this.stackID(e)+` (via always-reduce ${f.getName(a&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let v=this.tokens.getActions(e);for(let A=0;A<v.length;){let P=v[A++],L=v[A++],j=v[A++],F=A==v.length||!n,K=F?e:e.split(),se=this.tokens.mainToken;if(K.apply(P,L,se?se.start:K.pos,j),ya&&console.log(d+this.stackID(K)+` (via ${(P&65536)==0?"shift":`reduce of ${f.getName(P&65535)}`} for ${f.getName(L)} @ ${o}${K==e?"":", split"})`),F)return!0;K.pos>o?t.push(K):n.push(K)}return!1}advanceFully(e,t){let n=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>n)return xS(e,t),!0}}runRecovery(e,t,n){let o=null,f=!1;for(let d=0;d<e.length;d++){let a=e[d],v=t[d<<1],A=t[(d<<1)+1],P=ya?this.stackID(a)+" -> ":"";if(a.deadEnd&&(f||(f=!0,a.restart(),ya&&console.log(P+this.stackID(a)+" (restarted)"),this.advanceFully(a,n))))continue;let L=a.split(),j=P;for(let F=0;L.forceReduce()&&F<10&&(ya&&console.log(j+this.stackID(L)+" (via force-reduce)"),!this.advanceFully(L,n));F++)ya&&(j=this.stackID(L)+" -> ");for(let F of a.recoverByInsert(v))ya&&console.log(P+this.stackID(F)+" (via recover-insert)"),this.advanceFully(F,n);this.stream.end>a.pos?(A==a.pos&&(A++,v=0),a.recoverByDelete(v,A),ya&&console.log(P+this.stackID(a)+` (via recover-delete ${this.parser.getName(v)})`),xS(a,n)):(!o||o.score<a.score)&&(o=a)}return o}stackToTree(e){return e.close(),qs.build({buffer:I0.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(nv||(nv=new WeakMap)).get(e);return t||nv.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function xS(s,e){for(let t=0;t<e.length;t++){let n=e[t];if(n.pos==s.pos&&n.sameState(s)){e[t].score<s.score&&(e[t]=s);return}}e.push(s)}class EI{constructor(e,t,n){this.source=e,this.flags=t,this.disabled=n}allows(e){return!this.disabled||this.disabled[e]==0}}const sv=s=>s;class PI{constructor(e){this.start=e.start,this.shift=e.shift||sv,this.reduce=e.reduce||sv,this.reuse=e.reuse||sv,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class z0 extends ST{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let a=0;a<e.repeatNodeCount;a++)t.push("");let n=Object.keys(e.topRules).map(a=>e.topRules[a][1]),o=[];for(let a=0;a<t.length;a++)o.push([]);function f(a,v,A){o[a].push([v,v.deserialize(String(A))])}if(e.nodeProps)for(let a of e.nodeProps){let v=a[0];typeof v=="string"&&(v=ki[v]);for(let A=1;A<a.length;){let P=a[A++];if(P>=0)f(P,v,a[A++]);else{let L=a[A+-P];for(let j=-P;j>0;j--)f(a[A++],v,L);A++}}}this.nodeSet=new Lx(t.map((a,v)=>Vo.define({name:v>=this.minRepeatTerm?void 0:a,id:v,props:o[v],top:n.indexOf(v)>-1,error:v==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(v)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=bT;let d=j_(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(wS),this.states=j_(e.states,Uint32Array),this.data=j_(e.stateData),this.goto=j_(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(a=>typeof a=="number"?new ym(d,a):a),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,n){let o=new kI(this,e,t,n);for(let f of this.wrappers)o=f(o,e,t,n);return o}getGoto(e,t,n=!1){let o=this.goto;if(t>=o[0])return-1;for(let f=o[t+1];;){let d=o[f++],a=d&1,v=o[f++];if(a&&n)return v;for(let A=f+(d>>1);f<A;f++)if(o[f]==e)return v;if(a)return-1}}hasAction(e,t){let n=this.data;for(let o=0;o<2;o++)for(let f=this.stateSlot(e,o?2:1),d;;f+=3){if((d=n[f])==65535)if(n[f+1]==1)d=n[f=Yu(n,f+2)];else{if(n[f+1]==2)return Yu(n,f+2);break}if(d==t||d==0)return Yu(n,f+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,n=>n==t?!0:null)}allActions(e,t){let n=this.stateSlot(e,4),o=n?t(n):void 0;for(let f=this.stateSlot(e,1);o==null;f+=3){if(this.data[f]==65535)if(this.data[f+1]==1)f=Yu(this.data,f+2);else break;o=t(Yu(this.data,f+1))}return o}nextStates(e){let t=[];for(let n=this.stateSlot(e,1);;n+=3){if(this.data[n]==65535)if(this.data[n+1]==1)n=Yu(this.data,n+2);else break;if((this.data[n+2]&1)==0){let o=this.data[n+1];t.some((f,d)=>d&1&&f==o)||t.push(this.data[n],o)}}return t}configure(e){let t=Object.assign(Object.create(z0.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let n=this.topRules[e.top];if(!n)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=n}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(n=>{let o=e.tokenizers.find(f=>f.from==n);return o?o.to:n})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((n,o)=>{let f=e.specializers.find(a=>a.from==n.external);if(!f)return n;let d=Object.assign(Object.assign({},n),{external:f.to});return t.specializers[o]=wS(d),d})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),n=t.map(()=>!1);if(e)for(let f of e.split(" ")){let d=t.indexOf(f);d>=0&&(n[d]=!0)}let o=null;for(let f=0;f<t.length;f++)if(!n[f])for(let d=this.dialects[t[f]],a;(a=this.data[d++])!=65535;)(o||(o=new Uint8Array(this.maxTerm+1)))[a]=1;return new EI(e,n,o)}static deserialize(e){return new z0(e)}}function Yu(s,e){return s[e]|s[e+1]<<16}function OI(s){let e=null;for(let t of s){let n=t.p.stoppedAt;(t.pos==t.p.stream.end||n!=null&&t.pos>n)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function wS(s){if(s.external){let e=s.extend?1:0;return(t,n)=>s.external(t,n)<<1|e}return s.get}const nm=63,SS=64,DI=1,RI=2,XM=3,II=4,QM=5,zI=6,LI=7,WM=65,BI=66,NI=8,FI=9,jI=10,VI=11,UI=12,KM=13,qI=19,HI=20,ZI=29,GI=33,$I=34,XI=47,QI=0,Jx=1,ux=2,_y=3,hx=4;class Id{constructor(e,t,n){this.parent=e,this.depth=t,this.type=n,this.hash=(e?e.hash+e.hash<<8:0)+t+(t<<4)+n}}Id.top=new Id(null,-1,QI);function ey(s,e){for(let t=0,n=e-s.pos-1;;n--,t++){let o=s.peek(n);if(sh(o)||o==-1)return t}}function fx(s){return s==32||s==9}function sh(s){return s==10||s==13}function YM(s){return fx(s)||sh(s)}function Bd(s){return s<0||YM(s)}const WI=new PI({start:Id.top,reduce(s,e){return s.type==_y&&(e==HI||e==$I)?s.parent:s},shift(s,e,t,n){if(e==XM)return new Id(s,ey(n,n.pos),Jx);if(e==WM||e==QM)return new Id(s,ey(n,n.pos),ux);if(e==nm)return s.parent;if(e==qI||e==GI)return new Id(s,0,_y);if(e==KM&&s.type==hx)return s.parent;if(e==XI){let o=/[1-9]/.exec(n.read(n.pos,t.pos));if(o)return new Id(s,s.depth+ +o[0],hx)}return s},hash(s){return s.hash}});function km(s,e,t=0){return s.peek(t)==e&&s.peek(t+1)==e&&s.peek(t+2)==e&&Bd(s.peek(t+3))}const KI=new eb((s,e)=>{if(s.next==-1&&e.canShift(SS))return s.acceptToken(SS);let t=s.peek(-1);if((sh(t)||t<0)&&e.context.type!=_y){if(km(s,45))if(e.canShift(nm))s.acceptToken(nm);else return s.acceptToken(DI,3);if(km(s,46))if(e.canShift(nm))s.acceptToken(nm);else return s.acceptToken(RI,3);let n=0;for(;s.next==32;)n++,s.advance();(n<e.context.depth||n==e.context.depth&&e.context.type==Jx&&(s.next!=45||!Bd(s.peek(1))))&&s.next!=-1&&!sh(s.next)&&s.next!=35&&s.acceptToken(nm,-n)}},{contextual:!0}),YI=new eb((s,e)=>{if(e.context.type==_y){s.next==63&&(s.advance(),Bd(s.next)&&s.acceptToken(LI));return}if(s.next==45)s.advance(),Bd(s.next)&&s.acceptToken(e.context.type==Jx&&e.context.depth==ey(s,s.pos-1)?II:XM);else if(s.next==63)s.advance(),Bd(s.next)&&s.acceptToken(e.context.type==ux&&e.context.depth==ey(s,s.pos-1)?zI:QM);else{let t=s.pos;for(;;)if(fx(s.next)){if(s.pos==t)return;s.advance()}else if(s.next==33)JM(s);else if(s.next==38)dx(s);else if(s.next==42){dx(s);break}else if(s.next==39||s.next==34){if(e1(s,!0))break;return}else if(s.next==91||s.next==123){if(!ez(s))return;break}else{eC(s,!0,!1,0);break}for(;fx(s.next);)s.advance();if(s.next==58){if(s.pos==t&&e.canShift(ZI))return;let n=s.peek(1);Bd(n)&&s.acceptTokenTo(e.context.type==ux&&e.context.depth==ey(s,t)?BI:WM,t)}}},{contextual:!0});function JI(s){return s>32&&s<127&&s!=34&&s!=37&&s!=44&&s!=60&&s!=62&&s!=92&&s!=94&&s!=96&&s!=123&&s!=124&&s!=125}function TS(s){return s>=48&&s<=57||s>=97&&s<=102||s>=65&&s<=70}function MS(s,e){return s.next==37?(s.advance(),TS(s.next)&&s.advance(),TS(s.next)&&s.advance(),!0):JI(s.next)||e&&s.next==44?(s.advance(),!0):!1}function JM(s){if(s.advance(),s.next==60){for(s.advance();;)if(!MS(s,!0)){s.next==62&&s.advance();break}}else for(;MS(s,!1););}function dx(s){for(s.advance();!Bd(s.next)&&L0(s.tag)!="f";)s.advance()}function e1(s,e){let t=s.next,n=!1,o=s.pos;for(s.advance();;){let f=s.next;if(f<0)break;if(s.advance(),f==t)if(f==39)if(s.next==39)s.advance();else break;else break;else if(f==92&&t==34)s.next>=0&&s.advance();else if(sh(f)){if(e)return!1;n=!0}else if(e&&s.pos>=o+1024)return!1}return!n}function ez(s){for(let e=[],t=s.pos+1024;;)if(s.next==91||s.next==123)e.push(s.next),s.advance();else if(s.next==39||s.next==34){if(!e1(s,!0))return!1}else if(s.next==93||s.next==125){if(e[e.length-1]!=s.next-2)return!1;if(e.pop(),s.advance(),!e.length)return!0}else{if(s.next<0||s.pos>t||sh(s.next))return!1;s.advance()}}const tz="iiisiiissisfissssssssssssisssiiissssssssssssssssssssssssssfsfssissssssssssssssssssssssssssfif";function L0(s){return s<33?"u":s>125?"s":tz[s-33]}function rv(s,e){let t=L0(s);return t!="u"&&!(e&&t=="f")}function eC(s,e,t,n){if(L0(s.next)=="s"||(s.next==63||s.next==58||s.next==45)&&rv(s.peek(1),t))s.advance();else return!1;let o=s.pos;for(;;){let f=s.next,d=0,a=n+1;for(;YM(f);){if(sh(f)){if(e)return!1;a=0}else a++;f=s.peek(++d)}if(!(f>=0&&(f==58?rv(s.peek(d+1),t):f==35?s.peek(d-1)!=32:rv(f,t)))||!t&&a<=n||a==0&&!t&&(km(s,45,d)||km(s,46,d)))break;if(e&&L0(f)=="f")return!1;for(let A=d;A>=0;A--)s.advance();if(e&&s.pos>o+1024)return!1}return!0}const iz=new eb((s,e)=>{if(s.next==33)JM(s),s.acceptToken(UI);else if(s.next==38||s.next==42){let t=s.next==38?jI:VI;dx(s),s.acceptToken(t)}else s.next==39||s.next==34?(e1(s,!1),s.acceptToken(FI)):eC(s,!1,e.context.type==_y,e.context.depth)&&s.acceptToken(NI)}),nz=new eb((s,e)=>{let t=e.context.type==hx?e.context.depth:-1,n=s.pos;e:for(;;){let o=0,f=s.next;for(;f==32;)f=s.peek(++o);if(!o&&(km(s,45,o)||km(s,46,o))||!sh(f)&&(t<0&&(t=Math.max(e.context.depth+1,o)),o<t))break;for(;;){if(s.next<0)break e;let d=sh(s.next);if(s.advance(),d)continue e;n=s.pos}}s.acceptTokenTo(KM,n)}),sz=TT({DirectiveName:me.keyword,DirectiveContent:me.attributeValue,"DirectiveEnd DocEnd":me.meta,QuotedLiteral:me.string,BlockLiteralHeader:me.special(me.string),BlockLiteralContent:me.content,Literal:me.content,"Key/Literal Key/QuotedLiteral":me.definition(me.propertyName),"Anchor Alias":me.labelName,Tag:me.typeName,Comment:me.lineComment,": , -":me.separator,"?":me.punctuation,"[ ]":me.squareBracket,"{ }":me.brace}),rz=z0.deserialize({version:14,states:"5lQ!ZQgOOO#PQfO'#CpO#uQfO'#DOOOQR'#Dv'#DvO$qQgO'#DRO%gQdO'#DUO%nQgO'#DUO&ROaO'#D[OOQR'#Du'#DuO&{QgO'#D^O'rQgO'#D`OOQR'#Dt'#DtO(iOqO'#DbOOQP'#Dj'#DjO(zQaO'#CmO)YQgO'#CmOOQP'#Cm'#CmQ)jQaOOQ)uQgOOQ]QgOOO*PQdO'#CrO*nQdO'#CtOOQO'#Dw'#DwO+]Q`O'#CxO+hQdO'#CwO+rQ`O'#CwOOQO'#Cv'#CvO+wQdO'#CvOOQO'#Cq'#CqO,UQ`O,59[O,^QfO,59[OOQR,59[,59[OOQO'#Cx'#CxO,eQ`O'#DPO,pQdO'#DPOOQO'#Dx'#DxO,zQdO'#DxO-XQ`O,59jO-aQfO,59jOOQR,59j,59jOOQR'#DS'#DSO-hQcO,59mO-sQgO'#DVO.TQ`O'#DVO.YQcO,59pOOQR'#DX'#DXO#|QfO'#DWO.hQcO'#DWOOQR,59v,59vO.yOWO,59vO/OOaO,59vO/WOaO,59vO/cQgO'#D_OOQR,59x,59xO0VQgO'#DaOOQR,59z,59zOOQP,59|,59|O0yOaO,59|O1ROaO,59|O1aOqO,59|OOQP-E7h-E7hO1oQgO,59XOOQP,59X,59XO2PQaO'#DeO2_QgO'#DeO2oQgO'#DkOOQP'#Dk'#DkQ)jQaOOO3PQdO'#CsOOQO,59^,59^O3kQdO'#CuOOQO,59`,59`OOQO,59c,59cO4VQdO,59cO4aQdO'#CzO4kQ`O'#CzOOQO,59b,59bOOQU,5:Q,5:QOOQR1G.v1G.vO4pQ`O1G.vOOQU-E7d-E7dO4xQdO,59kOOQO,59k,59kO5SQdO'#DQO5^Q`O'#DQOOQO,5:d,5:dOOQU,5:R,5:ROOQR1G/U1G/UO5cQ`O1G/UOOQU-E7e-E7eO5kQgO'#DhO5xQcO1G/XOOQR1G/X1G/XOOQR,59q,59qO6TQgO,59qO6eQdO'#DiO6lQgO'#DiO7PQcO1G/[OOQR1G/[1G/[OOQR,59r,59rO#|QfO,59rOOQR1G/b1G/bO7_OWO1G/bO7dOaO1G/bOOQR,59y,59yOOQR,59{,59{OOQP1G/h1G/hO7lOaO1G/hO7tOaO1G/hO8POaO1G/hOOQP1G.s1G.sO8_QgO,5:POOQP,5:P,5:POOQP,5:V,5:VOOQP-E7i-E7iOOQO,59_,59_OOQO,59a,59aOOQO1G.}1G.}OOQO,59f,59fO8oQdO,59fOOQR7+$b7+$bP,XQ`O'#DfOOQO1G/V1G/VOOQO,59l,59lO8yQdO,59lOOQR7+$p7+$pP9TQ`O'#DgOOQR'#DT'#DTOOQR,5:S,5:SOOQR-E7f-E7fOOQR7+$s7+$sOOQR1G/]1G/]O9YQgO'#DYO9jQ`O'#DYOOQR,5:T,5:TO#|QfO'#DZO9oQcO'#DZOOQR-E7g-E7gOOQR7+$v7+$vOOQR1G/^1G/^OOQR7+$|7+$|O:QOWO7+$|OOQP7+%S7+%SO:VOaO7+%SO:_OaO7+%SOOQP1G/k1G/kOOQO1G/Q1G/QOOQO1G/W1G/WOOQR,59t,59tO:jQgO,59tOOQR,59u,59uO#|QfO,59uOOQR<<Hh<<HhOOQP<<Hn<<HnO:zOaO<<HnOOQR1G/`1G/`OOQR1G/a1G/aOOQPAN>YAN>Y",stateData:";S~O!fOS!gOS^OS~OP_OQbORSOTUOWROXROYYOZZO[XOcPOqQO!PVO!V[O!cTO~O`cO~P]OVkOWROXROYeOZfO[dOcPOmhOqQO~OboO~P!bOVtOWROXROYeOZfO[dOcPOmrOqQO~OpwO~P#WORSOTUOWROXROYYOZZO[XOcPOqQO!PVO!cTO~OSvP!avP!bvP~P#|OWROXROYeOZfO[dOcPOqQO~OmzO~P%OOm!OOUzP!azP!bzP!dzP~P#|O^!SO!b!QO!f!TO!g!RO~ORSOTUOWROXROcPOqQO!PVO!cTO~OY!UOP!QXQ!QX!V!QX!`!QXS!QX!a!QX!b!QXU!QXm!QX!d!QX~P&aO[!WOP!SXQ!SX!V!SX!`!SXS!SX!a!SX!b!SXU!SXm!SX!d!SX~P&aO^!ZO!W![O!b!YO!f!]O!g!YO~OP!_O!V[OQaX!`aX~OPaXQaX!VaX!`aX~P#|OP!bOQ!cO!V[O~OP_O!V[O~P#|OWROXROY!fOcPOqQObfXmfXofXpfX~OWROXRO[!hOcPOqQObhXmhXohXphX~ObeXmlXoeX~ObkXokX~P%OOm!kO~Om!lObnPonP~P%OOb!pOo!oO~Ob!pO~P!bOm!sOosXpsX~OosXpsX~P%OOm!uOotPptP~P%OOo!xOp!yO~Op!yO~P#WOS!|O!a#OO!b#OO~OUyX!ayX!byX!dyX~P#|Om#QO~OU#SO!a#UO!b#UO!d#RO~Om#WOUzX!azX!bzX!dzX~O]#XO~O!b#XO!g#YO~O^#ZO!b#XO!g#YO~OP!RXQ!RX!V!RX!`!RXS!RX!a!RX!b!RXU!RXm!RX!d!RX~P&aOP!TXQ!TX!V!TX!`!TXS!TX!a!TX!b!TXU!TXm!TX!d!TX~P&aO!b#^O!g#^O~O^#_O!b#^O!f#`O!g#^O~O^#_O!W#aO!b#^O!g#^O~OPaaQaa!Vaa!`aa~P#|OP#cO!V[OQ!XX!`!XX~OP!XXQ!XX!V!XX!`!XX~P#|OP_O!V[OQ!_X!`!_X~P#|OWROXROcPOqQObgXmgXogXpgX~OWROXROcPOqQObiXmiXoiXpiX~Obkaoka~P%OObnXonX~P%OOm#kO~Ob#lOo!oO~Oosapsa~P%OOotXptX~P%OOm#pO~Oo!xOp#qO~OSwP!awP!bwP~P#|OS!|O!a#vO!b#vO~OUya!aya!bya!dya~P#|Om#xO~P%OOm#{OU}P!a}P!b}P!d}P~P#|OU#SO!a$OO!b$OO!d#RO~O]$QO~O!b$QO!g$RO~O!b$SO!g$SO~O^$TO!b$SO!g$SO~O^$TO!b$SO!f$UO!g$SO~OP!XaQ!Xa!V!Xa!`!Xa~P#|Obnaona~P%OOotapta~P%OOo!xO~OU|X!a|X!b|X!d|X~P#|Om$ZO~Om$]OU}X!a}X!b}X!d}X~O]$^O~O!b$_O!g$_O~O^$`O!b$_O!g$_O~OU|a!a|a!b|a!d|a~P#|O!b$cO!g$cO~O",goto:",]!mPPPPPPPPPPPPPPPPP!nPP!v#v#|$`#|$c$f$j$nP%VPPP!v%Y%^%a%{&O%a&R&U&X&_&b%aP&e&{&e'O'RPP']'a'g'm's'y(XPPPPPPPP(_)e*X+c,VUaObcR#e!c!{ROPQSTUXY_bcdehknrtvz!O!U!W!_!b!c!f!h!k!l!s!u!|#Q#R#S#W#c#k#p#x#{$Z$]QmPR!qnqfPQThknrtv!k!l!s!u#R#k#pR!gdR!ieTlPnTjPnSiPnSqQvQ{TQ!mkQ!trQ!vtR#y#RR!nkTsQvR!wt!RWOSUXY_bcz!O!U!W!_!b!c!|#Q#S#W#c#x#{$Z$]RySR#t!|R|TR|UQ!PUR#|#SR#z#RR#z#SyZOSU_bcz!O!_!b!c!|#Q#S#W#c#x#{$Z$]R!VXR!XYa]O^abc!a!c!eT!da!eQnPR!rnQvQR!{vQ!}yR#u!}Q#T|R#}#TW^Obc!cS!^^!aT!aa!eQ!eaR#f!eW`Obc!cQxSS}U#SQ!`_Q#PzQ#V!OQ#b!_Q#d!bQ#s!|Q#w#QQ$P#WQ$V#cQ$Y#xQ$[#{Q$a$ZR$b$]xZOSU_bcz!O!_!b!c!|#Q#S#W#c#x#{$Z$]Q!VXQ!XYQ#[!UR#]!W!QWOSUXY_bcz!O!U!W!_!b!c!|#Q#S#W#c#x#{$Z$]pfPQThknrtv!k!l!s!u#R#k#pQ!gdQ!ieQ#g!fR#h!hSgPn^pQTkrtv#RQ!jhQ#i!kQ#j!lQ#n!sQ#o!uQ$W#kR$X#pQuQR!zv",nodeNames:"⚠ DirectiveEnd DocEnd - - ? ? ? Literal QuotedLiteral Anchor Alias Tag BlockLiteralContent Comment Stream BOM Document ] [ FlowSequence Item Tagged Anchored Anchored Tagged FlowMapping Pair Key : Pair , } { FlowMapping Pair Pair BlockSequence Item Item BlockMapping Pair Pair Key Pair Pair BlockLiteral BlockLiteralHeader Tagged Anchored Anchored Tagged Directive DirectiveName DirectiveContent Document",maxTerm:74,context:WI,nodeProps:[["isolate",-3,8,9,14,""],["openedBy",18,"[",32,"{"],["closedBy",19,"]",33,"}"]],propSources:[sz],skippedNodes:[0],repeatNodeCount:6,tokenData:"-Y~RnOX#PXY$QYZ$]Z]#P]^$]^p#Ppq$Qqs#Pst$btu#Puv$yv|#P|}&e}![#P![!]'O!]!`#P!`!a'i!a!}#P!}#O*g#O#P#P#P#Q+Q#Q#o#P#o#p+k#p#q'i#q#r,U#r;'S#P;'S;=`#z<%l?HT#P?HT?HU,o?HUO#PQ#UU!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PQ#kTOY#PZs#Pt;'S#P;'S;=`#z<%lO#PQ#}P;=`<%l#P~$VQ!f~XY$Qpq$Q~$bO!g~~$gS^~OY$bZ;'S$b;'S;=`$s<%lO$b~$vP;=`<%l$bR%OX!WQOX%kXY#PZ]%k]^#P^p%kpq#hq;'S%k;'S;=`&_<%lO%kR%rX!WQ!VPOX%kXY#PZ]%k]^#P^p%kpq#hq;'S%k;'S;=`&_<%lO%kR&bP;=`<%l%kR&lUoP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR'VUmP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR'p[!PP!WQOY#PZp#Ppq#hq{#P{|(f|}#P}!O(f!O!R#P!R![)p![;'S#P;'S;=`#z<%lO#PR(mW!PP!WQOY#PZp#Ppq#hq!R#P!R![)V![;'S#P;'S;=`#z<%lO#PR)^U!PP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR)wY!PP!WQOY#PZp#Ppq#hq{#P{|)V|}#P}!O)V!O;'S#P;'S;=`#z<%lO#PR*nUcP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR+XUbP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR+rUqP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR,]UpP!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#PR,vU`P!WQOY#PZp#Ppq#hq;'S#P;'S;=`#z<%lO#P",tokenizers:[KI,YI,iz,nz,0,1],topRules:{Stream:[0,15]},tokenPrec:0}),oz=b0.define({name:"yaml",parser:rz.configure({props:[kT.add({Stream:s=>{for(let e=s.node.resolve(s.pos,-1);e&&e.to>=s.pos;e=e.parent){if(e.name=="BlockLiteralContent"&&e.from<e.to)return s.baseIndentFor(e);if(e.name=="BlockLiteral")return s.baseIndentFor(e)+s.unit;if(e.name=="BlockSequence"||e.name=="BlockMapping")return s.column(e.from,1);if(e.name=="QuotedLiteral")return null;if(e.name=="Literal"){let t=s.column(e.from,1);if(t==s.lineIndent(e.from,1))return t;if(e.to>s.pos)return null}}return null},FlowMapping:zw({closing:"}"}),FlowSequence:zw({closing:"]"})}),OT.add({"FlowMapping FlowSequence":NP,"Item Pair BlockLiteral":(s,e)=>({from:e.doc.lineAt(s.from).to,to:s.to})})]}),languageData:{commentTokens:{line:"#"},indentOnInput:/^\s*[\]\}]$/}});function az(){return new AP(oz)}const lz=s=>{const e=Ot.useRef(s);return e.current=s,e},cz=({altKey:s,ctrlKey:e,metaKey:t,shiftKey:n,key:o,onKeyDown:f,targetRef:d})=>{const a=lz(f);Ot.useEffect(()=>{const v=A=>{var P;s&&!A.altKey||A.ctrlKey&&(t&&!A.metaKey||n&&!A.shiftKey||A.key===o&&(A.preventDefault(),(P=a.current)==null||P.call(a,A)))};if(d!=null&&d.current){const A=d.current;return A.addEventListener("keydown",v),()=>A.removeEventListener("keydown",v)}else return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[s,e,o,t,a,n,d])},uz="modulepreload",hz=function(s){return"/maplibre-style-editor/"+s},CS={},fz=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let d=function(A){return Promise.all(A.map(P=>Promise.resolve(P).then(L=>({status:"fulfilled",value:L}),L=>({status:"rejected",reason:L}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),v=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=d(t.map(A=>{if(A=hz(A),A in CS)return;CS[A]=!0;const P=A.endsWith(".css"),L=P?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${L}`))return;const j=document.createElement("link");if(j.rel=P?"stylesheet":uz,P||(j.as="script"),j.crossOrigin="",j.href=A,v&&j.setAttribute("nonce",v),document.head.appendChild(j),P)return new Promise((F,K)=>{j.addEventListener("load",F),j.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${A}`)))})}))}function f(d){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=d,window.dispatchEvent(a),!a.defaultPrevented)throw d}return o.then(d=>{for(const a of d||[])a.status==="rejected"&&f(a.reason);return e().catch(f)})},dz=Ot.createContext(null);function pz(s,e){const t=Array.isArray(s)?s[0]:s?s.x:0,n=Array.isArray(s)?s[1]:s?s.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,f=Array.isArray(e)?e[1]:e?e.y:0;return t===o&&n===f}function jc(s,e){if(s===e)return!0;if(!s||!e)return!1;if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!jc(s[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof s=="object"&&typeof e=="object"){const t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(const o of t)if(!e.hasOwnProperty(o)||!jc(s[o],e[o]))return!1;return!0}return!1}function AS(s){return{longitude:s.center.lng,latitude:s.center.lat,zoom:s.zoom,pitch:s.pitch,bearing:s.bearing,padding:s.padding}}function kS(s,e){const t=e.viewState||e,n={};if("longitude"in t&&"latitude"in t&&(t.longitude!==s.center.lng||t.latitude!==s.center.lat)){const o=s.center.constructor;n.center=new o(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==s.zoom&&(n.zoom=t.zoom),"bearing"in t&&t.bearing!==s.bearing&&(n.bearing=t.bearing),"pitch"in t&&t.pitch!==s.pitch&&(n.pitch=t.pitch),t.padding&&s.padding&&!jc(t.padding,s.padding)&&(n.padding=t.padding),n}const mz=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ES(s){if(!s)return null;if(typeof s=="string"||("toJS"in s&&(s=s.toJS()),!s.layers))return s;const e={};for(const n of s.layers)e[n.id]=n;const t=s.layers.map(n=>{let o=null;"interactive"in n&&(o=Object.assign({},n),delete o.interactive);const f=e[n.ref];if(f){o=o||Object.assign({},n),delete o.ref;for(const d of mz)d in f&&(o[d]=f[d])}return o||n});return{...s,layers:t}}const PS={version:8,sources:{},layers:[]},OS={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},DS={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},RS={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},gz=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],yz=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Em{constructor(e,t,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=o=>{const f=this.props[RS[o.type]];f?f(o):o.type==="error"&&console.error(o.error)},this._onCameraEvent=o=>{if(this._internalUpdate)return;o.viewState=this._propsedCameraUpdate||AS(this._map.transform);const f=this.props[DS[o.type]];f&&f(o)},this._onCameraUpdate=o=>this._internalUpdate?o:(this._propsedCameraUpdate=AS(o),kS(o,this.props)),this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const f=this.props[OS[o.type]];f&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),f(o),delete o.features)},this._MapClass=e,this.props=t,this._initialize(n)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const n=this._updateSettings(e,t),o=this._updateSize(e),f=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(n||o||f&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const n=Em.savedMaps.pop();if(!n)return null;const o=n.map,f=o.getContainer();for(t.className=f.className;f.childNodes.length>0;)t.appendChild(f.childNodes[0]);o._container=t;const d=o._resizeObserver;d&&(d.disconnect(),d.observe(t)),n.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:a}=e;return a&&(a.bounds?o.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):n._updateViewState(a)),o.isStyleLoaded()?o.fire("load"):o.once("style.load",()=>o.fire("load")),o._update(),n}_initialize(e){const{props:t}=this,{mapStyle:n=PS}=t,o={...t,...t.initialViewState,container:e,style:ES(n)},f=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[f.longitude||0,f.latitude||0],zoom:f.zoom||0,pitch:f.pitch||0,bearing:f.bearing||0}),t.gl){const a=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=a,t.gl)}const d=new this._MapClass(o);f.padding&&d.setPadding(f.padding),t.cursor&&(d.getCanvas().style.cursor=t.cursor),d.transformCameraUpdate=this._onCameraUpdate,d.on("style.load",()=>{var a;this._styleComponents={light:d.getLight(),sky:d.getSky(),projection:(a=d.getProjection)==null?void 0:a.call(d),terrain:d.getTerrain()},this._updateStyleComponents(this.props)}),d.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const a in OS)d.on(a,this._onPointerEvent);for(const a in DS)d.on(a,this._onCameraEvent);for(const a in RS)d.on(a,this._onEvent);this._map=d}recycle(){const t=this.map.getContainer().querySelector("[mapboxgl-children]");t==null||t.remove(),Em.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const n=this._map;if(t.width!==n.transform.width||t.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(e){const t=this._map,n=t.transform;if(!t.isMoving()){const f=kS(n,e);if(Object.keys(f).length>0)return this._internalUpdate=!0,t.jumpTo(f),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const n=this._map;let o=!1;for(const f of gz)if(f in e&&!jc(e[f],t[f])){o=!0;const d=n[`set${f[0].toUpperCase()}${f.slice(1)}`];d==null||d.call(n,e[f])}return o}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:n=PS,styleDiffing:o=!0}=e,f={diff:o};"localIdeographFontFamily"in e&&(f.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(ES(n),f)}}_updateStyleComponents({light:e,projection:t,sky:n,terrain:o}){var a,v;const f=this._map,d=this._styleComponents;f.style._loaded&&(e&&!jc(e,d.light)&&(d.light=e,f.setLight(e)),t&&!jc(t,d.projection)&&t!==((a=d.projection)==null?void 0:a.type)&&(d.projection=typeof t=="string"?{type:t}:t,(v=f.setProjection)==null||v.call(f,d.projection)),n&&!jc(n,d.sky)&&(d.sky=n,f.setSky(n)),o!==void 0&&!jc(o,d.terrain)&&(!o||f.getSource(o.source))&&(d.terrain=o,f.setTerrain(o)))}_updateHandlers(e,t){const n=this._map;for(const o of yz){const f=e[o]??!0,d=t[o]??!0;jc(f,d)||(f?n[o].enable(f):n[o].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:n=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:n.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){var o;const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const f=e.type,d=((o=this._hoveredFeatures)==null?void 0:o.length)>0,a=this._queryRenderedFeatures(e.point),v=a.length>0;!v&&d&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,v&&!d&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=f}else this._hoveredFeatures=null}}Em.savedMaps=[];const _z=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function bz(s){if(!s)return null;const e=s.map,t={getMap:()=>e};for(const n of vz(e))!(n in t)&&!_z.includes(n)&&(t[n]=e[n].bind(e));return t}function vz(s){const e=new Set;let t=s;for(;t;){for(const n of Object.getOwnPropertyNames(t))n[0]!=="_"&&typeof s[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&e.add(n);t=Object.getPrototypeOf(t)}return Array.from(e)}const xz=typeof document<"u"?Ot.useLayoutEffect:Ot.useEffect;function wz(s,e){const{RTLTextPlugin:t,maxParallelImageRequests:n,workerCount:o,workerUrl:f}=e;if(t&&s.getRTLTextPluginStatus&&s.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:d,lazy:a=!0}=typeof t=="string"?{pluginUrl:t}:t;s.setRTLTextPlugin(d,v=>{v&&console.error(v)},a)}n!==void 0&&s.setMaxParallelImageRequests(n),o!==void 0&&s.setWorkerCount(o),f!==void 0&&s.setWorkerUrl(f)}const tb=Ot.createContext(null);function Sz(s,e){const t=Ot.useContext(dz),[n,o]=Ot.useState(null),f=Ot.useRef(),{current:d}=Ot.useRef({mapLib:null,map:null});Ot.useEffect(()=>{const A=s.mapLib;let P=!0,L;return Promise.resolve(A||fz(()=>Promise.resolve().then(()=>zz),void 0)).then(j=>{if(!P)return;if(!j)throw new Error("Invalid mapLib");const F="Map"in j?j:j.default;if(!F.Map)throw new Error("Invalid mapLib");wz(F,s),s.reuseMaps&&(L=Em.reuse(s,f.current)),L||(L=new Em(F.Map,s,f.current)),d.map=bz(L),d.mapLib=F,o(L),t==null||t.onMapMount(d.map,s.id)}).catch(j=>{const{onError:F}=s;F?F({type:"error",target:null,originalEvent:null,error:j}):console.error(j)}),()=>{P=!1,L&&(t==null||t.onMapUnmount(s.id),s.reuseMaps?L.recycle():L.destroy())}},[]),xz(()=>{n&&n.setProps(s)}),Ot.useImperativeHandle(e,()=>d.map,[n]);const a=Ot.useMemo(()=>({position:"relative",width:"100%",height:"100%",...s.style}),[s.style]),v={height:"100%"};return Ot.createElement("div",{id:s.id,ref:f,style:a},n&&Ot.createElement(tb.Provider,{value:d},Ot.createElement("div",{"mapboxgl-children":"",style:v},s.children)))}const Tz=Ot.forwardRef(Sz);var tC=GS();const Mz=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function oh(s,e){if(!s||!e)return;const t=s.style;for(const n in e){const o=e[n];Number.isFinite(o)&&!Mz.test(n)?t[n]=`${o}px`:t[n]=o}}function iC(s,e){if(s===e)return null;const t=IS(s),n=IS(e),o=[];for(const f of n)t.has(f)||o.push(f);for(const f of t)n.has(f)||o.push(f);return o.length===0?null:o}function IS(s){return new Set(s?s.trim().split(/\s+/):[])}Ot.memo(Ot.forwardRef((s,e)=>{const{map:t,mapLib:n}=Ot.useContext(tb),o=Ot.useRef({props:s}),f=Ot.useMemo(()=>{let ve=!1;Ot.Children.forEach(s.children,ze=>{ze&&(ve=!0)});const Be={...s,element:ve?document.createElement("div"):void 0},je=new n.Marker(Be);return je.setLngLat([s.longitude,s.latitude]),je.getElement().addEventListener("click",ze=>{var ke,Se;(Se=(ke=o.current.props).onClick)==null||Se.call(ke,{type:"click",target:je,originalEvent:ze})}),je.on("dragstart",ze=>{var Se,Fe;const ke=ze;ke.lngLat=f.getLngLat(),(Fe=(Se=o.current.props).onDragStart)==null||Fe.call(Se,ke)}),je.on("drag",ze=>{var Se,Fe;const ke=ze;ke.lngLat=f.getLngLat(),(Fe=(Se=o.current.props).onDrag)==null||Fe.call(Se,ke)}),je.on("dragend",ze=>{var Se,Fe;const ke=ze;ke.lngLat=f.getLngLat(),(Fe=(Se=o.current.props).onDragEnd)==null||Fe.call(Se,ke)}),je},[]);Ot.useEffect(()=>(f.addTo(t.getMap()),()=>{f.remove()}),[]);const{longitude:d,latitude:a,offset:v,style:A,draggable:P=!1,popup:L=null,rotation:j=0,rotationAlignment:F="auto",pitchAlignment:K="auto"}=s;Ot.useEffect(()=>{oh(f.getElement(),A)},[A]),Ot.useImperativeHandle(e,()=>f,[]);const se=o.current.props;(f.getLngLat().lng!==d||f.getLngLat().lat!==a)&&f.setLngLat([d,a]),v&&!pz(f.getOffset(),v)&&f.setOffset(v),f.isDraggable()!==P&&f.setDraggable(P),f.getRotation()!==j&&f.setRotation(j),f.getRotationAlignment()!==F&&f.setRotationAlignment(F),f.getPitchAlignment()!==K&&f.setPitchAlignment(K),f.getPopup()!==L&&f.setPopup(L);const le=iC(se.className,s.className);if(le)for(const ve of le)f.toggleClassName(ve);return o.current.props=s,tC.createPortal(s.children,f.getElement())}));Ot.memo(Ot.forwardRef((s,e)=>{const{map:t,mapLib:n}=Ot.useContext(tb),o=Ot.useMemo(()=>document.createElement("div"),[]),f=Ot.useRef({props:s}),d=Ot.useMemo(()=>{const a={...s},v=new n.Popup(a);return v.setLngLat([s.longitude,s.latitude]),v.once("open",A=>{var P,L;(L=(P=f.current.props).onOpen)==null||L.call(P,A)}),v},[]);if(Ot.useEffect(()=>{const a=v=>{var A,P;(P=(A=f.current.props).onClose)==null||P.call(A,v)};return d.on("close",a),d.setDOMContent(o).addTo(t.getMap()),()=>{d.off("close",a),d.isOpen()&&d.remove()}},[]),Ot.useEffect(()=>{oh(d.getElement(),s.style)},[s.style]),Ot.useImperativeHandle(e,()=>d,[]),d.isOpen()){const a=f.current.props;(d.getLngLat().lng!==s.longitude||d.getLngLat().lat!==s.latitude)&&d.setLngLat([s.longitude,s.latitude]),s.offset&&!jc(a.offset,s.offset)&&d.setOffset(s.offset),(a.anchor!==s.anchor||a.maxWidth!==s.maxWidth)&&(d.options.anchor=s.anchor,d.setMaxWidth(s.maxWidth));const v=iC(a.className,s.className);if(v)for(const A of v)d.toggleClassName(A);f.current.props=s}return tC.createPortal(s.children,o)}));function Qd(s,e,t,n){const o=Ot.useContext(tb),f=Ot.useMemo(()=>s(o),[]);return Ot.useEffect(()=>{const d=e,a=null,v=typeof e=="function"?e:null,{map:A}=o;return A.hasControl(f)||(A.addControl(f,d==null?void 0:d.position),a&&a(o)),()=>{v&&v(o),A.hasControl(f)&&A.removeControl(f)}},[]),f}function Cz(s){const e=Qd(({mapLib:t})=>new t.AttributionControl(s),{position:s.position});return Ot.useEffect(()=>{oh(e._container,s.style)},[s.style]),null}Ot.memo(Cz);function Az(s){const e=Qd(({mapLib:t})=>new t.FullscreenControl({container:s.containerId&&document.getElementById(s.containerId)}),{position:s.position});return Ot.useEffect(()=>{oh(e._controlContainer,s.style)},[s.style]),null}Ot.memo(Az);function kz(s,e){const t=Ot.useRef({props:s}),n=Qd(({mapLib:o})=>{const f=new o.GeolocateControl(s),d=f._setupUI;return f._setupUI=()=>{f._container.hasChildNodes()||d()},f.on("geolocate",a=>{var v,A;(A=(v=t.current.props).onGeolocate)==null||A.call(v,a)}),f.on("error",a=>{var v,A;(A=(v=t.current.props).onError)==null||A.call(v,a)}),f.on("outofmaxbounds",a=>{var v,A;(A=(v=t.current.props).onOutOfMaxBounds)==null||A.call(v,a)}),f.on("trackuserlocationstart",a=>{var v,A;(A=(v=t.current.props).onTrackUserLocationStart)==null||A.call(v,a)}),f.on("trackuserlocationend",a=>{var v,A;(A=(v=t.current.props).onTrackUserLocationEnd)==null||A.call(v,a)}),f},{position:s.position});return t.current.props=s,Ot.useImperativeHandle(e,()=>n,[]),Ot.useEffect(()=>{oh(n._container,s.style)},[s.style]),null}Ot.memo(Ot.forwardRef(kz));function Ez(s){const e=Qd(({mapLib:t})=>new t.NavigationControl(s),{position:s.position});return Ot.useEffect(()=>{oh(e._container,s.style)},[s.style]),null}Ot.memo(Ez);function Pz(s){const e=Qd(({mapLib:f})=>new f.ScaleControl(s),{position:s.position}),t=Ot.useRef(s),n=t.current;t.current=s;const{style:o}=s;return s.maxWidth!==void 0&&s.maxWidth!==n.maxWidth&&(e.options.maxWidth=s.maxWidth),s.unit!==void 0&&s.unit!==n.unit&&e.setUnit(s.unit),Ot.useEffect(()=>{oh(e._container,o)},[o]),null}Ot.memo(Pz);function Oz(s){const e=Qd(({mapLib:t})=>new t.TerrainControl(s),{position:s.position});return Ot.useEffect(()=>{oh(e._container,s.style)},[s.style]),null}Ot.memo(Oz);function Dz(s){const e=Qd(({mapLib:t})=>new t.LogoControl(s),{position:s.position});return Ot.useEffect(()=>{oh(e._container,s.style)},[s.style]),null}Ot.memo(Dz);var n0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.4.0/LICENSE.txt
 */var Rz=n0.exports,zS;function Iz(){return zS||(zS=1,function(s,e){(function(t,n){s.exports=n()})(Rz,function(){var t={},n={};function o(d,a,v){if(n[d]=v,d==="index"){var A="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",P={};return n.shared(P),n.index(t,P),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),t}}o("shared",["exports"],function(d){function a(u,r,h,m){return new(h||(h=Promise))(function(b,T){function M(z){try{D(m.next(z))}catch(N){T(N)}}function k(z){try{D(m.throw(z))}catch(N){T(N)}}function D(z){var N;z.done?b(z.value):(N=z.value,N instanceof h?N:new h(function(U){U(N)})).then(M,k)}D((m=m.apply(u,r||[])).next())})}function v(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var A,P;function L(){if(P)return A;function u(r,h){this.x=r,this.y=h}return P=1,A=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,h){return this.clone()._rotateAround(r,h)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var h=r.x-this.x,m=r.y-this.y;return h*h+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,h){return Math.atan2(this.x*h-this.y*r,this.x*r+this.y*h)},_matMult:function(r){var h=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=h,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var h=Math.cos(r),m=Math.sin(r),b=m*this.x+h*this.y;return this.x=h*this.x-m*this.y,this.y=b,this},_rotateAround:function(r,h){var m=Math.cos(r),b=Math.sin(r),T=h.y+b*(this.x-h.x)+m*(this.y-h.y);return this.x=h.x+m*(this.x-h.x)-b*(this.y-h.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(r){return r instanceof u?r:Array.isArray(r)?new u(r[0],r[1]):r},A}typeof SuppressedError=="function"&&SuppressedError;var j,F,K=v(L()),se=function(){if(F)return j;function u(r,h,m,b){this.cx=3*r,this.bx=3*(m-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(b-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=h,this.p2x=m,this.p2y=b}return F=1,j=u,u.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,h){if(h===void 0&&(h=1e-6),r<0)return 0;if(r>1)return 1;for(var m=r,b=0;b<8;b++){var T=this.sampleCurveX(m)-r;if(Math.abs(T)<h)return m;var M=this.sampleCurveDerivativeX(m);if(Math.abs(M)<1e-6)break;m-=T/M}var k=0,D=1;for(m=r,b=0;b<20&&(T=this.sampleCurveX(m),!(Math.abs(T-r)<h));b++)r>T?k=m:D=m,m=.5*(D-k)+k;return m},solve:function(r,h){return this.sampleCurveY(this.solveCurveX(r,h))}},j}(),le=v(se);let ve,Be;function je(){return ve==null&&(ve=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ve}function ze(){if(Be==null&&(Be=!1,je())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let m=0;m<5*5;m++){const b=4*m;r.fillStyle=`rgb(${b},${b+1},${b+2})`,r.fillRect(m%5,Math.floor(m/5),1,1)}const h=r.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){Be=!0;break}}}return Be||!1}var ke=1e-6,Se=typeof Float32Array<"u"?Float32Array:Array;function Fe(){var u=new Se(9);return Se!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function He(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function gt(){var u=new Se(3);return Se!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function Et(u){return Math.hypot(u[0],u[1],u[2])}function Mt(u,r,h){var m=new Se(3);return m[0]=u,m[1]=r,m[2]=h,m}Math.hypot||(Math.hypot=function(){for(var u=0,r=arguments.length;r--;)u+=arguments[r]*arguments[r];return Math.sqrt(u)});var ht,Gt=Et;function Ft(u,r,h){var m=r[0],b=r[1],T=r[2],M=r[3];return u[0]=h[0]*m+h[4]*b+h[8]*T+h[12]*M,u[1]=h[1]*m+h[5]*b+h[9]*T+h[13]*M,u[2]=h[2]*m+h[6]*b+h[10]*T+h[14]*M,u[3]=h[3]*m+h[7]*b+h[11]*T+h[15]*M,u}function ei(){var u=new Se(4);return Se!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Xe(){var u=new Se(2);return Se!=Float32Array&&(u[0]=0,u[1]=0),u}function dt(u,r){var h=new Se(2);return h[0]=u,h[1]=r,h}gt(),ht=new Se(4),Se!=Float32Array&&(ht[0]=0,ht[1]=0,ht[2]=0,ht[3]=0),gt(),Mt(1,0,0),Mt(0,1,0),ei(),ei(),Fe(),Xe();const _t=8192;function qt(u,r,h){return r*(_t/(u.tileSize*Math.pow(2,h-u.tileID.overscaledZ)))}function xe(u,r){return(u%r+r)%r}function ot(u,r,h){return u*(1-h)+r*h}function xt(u){if(u<=0)return 0;if(u>=1)return 1;const r=u*u,h=r*u;return 4*(u<.5?h:3*(u-r)+h-.75)}function Tt(u,r,h,m){const b=new le(u,r,h,m);return T=>b.solve(T)}const Rt=Tt(.25,.1,.25,1);function Jt(u,r,h){return Math.min(h,Math.max(r,u))}function Nt(u,r,h){const m=h-r,b=((u-r)%m+m)%m+r;return b===r?h:b}function Ei(u,...r){for(const h of r)for(const m in h)u[m]=h[m];return u}let Ni=1;function ms(u,r,h){const m={};for(const b in u)m[b]=r.call(this,u[b],b,u);return m}function dl(u,r,h){const m={};for(const b in u)r.call(this,u[b],b,u)&&(m[b]=u[b]);return m}function Es(u){return Array.isArray(u)?u.map(Es):typeof u=="object"&&u?ms(u,Es):u}const Hs={};function gs(u){Hs[u]||(typeof console<"u"&&console.warn(u),Hs[u]=!0)}function ji(u,r,h){return(h.y-u.y)*(r.x-u.x)>(r.y-u.y)*(h.x-u.x)}function yo(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let wa=null;function Rn(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Yc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function sc(u,r,h,m,b){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(u,{timestamp:0});try{const M=T==null?void 0:T.format;if(!M||!M.startsWith("BGR")&&!M.startsWith("RGB"))throw new Error(`Unrecognized format ${M}`);const k=M.startsWith("BGR"),D=new Uint8ClampedArray(m*b*4);if(yield T.copyTo(D,function(z,N,U,Z,$){const Q=4*Math.max(1,0),J=(Math.max(0,U)-U)*Z*4+Q,oe=4*Z,fe=Math.max(0,N),Ae=Math.max(0,U);return{rect:{x:fe,y:Ae,width:Math.min(z.width,N+Z)-fe,height:Math.min(z.height,U+$)-Ae},layout:[{offset:J,stride:oe}]}}(u,r,h,m,b)),k)for(let z=0;z<D.length;z+=4){const N=D[z];D[z]=D[z+2],D[z+2]=N}return D}finally{T.close()}})}let tr,br;function pl(u,r,h,m){return u.addEventListener(r,h,m),{unsubscribe:()=>{u.removeEventListener(r,h,m)}}}function Kr(u){return u/Math.PI*180}const Jc={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},rc={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},_o="AbortError";function Kn(){return new Error(_o)}const ys={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Yn(u){return ys.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Uo="global-dispatcher";class Sa extends Error{constructor(r,h,m,b){super(`AJAXError: ${h} (${r}): ${m}`),this.status=r,this.statusText=h,this.url=m,this.body=b}}const bo=()=>yo(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,_s=function(u,r){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const m=Yn(u.url);if(m)return m(u,r);if(yo(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Uo},r)}if(!(/^file:/.test(h=u.url)||/^file:/.test(bo())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return a(this,void 0,void 0,function*(){const T=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:bo(),signal:b.signal});let M,k;m.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");try{M=yield fetch(T)}catch(z){throw new Sa(0,z.message,m.url,new Blob)}if(!M.ok){const z=yield M.blob();throw new Sa(M.status,M.statusText,m.url,z)}k=m.type==="arrayBuffer"||m.type==="image"?M.arrayBuffer():m.type==="json"?M.json():M.text();const D=yield k;if(b.signal.aborted)throw Kn();return{data:D,cacheControl:M.headers.get("Cache-Control"),expires:M.headers.get("Expires")}})}(u,r);if(yo(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Uo},r)}var h;return function(m,b){return new Promise((T,M)=>{var k;const D=new XMLHttpRequest;D.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(D.responseType="arraybuffer");for(const z in m.headers)D.setRequestHeader(z,m.headers[z]);m.type==="json"&&(D.responseType="text",!((k=m.headers)===null||k===void 0)&&k.Accept||D.setRequestHeader("Accept","application/json")),D.withCredentials=m.credentials==="include",D.onerror=()=>{M(new Error(D.statusText))},D.onload=()=>{if(!b.signal.aborted)if((D.status>=200&&D.status<300||D.status===0)&&D.response!==null){let z=D.response;if(m.type==="json")try{z=JSON.parse(D.response)}catch(N){return void M(N)}T({data:z,cacheControl:D.getResponseHeader("Cache-Control"),expires:D.getResponseHeader("Expires")})}else{const z=new Blob([D.response],{type:D.getResponseHeader("Content-Type")});M(new Sa(D.status,D.statusText,m.url,z))}},b.signal.addEventListener("abort",()=>{D.abort(),M(Kn())}),D.send(m.body)})}(u,r)};function Lr(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const r=new URL(u),h=window.location;return r.protocol===h.protocol&&r.host===h.host}function De(u,r,h){h[u]&&h[u].indexOf(r)!==-1||(h[u]=h[u]||[],h[u].push(r))}function ee(u,r,h){if(h&&h[u]){const m=h[u].indexOf(r);m!==-1&&h[u].splice(m,1)}}class te{constructor(r,h={}){Ei(this,h),this.type=r}}class ae extends te{constructor(r,h={}){super("error",Ei({error:r},h))}}class ge{on(r,h){return this._listeners=this._listeners||{},De(r,h,this._listeners),{unsubscribe:()=>{this.off(r,h)}}}off(r,h){return ee(r,h,this._listeners),ee(r,h,this._oneTimeListeners),this}once(r,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},De(r,h,this._oneTimeListeners),this):new Promise(m=>this.once(r,m))}fire(r,h){typeof r=="string"&&(r=new te(r,h||{}));const m=r.type;if(this.listens(m)){r.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const k of b)k.call(this,r);const T=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const k of T)ee(m,k,this._oneTimeListeners),k.call(this,r);const M=this._eventedParent;M&&(Ei(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(r))}else r instanceof ae&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,h){return this._eventedParent=r,this._eventedParentData=h,this}}var ne={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Oe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ve(u,r){const h={};for(const m in u)m!=="ref"&&(h[m]=u[m]);return Oe.forEach(m=>{m in r&&(h[m]=r[m])}),h}function Te(u,r){if(Array.isArray(u)){if(!Array.isArray(r)||u.length!==r.length)return!1;for(let h=0;h<u.length;h++)if(!Te(u[h],r[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&r!==null){if(typeof r!="object"||Object.keys(u).length!==Object.keys(r).length)return!1;for(const h in u)if(!Te(u[h],r[h]))return!1;return!0}return u===r}function Qe(u,r){u.push(r)}function Ye(u,r,h){Qe(h,{command:"addSource",args:[u,r[u]]})}function Re(u,r,h){Qe(r,{command:"removeSource",args:[u]}),h[u]=!0}function at(u,r,h,m){Re(u,h,m),Ye(u,r,h)}function St(u,r,h){let m;for(m in u[h])if(Object.prototype.hasOwnProperty.call(u[h],m)&&m!=="data"&&!Te(u[h][m],r[h][m]))return!1;for(m in r[h])if(Object.prototype.hasOwnProperty.call(r[h],m)&&m!=="data"&&!Te(u[h][m],r[h][m]))return!1;return!0}function Ct(u,r,h,m,b,T){u=u||{},r=r||{};for(const M in u)Object.prototype.hasOwnProperty.call(u,M)&&(Te(u[M],r[M])||h.push({command:T,args:[m,M,r[M],b]}));for(const M in r)Object.prototype.hasOwnProperty.call(r,M)&&!Object.prototype.hasOwnProperty.call(u,M)&&(Te(u[M],r[M])||h.push({command:T,args:[m,M,r[M],b]}))}function Vt(u){return u.id}function Xt(u,r){return u[r.id]=r,u}class We{constructor(r,h,m,b){this.message=(r?`${r}: `:"")+m,b&&(this.identifier=b),h!=null&&h.__line__&&(this.line=h.__line__)}}function Wt(u,...r){for(const h of r)for(const m in h)u[m]=h[m];return u}class _i extends Error{constructor(r,h){super(h),this.message=h,this.key=r}}class zi{constructor(r,h=[]){this.parent=r,this.bindings={};for(const[m,b]of h)this.bindings[m]=b}concat(r){return new zi(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Si={kind:"null"},st={kind:"number"},kt={kind:"string"},Qt={kind:"boolean"},Vn={kind:"color"},In={kind:"projectionDefinition"},Vi={kind:"object"},ti={kind:"value"},En={kind:"collator"},Ta={kind:"formatted"},eu={kind:"padding"},ir={kind:"resolvedImage"},qo={kind:"variableAnchorOffsetCollection"};function os(u,r){return{kind:"array",itemType:u,N:r}}function Wi(u){if(u.kind==="array"){const r=Wi(u.itemType);return typeof u.N=="number"?`array<${r}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${r}>`}return u.kind}const Jn=[Si,st,kt,Qt,Vn,In,Ta,Vi,os(ti),eu,ir,qo];function tu(u,r){if(r.kind==="error")return null;if(u.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!tu(u.itemType,r.itemType))&&(typeof u.N!="number"||u.N===r.N))return null}else{if(u.kind===r.kind)return null;if(u.kind==="value"){for(const h of Jn)if(!tu(h,r))return null}}return`Expected ${Wi(u)} but found ${Wi(r)} instead.`}function ml(u,r){return r.some(h=>h.kind===u.kind)}function nr(u,r){return r.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function Zs(u,r){return u.kind==="array"&&r.kind==="array"?u.itemType.kind===r.itemType.kind&&typeof u.N=="number":u.kind===r.kind}const ah=.96422,Ef=.82521,Ma=4/29,Ca=6/29,iu=3*Ca*Ca,Um=Ca*Ca*Ca,Yd=Math.PI/180,Br=180/Math.PI;function Pf(u){return(u%=360)<0&&(u+=360),u}function Jd([u,r,h,m]){let b,T;const M=lh((.2225045*(u=oc(u))+.7168786*(r=oc(r))+.0606169*(h=oc(h)))/1);u===r&&r===h?b=T=M:(b=lh((.4360747*u+.3850649*r+.1430804*h)/ah),T=lh((.0139322*u+.0971045*r+.7141733*h)/Ef));const k=116*M-16;return[k<0?0:k,500*(b-M),200*(M-T),m]}function oc(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function lh(u){return u>Um?Math.pow(u,1/3):u/iu+Ma}function ac([u,r,h,m]){let b=(u+16)/116,T=isNaN(r)?b:b+r/500,M=isNaN(h)?b:b-h/200;return b=1*sr(b),T=ah*sr(T),M=Ef*sr(M),[gl(3.1338561*T-1.6168667*b-.4906146*M),gl(-.9787684*T+1.9161415*b+.033454*M),gl(.0719453*T-.2289914*b+1.4052427*M),m]}function gl(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function sr(u){return u>Ca?u*u*u:iu*(u-Ma)}function lc(u){return parseInt(u.padEnd(2,u),16)/255}function yl(u,r){return Aa(r?u/100:u,0,1)}function Aa(u,r,h){return Math.min(Math.max(r,u),h)}function _l(u){return!u.some(Number.isNaN)}const ep={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function vo(u,r,h){return u+h*(r-u)}function Yr(u,r,h){return u.map((m,b)=>vo(m,r[b],h))}class hi{constructor(r,h,m,b=1,T=!0){this.r=r,this.g=h,this.b=m,this.a=b,T||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[r,h,m,b]))}static parse(r){if(r instanceof hi)return r;if(typeof r!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=ep[m];if(b){const[M,k,D]=b;return[M/255,k/255,D/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const M=m.length<6?1:2;let k=1;return[lc(m.slice(k,k+=M)),lc(m.slice(k,k+=M)),lc(m.slice(k,k+=M)),lc(m.slice(k,k+M)||"ff")]}if(m.startsWith("rgb")){const M=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[k,D,z,N,U,Z,$,Q,J,oe,fe,Ae]=M,pe=[N||" ",$||" ",oe].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const G=[z,Z,J].join(""),re=G==="%%%"?100:G===""?255:0;if(re){const ye=[Aa(+D/re,0,1),Aa(+U/re,0,1),Aa(+Q/re,0,1),fe?yl(+fe,Ae):1];if(_l(ye))return ye}}return}}const T=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[M,k,D,z,N,U,Z,$,Q]=T,J=[D||" ",N||" ",Z].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const oe=[+k,Aa(+z,0,100),Aa(+U,0,100),$?yl(+$,Q):1];if(_l(oe))return function([fe,Ae,pe,G]){function re(ye){const Ue=(ye+fe/30)%12,ut=Ae*Math.min(pe,1-pe);return pe-ut*Math.max(-1,Math.min(Ue-3,9-Ue,1))}return fe=Pf(fe),Ae/=100,pe/=100,[re(0),re(8),re(4),G]}(oe)}}}(r);return h?new hi(...h,!1):void 0}get rgb(){const{r,g:h,b:m,a:b}=this,T=b||1/0;return this.overwriteGetter("rgb",[r/T,h/T,m/T,b])}get hcl(){return this.overwriteGetter("hcl",function(r){const[h,m,b,T]=Jd(r),M=Math.sqrt(m*m+b*b);return[Math.round(1e4*M)?Pf(Math.atan2(b,m)*Br):NaN,M,h,T]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Jd(this.rgb))}overwriteGetter(r,h){return Object.defineProperty(this,r,{value:h}),h}toString(){const[r,h,m,b]=this.rgb;return`rgba(${[r,h,m].map(T=>Math.round(255*T)).join(",")},${b})`}static interpolate(r,h,m,b="rgb"){switch(b){case"rgb":{const[T,M,k,D]=Yr(r.rgb,h.rgb,m);return new hi(T,M,k,D,!1)}case"hcl":{const[T,M,k,D]=r.hcl,[z,N,U,Z]=h.hcl;let $,Q;if(isNaN(T)||isNaN(z))isNaN(T)?isNaN(z)?$=NaN:($=z,k!==1&&k!==0||(Q=N)):($=T,U!==1&&U!==0||(Q=M));else{let pe=z-T;z>T&&pe>180?pe-=360:z<T&&T-z>180&&(pe+=360),$=T+m*pe}const[J,oe,fe,Ae]=function([pe,G,re,ye]){return pe=isNaN(pe)?0:pe*Yd,ac([re,Math.cos(pe)*G,Math.sin(pe)*G,ye])}([$,Q??vo(M,N,m),vo(k,U,m),vo(D,Z,m)]);return new hi(J,oe,fe,Ae,!1)}case"lab":{const[T,M,k,D]=ac(Yr(r.lab,h.lab,m));return new hi(T,M,k,D,!1)}}}}hi.black=new hi(0,0,0,1),hi.white=new hi(1,1,1,1),hi.transparent=new hi(0,0,0,0),hi.red=new hi(1,0,0,1);class bi{constructor(r,h,m){this.sensitivity=r?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,h){return this.collator.compare(r,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const bl=["bottom","center","top"];class Nr{constructor(r,h,m,b,T,M){this.text=r,this.image=h,this.scale=m,this.fontStack=b,this.textColor=T,this.verticalAlign=M}}class rr{constructor(r){this.sections=r}static fromString(r){return new rr([new Nr(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof rr?r:rr.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Ps{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Ps)return r;if(typeof r=="number")return new Ps([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const h of r)if(typeof h!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Ps(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,h,m){return new Ps(Yr(r.values,h.values,m))}}class rn{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const vl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class es{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof es)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let h=0;h<r.length;h+=2){const m=r[h],b=r[h+1];if(typeof m!="string"||!vl.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new es(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,h,m){const b=r.values,T=h.values;if(b.length!==T.length)throw new rn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${h.toString()}`);const M=[];for(let k=0;k<b.length;k+=2){if(b[k]!==T[k])throw new rn(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${b[k]}, to[${k}]: ${T[k]}`);M.push(b[k]);const[D,z]=b[k+1],[N,U]=T[k+1];M.push([vo(D,N,m),vo(z,U,m)])}return new es(M)}}class as{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new as({name:r,available:!1}):null}}class Un{constructor(r,h,m){this.from=r,this.to=h,this.transition=m}static interpolate(r,h,m){return new Un(r,h,m)}static parse(r){return r instanceof Un?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new Un(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new Un(r.from,r.to,r.transition):typeof r=="string"?new Un(r,r,1):void 0}}function Ho(u,r,h,m){return typeof u=="number"&&u>=0&&u<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[u,r,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[u,r,h,m]:[u,r,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xl(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Un||u instanceof hi||u instanceof bi||u instanceof rr||u instanceof Ps||u instanceof es||u instanceof as)return!0;if(Array.isArray(u)){for(const r of u)if(!xl(r))return!1;return!0}if(typeof u=="object"){for(const r in u)if(!xl(u[r]))return!1;return!0}return!1}function mn(u){if(u===null)return Si;if(typeof u=="string")return kt;if(typeof u=="boolean")return Qt;if(typeof u=="number")return st;if(u instanceof hi)return Vn;if(u instanceof Un)return In;if(u instanceof bi)return En;if(u instanceof rr)return Ta;if(u instanceof Ps)return eu;if(u instanceof es)return qo;if(u instanceof as)return ir;if(Array.isArray(u)){const r=u.length;let h;for(const m of u){const b=mn(m);if(h){if(h===b)continue;h=ti;break}h=b}return os(h||ti,r)}return Vi}function or(u){const r=typeof u;return u===null?"":r==="string"||r==="number"||r==="boolean"?String(u):u instanceof hi||u instanceof Un||u instanceof rr||u instanceof Ps||u instanceof es||u instanceof as?u.toString():JSON.stringify(u)}class Os{constructor(r,h){this.type=r,this.value=h}static parse(r,h){if(r.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!xl(r[1]))return h.error("invalid value");const m=r[1];let b=mn(m);const T=h.expectedType;return b.kind!=="array"||b.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(b=T),new Os(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const wl={string:kt,number:st,boolean:Qt,object:Vi};class Ds{constructor(r,h){this.type=r,this.args=h}static parse(r,h){if(r.length<2)return h.error("Expected at least one argument.");let m,b=1;const T=r[0];if(T==="array"){let k,D;if(r.length>2){const z=r[1];if(typeof z!="string"||!(z in wl)||z==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);k=wl[z],b++}else k=ti;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return h.error('The length argument to "array" must be a positive integer literal',2);D=r[2],b++}m=os(k,D)}else{if(!wl[T])throw new Error(`Types doesn't contain name = ${T}`);m=wl[T]}const M=[];for(;b<r.length;b++){const k=h.parse(r[b],b,ti);if(!k)return null;M.push(k)}return new Ds(m,M)}evaluate(r){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(r);if(!tu(this.type,mn(m)))return m;if(h===this.args.length-1)throw new rn(`Expected value to be of type ${Wi(this.type)}, but found ${Wi(mn(m))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Fr={"to-boolean":Qt,"to-color":Vn,"to-number":st,"to-string":kt};class Ai{constructor(r,h){this.type=r,this.args=h}static parse(r,h){if(r.length<2)return h.error("Expected at least one argument.");const m=r[0];if(!Fr[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&r.length!==2)return h.error("Expected one argument.");const b=Fr[m],T=[];for(let M=1;M<r.length;M++){const k=h.parse(r[M],M,ti);if(!k)return null;T.push(k)}return new Ai(b,T)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let h,m;for(const b of this.args){if(h=b.evaluate(r),m=null,h instanceof hi)return h;if(typeof h=="string"){const T=r.parseColor(h);if(T)return T}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rgba value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Ho(h[0],h[1],h[2],h[3]),!m))return new hi(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new rn(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(r);const b=Ps.parse(h);if(b)return b}throw new rn(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(r);const b=es.parse(h);if(b)return b}throw new rn(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(r),h===null)return 0;const b=Number(h);if(!isNaN(b))return b}throw new rn(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return rr.fromString(or(this.args[0].evaluate(r)));case"resolvedImage":return as.fromString(or(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return or(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const cc=["Unknown","Point","LineString","Polygon"];class Ti{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let h=this._parseColorCache[r];return h||(h=this._parseColorCache[r]=hi.parse(r)),h}}class ri{constructor(r,h,m=[],b,T=new zi,M=[]){this.registry=r,this.path=m,this.key=m.map(k=>`[${k}]`).join(""),this.scope=T,this.errors=M,this.expectedType=b,this._isConstant=h}parse(r,h,m,b,T={}){return h?this.concat(h,m,b)._parse(r,T):this._parse(r,T)}_parse(r,h){function m(b,T,M){return M==="assert"?new Ds(T,[b]):M==="coerce"?new Ai(T,[b]):b}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=r[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[b];if(T){let M=T.parse(r,this);if(!M)return null;if(this.expectedType){const k=this.expectedType,D=M.type;if(k.kind!=="string"&&k.kind!=="number"&&k.kind!=="boolean"&&k.kind!=="object"&&k.kind!=="array"||D.kind!=="value")if(k.kind!=="projectionDefinition"||D.kind!=="string"&&D.kind!=="array")if(k.kind!=="color"&&k.kind!=="formatted"&&k.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string")if(k.kind!=="padding"||D.kind!=="value"&&D.kind!=="number"&&D.kind!=="array")if(k.kind!=="variableAnchorOffsetCollection"||D.kind!=="value"&&D.kind!=="array"){if(this.checkSubtype(k,D))return null}else M=m(M,k,h.typeAnnotation||"coerce");else M=m(M,k,h.typeAnnotation||"coerce");else M=m(M,k,h.typeAnnotation||"coerce");else M=m(M,k,h.typeAnnotation||"coerce");else M=m(M,k,h.typeAnnotation||"assert")}if(!(M instanceof Os)&&M.type.kind!=="resolvedImage"&&this._isConstant(M)){const k=new Ti;try{M=new Os(M.type,M.evaluate(k))}catch(D){return this.error(D.message),null}}return M}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,h,m){const b=typeof r=="number"?this.path.concat(r):this.path,T=m?this.scope.concat(m):this.scope;return new ri(this.registry,this._isConstant,b,h||null,T,this.errors)}error(r,...h){const m=`${this.key}${h.map(b=>`[${b}]`).join("")}`;this.errors.push(new _i(m,r))}checkSubtype(r,h){const m=tu(r,h);return m&&this.error(m),m}}class Zo{constructor(r,h){this.type=h.type,this.bindings=[].concat(r),this.result=h}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const h of this.bindings)r(h[1]);r(this.result)}static parse(r,h){if(r.length<4)return h.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const m=[];for(let T=1;T<r.length-1;T+=2){const M=r[T];if(typeof M!="string")return h.error(`Expected string, but found ${typeof M} instead.`,T);if(/[^a-zA-Z0-9_]/.test(M))return h.error("Variable names must contain only alphanumeric characters or '_'.",T);const k=h.parse(r[T+1],T+1);if(!k)return null;m.push([M,k])}const b=h.parse(r[r.length-1],r.length-1,h.expectedType,m);return b?new Zo(m,b):null}outputDefined(){return this.result.outputDefined()}}class vi{constructor(r,h){this.type=h.type,this.name=r,this.boundExpression=h}static parse(r,h){if(r.length!==2||typeof r[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=r[1];return h.scope.has(m)?new vi(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class ls{constructor(r,h,m){this.type=r,this.index=h,this.input=m}static parse(r,h){if(r.length!==3)return h.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const m=h.parse(r[1],1,st),b=h.parse(r[2],2,os(h.expectedType||ti));return m&&b?new ls(b.type.itemType,m,b):null}evaluate(r){const h=this.index.evaluate(r),m=this.input.evaluate(r);if(h<0)throw new rn(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new rn(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new rn(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class bs{constructor(r,h){this.type=Qt,this.needle=r,this.haystack=h}static parse(r,h){if(r.length!==3)return h.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const m=h.parse(r[1],1,ti),b=h.parse(r[2],2,ti);return m&&b?ml(m.type,[Qt,kt,st,Si,ti])?new bs(m,b):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(m.type)} instead`):null}evaluate(r){const h=this.needle.evaluate(r),m=this.haystack.evaluate(r);if(!m)return!1;if(!nr(h,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(mn(h))} instead.`);if(!nr(m,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${Wi(mn(m))} instead.`);return m.indexOf(h)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Go{constructor(r,h,m){this.type=st,this.needle=r,this.haystack=h,this.fromIndex=m}static parse(r,h){if(r.length<=2||r.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const m=h.parse(r[1],1,ti),b=h.parse(r[2],2,ti);if(!m||!b)return null;if(!ml(m.type,[Qt,kt,st,Si,ti]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(m.type)} instead`);if(r.length===4){const T=h.parse(r[3],3,st);return T?new Go(m,b,T):null}return new Go(m,b)}evaluate(r){const h=this.needle.evaluate(r),m=this.haystack.evaluate(r);if(!nr(h,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(mn(h))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(r)),nr(m,["string"])){const T=m.indexOf(h,b);return T===-1?-1:[...m.slice(0,T)].length}if(nr(m,["array"]))return m.indexOf(h,b);throw new rn(`Expected second argument to be of type array or string, but found ${Wi(mn(m))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class ka{constructor(r,h,m,b,T,M){this.inputType=r,this.type=h,this.input=m,this.cases=b,this.outputs=T,this.otherwise=M}static parse(r,h){if(r.length<5)return h.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return h.error("Expected an even number of arguments.");let m,b;h.expectedType&&h.expectedType.kind!=="value"&&(b=h.expectedType);const T={},M=[];for(let z=2;z<r.length-1;z+=2){let N=r[z];const U=r[z+1];Array.isArray(N)||(N=[N]);const Z=h.concat(z);if(N.length===0)return Z.error("Expected at least one branch label.");for(const Q of N){if(typeof Q!="number"&&typeof Q!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return Z.error("Numeric branch labels must be integer values.");if(m){if(Z.checkSubtype(m,mn(Q)))return null}else m=mn(Q);if(T[String(Q)]!==void 0)return Z.error("Branch labels must be unique.");T[String(Q)]=M.length}const $=h.parse(U,z,b);if(!$)return null;b=b||$.type,M.push($)}const k=h.parse(r[1],1,ti);if(!k)return null;const D=h.parse(r[r.length-1],r.length-1,b);return D?k.type.kind!=="value"&&h.concat(1).checkSubtype(m,k.type)?null:new ka(m,b,k,T,M,D):null}evaluate(r){const h=this.input.evaluate(r);return(mn(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class ch{constructor(r,h,m){this.type=r,this.branches=h,this.otherwise=m}static parse(r,h){if(r.length<4)return h.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const b=[];for(let M=1;M<r.length-1;M+=2){const k=h.parse(r[M],M,Qt);if(!k)return null;const D=h.parse(r[M+1],M+1,m);if(!D)return null;b.push([k,D]),m=m||D.type}const T=h.parse(r[r.length-1],r.length-1,m);if(!T)return null;if(!m)throw new Error("Can't infer output type");return new ch(m,b,T)}evaluate(r){for(const[h,m]of this.branches)if(h.evaluate(r))return m.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[h,m]of this.branches)r(h),r(m);r(this.otherwise)}outputDefined(){return this.branches.every(([r,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Ea{constructor(r,h,m,b){this.type=r,this.input=h,this.beginIndex=m,this.endIndex=b}static parse(r,h){if(r.length<=2||r.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const m=h.parse(r[1],1,ti),b=h.parse(r[2],2,st);if(!m||!b)return null;if(!ml(m.type,[os(ti),kt,ti]))return h.error(`Expected first argument to be of type array or string, but found ${Wi(m.type)} instead`);if(r.length===4){const T=h.parse(r[3],3,st);return T?new Ea(m.type,m,b,T):null}return new Ea(m.type,m,b)}evaluate(r){const h=this.input.evaluate(r),m=this.beginIndex.evaluate(r);let b;if(this.endIndex&&(b=this.endIndex.evaluate(r)),nr(h,["string"]))return[...h].slice(m,b).join("");if(nr(h,["array"]))return h.slice(m,b);throw new rn(`Expected first argument to be of type array or string, but found ${Wi(mn(h))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Sl(u,r){const h=u.length-1;let m,b,T=0,M=h,k=0;for(;T<=M;)if(k=Math.floor((T+M)/2),m=u[k],b=u[k+1],m<=r){if(k===h||r<b)return k;T=k+1}else{if(!(m>r))throw new rn("Input is not a number.");M=k-1}return 0}class $o{constructor(r,h,m){this.type=r,this.input=h,this.labels=[],this.outputs=[];for(const[b,T]of m)this.labels.push(b),this.outputs.push(T)}static parse(r,h){if(r.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(r[1],1,st);if(!m)return null;const b=[];let T=null;h.expectedType&&h.expectedType.kind!=="value"&&(T=h.expectedType);for(let M=1;M<r.length;M+=2){const k=M===1?-1/0:r[M],D=r[M+1],z=M,N=M+1;if(typeof k!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(b.length&&b[b.length-1][0]>=k)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const U=h.parse(D,N,T);if(!U)return null;T=T||U.type,b.push([k,U])}return new $o(T,m,b)}evaluate(r){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(r);const b=this.input.evaluate(r);if(b<=h[0])return m[0].evaluate(r);const T=h.length;return b>=h[T-1]?m[T-1].evaluate(r):m[Sl(h,b)].evaluate(r)}eachChild(r){r(this.input);for(const h of this.outputs)r(h)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function nu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var su,uc,Rs=function(){if(uc)return su;function u(r,h,m,b){this.cx=3*r,this.bx=3*(m-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(b-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=h,this.p2x=m,this.p2y=b}return uc=1,su=u,u.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,h){if(h===void 0&&(h=1e-6),r<0)return 0;if(r>1)return 1;for(var m=r,b=0;b<8;b++){var T=this.sampleCurveX(m)-r;if(Math.abs(T)<h)return m;var M=this.sampleCurveDerivativeX(m);if(Math.abs(M)<1e-6)break;m-=T/M}var k=0,D=1;for(m=r,b=0;b<20&&(T=this.sampleCurveX(m),!(Math.abs(T-r)<h));b++)r>T?k=m:D=m,m=.5*(D-k)+k;return m},solve:function(r,h){return this.sampleCurveY(this.solveCurveX(r,h))}},su}(),uh=nu(Rs);class Is{constructor(r,h,m,b,T){this.type=r,this.operator=h,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[M,k]of T)this.labels.push(M),this.outputs.push(k)}static interpolationFactor(r,h,m,b){let T=0;if(r.name==="exponential")T=hc(h,r.base,m,b);else if(r.name==="linear")T=hc(h,1,m,b);else if(r.name==="cubic-bezier"){const M=r.controlPoints;T=new uh(M[0],M[1],M[2],M[3]).solve(hc(h,1,m,b))}return T}static parse(r,h){let[m,b,T,...M]=r;if(!Array.isArray(b)||b.length===0)return h.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const z=b[1];if(typeof z!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:z}}else{if(b[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const z=b.slice(1);if(z.length!==4||z.some(N=>typeof N!="number"||N<0||N>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:z}}}if(r.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(T=h.parse(T,2,st),!T)return null;const k=[];let D=null;m==="interpolate-hcl"||m==="interpolate-lab"?D=Vn:h.expectedType&&h.expectedType.kind!=="value"&&(D=h.expectedType);for(let z=0;z<M.length;z+=2){const N=M[z],U=M[z+1],Z=z+3,$=z+4;if(typeof N!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(k.length&&k[k.length-1][0]>=N)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const Q=h.parse(U,$,D);if(!Q)return null;D=D||Q.type,k.push([N,Q])}return Zs(D,st)||Zs(D,In)||Zs(D,Vn)||Zs(D,eu)||Zs(D,qo)||Zs(D,os(st))?new Is(D,m,b,T,k):h.error(`Type ${Wi(D)} is not interpolatable.`)}evaluate(r){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(r);const b=this.input.evaluate(r);if(b<=h[0])return m[0].evaluate(r);const T=h.length;if(b>=h[T-1])return m[T-1].evaluate(r);const M=Sl(h,b),k=Is.interpolationFactor(this.interpolation,b,h[M],h[M+1]),D=m[M].evaluate(r),z=m[M+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return vo(D,z,k);case"color":return hi.interpolate(D,z,k);case"padding":return Ps.interpolate(D,z,k);case"variableAnchorOffsetCollection":return es.interpolate(D,z,k);case"array":return Yr(D,z,k);case"projectionDefinition":return Un.interpolate(D,z,k)}case"interpolate-hcl":return hi.interpolate(D,z,k,"hcl");case"interpolate-lab":return hi.interpolate(D,z,k,"lab")}}eachChild(r){r(this.input);for(const h of this.outputs)r(h)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function hc(u,r,h,m){const b=m-h,T=u-h;return b===0?0:r===1?T/b:(Math.pow(r,T)-1)/(Math.pow(r,b)-1)}const Ki={color:hi.interpolate,number:vo,padding:Ps.interpolate,variableAnchorOffsetCollection:es.interpolate,array:Yr};class ru{constructor(r,h){this.type=r,this.args=h}static parse(r,h){if(r.length<2)return h.error("Expected at least one argument.");let m=null;const b=h.expectedType;b&&b.kind!=="value"&&(m=b);const T=[];for(const k of r.slice(1)){const D=h.parse(k,1+T.length,m,void 0,{typeAnnotation:"omit"});if(!D)return null;m=m||D.type,T.push(D)}if(!m)throw new Error("No output type");const M=b&&T.some(k=>tu(b,k.type));return new ru(M?ti:m,T)}evaluate(r){let h,m=null,b=0;for(const T of this.args)if(b++,m=T.evaluate(r),m&&m instanceof as&&!m.available&&(h||(h=m.name),m=null,b===this.args.length&&(m=h)),m!==null)break;return m}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function hh(u,r){return u==="=="||u==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Of(u,r,h,m){return m.compare(r,h)===0}function Tl(u,r,h){const m=u!=="=="&&u!=="!=";return class nC{constructor(T,M,k){this.type=Qt,this.lhs=T,this.rhs=M,this.collator=k,this.hasUntypedArgument=T.type.kind==="value"||M.type.kind==="value"}static parse(T,M){if(T.length!==3&&T.length!==4)return M.error("Expected two or three arguments.");const k=T[0];let D=M.parse(T[1],1,ti);if(!D)return null;if(!hh(k,D.type))return M.concat(1).error(`"${k}" comparisons are not supported for type '${Wi(D.type)}'.`);let z=M.parse(T[2],2,ti);if(!z)return null;if(!hh(k,z.type))return M.concat(2).error(`"${k}" comparisons are not supported for type '${Wi(z.type)}'.`);if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return M.error(`Cannot compare types '${Wi(D.type)}' and '${Wi(z.type)}'.`);m&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new Ds(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new Ds(D.type,[z])));let N=null;if(T.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if(N=M.parse(T[3],3,En),!N)return null}return new nC(D,z,N)}evaluate(T){const M=this.lhs.evaluate(T),k=this.rhs.evaluate(T);if(m&&this.hasUntypedArgument){const D=mn(M),z=mn(k);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new rn(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${D.kind}, ${z.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const D=mn(M),z=mn(k);if(D.kind!=="string"||z.kind!=="string")return r(T,M,k)}return this.collator?h(T,M,k,this.collator.evaluate(T)):r(T,M,k)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const fh=Tl("==",function(u,r,h){return r===h},Of),Df=Tl("!=",function(u,r,h){return r!==h},function(u,r,h,m){return!Of(0,r,h,m)}),qm=Tl("<",function(u,r,h){return r<h},function(u,r,h,m){return m.compare(r,h)<0}),dh=Tl(">",function(u,r,h){return r>h},function(u,r,h,m){return m.compare(r,h)>0}),fc=Tl("<=",function(u,r,h){return r<=h},function(u,r,h,m){return m.compare(r,h)<=0}),Jr=Tl(">=",function(u,r,h){return r>=h},function(u,r,h,m){return m.compare(r,h)>=0});class ou{constructor(r,h,m){this.type=En,this.locale=m,this.caseSensitive=r,this.diacriticSensitive=h}static parse(r,h){if(r.length!==2)return h.error("Expected one argument.");const m=r[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const b=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,Qt);if(!b)return null;const T=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,Qt);if(!T)return null;let M=null;return m.locale&&(M=h.parse(m.locale,1,kt),!M)?null:new ou(b,T,M)}evaluate(r){return new bi(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class dc{constructor(r,h,m,b,T){this.type=kt,this.number=r,this.locale=h,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=T}static parse(r,h){if(r.length!==3)return h.error("Expected two arguments.");const m=h.parse(r[1],1,st);if(!m)return null;const b=r[2];if(typeof b!="object"||Array.isArray(b))return h.error("NumberFormat options argument must be an object.");let T=null;if(b.locale&&(T=h.parse(b.locale,1,kt),!T))return null;let M=null;if(b.currency&&(M=h.parse(b.currency,1,kt),!M))return null;let k=null;if(b["min-fraction-digits"]&&(k=h.parse(b["min-fraction-digits"],1,st),!k))return null;let D=null;return b["max-fraction-digits"]&&(D=h.parse(b["max-fraction-digits"],1,st),!D)?null:new dc(m,T,M,k,D)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class au{constructor(r){this.type=Ta,this.sections=r}static parse(r,h){if(r.length<2)return h.error("Expected at least one argument.");const m=r[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const b=[];let T=!1;for(let M=1;M<=r.length-1;++M){const k=r[M];if(T&&typeof k=="object"&&!Array.isArray(k)){T=!1;let D=null;if(k["font-scale"]&&(D=h.parse(k["font-scale"],1,st),!D))return null;let z=null;if(k["text-font"]&&(z=h.parse(k["text-font"],1,os(kt)),!z))return null;let N=null;if(k["text-color"]&&(N=h.parse(k["text-color"],1,Vn),!N))return null;let U=null;if(k["vertical-align"]){if(typeof k["vertical-align"]=="string"&&!bl.includes(k["vertical-align"]))return h.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${k["vertical-align"]}' instead.`);if(U=h.parse(k["vertical-align"],1,kt),!U)return null}const Z=b[b.length-1];Z.scale=D,Z.font=z,Z.textColor=N,Z.verticalAlign=U}else{const D=h.parse(r[M],1,ti);if(!D)return null;const z=D.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,b.push({content:D,scale:null,font:null,textColor:null,verticalAlign:null})}}return new au(b)}evaluate(r){return new rr(this.sections.map(h=>{const m=h.content.evaluate(r);return mn(m)===ir?new Nr("",m,null,null,null,h.verticalAlign?h.verticalAlign.evaluate(r):null):new Nr(or(m),null,h.scale?h.scale.evaluate(r):null,h.font?h.font.evaluate(r).join(","):null,h.textColor?h.textColor.evaluate(r):null,h.verticalAlign?h.verticalAlign.evaluate(r):null)}))}eachChild(r){for(const h of this.sections)r(h.content),h.scale&&r(h.scale),h.font&&r(h.font),h.textColor&&r(h.textColor),h.verticalAlign&&r(h.verticalAlign)}outputDefined(){return!1}}class lu{constructor(r){this.type=ir,this.input=r}static parse(r,h){if(r.length!==2)return h.error("Expected two arguments.");const m=h.parse(r[1],1,kt);return m?new lu(m):h.error("No image name provided.")}evaluate(r){const h=this.input.evaluate(r),m=as.fromString(h);return m&&r.availableImages&&(m.available=r.availableImages.indexOf(h)>-1),m}eachChild(r){r(this.input)}outputDefined(){return!1}}class Rf{constructor(r){this.type=st,this.input=r}static parse(r,h){if(r.length!==2)return h.error(`Expected 1 argument, but found ${r.length-1} instead.`);const m=h.parse(r[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Wi(m.type)} instead.`):new Rf(m):null}evaluate(r){const h=this.input.evaluate(r);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new rn(`Expected value to be of type string or array, but found ${Wi(mn(h))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const xo=8192;function Hm(u,r){const h=(180+u[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,b=Math.pow(2,r.z);return[Math.round(h*b*xo),Math.round(m*b*xo)]}function If(u,r){const h=Math.pow(2,r.z);return[(b=(u[0]/xo+r.x)/h,360*b-180),(m=(u[1]/xo+r.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,b}function Pa(u,r){u[0]=Math.min(u[0],r[0]),u[1]=Math.min(u[1],r[1]),u[2]=Math.max(u[2],r[0]),u[3]=Math.max(u[3],r[1])}function cu(u,r){return!(u[0]<=r[0]||u[2]>=r[2]||u[1]<=r[1]||u[3]>=r[3])}function tp(u,r,h){const m=u[0]-r[0],b=u[1]-r[1],T=u[0]-h[0],M=u[1]-h[1];return m*M-T*b==0&&m*T<=0&&b*M<=0}function uu(u,r,h,m){return(b=[m[0]-h[0],m[1]-h[1]])[0]*(T=[r[0]-u[0],r[1]-u[1]])[1]-b[1]*T[0]!=0&&!(!Bf(u,r,h,m)||!Bf(h,m,u,r));var b,T}function zf(u,r,h){for(const m of h)for(let b=0;b<m.length-1;++b)if(uu(u,r,m[b],m[b+1]))return!0;return!1}function eo(u,r,h=!1){let m=!1;for(const k of r)for(let D=0;D<k.length-1;D++){if(tp(u,k[D],k[D+1]))return h;(T=k[D])[1]>(b=u)[1]!=(M=k[D+1])[1]>b[1]&&b[0]<(M[0]-T[0])*(b[1]-T[1])/(M[1]-T[1])+T[0]&&(m=!m)}var b,T,M;return m}function Zm(u,r){for(const h of r)if(eo(u,h))return!0;return!1}function Lf(u,r){for(const h of u)if(!eo(h,r))return!1;for(let h=0;h<u.length-1;++h)if(zf(u[h],u[h+1],r))return!1;return!0}function ip(u,r){for(const h of r)if(Lf(u,h))return!0;return!1}function Bf(u,r,h,m){const b=m[0]-h[0],T=m[1]-h[1],M=(u[0]-h[0])*T-b*(u[1]-h[1]),k=(r[0]-h[0])*T-b*(r[1]-h[1]);return M>0&&k<0||M<0&&k>0}function ph(u,r,h){const m=[];for(let b=0;b<u.length;b++){const T=[];for(let M=0;M<u[b].length;M++){const k=Hm(u[b][M],h);Pa(r,k),T.push(k)}m.push(T)}return m}function mh(u,r,h){const m=[];for(let b=0;b<u.length;b++){const T=ph(u[b],r,h);m.push(T)}return m}function Oa(u,r,h,m){if(u[0]<h[0]||u[0]>h[2]){const b=.5*m;let T=u[0]-h[0]>b?-m:h[0]-u[0]>b?m:0;T===0&&(T=u[0]-h[2]>b?-m:h[2]-u[0]>b?m:0),u[0]+=T}Pa(r,u)}function Nf(u,r,h,m){const b=Math.pow(2,m.z)*xo,T=[m.x*xo,m.y*xo],M=[];for(const k of u)for(const D of k){const z=[D.x+T[0],D.y+T[1]];Oa(z,r,h,b),M.push(z)}return M}function np(u,r,h,m){const b=Math.pow(2,m.z)*xo,T=[m.x*xo,m.y*xo],M=[];for(const D of u){const z=[];for(const N of D){const U=[N.x+T[0],N.y+T[1]];Pa(r,U),z.push(U)}M.push(z)}if(r[2]-r[0]<=b/2){(k=r)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(const D of M)for(const z of D)Oa(z,r,h,b)}var k;return M}class Ml{constructor(r,h){this.type=Qt,this.geojson=r,this.geometries=h}static parse(r,h){if(r.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(xl(r[1])){const m=r[1];if(m.type==="FeatureCollection"){const b=[];for(const T of m.features){const{type:M,coordinates:k}=T.geometry;M==="Polygon"&&b.push(k),M==="MultiPolygon"&&b.push(...k)}if(b.length)return new Ml(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Ml(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Ml(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(h,m){const b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],M=h.canonicalID();if(m.type==="Polygon"){const k=ph(m.coordinates,T,M),D=Nf(h.geometry(),b,T,M);if(!cu(b,T))return!1;for(const z of D)if(!eo(z,k))return!1}if(m.type==="MultiPolygon"){const k=mh(m.coordinates,T,M),D=Nf(h.geometry(),b,T,M);if(!cu(b,T))return!1;for(const z of D)if(!Zm(z,k))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(h,m){const b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],M=h.canonicalID();if(m.type==="Polygon"){const k=ph(m.coordinates,T,M),D=np(h.geometry(),b,T,M);if(!cu(b,T))return!1;for(const z of D)if(!Lf(z,k))return!1}if(m.type==="MultiPolygon"){const k=mh(m.coordinates,T,M),D=np(h.geometry(),b,T,M);if(!cu(b,T))return!1;for(const z of D)if(!ip(z,k))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ff=class{constructor(u=[],r=(h,m)=>h<m?-1:h>m?1:0){if(this.data=u,this.length=this.data.length,this.compare=r,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:r,compare:h}=this,m=r[u];for(;u>0;){const b=u-1>>1,T=r[b];if(h(m,T)>=0)break;r[u]=T,u=b}r[u]=m}_down(u){const{data:r,compare:h}=this,m=this.length>>1,b=r[u];for(;u<m;){let T=1+(u<<1);const M=T+1;if(M<this.length&&h(r[M],r[T])<0&&(T=M),h(r[T],b)>=0)break;r[u]=r[T],u=T}r[u]=b}};function hu(u,r,h=0,m=u.length-1,b=fu){for(;m>h;){if(m-h>600){const D=m-h+1,z=r-h+1,N=Math.log(D),U=.5*Math.exp(2*N/3),Z=.5*Math.sqrt(N*U*(D-U)/D)*(z-D/2<0?-1:1);hu(u,r,Math.max(h,Math.floor(r-z*U/D+Z)),Math.min(m,Math.floor(r+(D-z)*U/D+Z)),b)}const T=u[r];let M=h,k=m;for(Xo(u,h,r),b(u[m],T)>0&&Xo(u,h,m);M<k;){for(Xo(u,M,k),M++,k--;b(u[M],T)<0;)M++;for(;b(u[k],T)>0;)k--}b(u[h],T)===0?Xo(u,h,k):(k++,Xo(u,k,m)),k<=r&&(h=k+1),r<=k&&(m=k-1)}}function Xo(u,r,h){const m=u[r];u[r]=u[h],u[h]=m}function fu(u,r){return u<r?-1:u>r?1:0}function gh(u,r){if(u.length<=1)return[u];const h=[];let m,b;for(const T of u){const M=jf(T);M!==0&&(T.area=Math.abs(M),b===void 0&&(b=M<0),b===M<0?(m&&h.push(m),m=[T]):m.push(T))}if(m&&h.push(m),r>1)for(let T=0;T<h.length;T++)h[T].length<=r||(hu(h[T],r,1,h[T].length-1,du),h[T]=h[T].slice(0,r));return h}function du(u,r){return r.area-u.area}function jf(u){let r=0;for(let h,m,b=0,T=u.length,M=T-1;b<T;M=b++)h=u[b],m=u[M],r+=(m.x-h.x)*(h.y+m.y);return r}const Vf=1/298.257223563,yh=Vf*(2-Vf),pu=Math.PI/180;class mu{constructor(r){const h=6378.137*pu*1e3,m=Math.cos(r*pu),b=1/(1-yh*(1-m*m)),T=Math.sqrt(b);this.kx=h*T*m,this.ky=h*T*b*(1-yh)}distance(r,h){const m=this.wrap(r[0]-h[0])*this.kx,b=(r[1]-h[1])*this.ky;return Math.sqrt(m*m+b*b)}pointOnLine(r,h){let m,b,T,M,k=1/0;for(let D=0;D<r.length-1;D++){let z=r[D][0],N=r[D][1],U=this.wrap(r[D+1][0]-z)*this.kx,Z=(r[D+1][1]-N)*this.ky,$=0;U===0&&Z===0||($=(this.wrap(h[0]-z)*this.kx*U+(h[1]-N)*this.ky*Z)/(U*U+Z*Z),$>1?(z=r[D+1][0],N=r[D+1][1]):$>0&&(z+=U/this.kx*$,N+=Z/this.ky*$)),U=this.wrap(h[0]-z)*this.kx,Z=(h[1]-N)*this.ky;const Q=U*U+Z*Z;Q<k&&(k=Q,m=z,b=N,T=D,M=$)}return{point:[m,b],index:T,t:Math.max(0,Math.min(1,M))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function Uf(u,r){return r[0]-u[0]}function gu(u){return u[1]-u[0]+1}function Qo(u,r){return u[1]>=u[0]&&u[1]<r}function _h(u,r){if(u[0]>u[1])return[null,null];const h=gu(u);if(r){if(h===2)return[u,null];const b=Math.floor(h/2);return[[u[0],u[0]+b],[u[0]+b,u[1]]]}if(h===1)return[u,null];const m=Math.floor(h/2)-1;return[[u[0],u[0]+m],[u[0]+m+1,u[1]]]}function qf(u,r){if(!Qo(r,u.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let m=r[0];m<=r[1];++m)Pa(h,u[m]);return h}function Hf(u){const r=[1/0,1/0,-1/0,-1/0];for(const h of u)for(const m of h)Pa(r,m);return r}function sp(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Gs(u,r,h){if(!sp(u)||!sp(r))return NaN;let m=0,b=0;return u[2]<r[0]&&(m=r[0]-u[2]),u[0]>r[2]&&(m=u[0]-r[2]),u[1]>r[3]&&(b=u[1]-r[3]),u[3]<r[1]&&(b=r[1]-u[3]),h.distance([0,0],[m,b])}function fi(u,r,h){const m=h.pointOnLine(r,u);return h.distance(u,m.point)}function bh(u,r,h,m,b){const T=Math.min(fi(u,[h,m],b),fi(r,[h,m],b)),M=Math.min(fi(h,[u,r],b),fi(m,[u,r],b));return Math.min(T,M)}function rp(u,r,h,m,b){if(!Qo(r,u.length)||!Qo(m,h.length))return 1/0;let T=1/0;for(let M=r[0];M<r[1];++M){const k=u[M],D=u[M+1];for(let z=m[0];z<m[1];++z){const N=h[z],U=h[z+1];if(uu(k,D,N,U))return 0;T=Math.min(T,bh(k,D,N,U,b))}}return T}function op(u,r,h,m,b){if(!Qo(r,u.length)||!Qo(m,h.length))return NaN;let T=1/0;for(let M=r[0];M<=r[1];++M)for(let k=m[0];k<=m[1];++k)if(T=Math.min(T,b.distance(u[M],h[k])),T===0)return T;return T}function ap(u,r,h){if(eo(u,r,!0))return 0;let m=1/0;for(const b of r){const T=b[0],M=b[b.length-1];if(T!==M&&(m=Math.min(m,fi(u,[M,T],h)),m===0))return m;const k=h.pointOnLine(b,u);if(m=Math.min(m,h.distance(u,k.point)),m===0)return m}return m}function Zf(u,r,h,m){if(!Qo(r,u.length))return NaN;for(let T=r[0];T<=r[1];++T)if(eo(u[T],h,!0))return 0;let b=1/0;for(let T=r[0];T<r[1];++T){const M=u[T],k=u[T+1];for(const D of h)for(let z=0,N=D.length,U=N-1;z<N;U=z++){const Z=D[U],$=D[z];if(uu(M,k,Z,$))return 0;b=Math.min(b,bh(M,k,Z,$,m))}}return b}function lp(u,r){for(const h of u)for(const m of h)if(eo(m,r,!0))return!0;return!1}function pc(u,r,h,m=1/0){const b=Hf(u),T=Hf(r);if(m!==1/0&&Gs(b,T,h)>=m)return m;if(cu(b,T)){if(lp(u,r))return 0}else if(lp(r,u))return 0;let M=1/0;for(const k of u)for(let D=0,z=k.length,N=z-1;D<z;N=D++){const U=k[N],Z=k[D];for(const $ of r)for(let Q=0,J=$.length,oe=J-1;Q<J;oe=Q++){const fe=$[oe],Ae=$[Q];if(uu(U,Z,fe,Ae))return 0;M=Math.min(M,bh(U,Z,fe,Ae,h))}}return M}function vh(u,r,h,m,b,T){if(!T)return;const M=Gs(qf(m,T),b,h);M<r&&u.push([M,T,[0,0]])}function Da(u,r,h,m,b,T,M){if(!T||!M)return;const k=Gs(qf(m,T),qf(b,M),h);k<r&&u.push([k,T,M])}function mc(u,r,h,m,b=1/0){let T=Math.min(m.distance(u[0],h[0][0]),b);if(T===0)return T;const M=new Ff([[0,[0,u.length-1],[0,0]]],Uf),k=Hf(h);for(;M.length>0;){const D=M.pop();if(D[0]>=T)continue;const z=D[1],N=r?50:100;if(gu(z)<=N){if(!Qo(z,u.length))return NaN;if(r){const U=Zf(u,z,h,m);if(isNaN(U)||U===0)return U;T=Math.min(T,U)}else for(let U=z[0];U<=z[1];++U){const Z=ap(u[U],h,m);if(T=Math.min(T,Z),T===0)return 0}}else{const U=_h(z,r);vh(M,T,m,u,k,U[0]),vh(M,T,m,u,k,U[1])}}return T}function yu(u,r,h,m,b,T=1/0){let M=Math.min(T,b.distance(u[0],h[0]));if(M===0)return M;const k=new Ff([[0,[0,u.length-1],[0,h.length-1]]],Uf);for(;k.length>0;){const D=k.pop();if(D[0]>=M)continue;const z=D[1],N=D[2],U=r?50:100,Z=m?50:100;if(gu(z)<=U&&gu(N)<=Z){if(!Qo(z,u.length)&&Qo(N,h.length))return NaN;let $;if(r&&m)$=rp(u,z,h,N,b),M=Math.min(M,$);else if(r&&!m){const Q=u.slice(z[0],z[1]+1);for(let J=N[0];J<=N[1];++J)if($=fi(h[J],Q,b),M=Math.min(M,$),M===0)return M}else if(!r&&m){const Q=h.slice(N[0],N[1]+1);for(let J=z[0];J<=z[1];++J)if($=fi(u[J],Q,b),M=Math.min(M,$),M===0)return M}else $=op(u,z,h,N,b),M=Math.min(M,$)}else{const $=_h(z,r),Q=_h(N,m);Da(k,M,b,u,h,$[0],Q[0]),Da(k,M,b,u,h,$[0],Q[1]),Da(k,M,b,u,h,$[1],Q[0]),Da(k,M,b,u,h,$[1],Q[1])}}return M}function Wo(u){return u.type==="MultiPolygon"?u.coordinates.map(r=>({type:"Polygon",coordinates:r})):u.type==="MultiLineString"?u.coordinates.map(r=>({type:"LineString",coordinates:r})):u.type==="MultiPoint"?u.coordinates.map(r=>({type:"Point",coordinates:r})):[u]}class jr{constructor(r,h){this.type=st,this.geojson=r,this.geometries=h}static parse(r,h){if(r.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(xl(r[1])){const m=r[1];if(m.type==="FeatureCollection")return new jr(m,m.features.map(b=>Wo(b.geometry)).flat());if(m.type==="Feature")return new jr(m,Wo(m.geometry));if("type"in m&&"coordinates"in m)return new jr(m,Wo(m))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(h,m){const b=h.geometry(),T=b.flat().map(D=>If([D.x,D.y],h.canonical));if(b.length===0)return NaN;const M=new mu(T[0][1]);let k=1/0;for(const D of m){switch(D.type){case"Point":k=Math.min(k,yu(T,!1,[D.coordinates],!1,M,k));break;case"LineString":k=Math.min(k,yu(T,!1,D.coordinates,!0,M,k));break;case"Polygon":k=Math.min(k,mc(T,!1,D.coordinates,M,k))}if(k===0)return k}return k}(r,this.geometries);if(r.geometryType()==="LineString")return function(h,m){const b=h.geometry(),T=b.flat().map(D=>If([D.x,D.y],h.canonical));if(b.length===0)return NaN;const M=new mu(T[0][1]);let k=1/0;for(const D of m){switch(D.type){case"Point":k=Math.min(k,yu(T,!0,[D.coordinates],!1,M,k));break;case"LineString":k=Math.min(k,yu(T,!0,D.coordinates,!0,M,k));break;case"Polygon":k=Math.min(k,mc(T,!0,D.coordinates,M,k))}if(k===0)return k}return k}(r,this.geometries);if(r.geometryType()==="Polygon")return function(h,m){const b=h.geometry();if(b.length===0||b[0].length===0)return NaN;const T=gh(b,0).map(D=>D.map(z=>z.map(N=>If([N.x,N.y],h.canonical)))),M=new mu(T[0][0][0][1]);let k=1/0;for(const D of m)for(const z of T){switch(D.type){case"Point":k=Math.min(k,mc([D.coordinates],!1,z,M,k));break;case"LineString":k=Math.min(k,mc(D.coordinates,!0,z,M,k));break;case"Polygon":k=Math.min(k,pc(z,D.coordinates,M,k))}if(k===0)return k}return k}(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ra={"==":fh,"!=":Df,">":dh,"<":qm,">=":Jr,"<=":fc,array:Ds,at:ls,boolean:Ds,case:ch,coalesce:ru,collator:ou,format:au,image:lu,in:bs,"index-of":Go,interpolate:Is,"interpolate-hcl":Is,"interpolate-lab":Is,length:Rf,let:Zo,literal:Os,match:ka,number:Ds,"number-format":dc,object:Ds,slice:Ea,step:$o,string:Ds,"to-boolean":Ai,"to-color":Ai,"to-number":Ai,"to-string":Ai,var:vi,within:Ml,distance:jr};class vr{constructor(r,h,m,b){this.name=r,this.type=h,this._evaluate=m,this.args=b}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,h){const m=r[0],b=vr.definitions[m];if(!b)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(b)?b[0]:b.type,M=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,k=M.filter(([z])=>!Array.isArray(z)||z.length===r.length-1);let D=null;for(const[z,N]of k){D=new ri(h.registry,wh,h.path,null,h.scope);const U=[];let Z=!1;for(let $=1;$<r.length;$++){const Q=r[$],J=Array.isArray(z)?z[$-1]:z.type,oe=D.parse(Q,1+U.length,J);if(!oe){Z=!0;break}U.push(oe)}if(!Z)if(Array.isArray(z)&&z.length!==U.length)D.error(`Expected ${z.length} arguments, but found ${U.length} instead.`);else{for(let $=0;$<U.length;$++){const Q=Array.isArray(z)?z[$]:z.type,J=U[$];D.concat($+1).checkSubtype(Q,J.type)}if(D.errors.length===0)return new vr(m,T,N,U)}}if(k.length===1)h.errors.push(...D.errors);else{const z=(k.length?k:M).map(([U])=>{return Z=U,Array.isArray(Z)?`(${Z.map(Wi).join(", ")})`:`(${Wi(Z.type)}...)`;var Z}).join(" | "),N=[];for(let U=1;U<r.length;U++){const Z=h.parse(r[U],1+N.length);if(!Z)return null;N.push(Wi(Z.type))}h.error(`Expected arguments of type ${z}, but found (${N.join(", ")}) instead.`)}return null}static register(r,h){vr.definitions=h;for(const m in h)r[m]=vr}}function Ia(u,[r,h,m,b]){r=r.evaluate(u),h=h.evaluate(u),m=m.evaluate(u);const T=b?b.evaluate(u):1,M=Ho(r,h,m,T);if(M)throw new rn(M);return new hi(r/255,h/255,m/255,T,!1)}function Gf(u,r){return u in r}function xh(u,r){const h=r[u];return h===void 0?null:h}function za(u){return{type:u}}function wh(u){if(u instanceof vi)return wh(u.boundExpression);if(u instanceof vr&&u.name==="error"||u instanceof ou||u instanceof Ml||u instanceof jr)return!1;const r=u instanceof Ai||u instanceof Ds;let h=!0;return u.eachChild(m=>{h=r?h&&wh(m):h&&m instanceof Os}),!!h&&Sh(u)&&bu(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Sh(u){if(u instanceof vr&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Ml||u instanceof jr)return!1;let r=!0;return u.eachChild(h=>{r&&!Sh(h)&&(r=!1)}),r}function _u(u){if(u instanceof vr&&u.name==="feature-state")return!1;let r=!0;return u.eachChild(h=>{r&&!_u(h)&&(r=!1)}),r}function bu(u,r){if(u instanceof vr&&r.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(m=>{h&&!bu(m,r)&&(h=!1)}),h}function $f(u){return{result:"success",value:u}}function La(u){return{result:"error",value:u}}function zs(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Xf(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function ar(u){return!!u.expression&&u.expression.interpolated}function ai(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Ko(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Qf(u){return u}function Cl(u,r){const h=r.type==="color",m=u.stops&&typeof u.stops[0][0]=="object",b=m||!(m||u.property!==void 0),T=u.type||(ar(r)?"exponential":"interval");if(h||r.type==="padding"){const N=h?hi.parse:Ps.parse;(u=Wt({},u)).stops&&(u.stops=u.stops.map(U=>[U[0],N(U[1])])),u.default=N(u.default?u.default:r.default)}if(u.colorSpace&&(M=u.colorSpace)!=="rgb"&&M!=="hcl"&&M!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var M;let k,D,z;if(T==="exponential")k=Th;else if(T==="interval")k=gc;else if(T==="categorical"){k=Wf,D=Object.create(null);for(const N of u.stops)D[N[0]]=N[1];z=typeof u.stops[0][0]}else{if(T!=="identity")throw new Error(`Unknown function type "${T}"`);k=Mh}if(m){const N={},U=[];for(let Q=0;Q<u.stops.length;Q++){const J=u.stops[Q],oe=J[0].zoom;N[oe]===void 0&&(N[oe]={zoom:oe,type:u.type,property:u.property,default:u.default,stops:[]},U.push(oe)),N[oe].stops.push([J[0].value,J[1]])}const Z=[];for(const Q of U)Z.push([N[Q].zoom,Cl(N[Q],r)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Is.interpolationFactor.bind(void 0,$),zoomStops:Z.map(Q=>Q[0]),evaluate:({zoom:Q},J)=>Th({stops:Z,base:u.base},r,Q).evaluate(Q,J)}}if(b){const N=T==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Is.interpolationFactor.bind(void 0,N),zoomStops:u.stops.map(U=>U[0]),evaluate:({zoom:U})=>k(u,r,U,D,z)}}return{kind:"source",evaluate(N,U){const Z=U&&U.properties?U.properties[u.property]:void 0;return Z===void 0?Ba(u.default,r.default):k(u,r,Z,D,z)}}}function Ba(u,r,h){return u!==void 0?u:r!==void 0?r:h!==void 0?h:void 0}function Wf(u,r,h,m,b){return Ba(typeof h===b?m[h]:void 0,u.default,r.default)}function gc(u,r,h){if(ai(h)!=="number")return Ba(u.default,r.default);const m=u.stops.length;if(m===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[m-1][0])return u.stops[m-1][1];const b=Sl(u.stops.map(T=>T[0]),h);return u.stops[b][1]}function Th(u,r,h){const m=u.base!==void 0?u.base:1;if(ai(h)!=="number")return Ba(u.default,r.default);const b=u.stops.length;if(b===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[b-1][0])return u.stops[b-1][1];const T=Sl(u.stops.map(N=>N[0]),h),M=function(N,U,Z,$){const Q=$-Z,J=N-Z;return Q===0?0:U===1?J/Q:(Math.pow(U,J)-1)/(Math.pow(U,Q)-1)}(h,m,u.stops[T][0],u.stops[T+1][0]),k=u.stops[T][1],D=u.stops[T+1][1],z=Ki[r.type]||Qf;return typeof k.evaluate=="function"?{evaluate(...N){const U=k.evaluate.apply(void 0,N),Z=D.evaluate.apply(void 0,N);if(U!==void 0&&Z!==void 0)return z(U,Z,M,u.colorSpace)}}:z(k,D,M,u.colorSpace)}function Mh(u,r,h){switch(r.type){case"color":h=hi.parse(h);break;case"formatted":h=rr.fromString(h.toString());break;case"resolvedImage":h=as.fromString(h.toString());break;case"padding":h=Ps.parse(h);break;default:ai(h)===r.type||r.type==="enum"&&r.values[h]||(h=void 0)}return Ba(h,u.default,r.default)}vr.register(Ra,{error:[{kind:"error"},[kt],(u,[r])=>{throw new rn(r.evaluate(u))}],typeof:[kt,[ti],(u,[r])=>Wi(mn(r.evaluate(u)))],"to-rgba":[os(st,4),[Vn],(u,[r])=>{const[h,m,b,T]=r.evaluate(u).rgb;return[255*h,255*m,255*b,T]}],rgb:[Vn,[st,st,st],Ia],rgba:[Vn,[st,st,st,st],Ia],has:{type:Qt,overloads:[[[kt],(u,[r])=>Gf(r.evaluate(u),u.properties())],[[kt,Vi],(u,[r,h])=>Gf(r.evaluate(u),h.evaluate(u))]]},get:{type:ti,overloads:[[[kt],(u,[r])=>xh(r.evaluate(u),u.properties())],[[kt,Vi],(u,[r,h])=>xh(r.evaluate(u),h.evaluate(u))]]},"feature-state":[ti,[kt],(u,[r])=>xh(r.evaluate(u),u.featureState||{})],properties:[Vi,[],u=>u.properties()],"geometry-type":[kt,[],u=>u.geometryType()],id:[ti,[],u=>u.id()],zoom:[st,[],u=>u.globals.zoom],"heatmap-density":[st,[],u=>u.globals.heatmapDensity||0],"line-progress":[st,[],u=>u.globals.lineProgress||0],accumulated:[ti,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[st,za(st),(u,r)=>{let h=0;for(const m of r)h+=m.evaluate(u);return h}],"*":[st,za(st),(u,r)=>{let h=1;for(const m of r)h*=m.evaluate(u);return h}],"-":{type:st,overloads:[[[st,st],(u,[r,h])=>r.evaluate(u)-h.evaluate(u)],[[st],(u,[r])=>-r.evaluate(u)]]},"/":[st,[st,st],(u,[r,h])=>r.evaluate(u)/h.evaluate(u)],"%":[st,[st,st],(u,[r,h])=>r.evaluate(u)%h.evaluate(u)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(u,[r,h])=>Math.pow(r.evaluate(u),h.evaluate(u))],sqrt:[st,[st],(u,[r])=>Math.sqrt(r.evaluate(u))],log10:[st,[st],(u,[r])=>Math.log(r.evaluate(u))/Math.LN10],ln:[st,[st],(u,[r])=>Math.log(r.evaluate(u))],log2:[st,[st],(u,[r])=>Math.log(r.evaluate(u))/Math.LN2],sin:[st,[st],(u,[r])=>Math.sin(r.evaluate(u))],cos:[st,[st],(u,[r])=>Math.cos(r.evaluate(u))],tan:[st,[st],(u,[r])=>Math.tan(r.evaluate(u))],asin:[st,[st],(u,[r])=>Math.asin(r.evaluate(u))],acos:[st,[st],(u,[r])=>Math.acos(r.evaluate(u))],atan:[st,[st],(u,[r])=>Math.atan(r.evaluate(u))],min:[st,za(st),(u,r)=>Math.min(...r.map(h=>h.evaluate(u)))],max:[st,za(st),(u,r)=>Math.max(...r.map(h=>h.evaluate(u)))],abs:[st,[st],(u,[r])=>Math.abs(r.evaluate(u))],round:[st,[st],(u,[r])=>{const h=r.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[st,[st],(u,[r])=>Math.floor(r.evaluate(u))],ceil:[st,[st],(u,[r])=>Math.ceil(r.evaluate(u))],"filter-==":[Qt,[kt,ti],(u,[r,h])=>u.properties()[r.value]===h.value],"filter-id-==":[Qt,[ti],(u,[r])=>u.id()===r.value],"filter-type-==":[Qt,[kt],(u,[r])=>u.geometryType()===r.value],"filter-<":[Qt,[kt,ti],(u,[r,h])=>{const m=u.properties()[r.value],b=h.value;return typeof m==typeof b&&m<b}],"filter-id-<":[Qt,[ti],(u,[r])=>{const h=u.id(),m=r.value;return typeof h==typeof m&&h<m}],"filter->":[Qt,[kt,ti],(u,[r,h])=>{const m=u.properties()[r.value],b=h.value;return typeof m==typeof b&&m>b}],"filter-id->":[Qt,[ti],(u,[r])=>{const h=u.id(),m=r.value;return typeof h==typeof m&&h>m}],"filter-<=":[Qt,[kt,ti],(u,[r,h])=>{const m=u.properties()[r.value],b=h.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[Qt,[ti],(u,[r])=>{const h=u.id(),m=r.value;return typeof h==typeof m&&h<=m}],"filter->=":[Qt,[kt,ti],(u,[r,h])=>{const m=u.properties()[r.value],b=h.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[Qt,[ti],(u,[r])=>{const h=u.id(),m=r.value;return typeof h==typeof m&&h>=m}],"filter-has":[Qt,[ti],(u,[r])=>r.value in u.properties()],"filter-has-id":[Qt,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Qt,[os(kt)],(u,[r])=>r.value.indexOf(u.geometryType())>=0],"filter-id-in":[Qt,[os(ti)],(u,[r])=>r.value.indexOf(u.id())>=0],"filter-in-small":[Qt,[kt,os(ti)],(u,[r,h])=>h.value.indexOf(u.properties()[r.value])>=0],"filter-in-large":[Qt,[kt,os(ti)],(u,[r,h])=>function(m,b,T,M){for(;T<=M;){const k=T+M>>1;if(b[k]===m)return!0;b[k]>m?M=k-1:T=k+1}return!1}(u.properties()[r.value],h.value,0,h.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(u,[r,h])=>r.evaluate(u)&&h.evaluate(u)],[za(Qt),(u,r)=>{for(const h of r)if(!h.evaluate(u))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(u,[r,h])=>r.evaluate(u)||h.evaluate(u)],[za(Qt),(u,r)=>{for(const h of r)if(h.evaluate(u))return!0;return!1}]]},"!":[Qt,[Qt],(u,[r])=>!r.evaluate(u)],"is-supported-script":[Qt,[kt],(u,[r])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(r.evaluate(u))}],upcase:[kt,[kt],(u,[r])=>r.evaluate(u).toUpperCase()],downcase:[kt,[kt],(u,[r])=>r.evaluate(u).toLowerCase()],concat:[kt,za(ti),(u,r)=>r.map(h=>or(h.evaluate(u))).join("")],"resolved-locale":[kt,[En],(u,[r])=>r.evaluate(u).resolvedLocale()]});class Na{constructor(r,h){var m;this.expression=r,this._warningHistory={},this._evaluator=new Ti,this._defaultValue=h?(m=h).type==="color"&&Ko(m.default)?new hi(0,0,0,0):m.type==="color"?hi.parse(m.default)||null:m.type==="padding"?Ps.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?es.parse(m.default)||null:m.type==="projectionDefinition"?Un.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(r,h,m,b,T,M){return this._evaluator.globals=r,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=M,this.expression.evaluate(this._evaluator)}evaluate(r,h,m,b,T,M){this._evaluator.globals=r,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=M||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new rn(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function Al(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Ra}function vs(u,r){const h=new ri(Ra,wh,[],r?function(b){const T={color:Vn,string:kt,number:st,enum:kt,boolean:Qt,formatted:Ta,padding:eu,projectionDefinition:In,resolvedImage:ir,variableAnchorOffsetCollection:qo};return b.type==="array"?os(T[b.value]||ti,b.length):T[b.type]}(r):void 0),m=h.parse(u,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?$f(new Na(m,r)):La(h.errors)}class vu{constructor(r,h){this.kind=r,this._styleExpression=h,this.isStateDependent=r!=="constant"&&!_u(h.expression)}evaluateWithoutErrorHandling(r,h,m,b,T,M){return this._styleExpression.evaluateWithoutErrorHandling(r,h,m,b,T,M)}evaluate(r,h,m,b,T,M){return this._styleExpression.evaluate(r,h,m,b,T,M)}}class to{constructor(r,h,m,b){this.kind=r,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=r!=="camera"&&!_u(h.expression),this.interpolationType=b}evaluateWithoutErrorHandling(r,h,m,b,T,M){return this._styleExpression.evaluateWithoutErrorHandling(r,h,m,b,T,M)}evaluate(r,h,m,b,T,M){return this._styleExpression.evaluate(r,h,m,b,T,M)}interpolationFactor(r,h,m){return this.interpolationType?Is.interpolationFactor(this.interpolationType,r,h,m):0}}function Kf(u,r){const h=vs(u,r);if(h.result==="error")return h;const m=h.value.expression,b=Sh(m);if(!b&&!zs(r))return La([new _i("","data expressions not supported")]);const T=bu(m,["zoom"]);if(!T&&!Xf(r))return La([new _i("","zoom expressions not supported")]);const M=wo(m);return M||T?M instanceof _i?La([M]):M instanceof Is&&!ar(r)?La([new _i("",'"interpolate" expressions cannot be used with this property')]):$f(M?new to(b?"camera":"composite",h.value,M.labels,M instanceof Is?M.interpolation:void 0):new vu(b?"constant":"source",h.value)):La([new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class kl{constructor(r,h){this._parameters=r,this._specification=h,Wt(this,Cl(this._parameters,this._specification))}static deserialize(r){return new kl(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function wo(u){let r=null;if(u instanceof Zo)r=wo(u.result);else if(u instanceof ru){for(const h of u.args)if(r=wo(h),r)break}else(u instanceof $o||u instanceof Is)&&u.input instanceof vr&&u.input.name==="zoom"&&(r=u);return r instanceof _i||u.eachChild(h=>{const m=wo(h);m instanceof _i?r=m:!r&&m?r=new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&m&&r!==m&&(r=new _i("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function yc(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const r of u.slice(1))if(!yc(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Ch={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fa(u){if(u==null)return{filter:()=>!0,needGeometry:!1};yc(u)||(u=ja(u));const r=vs(u,Ch);if(r.result==="error")throw new Error(r.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,b)=>r.value.evaluate(h,m,{},b),needGeometry:bc(u)}}function _c(u,r){return u<r?-1:u>r?1:0}function bc(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let r=1;r<u.length;r++)if(bc(u[r]))return!0;return!1}function ja(u){if(!u)return!0;const r=u[0];return u.length<=1?r!=="any":r==="=="?$s(u[1],u[2],"=="):r==="!="?cr($s(u[1],u[2],"==")):r==="<"||r===">"||r==="<="||r===">="?$s(u[1],u[2],r):r==="any"?(h=u.slice(1),["any"].concat(h.map(ja))):r==="all"?["all"].concat(u.slice(1).map(ja)):r==="none"?["all"].concat(u.slice(1).map(ja).map(cr)):r==="in"?lr(u[1],u.slice(2)):r==="!in"?cr(lr(u[1],u.slice(2))):r==="has"?So(u[1]):r!=="!has"||cr(So(u[1]));var h}function $s(u,r,h){switch(u){case"$type":return[`filter-type-${h}`,r];case"$id":return[`filter-id-${h}`,r];default:return[`filter-${h}`,u,r]}}function lr(u,r){if(r.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(h=>typeof h!=typeof r[0])?["filter-in-large",u,["literal",r.sort(_c)]]:["filter-in-small",u,["literal",r]]}}function So(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function cr(u){return["!",u]}function xr(u){const r=typeof u;if(r==="number"||r==="boolean"||r==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let b="[";for(const T of u)b+=`${xr(T)},`;return`${b}]`}const h=Object.keys(u).sort();let m="{";for(let b=0;b<h.length;b++)m+=`${JSON.stringify(h[b])}:${xr(u[h[b]])},`;return`${m}}`}function To(u){let r="";for(const h of Oe)r+=`/${xr(u[h])}`;return r}function Yf(u){const r=u.value;return r?[new We(u.key,r,"constants have been deprecated as of v8")]:[]}function gn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Yo(u){if(Array.isArray(u))return u.map(Yo);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const r={};for(const h in u)r[h]=Yo(u[h]);return r}return gn(u)}function on(u){const r=u.key,h=u.value,m=u.valueSpec||{},b=u.objectElementValidators||{},T=u.style,M=u.styleSpec,k=u.validateSpec;let D=[];const z=ai(h);if(z!=="object")return[new We(r,h,`object expected, ${z} found`)];for(const N in h){const U=N.split(".")[0],Z=m[U]||m["*"];let $;if(b[U])$=b[U];else if(m[U])$=k;else if(b["*"])$=b["*"];else{if(!m["*"]){D.push(new We(r,h[N],`unknown property "${N}"`));continue}$=k}D=D.concat($({key:(r&&`${r}.`)+N,value:h[N],valueSpec:Z,style:T,styleSpec:M,object:h,objectKey:N,validateSpec:k},h))}for(const N in m)b[N]||m[N].required&&m[N].default===void 0&&h[N]===void 0&&D.push(new We(r,h,`missing required property "${N}"`));return D}function yn(u){const r=u.value,h=u.valueSpec,m=u.style,b=u.styleSpec,T=u.key,M=u.arrayElementValidator||u.validateSpec;if(ai(r)!=="array")return[new We(T,r,`array expected, ${ai(r)} found`)];if(h.length&&r.length!==h.length)return[new We(T,r,`array length ${h.length} expected, length ${r.length} found`)];if(h["min-length"]&&r.length<h["min-length"])return[new We(T,r,`array length at least ${h["min-length"]} expected, length ${r.length} found`)];let k={type:h.value,values:h.values};b.$version<7&&(k.function=h.function),ai(h.value)==="object"&&(k=h.value);let D=[];for(let z=0;z<r.length;z++)D=D.concat(M({array:r,arrayIndex:z,value:r[z],valueSpec:k,validateSpec:u.validateSpec,style:m,styleSpec:b,key:`${T}[${z}]`}));return D}function Pi(u){const r=u.key,h=u.value,m=u.valueSpec;let b=ai(h);return b==="number"&&h!=h&&(b="NaN"),b!=="number"?[new We(r,h,`number expected, ${b} found`)]:"minimum"in m&&h<m.minimum?[new We(r,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new We(r,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function Jo(u){const r=u.valueSpec,h=gn(u.value.type);let m,b,T,M={};const k=h!=="categorical"&&u.value.property===void 0,D=!k,z=ai(u.value.stops)==="array"&&ai(u.value.stops[0])==="array"&&ai(u.value.stops[0][0])==="object",N=on({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function($){if(h==="identity")return[new We($.key,$.value,'identity function may not have a "stops" property')];let Q=[];const J=$.value;return Q=Q.concat(yn({key:$.key,value:J,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:U})),ai(J)==="array"&&J.length===0&&Q.push(new We($.key,J,"array must have at least one stop")),Q},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:r,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return h==="identity"&&k&&N.push(new We(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||N.push(new We(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!ar(u.valueSpec)&&N.push(new We(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(D&&!zs(u.valueSpec)?N.push(new We(u.key,u.value,"property functions not supported")):k&&!Xf(u.valueSpec)&&N.push(new We(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!z||u.value.property!==void 0||N.push(new We(u.key,u.value,'"property" property is required')),N;function U($){let Q=[];const J=$.value,oe=$.key;if(ai(J)!=="array")return[new We(oe,J,`array expected, ${ai(J)} found`)];if(J.length!==2)return[new We(oe,J,`array length 2 expected, length ${J.length} found`)];if(z){if(ai(J[0])!=="object")return[new We(oe,J,`object expected, ${ai(J[0])} found`)];if(J[0].zoom===void 0)return[new We(oe,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new We(oe,J,"object stop key must have value")];if(T&&T>gn(J[0].zoom))return[new We(oe,J[0].zoom,"stop zoom values must appear in ascending order")];gn(J[0].zoom)!==T&&(T=gn(J[0].zoom),b=void 0,M={}),Q=Q.concat(on({key:`${oe}[0]`,value:J[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Pi,value:Z}}))}else Q=Q.concat(Z({key:`${oe}[0]`,value:J[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},J));return Al(Yo(J[1]))?Q.concat([new We(`${oe}[1]`,J[1],"expressions are not allowed in function stops.")]):Q.concat($.validateSpec({key:`${oe}[1]`,value:J[1],valueSpec:r,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function Z($,Q){const J=ai($.value),oe=gn($.value),fe=$.value!==null?$.value:Q;if(m){if(J!==m)return[new We($.key,fe,`${J} stop domain type must match previous stop domain type ${m}`)]}else m=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new We($.key,fe,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&h!=="categorical"){let Ae=`number expected, ${J} found`;return zs(r)&&h===void 0&&(Ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We($.key,fe,Ae)]}return h!=="categorical"||J!=="number"||isFinite(oe)&&Math.floor(oe)===oe?h!=="categorical"&&J==="number"&&b!==void 0&&oe<b?[new We($.key,fe,"stop domain values must appear in ascending order")]:(b=oe,h==="categorical"&&oe in M?[new We($.key,fe,"stop domain values must be unique")]:(M[oe]=!0,[])):[new We($.key,fe,`integer expected, found ${oe}`)]}}function Ls(u){const r=(u.expressionContext==="property"?Kf:vs)(Yo(u.value),u.valueSpec);if(r.result==="error")return r.value.map(m=>new We(`${u.key}${m.key}`,u.value,m.message));const h=r.value.expression||r.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new We(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!_u(h))return[new We(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!_u(h))return[new We(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!bu(h,["zoom","feature-state"]))return[new We(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Sh(h))return[new We(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mo(u){const r=u.key,h=u.value,m=u.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(gn(h))===-1&&b.push(new We(r,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(gn(h))===-1&&b.push(new We(r,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),b}function ea(u){return yc(Yo(u.value))?Ls(Wt({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ah(u)}function Ah(u){const r=u.value,h=u.key;if(ai(r)!=="array")return[new We(h,r,`array expected, ${ai(r)} found`)];const m=u.styleSpec;let b,T=[];if(r.length<1)return[new We(h,r,"filter array must have at least 1 element")];switch(T=T.concat(Mo({key:`${h}[0]`,value:r[0],valueSpec:m.filter_operator,style:u.style,styleSpec:u.styleSpec})),gn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&gn(r[1])==="$type"&&T.push(new We(h,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&T.push(new We(h,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(b=ai(r[1]),b!=="string"&&T.push(new We(`${h}[1]`,r[1],`string expected, ${b} found`)));for(let M=2;M<r.length;M++)b=ai(r[M]),gn(r[1])==="$type"?T=T.concat(Mo({key:`${h}[${M}]`,value:r[M],valueSpec:m.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new We(`${h}[${M}]`,r[M],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let M=1;M<r.length;M++)T=T.concat(Ah({key:`${h}[${M}]`,value:r[M],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=ai(r[1]),r.length!==2?T.push(new We(h,r,`filter array for "${r[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new We(`${h}[1]`,r[1],`string expected, ${b} found`))}return T}function kh(u,r){const h=u.key,m=u.validateSpec,b=u.style,T=u.styleSpec,M=u.value,k=u.objectKey,D=T[`${r}_${u.layerType}`];if(!D)return[];const z=k.match(/^(.*)-transition$/);if(r==="paint"&&z&&D[z[1]]&&D[z[1]].transition)return m({key:h,value:M,valueSpec:T.transition,style:b,styleSpec:T});const N=u.valueSpec||D[k];if(!N)return[new We(h,M,`unknown property "${k}"`)];let U;if(ai(M)==="string"&&zs(N)&&!N.tokens&&(U=/^{([^}]+)}$/.exec(M)))return[new We(h,M,`"${k}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const Z=[];return u.layerType==="symbol"&&(k==="text-field"&&b&&!b.glyphs&&Z.push(new We(h,M,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&Ko(Yo(M))&&gn(M.type)==="identity"&&Z.push(new We(h,M,'"text-font" does not support identity functions'))),Z.concat(m({key:u.key,value:M,valueSpec:N,style:b,styleSpec:T,expressionContext:"property",propertyType:r,propertyKey:k}))}function vc(u){return kh(u,"paint")}function El(u){return kh(u,"layout")}function Eh(u){let r=[];const h=u.value,m=u.key,b=u.style,T=u.styleSpec;h.type||h.ref||r.push(new We(m,h,'either "type" or "ref" is required'));let M=gn(h.type);const k=gn(h.ref);if(h.id){const D=gn(h.id);for(let z=0;z<u.arrayIndex;z++){const N=b.layers[z];gn(N.id)===D&&r.push(new We(m,h.id,`duplicate layer id "${h.id}", previously used at line ${N.id.__line__}`))}}if("ref"in h){let D;["type","source","source-layer","filter","layout"].forEach(z=>{z in h&&r.push(new We(m,h[z],`"${z}" is prohibited for ref layers`))}),b.layers.forEach(z=>{gn(z.id)===k&&(D=z)}),D?D.ref?r.push(new We(m,h.ref,"ref cannot reference another ref layer")):M=gn(D.type):r.push(new We(m,h.ref,`ref layer "${k}" not found`))}else if(M!=="background")if(h.source){const D=b.sources&&b.sources[h.source],z=D&&gn(D.type);D?z==="vector"&&M==="raster"?r.push(new We(m,h.source,`layer "${h.id}" requires a raster source`)):z!=="raster-dem"&&M==="hillshade"?r.push(new We(m,h.source,`layer "${h.id}" requires a raster-dem source`)):z==="raster"&&M!=="raster"?r.push(new We(m,h.source,`layer "${h.id}" requires a vector source`)):z!=="vector"||h["source-layer"]?z==="raster-dem"&&M!=="hillshade"?r.push(new We(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!h.paint||!h.paint["line-gradient"]||z==="geojson"&&D.lineMetrics||r.push(new We(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new We(m,h,`layer "${h.id}" must specify a "source-layer"`)):r.push(new We(m,h.source,`source "${h.source}" not found`))}else r.push(new We(m,h,'missing required property "source"'));return r=r.concat(on({key:m,value:h,valueSpec:T.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${m}.type`,value:h.type,valueSpec:T.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:ea,layout:D=>on({layer:h,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":z=>El(Wt({layerType:M},z))}}),paint:D=>on({layer:h,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":z=>vc(Wt({layerType:M},z))}})}})),r}function Xs(u){const r=u.value,h=u.key,m=ai(r);return m!=="string"?[new We(h,r,`string expected, ${m} found`)]:[]}const Ph={promoteId:function({key:u,value:r}){if(ai(r)==="string")return Xs({key:u,value:r});{const h=[];for(const m in r)h.push(...Xs({key:`${u}.${m}`,value:r[m]}));return h}}};function Va(u){const r=u.value,h=u.key,m=u.styleSpec,b=u.style,T=u.validateSpec;if(!r.type)return[new We(h,r,'"type" is required')];const M=gn(r.type);let k;switch(M){case"vector":case"raster":return k=on({key:h,value:r,valueSpec:m[`source_${M.replace("-","_")}`],style:u.style,styleSpec:m,objectElementValidators:Ph,validateSpec:T}),k;case"raster-dem":return k=function(D){var z;const N=(z=D.sourceName)!==null&&z!==void 0?z:"",U=D.value,Z=D.styleSpec,$=Z.source_raster_dem,Q=D.style;let J=[];const oe=ai(U);if(U===void 0)return J;if(oe!=="object")return J.push(new We("source_raster_dem",U,`object expected, ${oe} found`)),J;const fe=gn(U.encoding)==="custom",Ae=["redFactor","greenFactor","blueFactor","baseShift"],pe=D.value.encoding?`"${D.value.encoding}"`:"Default";for(const G in U)!fe&&Ae.includes(G)?J.push(new We(G,U[G],`In "${N}": "${G}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):$[G]?J=J.concat(D.validateSpec({key:G,value:U[G],valueSpec:$[G],validateSpec:D.validateSpec,style:Q,styleSpec:Z})):J.push(new We(G,U[G],`unknown property "${G}"`));return J}({sourceName:h,value:r,style:u.style,styleSpec:m,validateSpec:T}),k;case"geojson":if(k=on({key:h,value:r,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:T,objectElementValidators:Ph}),r.cluster)for(const D in r.clusterProperties){const[z,N]=r.clusterProperties[D],U=typeof z=="string"?[z,["accumulated"],["get",D]]:z;k.push(...Ls({key:`${h}.${D}.map`,value:N,expressionContext:"cluster-map"})),k.push(...Ls({key:`${h}.${D}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return k;case"video":return on({key:h,value:r,valueSpec:m.source_video,style:b,validateSpec:T,styleSpec:m});case"image":return on({key:h,value:r,valueSpec:m.source_image,style:b,validateSpec:T,styleSpec:m});case"canvas":return[new We(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mo({key:`${h}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Co(u){const r=u.value,h=u.styleSpec,m=h.light,b=u.style;let T=[];const M=ai(r);if(r===void 0)return T;if(M!=="object")return T=T.concat([new We("light",r,`object expected, ${M} found`)]),T;for(const k in r){const D=k.match(/^(.*)-transition$/);T=T.concat(D&&m[D[1]]&&m[D[1]].transition?u.validateSpec({key:k,value:r[k],valueSpec:h.transition,validateSpec:u.validateSpec,style:b,styleSpec:h}):m[k]?u.validateSpec({key:k,value:r[k],valueSpec:m[k],validateSpec:u.validateSpec,style:b,styleSpec:h}):[new We(k,r[k],`unknown property "${k}"`)])}return T}function ta(u){const r=u.value,h=u.styleSpec,m=h.sky,b=u.style,T=ai(r);if(r===void 0)return[];if(T!=="object")return[new We("sky",r,`object expected, ${T} found`)];let M=[];for(const k in r)M=M.concat(m[k]?u.validateSpec({key:k,value:r[k],valueSpec:m[k],style:b,styleSpec:h}):[new We(k,r[k],`unknown property "${k}"`)]);return M}function Ao(u){const r=u.value,h=u.styleSpec,m=h.terrain,b=u.style;let T=[];const M=ai(r);if(r===void 0)return T;if(M!=="object")return T=T.concat([new We("terrain",r,`object expected, ${M} found`)]),T;for(const k in r)T=T.concat(m[k]?u.validateSpec({key:k,value:r[k],valueSpec:m[k],validateSpec:u.validateSpec,style:b,styleSpec:h}):[new We(k,r[k],`unknown property "${k}"`)]);return T}function Oh(u){let r=[];const h=u.value,m=u.key;if(Array.isArray(h)){const b=[],T=[];for(const M in h)h[M].id&&b.includes(h[M].id)&&r.push(new We(m,h,`all the sprites' ids must be unique, but ${h[M].id} is duplicated`)),b.push(h[M].id),h[M].url&&T.includes(h[M].url)&&r.push(new We(m,h,`all the sprites' URLs must be unique, but ${h[M].url} is duplicated`)),T.push(h[M].url),r=r.concat(on({key:`${m}[${M}]`,value:h[M],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return r}return Xs({key:m,value:h})}const Ua={"*":()=>[],array:yn,boolean:function(u){const r=u.value,h=u.key,m=ai(r);return m!=="boolean"?[new We(h,r,`boolean expected, ${m} found`)]:[]},number:Pi,color:function(u){const r=u.key,h=u.value,m=ai(h);return m!=="string"?[new We(r,h,`color expected, ${m} found`)]:hi.parse(String(h))?[]:[new We(r,h,`color expected, "${h}" found`)]},constants:Yf,enum:Mo,filter:ea,function:Jo,layer:Eh,object:on,source:Va,light:Co,sky:ta,terrain:Ao,projection:function(u){const r=u.value,h=u.styleSpec,m=h.projection,b=u.style,T=ai(r);if(r===void 0)return[];if(T!=="object")return[new We("projection",r,`object expected, ${T} found`)];let M=[];for(const k in r)M=M.concat(m[k]?u.validateSpec({key:k,value:r[k],valueSpec:m[k],style:b,styleSpec:h}):[new We(k,r[k],`unknown property "${k}"`)]);return M},projectionDefinition:function(u){const r=u.key;let h=u.value;h=h instanceof String?h.valueOf():h;const m=ai(h);return m!=="array"||function(b){return Array.isArray(b)&&b.length===3&&typeof b[0]=="string"&&typeof b[1]=="string"&&typeof b[2]=="number"}(h)||function(b){return!!["interpolate","step","literal"].includes(b[0])}(h)?["array","string"].includes(m)?[]:[new We(r,h,`projection expected, invalid type "${m}" found`)]:[new We(r,h,`projection expected, invalid array ${JSON.stringify(h)} found`)]},string:Xs,formatted:function(u){return Xs(u).length===0?[]:Ls(u)},resolvedImage:function(u){return Xs(u).length===0?[]:Ls(u)},padding:function(u){const r=u.key,h=u.value;if(ai(h)==="array"){if(h.length<1||h.length>4)return[new We(r,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let b=[];for(let T=0;T<h.length;T++)b=b.concat(u.validateSpec({key:`${r}[${T}]`,value:h[T],validateSpec:u.validateSpec,valueSpec:m}));return b}return Pi({key:r,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const r=u.key,h=u.value,m=ai(h),b=u.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new We(r,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let M=0;M<h.length;M+=2)T=T.concat(Mo({key:`${r}[${M}]`,value:h[M],valueSpec:b.layout_symbol["text-anchor"]})),T=T.concat(yn({key:`${r}[${M+1}]`,value:h[M+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:b}));return T},sprite:Oh};function Vr(u){const r=u.value,h=u.valueSpec,m=u.styleSpec;return u.validateSpec=Vr,h.expression&&Ko(gn(r))?Jo(u):h.expression&&Al(Yo(r))?Ls(u):h.type&&Ua[h.type]?Ua[h.type](u):on(Wt({},u,{valueSpec:h.type?m[h.type]:h}))}function xs(u){const r=u.value,h=u.key,m=Xs(u);return m.length||(r.indexOf("{fontstack}")===-1&&m.push(new We(h,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&m.push(new We(h,r,'"glyphs" url must include a "{range}" token'))),m}function zn(u,r=ne){let h=[];return h=h.concat(Vr({key:"",value:u,valueSpec:r.$root,styleSpec:r,style:u,validateSpec:Vr,objectElementValidators:{glyphs:xs,"*":()=>[]}})),u.constants&&(h=h.concat(Yf({key:"constants",value:u.constants}))),xu(h)}function an(u){return function(r){return u({...r,validateSpec:Vr})}}function xu(u){return[].concat(u).sort((r,h)=>r.line-h.line)}function io(u){return function(...r){return xu(u.apply(this,r))}}zn.source=io(an(Va)),zn.sprite=io(an(Oh)),zn.glyphs=io(an(xs)),zn.light=io(an(Co)),zn.sky=io(an(ta)),zn.terrain=io(an(Ao)),zn.layer=io(an(Eh)),zn.filter=io(an(ea)),zn.paintProperty=io(an(vc)),zn.layoutProperty=io(an(El));const ko=zn,cp=ko.light,Jf=ko.sky,ts=ko.paintProperty,wu=ko.layoutProperty;function xc(u,r){let h=!1;if(r&&r.length)for(const m of r)u.fire(new ae(new Error(m.message))),h=!0;return h}class wr{constructor(r,h,m){const b=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const M=new Int32Array(this.arrayBuffer);r=M[0],this.d=(h=M[1])+2*(m=M[2]);for(let D=0;D<this.d*this.d;D++){const z=M[3+D],N=M[3+D+1];b.push(z===N?null:M.subarray(z,N))}const k=M[3+b.length+1];this.keys=M.subarray(M[3+b.length],k),this.bboxes=M.subarray(k),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let M=0;M<this.d*this.d;M++)b.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=r,this.padding=m,this.scale=h/r,this.uid=0;const T=m/h*r;this.min=-T,this.max=r+T}insert(r,h,m,b,T){this._forEachCell(h,m,b,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,h,m,b,T,M){this.cells[T].push(M)}query(r,h,m,b,T){const M=this.min,k=this.max;if(r<=M&&h<=M&&k<=m&&k<=b&&!T)return Array.prototype.slice.call(this.keys);{const D=[];return this._forEachCell(r,h,m,b,this._queryCell,D,{},T),D}}_queryCell(r,h,m,b,T,M,k,D){const z=this.cells[T];if(z!==null){const N=this.keys,U=this.bboxes;for(let Z=0;Z<z.length;Z++){const $=z[Z];if(k[$]===void 0){const Q=4*$;(D?D(U[Q+0],U[Q+1],U[Q+2],U[Q+3]):r<=U[Q+2]&&h<=U[Q+3]&&m>=U[Q+0]&&b>=U[Q+1])?(k[$]=!0,M.push(N[$])):k[$]=!1}}}}_forEachCell(r,h,m,b,T,M,k,D){const z=this._convertToCellCoord(r),N=this._convertToCellCoord(h),U=this._convertToCellCoord(m),Z=this._convertToCellCoord(b);for(let $=z;$<=U;$++)for(let Q=N;Q<=Z;Q++){const J=this.d*Q+$;if((!D||D(this._convertFromCellCoord($),this._convertFromCellCoord(Q),this._convertFromCellCoord($+1),this._convertFromCellCoord(Q+1)))&&T.call(this,r,h,m,b,J,M,k,D))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,h=3+this.cells.length+1+1;let m=0;for(let M=0;M<this.cells.length;M++)m+=this.cells[M].length;const b=new Int32Array(h+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let T=h;for(let M=0;M<r.length;M++){const k=r[M];b[3+M]=T,b.set(k,T),T+=k.length}return b[3+r.length]=T,b.set(this.keys,T),T+=this.keys.length,b[3+r.length+1]=T,b.set(this.bboxes,T),T+=this.bboxes.length,b.buffer}static serialize(r,h){const m=r.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(r){return new wr(r.buffer)}}const no={};function At(u,r,h={}){if(no[u])throw new Error(`${u} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:u,writeable:!1}),no[u]={klass:r,omit:h.omit||[],shallow:h.shallow||[]}}At("Object",Object),At("TransferableGridIndex",wr),At("Color",hi),At("Error",Error),At("AJAXError",Sa),At("ResolvedImage",as),At("StylePropertyFunction",kl),At("StyleExpression",Na,{omit:["_evaluator"]}),At("ZoomDependentExpression",to),At("ZoomConstantExpression",vu),At("CompoundExpression",vr,{omit:["_evaluate"]});for(const u in Ra)Ra[u]._classRegistryKey||At(`Expression_${u}`,Ra[u]);function Pl(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function ed(u){return u.$name||u.constructor._classRegistryKey}function wc(u){return!function(r){if(r===null||typeof r!="object")return!1;const h=ed(r);return!(!h||h==="Object")}(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Pl(u)||Rn(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function Su(u,r){if(wc(u))return(Pl(u)||Rn(u))&&r&&r.push(u),ArrayBuffer.isView(u)&&r&&r.push(u.buffer),u instanceof ImageData&&r&&r.push(u.data.buffer),u;if(Array.isArray(u)){const T=[];for(const M of u)T.push(Su(M,r));return T}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const h=ed(u);if(!h)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!no[h])throw new Error(`${h} is not registered.`);const{klass:m}=no[h],b=m.serialize?m.serialize(u,r):{};if(m.serialize){if(r&&b===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in u){if(!u.hasOwnProperty(T)||no[h].omit.indexOf(T)>=0)continue;const M=u[T];b[T]=no[h].shallow.indexOf(T)>=0?M:Su(M,r)}u instanceof Error&&(b.message=u.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(b.$name=h),b}function qa(u){if(wc(u))return u;if(Array.isArray(u))return u.map(qa);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const r=ed(u)||"Object";if(!no[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:h}=no[r];if(!h)throw new Error(`can't deserialize unregistered class ${r}`);if(h.deserialize)return h.deserialize(u);const m=Object.create(h.prototype);for(const b of Object.keys(u)){if(b==="$name")continue;const T=u[b];m[b]=no[r].shallow.indexOf(b)>=0?T:qa(T)}return m}class so{constructor(){this.first=!0}update(r,h){const m=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=m,!0))}}const di={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Hangul Syllables":u=>u>=44032&&u<=55215,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Ol(u){for(const r of u)if(Mu(r.charCodeAt(0)))return!0;return!1}function td(u){for(const r of u)if(!Tu(r.charCodeAt(0)))return!1;return!0}function Ha(u){const r=u.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(r.join("|"),"u")}const Dh=Ha(["Arab","Dupl","Mong","Ougr","Syrc"]);function Tu(u){return!Dh.test(String.fromCodePoint(u))}const Rh=Ha(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Mu(u){return!(u!==746&&u!==747&&(u<4352||!(di["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||di["CJK Compatibility"](u)||di["CJK Strokes"](u)||!(!di["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||di["Enclosed CJK Letters and Months"](u)||di["Ideographic Description Characters"](u)||di.Kanbun(u)||di.Katakana(u)&&u!==12540||!(!di["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!di["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||di["Vertical Forms"](u)||di["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||Rh.test(String.fromCodePoint(u)))))}function Cu(u){return!(Mu(u)||function(r){return!!(di["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||di["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||di["Letterlike Symbols"](r)||di["Number Forms"](r)||di["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||di["Control Pictures"](r)&&r!==9251||di["Optical Character Recognition"](r)||di["Enclosed Alphanumerics"](r)||di["Geometric Shapes"](r)||di["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||di["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||di["CJK Symbols and Punctuation"](r)||di.Katakana(r)||di["Private Use Area"](r)||di["CJK Compatibility Forms"](r)||di["Small Form Variants"](r)||di["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(u))}const id=Ha(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Dl(u){return id.test(String.fromCodePoint(u))}function nd(u,r){return!(!r&&Dl(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||di.Khmer(u))}function up(u){for(const r of u)if(Dl(r.charCodeAt(0)))return!0;return!1}const Qs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(Qs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,r){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const h=u.pluginURL,m=new Promise(T=>{this.loadScriptResolve=T});r(h);const b=new Promise(T=>setTimeout(()=>T(),this.TIMEOUT));if(yield Promise.race([m,b]),this.isParsed()){const T={pluginStatus:"loaded",pluginURL:h};return this.setState(T),T}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${h}`)})}};class Hi{constructor(r,h){this.zoom=r,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new so,this.transition={})}isSupportedScript(r){return function(h,m){for(const b of h)if(!nd(b.charCodeAt(0),m))return!1;return!0}(r,Qs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,h=r-Math.floor(r),m=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class Rl{constructor(r,h){this.property=r,this.value=h,this.expression=function(m,b){if(Ko(m))return new kl(m,b);if(Al(m)){const T=Kf(m,b);if(T.result==="error")throw new Error(T.value.map(M=>`${M.key}: ${M.message}`).join(", "));return T.value}{let T=m;return b.type==="color"&&typeof m=="string"?T=hi.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)?T=es.parse(m):b.type==="projectionDefinition"&&typeof m=="string"&&(T=Un.parse(m)):T=Ps.parse(m),{kind:"constant",evaluate:()=>T}}}(h===void 0?r.specification.default:h,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,h,m){return this.property.possiblyEvaluate(this,r,h,m)}}class ro{constructor(r){this.property=r,this.value=new Rl(r,void 0)}transitioned(r,h){return new ia(this.property,this.value,h,Ei({},r.transition,this.transition),r.now)}untransitioned(){return new ia(this.property,this.value,null,{},0)}}class Eo{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Es(this._values[r].value.value)}setValue(r,h){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ro(this._values[r].property)),this._values[r].value=new Rl(this._values[r].property,h===null?void 0:Es(h))}getTransition(r){return Es(this._values[r].transition)}setTransition(r,h){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ro(this._values[r].property)),this._values[r].transition=Es(h)||void 0}serialize(){const r={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(r[h]=m);const b=this.getTransition(h);b!==void 0&&(r[`${h}-transition`]=b)}return r}transitioned(r,h){const m=new Ih(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(r,h._values[b]);return m}untransitioned(){const r=new Ih(this._properties);for(const h of Object.keys(this._values))r._values[h]=this._values[h].untransitioned();return r}}class ia{constructor(r,h,m,b,T){this.property=r,this.value=h,this.begin=T+b.delay||0,this.end=this.begin+b.duration||0,r.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(r,h,m){const b=r.now||0,T=this.value.possiblyEvaluate(r,h,m),M=this.prior;if(M){if(b>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(b<this.begin)return M.possiblyEvaluate(r,h,m);{const k=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(M.possiblyEvaluate(r,h,m),T,xt(k))}}return T}}class Ih{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,h,m){const b=new Za(this._properties);for(const T of Object.keys(this._values))b._values[T]=this._values[T].possiblyEvaluate(r,h,m);return b}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Au{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return Es(this._values[r].value)}setValue(r,h){this._values[r]=new Rl(this._values[r].property,h===null?void 0:Es(h))}serialize(){const r={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(r[h]=m)}return r}possiblyEvaluate(r,h,m){const b=new Za(this._properties);for(const T of Object.keys(this._values))b._values[T]=this._values[T].possiblyEvaluate(r,h,m);return b}}class ur{constructor(r,h,m){this.property=r,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,h,m,b){return this.property.evaluate(this.value,this.parameters,r,h,m,b)}}class Za{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class jt{constructor(r){this.specification=r}possiblyEvaluate(r,h){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(h)}interpolate(r,h,m){const b=Ki[this.specification.type];return b?b(r,h,m):r}}class Yt{constructor(r,h){this.specification=r,this.overrides=h}possiblyEvaluate(r,h,m,b){return new ur(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(h,null,{},m,b)}:r.expression,h)}interpolate(r,h,m){if(r.value.kind!=="constant"||h.value.kind!=="constant")return r;if(r.value.value===void 0||h.value.value===void 0)return new ur(this,{kind:"constant",value:void 0},r.parameters);const b=Ki[this.specification.type];if(b){const T=b(r.value.value,h.value.value,m);return new ur(this,{kind:"constant",value:T},r.parameters)}return r}evaluate(r,h,m,b,T,M){return r.kind==="constant"?r.value:r.evaluate(h,m,b,T,M)}}class Po extends Yt{possiblyEvaluate(r,h,m,b){if(r.value===void 0)return new ur(this,{kind:"constant",value:void 0},h);if(r.expression.kind==="constant"){const T=r.expression.evaluate(h,null,{},m,b),M=r.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,k=this._calculate(M,M,M,h);return new ur(this,{kind:"constant",value:k},h)}if(r.expression.kind==="camera"){const T=this._calculate(r.expression.evaluate({zoom:h.zoom-1}),r.expression.evaluate({zoom:h.zoom}),r.expression.evaluate({zoom:h.zoom+1}),h);return new ur(this,{kind:"constant",value:T},h)}return new ur(this,r.expression,h)}evaluate(r,h,m,b,T,M){if(r.kind==="source"){const k=r.evaluate(h,m,b,T,M);return this._calculate(k,k,k,h)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(h.zoom)-1},m,b),r.evaluate({zoom:Math.floor(h.zoom)},m,b),r.evaluate({zoom:Math.floor(h.zoom)+1},m,b),h):r.value}_calculate(r,h,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:r,to:h}:{from:m,to:h}}interpolate(r){return r}}class Sc{constructor(r){this.specification=r}possiblyEvaluate(r,h,m,b){if(r.value!==void 0){if(r.expression.kind==="constant"){const T=r.expression.evaluate(h,null,{},m,b);return this._calculate(T,T,T,h)}return this._calculate(r.expression.evaluate(new Hi(Math.floor(h.zoom-1),h)),r.expression.evaluate(new Hi(Math.floor(h.zoom),h)),r.expression.evaluate(new Hi(Math.floor(h.zoom+1),h)),h)}}_calculate(r,h,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:r,to:h}:{from:m,to:h}}interpolate(r){return r}}class zh{constructor(r){this.specification=r}possiblyEvaluate(r,h,m,b){return!!r.expression.evaluate(h,null,{},m,b)}interpolate(){return!1}}class Bs{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in r){const m=r[h];m.specification.overridable&&this.overridableProperties.push(h);const b=this.defaultPropertyValues[h]=new Rl(m,void 0),T=this.defaultTransitionablePropertyValues[h]=new ro(m);this.defaultTransitioningPropertyValues[h]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=b.possiblyEvaluate({})}}}At("DataDrivenProperty",Yt),At("DataConstantProperty",jt),At("CrossFadedDataDrivenProperty",Po),At("CrossFadedProperty",Sc),At("ColorRampProperty",zh);const Lh="-transition";class ws extends ge{constructor(r,h){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),h.layout&&(this._unevaluatedLayout=new Au(h.layout)),h.paint)){this._transitionablePaint=new Eo(h.paint);for(const m in r.paint)this.setPaintProperty(m,r.paint[m],{validate:!1});for(const m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Za(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,h,m={}){h!=null&&this._validate(wu,`layers.${this.id}.layout.${r}`,r,h,m)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,h):this.visibility=h)}getPaintProperty(r){return r.endsWith(Lh)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,h,m={}){if(h!=null&&this._validate(ts,`layers.${this.id}.paint.${r}`,r,h,m))return!1;if(r.endsWith(Lh))return this._transitionablePaint.setTransition(r.slice(0,-11),h||void 0),!1;{const b=this._transitionablePaint._values[r],T=b.property.specification["property-type"]==="cross-faded-data-driven",M=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(r,h),this._handleSpecialPaintPropertyUpdate(r);const D=this._transitionablePaint._values[r].value;return D.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(r,k,D)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,h,m){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,h){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,h)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),dl(r,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(r,h,m,b,T={}){return(!T||T.validate!==!1)&&xc(this,r.call(ko,{key:h,layerType:this.type,objectKey:m,value:b,styleSpec:ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const h=this.paint.get(r);if(h instanceof ur&&zs(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const ui={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ri{constructor(r,h){this._structArray=r,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,h){return r._trim(),h&&(r.isTransferred=!0,h.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const h=Object.create(this.prototype);return h.arrayBuffer=r.arrayBuffer,h.length=r.length,h.capacity=r.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _n(u,r=1){let h=0,m=0;return{members:u.map(b=>{const T=ui[b.type].BYTES_PER_ELEMENT,M=h=Ga(h,Math.max(r,T)),k=b.components||1;return m=Math.max(m,T),h+=T*k,{name:b.name,type:b.type,components:k,offset:M}}),size:Ga(h,Math.max(m,r)),alignment:r}}function Ga(u,r){return Math.ceil(u/r)*r}class oo extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,h)}emplace(r,h,m){const b=2*r;return this.int16[b+0]=h,this.int16[b+1]=m,r}}oo.prototype.bytesPerElement=4,At("StructArrayLayout2i4",oo);class Il extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,r,h,m)}emplace(r,h,m,b){const T=3*r;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=b,r}}Il.prototype.bytesPerElement=6,At("StructArrayLayout3i6",Il);class Sr extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,h,m,b)}emplace(r,h,m,b,T){const M=4*r;return this.int16[M+0]=h,this.int16[M+1]=m,this.int16[M+2]=b,this.int16[M+3]=T,r}}Sr.prototype.bytesPerElement=8,At("StructArrayLayout4i8",Sr);class na extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M){const k=this.length;return this.resize(k+1),this.emplace(k,r,h,m,b,T,M)}emplace(r,h,m,b,T,M,k){const D=6*r;return this.int16[D+0]=h,this.int16[D+1]=m,this.int16[D+2]=b,this.int16[D+3]=T,this.int16[D+4]=M,this.int16[D+5]=k,r}}na.prototype.bytesPerElement=12,At("StructArrayLayout2i4i12",na);class ku extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M){const k=this.length;return this.resize(k+1),this.emplace(k,r,h,m,b,T,M)}emplace(r,h,m,b,T,M,k){const D=4*r,z=8*r;return this.int16[D+0]=h,this.int16[D+1]=m,this.uint8[z+4]=b,this.uint8[z+5]=T,this.uint8[z+6]=M,this.uint8[z+7]=k,r}}ku.prototype.bytesPerElement=8,At("StructArrayLayout2i4ub8",ku);class ln extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,h)}emplace(r,h,m){const b=2*r;return this.float32[b+0]=h,this.float32[b+1]=m,r}}ln.prototype.bytesPerElement=8,At("StructArrayLayout2f8",ln);class zl extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M,k,D,z,N){const U=this.length;return this.resize(U+1),this.emplace(U,r,h,m,b,T,M,k,D,z,N)}emplace(r,h,m,b,T,M,k,D,z,N,U){const Z=10*r;return this.uint16[Z+0]=h,this.uint16[Z+1]=m,this.uint16[Z+2]=b,this.uint16[Z+3]=T,this.uint16[Z+4]=M,this.uint16[Z+5]=k,this.uint16[Z+6]=D,this.uint16[Z+7]=z,this.uint16[Z+8]=N,this.uint16[Z+9]=U,r}}zl.prototype.bytesPerElement=20,At("StructArrayLayout10ui20",zl);class Eu extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M,k,D,z,N,U,Z){const $=this.length;return this.resize($+1),this.emplace($,r,h,m,b,T,M,k,D,z,N,U,Z)}emplace(r,h,m,b,T,M,k,D,z,N,U,Z,$){const Q=12*r;return this.int16[Q+0]=h,this.int16[Q+1]=m,this.int16[Q+2]=b,this.int16[Q+3]=T,this.uint16[Q+4]=M,this.uint16[Q+5]=k,this.uint16[Q+6]=D,this.uint16[Q+7]=z,this.int16[Q+8]=N,this.int16[Q+9]=U,this.int16[Q+10]=Z,this.int16[Q+11]=$,r}}Eu.prototype.bytesPerElement=24,At("StructArrayLayout4i4ui4i24",Eu);class Ll extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,r,h,m)}emplace(r,h,m,b){const T=3*r;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=b,r}}Ll.prototype.bytesPerElement=12,At("StructArrayLayout3f12",Ll);class $a extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const h=this.length;return this.resize(h+1),this.emplace(h,r)}emplace(r,h){return this.uint32[1*r+0]=h,r}}$a.prototype.bytesPerElement=4,At("StructArrayLayout1ul4",$a);class sd extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M,k,D,z){const N=this.length;return this.resize(N+1),this.emplace(N,r,h,m,b,T,M,k,D,z)}emplace(r,h,m,b,T,M,k,D,z,N){const U=10*r,Z=5*r;return this.int16[U+0]=h,this.int16[U+1]=m,this.int16[U+2]=b,this.int16[U+3]=T,this.int16[U+4]=M,this.int16[U+5]=k,this.uint32[Z+3]=D,this.uint16[U+8]=z,this.uint16[U+9]=N,r}}sd.prototype.bytesPerElement=20,At("StructArrayLayout6i1ul2ui20",sd);class Tc extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M){const k=this.length;return this.resize(k+1),this.emplace(k,r,h,m,b,T,M)}emplace(r,h,m,b,T,M,k){const D=6*r;return this.int16[D+0]=h,this.int16[D+1]=m,this.int16[D+2]=b,this.int16[D+3]=T,this.int16[D+4]=M,this.int16[D+5]=k,r}}Tc.prototype.bytesPerElement=12,At("StructArrayLayout2i2i2i12",Tc);class sa extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T){const M=this.length;return this.resize(M+1),this.emplace(M,r,h,m,b,T)}emplace(r,h,m,b,T,M){const k=4*r,D=8*r;return this.float32[k+0]=h,this.float32[k+1]=m,this.float32[k+2]=b,this.int16[D+6]=T,this.int16[D+7]=M,r}}sa.prototype.bytesPerElement=16,At("StructArrayLayout2f1f2i16",sa);class Pu extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M){const k=this.length;return this.resize(k+1),this.emplace(k,r,h,m,b,T,M)}emplace(r,h,m,b,T,M,k){const D=16*r,z=4*r,N=8*r;return this.uint8[D+0]=h,this.uint8[D+1]=m,this.float32[z+1]=b,this.float32[z+2]=T,this.int16[N+6]=M,this.int16[N+7]=k,r}}Pu.prototype.bytesPerElement=16,At("StructArrayLayout2ub2f2i16",Pu);class Ss extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,r,h,m)}emplace(r,h,m,b){const T=3*r;return this.uint16[T+0]=h,this.uint16[T+1]=m,this.uint16[T+2]=b,r}}Ss.prototype.bytesPerElement=6,At("StructArrayLayout3ui6",Ss);class Sn extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,r,h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe)}emplace(r,h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe,Ae){const pe=24*r,G=12*r,re=48*r;return this.int16[pe+0]=h,this.int16[pe+1]=m,this.uint16[pe+2]=b,this.uint16[pe+3]=T,this.uint32[G+2]=M,this.uint32[G+3]=k,this.uint32[G+4]=D,this.uint16[pe+10]=z,this.uint16[pe+11]=N,this.uint16[pe+12]=U,this.float32[G+7]=Z,this.float32[G+8]=$,this.uint8[re+36]=Q,this.uint8[re+37]=J,this.uint8[re+38]=oe,this.uint32[G+10]=fe,this.int16[pe+22]=Ae,r}}Sn.prototype.bytesPerElement=48,At("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Sn);class Ou extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe,Ae,pe,G,re,ye,Ue,ut,Ge,Je,mt,ft){const bt=this.length;return this.resize(bt+1),this.emplace(bt,r,h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe,Ae,pe,G,re,ye,Ue,ut,Ge,Je,mt,ft)}emplace(r,h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe,Ae,pe,G,re,ye,Ue,ut,Ge,Je,mt,ft,bt){const nt=32*r,Pt=16*r;return this.int16[nt+0]=h,this.int16[nt+1]=m,this.int16[nt+2]=b,this.int16[nt+3]=T,this.int16[nt+4]=M,this.int16[nt+5]=k,this.int16[nt+6]=D,this.int16[nt+7]=z,this.uint16[nt+8]=N,this.uint16[nt+9]=U,this.uint16[nt+10]=Z,this.uint16[nt+11]=$,this.uint16[nt+12]=Q,this.uint16[nt+13]=J,this.uint16[nt+14]=oe,this.uint16[nt+15]=fe,this.uint16[nt+16]=Ae,this.uint16[nt+17]=pe,this.uint16[nt+18]=G,this.uint16[nt+19]=re,this.uint16[nt+20]=ye,this.uint16[nt+21]=Ue,this.uint16[nt+22]=ut,this.uint32[Pt+12]=Ge,this.float32[Pt+13]=Je,this.float32[Pt+14]=mt,this.uint16[nt+30]=ft,this.uint16[nt+31]=bt,r}}Ou.prototype.bytesPerElement=64,At("StructArrayLayout8i15ui1ul2f2ui64",Ou);class x extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const h=this.length;return this.resize(h+1),this.emplace(h,r)}emplace(r,h){return this.float32[1*r+0]=h,r}}x.prototype.bytesPerElement=4,At("StructArrayLayout1f4",x);class i extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,r,h,m)}emplace(r,h,m,b){const T=3*r;return this.uint16[6*r+0]=h,this.float32[T+1]=m,this.float32[T+2]=b,r}}i.prototype.bytesPerElement=12,At("StructArrayLayout1ui2f12",i);class c extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,r,h,m)}emplace(r,h,m,b){const T=4*r;return this.uint32[2*r+0]=h,this.uint16[T+2]=m,this.uint16[T+3]=b,r}}c.prototype.bytesPerElement=8,At("StructArrayLayout1ul2ui8",c);class g extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,h)}emplace(r,h,m){const b=2*r;return this.uint16[b+0]=h,this.uint16[b+1]=m,r}}g.prototype.bytesPerElement=4,At("StructArrayLayout2ui4",g);class _ extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const h=this.length;return this.resize(h+1),this.emplace(h,r)}emplace(r,h){return this.uint16[1*r+0]=h,r}}_.prototype.bytesPerElement=2,At("StructArrayLayout1ui2",_);class S extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,h,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,h,m,b)}emplace(r,h,m,b,T){const M=4*r;return this.float32[M+0]=h,this.float32[M+1]=m,this.float32[M+2]=b,this.float32[M+3]=T,r}}S.prototype.bytesPerElement=16,At("StructArrayLayout4f16",S);class C extends Ri{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new K(this.anchorPointX,this.anchorPointY)}}C.prototype.size=20;class O extends sd{get(r){return new C(this,r)}}At("CollisionBoxArray",O);class R extends Ri{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}R.prototype.size=48;class B extends Sn{get(r){return new R(this,r)}}At("PlacedSymbolArray",B);class V extends Ri{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}V.prototype.size=64;class q extends Ou{get(r){return new V(this,r)}}At("SymbolInstanceArray",q);class H extends x{getoffsetX(r){return this.float32[1*r+0]}}At("GlyphOffsetArray",H);class W extends Il{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}At("SymbolLineVertexArray",W);class Y extends Ri{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Y.prototype.size=12;class ue extends i{get(r){return new Y(this,r)}}At("TextAnchorOffsetArray",ue);class ce extends Ri{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ce.prototype.size=8;class he extends c{get(r){return new ce(this,r)}}At("FeatureIndexArray",he);class de extends oo{}class _e extends oo{}class be extends oo{}class Me extends na{}class Pe extends ku{}class Ce extends ln{}class Ne extends zl{}class qe extends Eu{}class it extends Ll{}class tt extends $a{}class et extends Tc{}class wt extends Pu{}class vt extends Ss{}class rt extends g{}const zt=_n([{name:"a_pos",components:2,type:"Int16"}],4),{members:ci}=zt;class ii{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,h,m,b){const T=this.segments[this.segments.length-1];return r>ii.MAX_VERTEX_ARRAY_LENGTH&&gs(`Max vertices per segment is ${ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ii.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!T||T.vertexLength+r>ii.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==b?this.createNewSegment(h,m,b):T}createNewSegment(r,h,m){const b={vertexOffset:r.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0,vaos:{}};return m!==void 0&&(b.sortKey=m),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(b),b}getOrCreateLatestSegment(r,h,m){return this.prepareSegment(0,r,h,m)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const h in r.vaos)r.vaos[h].destroy()}static simpleSegment(r,h,m,b){return new ii([{vertexOffset:r,primitiveOffset:h,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function cn(u,r){return 256*(u=Jt(Math.floor(u),0,255))+Jt(Math.floor(r),0,255)}ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At("SegmentVector",ii);const Ii=_n([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var un,Zi,Li,Oi={exports:{}},qn={exports:{}},Hn={exports:{}},cs=function(){if(Li)return Oi.exports;Li=1;var u=(un||(un=1,qn.exports=function(h,m){var b,T,M,k,D,z,N,U;for(T=h.length-(b=3&h.length),M=m,D=3432918353,z=461845907,U=0;U<T;)N=255&h.charCodeAt(U)|(255&h.charCodeAt(++U))<<8|(255&h.charCodeAt(++U))<<16|(255&h.charCodeAt(++U))<<24,++U,M=27492+(65535&(k=5*(65535&(M=(M^=N=(65535&(N=(N=(65535&N)*D+(((N>>>16)*D&65535)<<16)&4294967295)<<15|N>>>17))*z+(((N>>>16)*z&65535)<<16)&4294967295)<<13|M>>>19))+((5*(M>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(N=0,b){case 3:N^=(255&h.charCodeAt(U+2))<<16;case 2:N^=(255&h.charCodeAt(U+1))<<8;case 1:M^=N=(65535&(N=(N=(65535&(N^=255&h.charCodeAt(U)))*D+(((N>>>16)*D&65535)<<16)&4294967295)<<15|N>>>17))*z+(((N>>>16)*z&65535)<<16)&4294967295}return M^=h.length,M=2246822507*(65535&(M^=M>>>16))+((2246822507*(M>>>16)&65535)<<16)&4294967295,M=3266489909*(65535&(M^=M>>>13))+((3266489909*(M>>>16)&65535)<<16)&4294967295,(M^=M>>>16)>>>0}),qn.exports),r=(Zi||(Zi=1,Hn.exports=function(h,m){for(var b,T=h.length,M=m^T,k=0;T>=4;)b=1540483477*(65535&(b=255&h.charCodeAt(k)|(255&h.charCodeAt(++k))<<8|(255&h.charCodeAt(++k))<<16|(255&h.charCodeAt(++k))<<24))+((1540483477*(b>>>16)&65535)<<16),M=1540483477*(65535&M)+((1540483477*(M>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),T-=4,++k;switch(T){case 3:M^=(255&h.charCodeAt(k+2))<<16;case 2:M^=(255&h.charCodeAt(k+1))<<8;case 1:M=1540483477*(65535&(M^=255&h.charCodeAt(k)))+((1540483477*(M>>>16)&65535)<<16)}return M=1540483477*(65535&(M^=M>>>13))+((1540483477*(M>>>16)&65535)<<16),(M^=M>>>15)>>>0}),Hn.exports);return Oi.exports=u,Oi.exports.murmur3=u,Oi.exports.murmur2=r,Oi.exports}(),Ns=v(cs);class Ur{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,h,m,b){this.ids.push(ra(r)),this.positions.push(h,m,b)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=ra(r);let m=0,b=this.ids.length-1;for(;m<b;){const M=m+b>>1;this.ids[M]>=h?b=M:m=M+1}const T=[];for(;this.ids[m]===h;)T.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return T}static serialize(r,h){const m=new Float64Array(r.ids),b=new Uint32Array(r.positions);return Oo(m,b,0,m.length-1),h&&h.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(r){const h=new Ur;return h.ids=r.ids,h.positions=r.positions,h.indexed=!0,h}}function ra(u){const r=+u;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Ns(String(u))}function Oo(u,r,h,m){for(;h<m;){const b=u[h+m>>1];let T=h-1,M=m+1;for(;;){do T++;while(u[T]<b);do M--;while(u[M]>b);if(T>=M)break;ao(u,T,M),ao(r,3*T,3*M),ao(r,3*T+1,3*M+1),ao(r,3*T+2,3*M+2)}M-h<m-M?(Oo(u,r,h,M),h=M+1):(Oo(u,r,M+1,m),m=M)}}function ao(u,r,h){const m=u[r];u[r]=u[h],u[h]=m}At("FeaturePositionMap",Ur);class lo{constructor(r,h){this.gl=r.gl,this.location=h}}class Xa extends lo{constructor(r,h){super(r,h),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Bl extends lo{constructor(r,h){super(r,h),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Tr extends lo{constructor(r,h){super(r,h),this.current=hi.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const oa=new Float32Array(16);function Mr(u){return[cn(255*u.r,255*u.g),cn(255*u.b,255*u.a)]}class co{constructor(r,h,m){this.value=r,this.uniformNames=h.map(b=>`u_${b}`),this.type=m}setUniform(r,h,m){r.set(m.constantOr(this.value))}getBinding(r,h,m){return this.type==="color"?new Tr(r,h):new Xa(r,h)}}class Yi{constructor(r,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=r.tlbr}setUniform(r,h,m,b){const T=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&r.set(T)}getBinding(r,h,m){return m.substr(0,9)==="u_pattern"?new Bl(r,h):new Xa(r,h)}}class Ji{constructor(r,h,m,b){this.expression=r,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(T=>({name:`a_${T}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,h,m,b,T){const M=this.paintVertexArray.length,k=this.expression.evaluate(new Hi(0),h,{},b,[],T);this.paintVertexArray.resize(r),this._setPaintValue(M,r,k)}updatePaintArray(r,h,m,b){const T=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(r,h,T)}_setPaintValue(r,h,m){if(this.type==="color"){const b=Mr(m);for(let T=r;T<h;T++)this.paintVertexArray.emplace(T,b[0],b[1])}else{for(let b=r;b<h;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Tn{constructor(r,h,m,b,T,M){this.expression=r,this.uniformNames=h.map(k=>`u_${k}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=h.map(k=>({name:`a_${k}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new M}populatePaintArray(r,h,m,b,T){const M=this.expression.evaluate(new Hi(this.zoom),h,{},b,[],T),k=this.expression.evaluate(new Hi(this.zoom+1),h,{},b,[],T),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,M,k)}updatePaintArray(r,h,m,b){const T=this.expression.evaluate({zoom:this.zoom},m,b),M=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(r,h,T,M)}_setPaintValue(r,h,m,b){if(this.type==="color"){const T=Mr(m),M=Mr(b);for(let k=r;k<h;k++)this.paintVertexArray.emplace(k,T[0],T[1],M[0],M[1])}else{for(let T=r;T<h;T++)this.paintVertexArray.emplace(T,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=Jt(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);r.set(b)}getBinding(r,h,m){return new Xa(r,h)}}class Gi{constructor(r,h,m,b,T,M){this.expression=r,this.type=h,this.useIntegerZoom=m,this.zoom=b,this.layerId=M,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(r,h,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(b,r,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(r,h,m,b,T){this._setPaintValues(r,h,m.patterns&&m.patterns[this.layerId],T)}_setPaintValues(r,h,m,b){if(!b||!m)return;const{min:T,mid:M,max:k}=m,D=b[T],z=b[M],N=b[k];if(D&&z&&N)for(let U=r;U<h;U++)this.zoomInPaintVertexArray.emplace(U,z.tl[0],z.tl[1],z.br[0],z.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],z.pixelRatio,D.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,z.tl[0],z.tl[1],z.br[0],z.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],z.pixelRatio,N.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,Ii.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,Ii.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class rd{constructor(r,h,m){this.binders={},this._buffers=[];const b=[];for(const T in r.paint._values){if(!m(T))continue;const M=r.paint.get(T);if(!(M instanceof ur&&zs(M.property.specification)))continue;const k=Gm(T,r.type),D=M.value,z=M.property.specification.type,N=M.property.useIntegerZoom,U=M.property.specification["property-type"],Z=U==="cross-faded"||U==="cross-faded-data-driven";if(D.kind==="constant")this.binders[T]=Z?new Yi(D.value,k):new co(D.value,k,z),b.push(`/u_${T}`);else if(D.kind==="source"||Z){const $=Nl(T,z,"source");this.binders[T]=Z?new Gi(D,z,N,h,$,r.id):new Ji(D,k,z,$),b.push(`/a_${T}`)}else{const $=Nl(T,z,"composite");this.binders[T]=new Tn(D,k,z,N,h,$),b.push(`/z_${T}`)}}this.cacheKey=b.sort().join("")}getMaxValue(r){const h=this.binders[r];return h instanceof Ji||h instanceof Tn?h.maxValue:0}populatePaintArrays(r,h,m,b,T){for(const M in this.binders){const k=this.binders[M];(k instanceof Ji||k instanceof Tn||k instanceof Gi)&&k.populatePaintArray(r,h,m,b,T)}}setConstantPatternPositions(r,h){for(const m in this.binders){const b=this.binders[m];b instanceof Yi&&b.setConstantPatternPositions(r,h)}}updatePaintArrays(r,h,m,b,T){let M=!1;for(const k in r){const D=h.getPositions(k);for(const z of D){const N=m.feature(z.index);for(const U in this.binders){const Z=this.binders[U];if((Z instanceof Ji||Z instanceof Tn||Z instanceof Gi)&&Z.expression.isStateDependent===!0){const $=b.paint.get(U);Z.expression=$.value,Z.updatePaintArray(z.start,z.end,N,r[k],T),M=!0}}}}return M}defines(){const r=[];for(const h in this.binders){const m=this.binders[h];(m instanceof co||m instanceof Yi)&&r.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return r}getBinderAttributes(){const r=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Ji||m instanceof Tn)for(let b=0;b<m.paintVertexAttributes.length;b++)r.push(m.paintVertexAttributes[b].name);else if(m instanceof Gi)for(let b=0;b<Ii.members.length;b++)r.push(Ii.members[b].name)}return r}getBinderUniforms(){const r=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof co||m instanceof Yi||m instanceof Tn)for(const b of m.uniformNames)r.push(b)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,h){const m=[];for(const b in this.binders){const T=this.binders[b];if(T instanceof co||T instanceof Yi||T instanceof Tn){for(const M of T.uniformNames)if(h[M]){const k=T.getBinding(r,h[M],M);m.push({name:M,property:b,binding:k})}}}return m}setUniforms(r,h,m,b){for(const{name:T,property:M,binding:k}of h)this.binders[M].setUniform(k,b,m.get(M),T)}updatePaintBuffers(r){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(r&&m instanceof Gi){const b=r.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof Ji||m instanceof Tn)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(r){for(const h in this.binders){const m=this.binders[h];(m instanceof Ji||m instanceof Tn||m instanceof Gi)&&m.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const h=this.binders[r];(h instanceof Ji||h instanceof Tn||h instanceof Gi)&&h.destroy()}}}class Qa{constructor(r,h,m=()=>!0){this.programConfigurations={};for(const b of r)this.programConfigurations[b.id]=new rd(b,h,m);this.needsUpload=!1,this._featureMap=new Ur,this._bufferOffset=0}populatePaintArrays(r,h,m,b,T,M){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(r,h,b,T,M);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,h,m,b){for(const T of m)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(r,this._featureMap,h,T,b)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function Gm(u,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${r}-`,"").replace(/-/g,"_")]}function Nl(u,r,h){const m={color:{source:ln,composite:S},number:{source:x,composite:ln}},b=function(T){return{"line-pattern":{source:Ne,composite:Ne},"fill-pattern":{source:Ne,composite:Ne},"fill-extrusion-pattern":{source:Ne,composite:Ne}}[T]}(u);return b&&b[h]||m[r][h]}At("ConstantBinder",co),At("CrossFadedConstantBinder",Yi),At("SourceExpressionBinder",Ji),At("CrossFadedCompositeBinder",Gi),At("CompositeExpressionBinder",Tn),At("ProgramConfiguration",rd,{omit:["_buffers"]}),At("ProgramConfigurationSet",Qa);const Fl=Math.pow(2,14)-1,Du=-Fl-1;function Ts(u){const r=_t/u.extent,h=u.loadGeometry();for(let m=0;m<h.length;m++){const b=h[m];for(let T=0;T<b.length;T++){const M=b[T],k=Math.round(M.x*r),D=Math.round(M.y*r);M.x=Jt(k,Du,Fl),M.y=Jt(D,Du,Fl),(k<M.x||k>M.x+1||D<M.y||D>M.y+1)&&gs("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function uo(u,r){return{type:u.type,id:u.id,properties:u.properties,geometry:r?Ts(u):[]}}const Bh=-32768;function od(u,r,h,m,b){u.emplaceBack(Bh+8*r+m,Bh+8*h+b)}class Do{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(h=>h.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.indexArray=new vt,this.segments=new ii,this.programConfigurations=new Qa(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(r,h,m){const b=this.layers[0],T=[];let M=null,k=!1,D=b.type==="heatmap";if(b.type==="circle"){const N=b;M=N.layout.get("circle-sort-key"),k=!M.isConstant(),D=D||N.paint.get("circle-pitch-alignment")==="map"}const z=D?h.subdivisionGranularity.circle:1;for(const{feature:N,id:U,index:Z,sourceLayerIndex:$}of r){const Q=this.layers[0]._featureFilter.needGeometry,J=uo(N,Q);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),J,m))continue;const oe=k?M.evaluate(J,{},m):void 0,fe={id:U,properties:N.properties,type:N.type,sourceLayerIndex:$,index:Z,geometry:Q?J.geometry:Ts(N),patterns:{},sortKey:oe};T.push(fe)}k&&T.sort((N,U)=>N.sortKey-U.sortKey);for(const N of T){const{geometry:U,index:Z,sourceLayerIndex:$}=N,Q=r[Z].feature;this.addFeature(N,U,Z,m,z),h.featureIndex.insert(Q,U,Z,$,this.index)}}update(r,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ci),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,h,m,b,T=1){let M;switch(T){case 1:M=[0,7];break;case 3:M=[0,2,5,7];break;case 5:M=[0,1,3,4,6,7];break;case 7:M=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${T}; valid values are 1, 3, 5, 7.`)}const k=M.length;for(const D of h)for(const z of D){const N=z.x,U=z.y;if(N<0||N>=_t||U<0||U>=_t)continue;const Z=this.segments.prepareSegment(k*k,this.layoutVertexArray,this.indexArray,r.sortKey),$=Z.vertexLength;for(let Q=0;Q<k;Q++)for(let J=0;J<k;J++)od(this.layoutVertexArray,N,U,M[J],M[Q]);for(let Q=0;Q<k-1;Q++)for(let J=0;J<k-1;J++){const oe=$+Q*k+J,fe=$+(Q+1)*k+J;this.indexArray.emplaceBack(oe,fe+1,oe+1),this.indexArray.emplaceBack(oe,fe,fe+1)}Z.vertexLength+=k*k,Z.primitiveLength+=(k-1)*(k-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,m,{},b)}}function Nh(u,r){for(let h=0;h<u.length;h++)if(jl(r,u[h]))return!0;for(let h=0;h<r.length;h++)if(jl(u,r[h]))return!0;return!!hp(u,r)}function hr(u,r,h){return!!jl(u,r)||!!la(r,u,h)}function aa(u,r){if(u.length===1)return ad(r,u[0]);for(let h=0;h<r.length;h++){const m=r[h];for(let b=0;b<m.length;b++)if(jl(u,m[b]))return!0}for(let h=0;h<u.length;h++)if(ad(r,u[h]))return!0;for(let h=0;h<r.length;h++)if(hp(u,r[h]))return!0;return!1}function Mc(u,r,h){if(u.length>1){if(hp(u,r))return!0;for(let m=0;m<r.length;m++)if(la(r[m],u,h))return!0}for(let m=0;m<u.length;m++)if(la(u[m],r,h))return!0;return!1}function hp(u,r){if(u.length===0||r.length===0)return!1;for(let h=0;h<u.length-1;h++){const m=u[h],b=u[h+1];for(let T=0;T<r.length-1;T++)if(Cc(m,b,r[T],r[T+1]))return!0}return!1}function Cc(u,r,h,m){return ji(u,h,m)!==ji(r,h,m)&&ji(u,r,h)!==ji(u,r,m)}function la(u,r,h){const m=h*h;if(r.length===1)return u.distSqr(r[0])<m;for(let b=1;b<r.length;b++)if(us(u,r[b-1],r[b])<m)return!0;return!1}function us(u,r,h){const m=r.distSqr(h);if(m===0)return u.distSqr(r);const b=((u.x-r.x)*(h.x-r.x)+(u.y-r.y)*(h.y-r.y))/m;return u.distSqr(b<0?r:b>1?h:h.sub(r)._mult(b)._add(r))}function ad(u,r){for(let h=0;h<u.length;h++)if(jl(u[h],r))return!0;return!1}function jl(u,r){let h=!1;for(let m=0,b=u.length-1;m<u.length;b=m++){const T=u[m],M=u[b];T.y>r.y!=M.y>r.y&&r.x<(M.x-T.x)*(r.y-T.y)/(M.y-T.y)+T.x&&(h=!h)}return h}function $m(u,r,h){const m=h[0],b=h[2];if(u.x<m.x&&r.x<m.x||u.x>b.x&&r.x>b.x||u.y<m.y&&r.y<m.y||u.y>b.y&&r.y>b.y)return!1;const T=ji(u,r,h[0]);return T!==ji(u,r,h[1])||T!==ji(u,r,h[2])||T!==ji(u,r,h[3])}function Fh(u,r,h){const m=r.paint.get(u).value;return m.kind==="constant"?m.value:h.programConfigurations.get(r.id).getMaxValue(u)}function ld(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Wa(u,r,h,m,b){if(!r[0]&&!r[1])return u;const T=K.convert(r)._mult(b);h==="viewport"&&T._rotate(-m);const M=[];for(let k=0;k<u.length;k++)M.push(u[k].sub(T));return M}let cd,Xm;At("CircleBucket",Do,{omit:["layers"]});var Dy={get paint(){return Xm=Xm||new Bs({"circle-radius":new Yt(ne.paint_circle["circle-radius"]),"circle-color":new Yt(ne.paint_circle["circle-color"]),"circle-blur":new Yt(ne.paint_circle["circle-blur"]),"circle-opacity":new Yt(ne.paint_circle["circle-opacity"]),"circle-translate":new jt(ne.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(ne.paint_circle["circle-stroke-opacity"])})},get layout(){return cd=cd||new Bs({"circle-sort-key":new Yt(ne.layout_circle["circle-sort-key"])})}};class Ry extends ws{constructor(r){super(r,Dy)}createBucket(r){return new Do(r)}queryRadius(r){const h=r;return Fh("circle-radius",this,h)+Fh("circle-stroke-width",this,h)+ld(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:h,featureState:m,geometry:b,transform:T,pixelsToTileUnits:M,unwrappedTileID:k,getElevation:D}){const z=Wa(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,M),N=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),U=this.paint.get("circle-pitch-alignment")==="map",Z=U?z:function(Q,J,oe,fe){return Q.map(Ae=>ud(Ae,J,oe,fe))}(z,T,k,D),$=U?N*M:N;for(const Q of b)for(const J of Q){const oe=U?J:ud(J,T,k,D);let fe=$;const Ae=T.projectTileCoordinates(J.x,J.y,k,D).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?fe*=Ae/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(fe*=T.cameraToCenterDistance/Ae),hr(Z,oe,fe))return!0}return!1}}function ud(u,r,h,m){const b=r.projectTileCoordinates(u.x,u.y,h,m).point;return new K((.5*b.x+.5)*r.width,(.5*-b.y+.5)*r.height)}class Qm extends Do{}let fp;At("HeatmapBucket",Qm,{omit:["layers"]});var Iy={get paint(){return fp=fp||new Bs({"heatmap-radius":new Yt(ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zh(ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(ne.paint_heatmap["heatmap-opacity"])})}};function dp(u,{width:r,height:h},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==r*h*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${r*h*m}`)}else b=new Uint8Array(r*h*m);return u.width=r,u.height=h,u.data=b,u}function zy(u,{width:r,height:h},m){if(r===u.width&&h===u.height)return;const b=dp({},{width:r,height:h},m);pp(u,b,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,r),height:Math.min(u.height,h)},m),u.width=r,u.height=h,u.data=b.data}function pp(u,r,h,m,b,T){if(b.width===0||b.height===0)return r;if(b.width>u.width||b.height>u.height||h.x>u.width-b.width||h.y>u.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>r.width||b.height>r.height||m.x>r.width-b.width||m.y>r.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const M=u.data,k=r.data;if(M===k)throw new Error("srcData equals dstData, so image is already copied");for(let D=0;D<b.height;D++){const z=((h.y+D)*u.width+h.x)*T,N=((m.y+D)*r.width+m.x)*T;for(let U=0;U<b.width*T;U++)k[N+U]=M[z+U]}return r}class Zn{constructor(r,h){dp(this,r,1,h)}resize(r){zy(this,r,1)}clone(){return new Zn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,h,m,b,T){pp(r,h,m,b,T,1)}}class en{constructor(r,h){dp(this,r,4,h)}resize(r){zy(this,r,4)}replace(r,h){h?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new en({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,h,m,b,T){pp(r,h,m,b,T,4)}}function Wm(u){const r={},h=u.resolution||256,m=u.clips?u.clips.length:1,b=u.image||new en({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const T=(M,k,D)=>{r[u.evaluationKey]=D;const z=u.expression.evaluate(r);b.data[M+k+0]=Math.floor(255*z.r/z.a),b.data[M+k+1]=Math.floor(255*z.g/z.a),b.data[M+k+2]=Math.floor(255*z.b/z.a),b.data[M+k+3]=Math.floor(255*z.a)};if(u.clips)for(let M=0,k=0;M<m;++M,k+=4*h)for(let D=0,z=0;D<h;D++,z+=4){const N=D/(h-1),{start:U,end:Z}=u.clips[M];T(k,z,U*(1-N)+Z*N)}else for(let M=0,k=0;M<h;M++,k+=4)T(0,k,M/(h-1));return b}At("AlphaImage",Zn),At("RGBAImage",en);const mp="big-fb";class Ly extends ws{createBucket(r){return new Qm(r)}constructor(r){super(r,Iy),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(mp)&&this.heatmapFbos.delete(mp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Km;var By={get paint(){return Km=Km||new Bs({"hillshade-illumination-direction":new jt(ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(ne.paint_hillshade["hillshade-accent-color"])})}};class gp extends ws{constructor(r){super(r,By)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ym=_n([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ny}=Ym;function yp(u,r,h){const m=h.patternDependencies;let b=!1;for(const T of r){const M=T.paint.get(`${u}-pattern`);M.isConstant()||(b=!0);const k=M.constantOr(null);k&&(b=!0,m[k.to]=!0,m[k.from]=!0)}return b}function _p(u,r,h,m,b){const T=b.patternDependencies;for(const M of r){const k=M.paint.get(`${u}-pattern`).value;if(k.kind!=="constant"){let D=k.evaluate({zoom:m-1},h,{},b.availableImages),z=k.evaluate({zoom:m},h,{},b.availableImages),N=k.evaluate({zoom:m+1},h,{},b.availableImages);D=D&&D.name?D.name:D,z=z&&z.name?z.name:z,N=N&&N.name?N.name:N,T[D]=!0,T[z]=!0,T[N]=!0,h.patterns[M.id]={min:D,mid:z,max:N}}}return h}function bp(u,r,h,m,b){let T;if(b===function(M,k,D,z){let N=0;for(let U=k,Z=D-z;U<D;U+=z)N+=(M[Z]-M[U])*(M[U+1]+M[Z+1]),Z=U;return N}(u,r,h,m)>0)for(let M=r;M<h;M+=m)T=Uh(M/m|0,u[M],u[M+1],T);else for(let M=h-m;M>=r;M-=m)T=Uh(M/m|0,u[M],u[M+1],T);return T&&ql(T,T.next)&&(Ro(T),T=T.next),T}function Vl(u,r){if(!u)return u;r||(r=u);let h,m=u;do if(h=!1,m.steiner||!ql(m,m.next)&&Pn(m.prev,m,m.next)!==0)m=m.next;else{if(Ro(m),m=r=m.prev,m===m.next)break;h=!0}while(h||m!==r);return r}function Ru(u,r,h,m,b,T,M){if(!u)return;!M&&T&&function(D,z,N,U){let Z=D;do Z.z===0&&(Z.z=ca(Z.x,Z.y,z,N,U)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==D);Z.prevZ.nextZ=null,Z.prevZ=null,function($){let Q,J=1;do{let oe,fe=$;$=null;let Ae=null;for(Q=0;fe;){Q++;let pe=fe,G=0;for(let ye=0;ye<J&&(G++,pe=pe.nextZ,pe);ye++);let re=J;for(;G>0||re>0&&pe;)G!==0&&(re===0||!pe||fe.z<=pe.z)?(oe=fe,fe=fe.nextZ,G--):(oe=pe,pe=pe.nextZ,re--),Ae?Ae.nextZ=oe:$=oe,oe.prevZ=Ae,Ae=oe;fe=pe}Ae.nextZ=null,J*=2}while(Q>1)}(Z)}(u,m,b,T);let k=u;for(;u.prev!==u.next;){const D=u.prev,z=u.next;if(T?Jm(u,m,b,T):Fy(u))r.push(D.i,u.i,z.i),Ro(u),u=z.next,k=z.next;else if((u=z)===k){M?M===1?Ru(u=vp(Vl(u),r),r,h,m,b,T,2):M===2&&eg(u,r,h,m,b,T):Ru(Vl(u),r,h,m,b,T,1);break}}}function Fy(u){const r=u.prev,h=u,m=u.next;if(Pn(r,h,m)>=0)return!1;const b=r.x,T=h.x,M=m.x,k=r.y,D=h.y,z=m.y,N=Math.min(b,T,M),U=Math.min(k,D,z),Z=Math.max(b,T,M),$=Math.max(k,D,z);let Q=m.next;for(;Q!==r;){if(Q.x>=N&&Q.x<=Z&&Q.y>=U&&Q.y<=$&&jh(b,k,T,D,M,z,Q.x,Q.y)&&Pn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function Jm(u,r,h,m){const b=u.prev,T=u,M=u.next;if(Pn(b,T,M)>=0)return!1;const k=b.x,D=T.x,z=M.x,N=b.y,U=T.y,Z=M.y,$=Math.min(k,D,z),Q=Math.min(N,U,Z),J=Math.max(k,D,z),oe=Math.max(N,U,Z),fe=ca($,Q,r,h,m),Ae=ca(J,oe,r,h,m);let pe=u.prevZ,G=u.nextZ;for(;pe&&pe.z>=fe&&G&&G.z<=Ae;){if(pe.x>=$&&pe.x<=J&&pe.y>=Q&&pe.y<=oe&&pe!==b&&pe!==M&&jh(k,N,D,U,z,Z,pe.x,pe.y)&&Pn(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,G.x>=$&&G.x<=J&&G.y>=Q&&G.y<=oe&&G!==b&&G!==M&&jh(k,N,D,U,z,Z,G.x,G.y)&&Pn(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;pe&&pe.z>=fe;){if(pe.x>=$&&pe.x<=J&&pe.y>=Q&&pe.y<=oe&&pe!==b&&pe!==M&&jh(k,N,D,U,z,Z,pe.x,pe.y)&&Pn(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;G&&G.z<=Ae;){if(G.x>=$&&G.x<=J&&G.y>=Q&&G.y<=oe&&G!==b&&G!==M&&jh(k,N,D,U,z,Z,G.x,G.y)&&Pn(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function vp(u,r){let h=u;do{const m=h.prev,b=h.next.next;!ql(m,b)&&Vh(m,h,h.next,b)&&hd(m,b)&&hd(b,m)&&(r.push(m.i,h.i,b.i),Ro(h),Ro(h.next),h=u=b),h=h.next}while(h!==u);return Vl(h)}function eg(u,r,h,m,b,T){let M=u;do{let k=M.next.next;for(;k!==M.prev;){if(M.i!==k.i&&Ul(M,k)){let D=ng(M,k);return M=Vl(M,M.next),D=Vl(D,D.next),Ru(M,r,h,m,b,T,0),void Ru(D,r,h,m,b,T,0)}k=k.next}M=M.next}while(M!==u)}function jy(u,r){let h=u.x-r.x;return h===0&&(h=u.y-r.y,h===0)&&(h=(u.next.y-u.y)/(u.next.x-u.x)-(r.next.y-r.y)/(r.next.x-r.x)),h}function tg(u,r){const h=function(b,T){let M=T;const k=b.x,D=b.y;let z,N=-1/0;if(ql(b,M))return M;do{if(ql(b,M.next))return M.next;if(D<=M.y&&D>=M.next.y&&M.next.y!==M.y){const J=M.x+(D-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(J<=k&&J>N&&(N=J,z=M.x<M.next.x?M:M.next,J===k))return z}M=M.next}while(M!==T);if(!z)return null;const U=z,Z=z.x,$=z.y;let Q=1/0;M=z;do{if(k>=M.x&&M.x>=Z&&k!==M.x&&Uy(D<$?k:N,D,Z,$,D<$?N:k,D,M.x,M.y)){const J=Math.abs(D-M.y)/(k-M.x);hd(M,b)&&(J<Q||J===Q&&(M.x>z.x||M.x===z.x&&Vy(z,M)))&&(z=M,Q=J)}M=M.next}while(M!==U);return z}(u,r);if(!h)return r;const m=ng(h,u);return Vl(m,m.next),Vl(h,h.next)}function Vy(u,r){return Pn(u.prev,u,r.prev)<0&&Pn(r.next,u,u.next)<0}function ca(u,r,h,m,b){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*b|0)|u<<8))|u<<4))|u<<2))|u<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-m)*b|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ig(u){let r=u,h=u;do(r.x<h.x||r.x===h.x&&r.y<h.y)&&(h=r),r=r.next;while(r!==u);return h}function Uy(u,r,h,m,b,T,M,k){return(b-M)*(r-k)>=(u-M)*(T-k)&&(u-M)*(m-k)>=(h-M)*(r-k)&&(h-M)*(T-k)>=(b-M)*(m-k)}function jh(u,r,h,m,b,T,M,k){return!(u===M&&r===k)&&Uy(u,r,h,m,b,T,M,k)}function Ul(u,r){return u.next.i!==r.i&&u.prev.i!==r.i&&!function(h,m){let b=h;do{if(b.i!==h.i&&b.next.i!==h.i&&b.i!==m.i&&b.next.i!==m.i&&Vh(b,b.next,h,m))return!0;b=b.next}while(b!==h);return!1}(u,r)&&(hd(u,r)&&hd(r,u)&&function(h,m){let b=h,T=!1;const M=(h.x+m.x)/2,k=(h.y+m.y)/2;do b.y>k!=b.next.y>k&&b.next.y!==b.y&&M<(b.next.x-b.x)*(k-b.y)/(b.next.y-b.y)+b.x&&(T=!T),b=b.next;while(b!==h);return T}(u,r)&&(Pn(u.prev,u,r.prev)||Pn(u,r.prev,r))||ql(u,r)&&Pn(u.prev,u,u.next)>0&&Pn(r.prev,r,r.next)>0)}function Pn(u,r,h){return(r.y-u.y)*(h.x-r.x)-(r.x-u.x)*(h.y-r.y)}function ql(u,r){return u.x===r.x&&u.y===r.y}function Vh(u,r,h,m){const b=xp(Pn(u,r,h)),T=xp(Pn(u,r,m)),M=xp(Pn(h,m,u)),k=xp(Pn(h,m,r));return b!==T&&M!==k||!(b!==0||!bn(u,h,r))||!(T!==0||!bn(u,m,r))||!(M!==0||!bn(h,u,m))||!(k!==0||!bn(h,r,m))}function bn(u,r,h){return r.x<=Math.max(u.x,h.x)&&r.x>=Math.min(u.x,h.x)&&r.y<=Math.max(u.y,h.y)&&r.y>=Math.min(u.y,h.y)}function xp(u){return u>0?1:u<0?-1:0}function hd(u,r){return Pn(u.prev,u,u.next)<0?Pn(u,r,u.next)>=0&&Pn(u,u.prev,r)>=0:Pn(u,r,u.prev)<0||Pn(u,u.next,r)<0}function ng(u,r){const h=wp(u.i,u.x,u.y),m=wp(r.i,r.x,r.y),b=u.next,T=r.prev;return u.next=r,r.prev=u,h.next=b,b.prev=h,m.next=h,h.prev=m,T.next=m,m.prev=T,m}function Uh(u,r,h,m){const b=wp(u,r,h);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Ro(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function wp(u,r,h){return{i:u,x:r,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Iu{constructor(r,h){if(h>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=h}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class Ac{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}Ac.noSubdivision=new Ac({fill:new Iu(0,0),line:new Iu(0,0),tile:new Iu(0,0),stencil:new Iu(0,0),circle:1}),At("SubdivisionGranularityExpression",Iu),At("SubdivisionGranularitySetting",Ac);const Cr=-32768,qh=32767;class sg{constructor(r,h){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=_t/r,this._canonical=h}_getKey(r,h){return(r+=32768)<<16|(h+=32768)<<0}_vertexToIndex(r,h){if(r<-32768||h<-32768||r>32767||h>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const m=0|Math.round(r),b=0|Math.round(h),T=this._getKey(m,b);if(this._vertexDictionary.has(T))return this._vertexDictionary.get(T);const M=this._vertexBuffer.length/2;return this._vertexDictionary.set(T,M),this._vertexBuffer.push(m,b),M}_subdivideTrianglesScanline(r){if(this._granularity<2)return function(b,T){const M=[];for(let k=0;k<T.length;k+=3){const D=T[k],z=T[k+1],N=T[k+2],U=b[2*D],Z=b[2*D+1];(b[2*z]-U)*(b[2*N+1]-Z)-(b[2*z+1]-Z)*(b[2*N]-U)>0?(M.push(D),M.push(N),M.push(z)):(M.push(D),M.push(z),M.push(N))}return M}(this._vertexBuffer,r);const h=[],m=r.length;for(let b=0;b<m;b+=3){const T=[r[b+0],r[b+1],r[b+2]],M=[this._vertexBuffer[2*r[b+0]+0],this._vertexBuffer[2*r[b+0]+1],this._vertexBuffer[2*r[b+1]+0],this._vertexBuffer[2*r[b+1]+1],this._vertexBuffer[2*r[b+2]+0],this._vertexBuffer[2*r[b+2]+1]];let k=1/0,D=1/0,z=-1/0,N=-1/0;for(let J=0;J<3;J++){const oe=M[2*J],fe=M[2*J+1];k=Math.min(k,oe),z=Math.max(z,oe),D=Math.min(D,fe),N=Math.max(N,fe)}if(k===z||D===N)continue;const U=Math.floor(k/this._granularityCellSize),Z=Math.ceil(z/this._granularityCellSize),$=Math.floor(D/this._granularityCellSize),Q=Math.ceil(N/this._granularityCellSize);if(U!==Z||$!==Q)for(let J=$;J<Q;J++){const oe=this._scanlineGenerateVertexRingForCellRow(J,M,T);og(this._vertexBuffer,oe,h)}else h.push(...T)}return h}_scanlineGenerateVertexRingForCellRow(r,h,m){const b=r*this._granularityCellSize,T=b+this._granularityCellSize,M=[];for(let k=0;k<3;k++){const D=h[2*k],z=h[2*k+1],N=h[2*(k+1)%6],U=h[(2*(k+1)+1)%6],Z=h[2*(k+2)%6],$=h[(2*(k+2)+1)%6],Q=N-D,J=U-z,oe=Q===0,fe=J===0,Ae=(b-z)/J,pe=(T-z)/J,G=Math.min(Ae,pe),re=Math.max(Ae,pe);if(!fe&&(G>=1||re<=0)||fe&&(z<b||z>T)){U>=b&&U<=T&&M.push(m[(k+1)%3]);continue}!fe&&G>0&&M.push(this._vertexToIndex(D+Q*G,z+J*G));const ye=D+Q*Math.max(G,0),Ue=D+Q*Math.min(re,1);oe||this._generateIntraEdgeVertices(M,D,z,N,U,ye,Ue),!fe&&re<1&&M.push(this._vertexToIndex(D+Q*re,z+J*re)),(fe||U>=b&&U<=T)&&M.push(m[(k+1)%3]),!fe&&(U<=b||U>=T)&&this._generateInterEdgeVertices(M,D,z,N,U,Z,$,Ue,b,T)}return M}_generateIntraEdgeVertices(r,h,m,b,T,M,k){const D=b-h,z=T-m,N=z===0,U=N?Math.min(h,b):Math.min(M,k),Z=N?Math.max(h,b):Math.max(M,k),$=Math.floor(U/this._granularityCellSize)+1,Q=Math.ceil(Z/this._granularityCellSize)-1;if(N?h<b:M<k)for(let J=$;J<=Q;J++){const oe=J*this._granularityCellSize;r.push(this._vertexToIndex(oe,m+z*(oe-h)/D))}else for(let J=Q;J>=$;J--){const oe=J*this._granularityCellSize;r.push(this._vertexToIndex(oe,m+z*(oe-h)/D))}}_generateInterEdgeVertices(r,h,m,b,T,M,k,D,z,N){const U=T-m,Z=M-b,$=k-T,Q=(z-T)/$,J=(N-T)/$,oe=Math.min(Q,J),fe=Math.max(Q,J),Ae=b+Z*oe;let pe=Math.floor(Math.min(Ae,D)/this._granularityCellSize)+1,G=Math.ceil(Math.max(Ae,D)/this._granularityCellSize)-1,re=D<Ae;const ye=$===0;if(ye&&(k===z||k===N))return;if(ye||oe>=1||fe<=0){const ut=m-k,Ge=M+(h-M)*Math.min((z-k)/ut,(N-k)/ut);pe=Math.floor(Math.min(Ge,D)/this._granularityCellSize)+1,G=Math.ceil(Math.max(Ge,D)/this._granularityCellSize)-1,re=D<Ge}const Ue=U>0?N:z;if(re)for(let ut=pe;ut<=G;ut++)r.push(this._vertexToIndex(ut*this._granularityCellSize,Ue));else for(let ut=G;ut>=pe;ut--)r.push(this._vertexToIndex(ut*this._granularityCellSize,Ue))}_generateOutline(r){const h=[];for(const m of r){const b=Hl(m,this._granularity,!0),T=this._pointArrayToIndices(b),M=[];for(let k=1;k<T.length;k++)M.push(T[k-1]),M.push(T[k]);h.push(M)}return h}_handlePoles(r){let h=!1,m=!1;this._canonical&&(this._canonical.y===0&&(h=!0),this._canonical.y===(1<<this._canonical.z)-1&&(m=!0)),(h||m)&&this._fillPoles(r,h,m)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let h=0;h<r.length;h+=2){const m=r[h+1];m===Cr&&(r[h+1]=-32767),m===qh&&(r[h+1]=32766)}}_generatePoleQuad(r,h,m,b,T,M){b>T!=(M===Cr)?(r.push(h),r.push(m),r.push(this._vertexToIndex(b,M)),r.push(m),r.push(this._vertexToIndex(T,M)),r.push(this._vertexToIndex(b,M))):(r.push(m),r.push(h),r.push(this._vertexToIndex(b,M)),r.push(this._vertexToIndex(T,M)),r.push(m),r.push(this._vertexToIndex(b,M)))}_fillPoles(r,h,m){const b=this._vertexBuffer,T=_t,M=r.length;for(let k=2;k<M;k+=3){const D=r[k-2],z=r[k-1],N=r[k],U=b[2*D],Z=b[2*D+1],$=b[2*z],Q=b[2*z+1],J=b[2*N],oe=b[2*N+1];h&&(Z===0&&Q===0&&this._generatePoleQuad(r,D,z,U,$,Cr),Q===0&&oe===0&&this._generatePoleQuad(r,z,N,$,J,Cr),oe===0&&Z===0&&this._generatePoleQuad(r,N,D,J,U,Cr)),m&&(Z===T&&Q===T&&this._generatePoleQuad(r,D,z,U,$,qh),Q===T&&oe===T&&this._generatePoleQuad(r,z,N,$,J,qh),oe===T&&Z===T&&this._generatePoleQuad(r,N,D,J,U,qh))}}_initializeVertices(r){for(let h=0;h<r.length;h+=2)this._vertexToIndex(r[h],r[h+1])}subdividePolygonInternal(r,h){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:m,holeIndices:b}=function(k){const D=[],z=[];for(const N of k)if(N.length!==0){N!==k[0]&&D.push(z.length/2);for(let U=0;U<N.length;U++)z.push(N[U].x),z.push(N[U].y)}return{flattened:z,holeIndices:D}}(r);let T;this._initializeVertices(m);try{const k=function(z,N,U=2){const Z=N&&N.length,$=Z?N[0]*U:z.length;let Q=bp(z,0,$,U,!0);const J=[];if(!Q||Q.next===Q.prev)return J;let oe,fe,Ae;if(Z&&(Q=function(pe,G,re,ye){const Ue=[];for(let ut=0,Ge=G.length;ut<Ge;ut++){const Je=bp(pe,G[ut]*ye,ut<Ge-1?G[ut+1]*ye:pe.length,ye,!1);Je===Je.next&&(Je.steiner=!0),Ue.push(ig(Je))}Ue.sort(jy);for(let ut=0;ut<Ue.length;ut++)re=tg(Ue[ut],re);return re}(z,N,Q,U)),z.length>80*U){oe=1/0,fe=1/0;let pe=-1/0,G=-1/0;for(let re=U;re<$;re+=U){const ye=z[re],Ue=z[re+1];ye<oe&&(oe=ye),Ue<fe&&(fe=Ue),ye>pe&&(pe=ye),Ue>G&&(G=Ue)}Ae=Math.max(pe-oe,G-fe),Ae=Ae!==0?32767/Ae:0}return Ru(Q,J,U,oe,fe,Ae,0),J}(m,b),D=this._convertIndices(m,k);T=this._subdivideTrianglesScanline(D)}catch(k){console.error(k)}let M=[];return h&&(M=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(T),{verticesFlattened:this._vertexBuffer,indicesTriangles:T,indicesLineList:M}}_convertIndices(r,h){const m=[];for(let b=0;b<h.length;b++)m.push(this._vertexToIndex(r[2*h[b]],r[2*h[b]+1]));return m}_pointArrayToIndices(r){const h=[];for(let m=0;m<r.length;m++){const b=r[m];h.push(this._vertexToIndex(b.x,b.y))}return h}}function rg(u,r,h,m=!0){return new sg(h,r).subdividePolygonInternal(u,m)}function Hl(u,r,h=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const m=u[0],b=u[u.length-1],T=h&&(m.x!==b.x||m.y!==b.y);if(r<2)return T?[...u,u[0]]:[...u];const M=Math.floor(_t/r),k=[];k.push(new K(u[0].x,u[0].y));const D=u.length,z=T?D:D-1;for(let N=0;N<z;N++){const U=u[N],Z=N<D-1?u[N+1]:u[0],$=U.x,Q=U.y,J=Z.x,oe=Z.y,fe=$!==J,Ae=Q!==oe;if(!fe&&!Ae)continue;const pe=J-$,G=oe-Q,re=Math.abs(pe),ye=Math.abs(G);let Ue=$,ut=Q;for(;;){const Je=pe>0?(Math.floor(Ue/M)+1)*M:(Math.ceil(Ue/M)-1)*M,mt=G>0?(Math.floor(ut/M)+1)*M:(Math.ceil(ut/M)-1)*M,ft=Math.abs(Ue-Je),bt=Math.abs(ut-mt),nt=Math.abs(Ue-J),Pt=Math.abs(ut-oe),Kt=fe?ft/re:Number.POSITIVE_INFINITY,$t=Ae?bt/ye:Number.POSITIVE_INFINITY;if((nt<=ft||!fe)&&(Pt<=bt||!Ae))break;if(Kt<$t&&fe||!Ae){Ue=Je,ut+=G*Kt;const Lt=new K(Ue,Math.round(ut));k[k.length-1].x===Lt.x&&k[k.length-1].y===Lt.y||k.push(Lt)}else{Ue+=pe*$t,ut=mt;const Lt=new K(Math.round(Ue),ut);k[k.length-1].x===Lt.x&&k[k.length-1].y===Lt.y||k.push(Lt)}}const Ge=new K(J,oe);k[k.length-1].x===Ge.x&&k[k.length-1].y===Ge.y||k.push(Ge)}return k}function og(u,r,h){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let m=0,b=u[2*r[0]];for(let D=1;D<r.length;D++){const z=u[2*r[D]];z<b&&(b=z,m=D)}const T=r.length;let M=m,k=(M+1)%T;for(;;){const D=M-1>=0?M-1:T-1,z=(k+1)%T,N=u[2*r[D]],U=u[2*r[z]],Z=u[2*r[M]],$=u[2*r[M]+1],Q=u[2*r[k]+1];let J=!1;if(N<U)J=!0;else if(N>U)J=!1;else{const oe=Q-$,fe=-(u[2*r[k]]-Z),Ae=$<Q?1:-1;((N-Z)*oe+(u[2*r[D]+1]-$)*fe)*Ae>((U-Z)*oe+(u[2*r[z]+1]-$)*fe)*Ae&&(J=!0)}if(J){const oe=r[D],fe=r[M],Ae=r[k];oe!==fe&&oe!==Ae&&fe!==Ae&&h.push(Ae,fe,oe),M--,M<0&&(M=T-1)}else{const oe=r[z],fe=r[M],Ae=r[k];oe!==fe&&oe!==Ae&&fe!==Ae&&h.push(Ae,fe,oe),k++,k>=T&&(k=0)}if(D===z)break}}function fd(u,r,h,m,b,T,M,k,D){const z=b.length/2,N=M&&k&&D;if(z<ii.MAX_VERTEX_ARRAY_LENGTH){const U=r.prepareSegment(z,h,m),Z=U.vertexLength;for(let J=0;J<T.length;J+=3)m.emplaceBack(Z+T[J],Z+T[J+1],Z+T[J+2]);let $,Q;U.vertexLength+=z,U.primitiveLength+=T.length/3,N&&(Q=M.prepareSegment(z,h,k),$=Q.vertexLength,Q.vertexLength+=z);for(let J=0;J<b.length;J+=2)u(b[J],b[J+1]);if(N)for(let J=0;J<D.length;J++){const oe=D[J];for(let fe=1;fe<oe.length;fe+=2)k.emplaceBack($+oe[fe-1],$+oe[fe]);Q.primitiveLength+=oe.length/2}}else(function(U,Z,$,Q,J,oe){const fe=[];for(let ye=0;ye<Q.length/2;ye++)fe.push(-1);const Ae={count:0};let pe=0,G=U.getOrCreateLatestSegment(Z,$),re=G.vertexLength;for(let ye=2;ye<J.length;ye+=3){const Ue=J[ye-2],ut=J[ye-1],Ge=J[ye];let Je=fe[Ue]<pe,mt=fe[ut]<pe,ft=fe[Ge]<pe;G.vertexLength+((Je?1:0)+(mt?1:0)+(ft?1:0))>ii.MAX_VERTEX_ARRAY_LENGTH&&(G=U.createNewSegment(Z,$),pe=Ae.count,Je=!0,mt=!0,ft=!0,re=0);const bt=Hh(fe,Q,oe,Ae,Ue,Je,G),nt=Hh(fe,Q,oe,Ae,ut,mt,G),Pt=Hh(fe,Q,oe,Ae,Ge,ft,G);$.emplaceBack(re+bt-pe,re+nt-pe,re+Pt-pe),G.primitiveLength++}})(r,h,m,b,T,u),N&&function(U,Z,$,Q,J,oe){const fe=[];for(let ye=0;ye<Q.length/2;ye++)fe.push(-1);const Ae={count:0};let pe=0,G=U.getOrCreateLatestSegment(Z,$),re=G.vertexLength;for(let ye=0;ye<J.length;ye++){const Ue=J[ye];for(let ut=1;ut<J[ye].length;ut+=2){const Ge=Ue[ut-1],Je=Ue[ut];let mt=fe[Ge]<pe,ft=fe[Je]<pe;G.vertexLength+((mt?1:0)+(ft?1:0))>ii.MAX_VERTEX_ARRAY_LENGTH&&(G=U.createNewSegment(Z,$),pe=Ae.count,mt=!0,ft=!0,re=0);const bt=Hh(fe,Q,oe,Ae,Ge,mt,G),nt=Hh(fe,Q,oe,Ae,Je,ft,G);$.emplaceBack(re+bt-pe,re+nt-pe),G.primitiveLength++}}}(M,h,k,b,D,u),r.forceNewSegmentOnNextPrepare(),M==null||M.forceNewSegmentOnNextPrepare()}function Hh(u,r,h,m,b,T,M){if(T){const k=m.count;return h(r[2*b],r[2*b+1]),u[b]=m.count,m.count++,M.vertexLength++,k}return u[b]}class ua{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(h=>h.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new be,this.indexArray=new vt,this.indexArray2=new rt,this.programConfigurations=new Qa(r.layers,r.zoom),this.segments=new ii,this.segments2=new ii,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(r,h,m){this.hasPattern=yp("fill",this.layers,h);const b=this.layers[0].layout.get("fill-sort-key"),T=!b.isConstant(),M=[];for(const{feature:k,id:D,index:z,sourceLayerIndex:N}of r){const U=this.layers[0]._featureFilter.needGeometry,Z=uo(k,U);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),Z,m))continue;const $=T?b.evaluate(Z,{},m,h.availableImages):void 0,Q={id:D,properties:k.properties,type:k.type,sourceLayerIndex:N,index:z,geometry:U?Z.geometry:Ts(k),patterns:{},sortKey:$};M.push(Q)}T&&M.sort((k,D)=>k.sortKey-D.sortKey);for(const k of M){const{geometry:D,index:z,sourceLayerIndex:N}=k;if(this.hasPattern){const U=_p("fill",this.layers,k,this.zoom,h);this.patternFeatures.push(U)}else this.addFeature(k,D,z,m,{},h.subdivisionGranularity);h.featureIndex.insert(r[z].feature,D,z,N,this.index)}}update(r,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,h,this.stateDependentLayers,m)}addFeatures(r,h,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,m,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ny),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,h,m,b,T,M){for(const k of gh(h,500)){const D=rg(k,b,M.fill.getGranularityForZoomLevel(b.z)),z=this.layoutVertexArray;fd((N,U)=>{z.emplaceBack(N,U)},this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles,this.segments2,this.indexArray2,D.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,m,T,b)}}let Gn,Sp;At("FillBucket",ua,{omit:["layers","patternFeatures"]});var qy={get paint(){return Sp=Sp||new Bs({"fill-antialias":new jt(ne.paint_fill["fill-antialias"]),"fill-opacity":new Yt(ne.paint_fill["fill-opacity"]),"fill-color":new Yt(ne.paint_fill["fill-color"]),"fill-outline-color":new Yt(ne.paint_fill["fill-outline-color"]),"fill-translate":new jt(ne.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new Po(ne.paint_fill["fill-pattern"])})},get layout(){return Gn=Gn||new Bs({"fill-sort-key":new Yt(ne.layout_fill["fill-sort-key"])})}};class Fs extends ws{constructor(r){super(r,qy)}recalculate(r,h){super.recalculate(r,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new ua(r)}queryRadius(){return ld(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:h,transform:m,pixelsToTileUnits:b}){return aa(Wa(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-m.bearingInRadians,b),h)}isTileClipped(){return!0}}const gb=_n([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Hy=_n([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zy}=gb;var vn,Ar,ha,ag,Tp,Gy,Mp,fr={};function Io(){if(Ar)return vn;Ar=1;var u=L();function r(b,T,M,k,D){this.properties={},this.extent=M,this.type=0,this._pbf=b,this._geometry=-1,this._keys=k,this._values=D,b.readFields(h,this,T)}function h(b,T,M){b==1?T.id=M.readVarint():b==2?function(k,D){for(var z=k.readVarint()+k.pos;k.pos<z;){var N=D._keys[k.readVarint()],U=D._values[k.readVarint()];D.properties[N]=U}}(M,T):b==3?T.type=M.readVarint():b==4&&(T._geometry=M.pos)}function m(b){for(var T,M,k=0,D=0,z=b.length,N=z-1;D<z;N=D++)k+=((M=b[N]).x-(T=b[D]).x)*(T.y+M.y);return k}return vn=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var b=this._pbf;b.pos=this._geometry;for(var T,M=b.readVarint()+b.pos,k=1,D=0,z=0,N=0,U=[];b.pos<M;){if(D<=0){var Z=b.readVarint();k=7&Z,D=Z>>3}if(D--,k===1||k===2)z+=b.readSVarint(),N+=b.readSVarint(),k===1&&(T&&U.push(T),T=[]),T.push(new u(z,N));else{if(k!==7)throw new Error("unknown command "+k);T&&T.push(T[0].clone())}}return T&&U.push(T),U},r.prototype.bbox=function(){var b=this._pbf;b.pos=this._geometry;for(var T=b.readVarint()+b.pos,M=1,k=0,D=0,z=0,N=1/0,U=-1/0,Z=1/0,$=-1/0;b.pos<T;){if(k<=0){var Q=b.readVarint();M=7&Q,k=Q>>3}if(k--,M===1||M===2)(D+=b.readSVarint())<N&&(N=D),D>U&&(U=D),(z+=b.readSVarint())<Z&&(Z=z),z>$&&($=z);else if(M!==7)throw new Error("unknown command "+M)}return[N,Z,U,$]},r.prototype.toGeoJSON=function(b,T,M){var k,D,z=this.extent*Math.pow(2,M),N=this.extent*b,U=this.extent*T,Z=this.loadGeometry(),$=r.types[this.type];function Q(fe){for(var Ae=0;Ae<fe.length;Ae++){var pe=fe[Ae];fe[Ae]=[360*(pe.x+N)/z-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+U)/z)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(k=0;k<Z.length;k++)J[k]=Z[k][0];Q(Z=J);break;case 2:for(k=0;k<Z.length;k++)Q(Z[k]);break;case 3:for(Z=function(fe){var Ae=fe.length;if(Ae<=1)return[fe];for(var pe,G,re=[],ye=0;ye<Ae;ye++){var Ue=m(fe[ye]);Ue!==0&&(G===void 0&&(G=Ue<0),G===Ue<0?(pe&&re.push(pe),pe=[fe[ye]]):pe.push(fe[ye]))}return pe&&re.push(pe),re}(Z),k=0;k<Z.length;k++)for(D=0;D<Z[k].length;D++)Q(Z[k][D])}Z.length===1?Z=Z[0]:$="Multi"+$;var oe={type:"Feature",geometry:{type:$,coordinates:Z},properties:this.properties};return"id"in this&&(oe.id=this.id),oe},vn}function lg(){if(ag)return ha;ag=1;var u=Io();function r(m,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=m,this._keys=[],this._values=[],this._features=[],m.readFields(h,this,b),this.length=this._features.length}function h(m,b,T){m===15?b.version=T.readVarint():m===1?b.name=T.readString():m===5?b.extent=T.readVarint():m===2?b._features.push(T.pos):m===3?b._keys.push(T.readString()):m===4&&b._values.push(function(M){for(var k=null,D=M.readVarint()+M.pos;M.pos<D;){var z=M.readVarint()>>3;k=z===1?M.readString():z===2?M.readFloat():z===3?M.readDouble():z===4?M.readVarint64():z===5?M.readVarint():z===6?M.readSVarint():z===7?M.readBoolean():null}return k}(T))}return ha=r,r.prototype.feature=function(m){if(m<0||m>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[m];var b=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,b,this.extent,this._keys,this._values)},ha}function qr(){return Mp||(Mp=1,fr.VectorTile=function(){if(Gy)return Tp;Gy=1;var u=lg();function r(h,m,b){if(h===3){var T=new u(b,b.readVarint()+b.pos);T.length&&(m[T.name]=T)}}return Tp=function(h,m){this.layers=h.readFields(r,{},m)},Tp}(),fr.VectorTileFeature=Io(),fr.VectorTileLayer=lg()),fr}var Zh=v(qr());const kc=Zh.VectorTileFeature.types,Zl=Math.pow(2,13);function zo(u,r,h,m,b,T,M,k){u.emplaceBack(r,h,2*Math.floor(m*Zl)+M,b*Zl*2,T*Zl*2,Math.round(k))}class dd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(h=>h.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new de,this.indexArray=new vt,this.programConfigurations=new Qa(r.layers,r.zoom),this.segments=new ii,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(r,h,m){this.features=[],this.hasPattern=yp("fill-extrusion",this.layers,h);for(const{feature:b,id:T,index:M,sourceLayerIndex:k}of r){const D=this.layers[0]._featureFilter.needGeometry,z=uo(b,D);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),z,m))continue;const N={id:T,sourceLayerIndex:k,index:M,geometry:D?z.geometry:Ts(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(_p("fill-extrusion",this.layers,N,this.zoom,h)):this.addFeature(N,N.geometry,M,m,{},h.subdivisionGranularity),h.featureIndex.insert(b,N.geometry,M,k,this.index,!0)}}addFeatures(r,h,m){for(const b of this.features){const{geometry:T}=b;this.addFeature(b,T,b.index,h,m,r.subdivisionGranularity)}}update(r,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Zy),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Hy.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,h,m,b,T,M){for(const k of gh(h,500)){const D={x:0,y:0,sampleCount:0},z=this.layoutVertexArray.length;this.processPolygon(D,b,r,k,M);const N=this.layoutVertexArray.length-z,U=Math.floor(D.x/D.sampleCount),Z=Math.floor(D.y/D.sampleCount);for(let $=0;$<N;$++)this.centroidVertexArray.emplaceBack(U,Z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,m,T,b)}processPolygon(r,h,m,b,T){if(b.length<1||ug(b[0]))return;for(const U of b)U.length!==0&&cg(r,U);const M={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},k=T.fill.getGranularityForZoomLevel(h.z),D=kc[m.type]==="Polygon";for(const U of b){if(U.length===0||ug(U))continue;const Z=Hl(U,k,D);this._generateSideFaces(Z,M)}if(!D)return;const z=rg(b,h,k,!1),N=this.layoutVertexArray;fd((U,Z)=>{zo(N,U,Z,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles)}_generateSideFaces(r,h){let m=0;for(let b=1;b<r.length;b++){const T=r[b],M=r[b-1];if(Ka(T,M))continue;h.segment.vertexLength+4>ii.MAX_VERTEX_ARRAY_LENGTH&&(h.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const k=T.sub(M)._perp()._unit(),D=M.dist(T);m+D>32768&&(m=0),zo(this.layoutVertexArray,T.x,T.y,k.x,k.y,0,0,m),zo(this.layoutVertexArray,T.x,T.y,k.x,k.y,0,1,m),m+=D,zo(this.layoutVertexArray,M.x,M.y,k.x,k.y,0,0,m),zo(this.layoutVertexArray,M.x,M.y,k.x,k.y,0,1,m);const z=h.segment.vertexLength;this.indexArray.emplaceBack(z,z+2,z+1),this.indexArray.emplaceBack(z+1,z+2,z+3),h.segment.vertexLength+=4,h.segment.primitiveLength+=2}}}function cg(u,r){for(let h=0;h<r.length;h++){const m=r[h];h===r.length-1&&r[0].x===m.x&&r[0].y===m.y||(u.x+=m.x,u.y+=m.y,u.sampleCount++)}}function Ka(u,r){return u.x===r.x&&(u.x<0||u.x>_t)||u.y===r.y&&(u.y<0||u.y>_t)}function ug(u){return u.every(r=>r.x<0)||u.every(r=>r.x>_t)||u.every(r=>r.y<0)||u.every(r=>r.y>_t)}let zu;At("FillExtrusionBucket",dd,{omit:["layers","features"]});var pd={get paint(){return zu=zu||new Bs({"fill-extrusion-opacity":new jt(ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Po(ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yt(ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class md extends ws{constructor(r){super(r,pd)}createBucket(r){return new dd(r)}queryRadius(){return ld(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:h,featureState:m,geometry:b,transform:T,pixelsToTileUnits:M,pixelPosMatrix:k}){const D=Wa(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,M),z=this.paint.get("fill-extrusion-height").evaluate(h,m),N=this.paint.get("fill-extrusion-base").evaluate(h,m),U=function($,Q,J){const oe=[];for(const fe of $){const Ae=[fe.x,fe.y,0,1];Ft(Ae,Ae,Q),oe.push(new K(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return oe}(D,k),Z=function($,Q,J,oe){const fe=[],Ae=[],pe=oe[8]*Q,G=oe[9]*Q,re=oe[10]*Q,ye=oe[11]*Q,Ue=oe[8]*J,ut=oe[9]*J,Ge=oe[10]*J,Je=oe[11]*J;for(const mt of $){const ft=[],bt=[];for(const nt of mt){const Pt=nt.x,Kt=nt.y,$t=oe[0]*Pt+oe[4]*Kt+oe[12],Lt=oe[1]*Pt+oe[5]*Kt+oe[13],gi=oe[2]*Pt+oe[6]*Kt+oe[14],xn=oe[3]*Pt+oe[7]*Kt+oe[15],On=gi+re,Vs=xn+ye,ho=$t+Ue,Ys=Lt+ut,is=gi+Ge,sn=xn+Je,Xn=new K(($t+pe)/Vs,(Lt+G)/Vs);Xn.z=On/Vs,ft.push(Xn);const fs=new K(ho/sn,Ys/sn);fs.z=is/sn,bt.push(fs)}fe.push(ft),Ae.push(bt)}return[fe,Ae]}(b,N,z,k);return function($,Q,J){let oe=1/0;aa(J,Q)&&(oe=hg(J,Q[0]));for(let fe=0;fe<Q.length;fe++){const Ae=Q[fe],pe=$[fe];for(let G=0;G<Ae.length-1;G++){const re=Ae[G],ye=[re,Ae[G+1],pe[G+1],pe[G],re];Nh(J,ye)&&(oe=Math.min(oe,hg(J,ye)))}}return oe!==1/0&&oe}(Z[0],Z[1],U)}}function Ya(u,r){return u.x*r.x+u.y*r.y}function hg(u,r){if(u.length===1){let h=0;const m=r[h++];let b;for(;!b||m.equals(b);)if(b=r[h++],!b)return 1/0;for(;h<r.length;h++){const T=r[h],M=u[0],k=b.sub(m),D=T.sub(m),z=M.sub(m),N=Ya(k,k),U=Ya(k,D),Z=Ya(D,D),$=Ya(z,k),Q=Ya(z,D),J=N*Z-U*U,oe=(Z*$-U*Q)/J,fe=(N*Q-U*$)/J,Ae=m.z*(1-oe-fe)+b.z*oe+T.z*fe;if(isFinite(Ae))return Ae}return 1/0}{let h=1/0;for(const m of r)h=Math.min(h,m.z);return h}}const $y=_n([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gd}=$y,Xy=_n([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Cp}=Xy,Qy=Zh.VectorTileFeature.types,yb=Math.cos(Math.PI/180*37.5),Wy=Math.pow(2,14)/.5;class Ui{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(h=>h.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Pe,this.layoutVertexArray2=new Ce,this.indexArray=new vt,this.programConfigurations=new Qa(r.layers,r.zoom),this.segments=new ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(r,h,m){this.hasPattern=yp("line",this.layers,h);const b=this.layers[0].layout.get("line-sort-key"),T=!b.isConstant(),M=[];for(const{feature:k,id:D,index:z,sourceLayerIndex:N}of r){const U=this.layers[0]._featureFilter.needGeometry,Z=uo(k,U);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),Z,m))continue;const $=T?b.evaluate(Z,{},m):void 0,Q={id:D,properties:k.properties,type:k.type,sourceLayerIndex:N,index:z,geometry:U?Z.geometry:Ts(k),patterns:{},sortKey:$};M.push(Q)}T&&M.sort((k,D)=>k.sortKey-D.sortKey);for(const k of M){const{geometry:D,index:z,sourceLayerIndex:N}=k;if(this.hasPattern){const U=_p("line",this.layers,k,this.zoom,h);this.patternFeatures.push(U)}else this.addFeature(k,D,z,m,{},h.subdivisionGranularity);h.featureIndex.insert(r[z].feature,D,z,N,this.index)}}update(r,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,h,this.stateDependentLayers,m)}addFeatures(r,h,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,m,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Cp)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,gd),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,h,m,b,T,M){const k=this.layers[0].layout,D=k.get("line-join").evaluate(r,{}),z=k.get("line-cap"),N=k.get("line-miter-limit"),U=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const Z of h)this.addLine(Z,r,D,z,N,U,b,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,m,T,b)}addLine(r,h,m,b,T,M,k,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=Hl(r,k?D.line.getGranularityForZoomLevel(k.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<r.length-1;pe++)this.totalDistance+=r[pe].dist(r[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=Qy[h.type]==="Polygon";let N=r.length;for(;N>=2&&r[N-1].equals(r[N-2]);)N--;let U=0;for(;U<N-1&&r[U].equals(r[U+1]);)U++;if(N<(z?3:2))return;m==="bevel"&&(T=1.05);const Z=this.overscaling<=16?15*_t/(512*this.overscaling):0,$=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let Q,J,oe,fe,Ae;this.e1=this.e2=-1,z&&(Q=r[N-2],Ae=r[U].sub(Q)._unit()._perp());for(let pe=U;pe<N;pe++){if(oe=pe===N-1?z?r[U+1]:void 0:r[pe+1],oe&&r[pe].equals(oe))continue;Ae&&(fe=Ae),Q&&(J=Q),Q=r[pe],Ae=oe?oe.sub(Q)._unit()._perp():fe,fe=fe||Ae;let G=fe.add(Ae);G.x===0&&G.y===0||G._unit();const re=fe.x*Ae.x+fe.y*Ae.y,ye=G.x*Ae.x+G.y*Ae.y,Ue=ye!==0?1/ye:1/0,ut=2*Math.sqrt(2-2*ye),Ge=ye<yb&&J&&oe,Je=fe.x*Ae.y-fe.y*Ae.x>0;if(Ge&&pe>U){const bt=Q.dist(J);if(bt>2*Z){const nt=Q.sub(Q.sub(J)._mult(Z/bt)._round());this.updateDistance(J,nt),this.addCurrentVertex(nt,fe,0,0,$),J=nt}}const mt=J&&oe;let ft=mt?m:z?"butt":b;if(mt&&ft==="round"&&(Ue<M?ft="miter":Ue<=2&&(ft="fakeround")),ft==="miter"&&Ue>T&&(ft="bevel"),ft==="bevel"&&(Ue>2&&(ft="flipbevel"),Ue<T&&(ft="miter")),J&&this.updateDistance(J,Q),ft==="miter")G._mult(Ue),this.addCurrentVertex(Q,G,0,0,$);else if(ft==="flipbevel"){if(Ue>100)G=Ae.mult(-1);else{const bt=Ue*fe.add(Ae).mag()/fe.sub(Ae).mag();G._perp()._mult(bt*(Je?-1:1))}this.addCurrentVertex(Q,G,0,0,$),this.addCurrentVertex(Q,G.mult(-1),0,0,$)}else if(ft==="bevel"||ft==="fakeround"){const bt=-Math.sqrt(Ue*Ue-1),nt=Je?bt:0,Pt=Je?0:bt;if(J&&this.addCurrentVertex(Q,fe,nt,Pt,$),ft==="fakeround"){const Kt=Math.round(180*ut/Math.PI/20);for(let $t=1;$t<Kt;$t++){let Lt=$t/Kt;if(Lt!==.5){const xn=Lt-.5;Lt+=Lt*xn*(Lt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*xn*xn+(.848013+re*(.215638*re-1.06021)))}const gi=Ae.sub(fe)._mult(Lt)._add(fe)._unit()._mult(Je?-1:1);this.addHalfVertex(Q,gi.x,gi.y,!1,Je,0,$)}}oe&&this.addCurrentVertex(Q,Ae,-nt,-Pt,$)}else if(ft==="butt")this.addCurrentVertex(Q,G,0,0,$);else if(ft==="square"){const bt=J?1:-1;this.addCurrentVertex(Q,G,bt,bt,$)}else ft==="round"&&(J&&(this.addCurrentVertex(Q,fe,0,0,$),this.addCurrentVertex(Q,fe,1,1,$,!0)),oe&&(this.addCurrentVertex(Q,Ae,-1,-1,$,!0),this.addCurrentVertex(Q,Ae,0,0,$)));if(Ge&&pe<N-1){const bt=Q.dist(oe);if(bt>2*Z){const nt=Q.add(oe.sub(Q)._mult(Z/bt)._round());this.updateDistance(Q,nt),this.addCurrentVertex(nt,Ae,0,0,$),Q=nt}}}}addCurrentVertex(r,h,m,b,T,M=!1){const k=h.y*b-h.x,D=-h.y-h.x*b;this.addHalfVertex(r,h.x+h.y*m,h.y-h.x*m,M,!1,m,T),this.addHalfVertex(r,k,D,M,!0,-b,T),this.distance>Wy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,h,m,b,T,M))}addHalfVertex({x:r,y:h},m,b,T,M,k,D){const z=.5*(this.lineClips?this.scaledDistance*(Wy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(T?1:0),(h<<1)+(M?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(k===0?0:k<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),D.primitiveLength++),M?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,h){this.distance+=r.dist(h),this.updateScaledDistance()}}let fn,Mi;At("LineBucket",Ui,{omit:["layers","patternFeatures"]});var Di={get paint(){return Mi=Mi||new Bs({"line-opacity":new Yt(ne.paint_line["line-opacity"]),"line-color":new Yt(ne.paint_line["line-color"]),"line-translate":new jt(ne.paint_line["line-translate"]),"line-translate-anchor":new jt(ne.paint_line["line-translate-anchor"]),"line-width":new Yt(ne.paint_line["line-width"]),"line-gap-width":new Yt(ne.paint_line["line-gap-width"]),"line-offset":new Yt(ne.paint_line["line-offset"]),"line-blur":new Yt(ne.paint_line["line-blur"]),"line-dasharray":new Sc(ne.paint_line["line-dasharray"]),"line-pattern":new Po(ne.paint_line["line-pattern"]),"line-gradient":new zh(ne.paint_line["line-gradient"])})},get layout(){return fn=fn||new Bs({"line-cap":new jt(ne.layout_line["line-cap"]),"line-join":new Yt(ne.layout_line["line-join"]),"line-miter-limit":new jt(ne.layout_line["line-miter-limit"]),"line-round-limit":new jt(ne.layout_line["line-round-limit"]),"line-sort-key":new Yt(ne.layout_line["line-sort-key"])})}};class tn extends Yt{possiblyEvaluate(r,h){return h=new Hi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(r,h)}evaluate(r,h,m,b){return h=Ei({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(r,h,m,b)}}let dr;class Ec extends ws{constructor(r){super(r,Di),this.gradientVersion=0,dr||(dr=new tn(Di.paint.properties["line-width"].specification),dr.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof $o,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,h){super.recalculate(r,h),this.paint._values["line-floorwidth"]=dr.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Ui(r)}queryRadius(r){const h=r,m=Lu(Fh("line-width",this,h),Fh("line-gap-width",this,h)),b=Fh("line-offset",this,h);return m/2+Math.abs(b)+ld(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:h,featureState:m,geometry:b,transform:T,pixelsToTileUnits:M}){const k=Wa(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,M),D=M/2*Lu(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),z=this.paint.get("line-offset").evaluate(h,m);return z&&(b=function(N,U){const Z=[];for(let $=0;$<N.length;$++){const Q=N[$],J=[];for(let oe=0;oe<Q.length;oe++){const fe=Q[oe-1],Ae=Q[oe],pe=Q[oe+1],G=oe===0?new K(0,0):Ae.sub(fe)._unit()._perp(),re=oe===Q.length-1?new K(0,0):pe.sub(Ae)._unit()._perp(),ye=G._add(re)._unit(),Ue=ye.x*re.x+ye.y*re.y;Ue!==0&&ye._mult(1/Ue),J.push(ye._mult(U)._add(Ae))}Z.push(J)}return Z}(b,z*M)),function(N,U,Z){for(let $=0;$<U.length;$++){const Q=U[$];if(N.length>=3){for(let J=0;J<Q.length;J++)if(jl(N,Q[J]))return!0}if(Mc(N,Q,Z))return!0}return!1}(k,b,D)}isTileClipped(){return!0}}function Lu(u,r){return r>0?r+2*u:u}const fg=_n([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gl=_n([{name:"a_projected_pos",components:3,type:"Float32"}],4);_n([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $n=_n([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_n([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $l=_n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bu=_n([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function dg(u,r,h){return u.sections.forEach(m=>{m.text=function(b,T,M){const k=T.layout.get("text-transform").evaluate(M,{});return k==="uppercase"?b=b.toLocaleUpperCase():k==="lowercase"&&(b=b.toLocaleLowerCase()),Qs.applyArabicShaping&&(b=Qs.applyArabicShaping(b)),b}(m.text,r,h)}),u}_n([{name:"triangle",components:3,type:"Uint16"}]),_n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_n([{type:"Float32",name:"offsetX"}]),_n([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_n([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pr={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Nu,Fu,kr,Ln=24,yd={};function Ap(){return Nu||(Nu=1,yd.read=function(u,r,h,m,b){var T,M,k=8*b-m-1,D=(1<<k)-1,z=D>>1,N=-7,U=h?b-1:0,Z=h?-1:1,$=u[r+U];for(U+=Z,T=$&(1<<-N)-1,$>>=-N,N+=k;N>0;T=256*T+u[r+U],U+=Z,N-=8);for(M=T&(1<<-N)-1,T>>=-N,N+=m;N>0;M=256*M+u[r+U],U+=Z,N-=8);if(T===0)T=1-z;else{if(T===D)return M?NaN:1/0*($?-1:1);M+=Math.pow(2,m),T-=z}return($?-1:1)*M*Math.pow(2,T-m)},yd.write=function(u,r,h,m,b,T){var M,k,D,z=8*T-b-1,N=(1<<z)-1,U=N>>1,Z=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=m?0:T-1,Q=m?1:-1,J=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(k=isNaN(r)?1:0,M=N):(M=Math.floor(Math.log(r)/Math.LN2),r*(D=Math.pow(2,-M))<1&&(M--,D*=2),(r+=M+U>=1?Z/D:Z*Math.pow(2,1-U))*D>=2&&(M++,D/=2),M+U>=N?(k=0,M=N):M+U>=1?(k=(r*D-1)*Math.pow(2,b),M+=U):(k=r*Math.pow(2,U-1)*Math.pow(2,b),M=0));b>=8;u[h+$]=255&k,$+=Q,k/=256,b-=8);for(M=M<<b|k,z+=b;z>0;u[h+$]=255&M,$+=Q,M/=256,z-=8);u[h+$-Q]|=128*J}),yd}function _d(){if(kr)return Fu;kr=1,Fu=r;var u=Ap();function r(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var h=4294967296,m=1/h,b=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function T(G){return G.type===r.Bytes?G.readVarint()+G.pos:G.pos+1}function M(G,re,ye){return ye?4294967296*re+(G>>>0):4294967296*(re>>>0)+(G>>>0)}function k(G,re,ye){var Ue=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));ye.realloc(Ue);for(var ut=ye.pos-1;ut>=G;ut--)ye.buf[ut+Ue]=ye.buf[ut]}function D(G,re){for(var ye=0;ye<G.length;ye++)re.writeVarint(G[ye])}function z(G,re){for(var ye=0;ye<G.length;ye++)re.writeSVarint(G[ye])}function N(G,re){for(var ye=0;ye<G.length;ye++)re.writeFloat(G[ye])}function U(G,re){for(var ye=0;ye<G.length;ye++)re.writeDouble(G[ye])}function Z(G,re){for(var ye=0;ye<G.length;ye++)re.writeBoolean(G[ye])}function $(G,re){for(var ye=0;ye<G.length;ye++)re.writeFixed32(G[ye])}function Q(G,re){for(var ye=0;ye<G.length;ye++)re.writeSFixed32(G[ye])}function J(G,re){for(var ye=0;ye<G.length;ye++)re.writeFixed64(G[ye])}function oe(G,re){for(var ye=0;ye<G.length;ye++)re.writeSFixed64(G[ye])}function fe(G,re){return(G[re]|G[re+1]<<8|G[re+2]<<16)+16777216*G[re+3]}function Ae(G,re,ye){G[ye]=re,G[ye+1]=re>>>8,G[ye+2]=re>>>16,G[ye+3]=re>>>24}function pe(G,re){return(G[re]|G[re+1]<<8|G[re+2]<<16)+(G[re+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(G,re,ye){for(ye=ye||this.length;this.pos<ye;){var Ue=this.readVarint(),ut=Ue>>3,Ge=this.pos;this.type=7&Ue,G(ut,re,this),this.pos===Ge&&this.skip(Ue)}return re},readMessage:function(G,re){return this.readFields(G,re,this.readVarint()+this.pos)},readFixed32:function(){var G=fe(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=pe(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=fe(this.buf,this.pos)+fe(this.buf,this.pos+4)*h;return this.pos+=8,G},readSFixed64:function(){var G=fe(this.buf,this.pos)+pe(this.buf,this.pos+4)*h;return this.pos+=8,G},readFloat:function(){var G=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var re,ye,Ue=this.buf;return re=127&(ye=Ue[this.pos++]),ye<128?re:(re|=(127&(ye=Ue[this.pos++]))<<7,ye<128?re:(re|=(127&(ye=Ue[this.pos++]))<<14,ye<128?re:(re|=(127&(ye=Ue[this.pos++]))<<21,ye<128?re:function(ut,Ge,Je){var mt,ft,bt=Je.buf;if(mt=(112&(ft=bt[Je.pos++]))>>4,ft<128||(mt|=(127&(ft=bt[Je.pos++]))<<3,ft<128)||(mt|=(127&(ft=bt[Je.pos++]))<<10,ft<128)||(mt|=(127&(ft=bt[Je.pos++]))<<17,ft<128)||(mt|=(127&(ft=bt[Je.pos++]))<<24,ft<128)||(mt|=(1&(ft=bt[Je.pos++]))<<31,ft<128))return M(ut,mt,Ge);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(ye=Ue[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,re=this.pos;return this.pos=G,G-re>=12&&b?function(ye,Ue,ut){return b.decode(ye.subarray(Ue,ut))}(this.buf,re,G):function(ye,Ue,ut){for(var Ge="",Je=Ue;Je<ut;){var mt,ft,bt,nt=ye[Je],Pt=null,Kt=nt>239?4:nt>223?3:nt>191?2:1;if(Je+Kt>ut)break;Kt===1?nt<128&&(Pt=nt):Kt===2?(192&(mt=ye[Je+1]))==128&&(Pt=(31&nt)<<6|63&mt)<=127&&(Pt=null):Kt===3?(ft=ye[Je+2],(192&(mt=ye[Je+1]))==128&&(192&ft)==128&&((Pt=(15&nt)<<12|(63&mt)<<6|63&ft)<=2047||Pt>=55296&&Pt<=57343)&&(Pt=null)):Kt===4&&(ft=ye[Je+2],bt=ye[Je+3],(192&(mt=ye[Je+1]))==128&&(192&ft)==128&&(192&bt)==128&&((Pt=(15&nt)<<18|(63&mt)<<12|(63&ft)<<6|63&bt)<=65535||Pt>=1114112)&&(Pt=null)),Pt===null?(Pt=65533,Kt=1):Pt>65535&&(Pt-=65536,Ge+=String.fromCharCode(Pt>>>10&1023|55296),Pt=56320|1023&Pt),Ge+=String.fromCharCode(Pt),Je+=Kt}return Ge}(this.buf,re,G)},readBytes:function(){var G=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,G);return this.pos=G,re},readPackedVarint:function(G,re){if(this.type!==r.Bytes)return G.push(this.readVarint(re));var ye=T(this);for(G=G||[];this.pos<ye;)G.push(this.readVarint(re));return G},readPackedSVarint:function(G){if(this.type!==r.Bytes)return G.push(this.readSVarint());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==r.Bytes)return G.push(this.readBoolean());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==r.Bytes)return G.push(this.readFloat());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==r.Bytes)return G.push(this.readDouble());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==r.Bytes)return G.push(this.readFixed32());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==r.Bytes)return G.push(this.readSFixed32());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==r.Bytes)return G.push(this.readFixed64());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==r.Bytes)return G.push(this.readSFixed64());var re=T(this);for(G=G||[];this.pos<re;)G.push(this.readSFixed64());return G},skip:function(G){var re=7&G;if(re===r.Varint)for(;this.buf[this.pos++]>127;);else if(re===r.Bytes)this.pos=this.readVarint()+this.pos;else if(re===r.Fixed32)this.pos+=4;else{if(re!==r.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(G,re){this.writeVarint(G<<3|re)},realloc:function(G){for(var re=this.length||16;re<this.pos+G;)re*=2;if(re!==this.length){var ye=new Uint8Array(re);ye.set(this.buf),this.buf=ye,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),Ae(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),Ae(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),Ae(this.buf,-1&G,this.pos),Ae(this.buf,Math.floor(G*m),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),Ae(this.buf,-1&G,this.pos),Ae(this.buf,Math.floor(G*m),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(re,ye){var Ue,ut;if(re>=0?(Ue=re%4294967296|0,ut=re/4294967296|0):(ut=~(-re/4294967296),4294967295^(Ue=~(-re%4294967296))?Ue=Ue+1|0:(Ue=0,ut=ut+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ye.realloc(10),function(Ge,Je,mt){mt.buf[mt.pos++]=127&Ge|128,Ge>>>=7,mt.buf[mt.pos++]=127&Ge|128,Ge>>>=7,mt.buf[mt.pos++]=127&Ge|128,Ge>>>=7,mt.buf[mt.pos++]=127&Ge|128,mt.buf[mt.pos]=127&(Ge>>>=7)}(Ue,0,ye),function(Ge,Je){var mt=(7&Ge)<<4;Je.buf[Je.pos++]|=mt|((Ge>>>=3)?128:0),Ge&&(Je.buf[Je.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(Je.buf[Je.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(Je.buf[Je.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(Je.buf[Je.pos++]=127&Ge|((Ge>>>=7)?128:0),Ge&&(Je.buf[Je.pos++]=127&Ge)))))}(ut,ye)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var re=this.pos;this.pos=function(Ue,ut,Ge){for(var Je,mt,ft=0;ft<ut.length;ft++){if((Je=ut.charCodeAt(ft))>55295&&Je<57344){if(!mt){Je>56319||ft+1===ut.length?(Ue[Ge++]=239,Ue[Ge++]=191,Ue[Ge++]=189):mt=Je;continue}if(Je<56320){Ue[Ge++]=239,Ue[Ge++]=191,Ue[Ge++]=189,mt=Je;continue}Je=mt-55296<<10|Je-56320|65536,mt=null}else mt&&(Ue[Ge++]=239,Ue[Ge++]=191,Ue[Ge++]=189,mt=null);Je<128?Ue[Ge++]=Je:(Je<2048?Ue[Ge++]=Je>>6|192:(Je<65536?Ue[Ge++]=Je>>12|224:(Ue[Ge++]=Je>>18|240,Ue[Ge++]=Je>>12&63|128),Ue[Ge++]=Je>>6&63|128),Ue[Ge++]=63&Je|128)}return Ge}(this.buf,G,this.pos);var ye=this.pos-re;ye>=128&&k(re,ye,this),this.pos=re-1,this.writeVarint(ye),this.pos+=ye},writeFloat:function(G){this.realloc(4),u.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),u.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var re=G.length;this.writeVarint(re),this.realloc(re);for(var ye=0;ye<re;ye++)this.buf[this.pos++]=G[ye]},writeRawMessage:function(G,re){this.pos++;var ye=this.pos;G(re,this);var Ue=this.pos-ye;Ue>=128&&k(ye,Ue,this),this.pos=ye-1,this.writeVarint(Ue),this.pos+=Ue},writeMessage:function(G,re,ye){this.writeTag(G,r.Bytes),this.writeRawMessage(re,ye)},writePackedVarint:function(G,re){re.length&&this.writeMessage(G,D,re)},writePackedSVarint:function(G,re){re.length&&this.writeMessage(G,z,re)},writePackedBoolean:function(G,re){re.length&&this.writeMessage(G,Z,re)},writePackedFloat:function(G,re){re.length&&this.writeMessage(G,N,re)},writePackedDouble:function(G,re){re.length&&this.writeMessage(G,U,re)},writePackedFixed32:function(G,re){re.length&&this.writeMessage(G,$,re)},writePackedSFixed32:function(G,re){re.length&&this.writeMessage(G,Q,re)},writePackedFixed64:function(G,re){re.length&&this.writeMessage(G,J,re)},writePackedSFixed64:function(G,re){re.length&&this.writeMessage(G,oe,re)},writeBytesField:function(G,re){this.writeTag(G,r.Bytes),this.writeBytes(re)},writeFixed32Field:function(G,re){this.writeTag(G,r.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(G,re){this.writeTag(G,r.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(G,re){this.writeTag(G,r.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(G,re){this.writeTag(G,r.Fixed64),this.writeSFixed64(re)},writeVarintField:function(G,re){this.writeTag(G,r.Varint),this.writeVarint(re)},writeSVarintField:function(G,re){this.writeTag(G,r.Varint),this.writeSVarint(re)},writeStringField:function(G,re){this.writeTag(G,r.Bytes),this.writeString(re)},writeFloatField:function(G,re){this.writeTag(G,r.Fixed32),this.writeFloat(re)},writeDoubleField:function(G,re){this.writeTag(G,r.Fixed64),this.writeDouble(re)},writeBooleanField:function(G,re){this.writeVarintField(G,!!re)}},Fu}var Ja=v(_d());const Ms=3;function Pc(u,r,h){u===1&&h.readMessage(Gh,r)}function Gh(u,r,h){if(u===3){const{id:m,bitmap:b,width:T,height:M,left:k,top:D,advance:z}=h.readMessage($h,{});r.push({id:m,bitmap:new Zn({width:T+2*Ms,height:M+2*Ms},b),metrics:{width:T,height:M,left:k,top:D,advance:z}})}}function $h(u,r,h){u===1?r.id=h.readVarint():u===2?r.bitmap=h.readBytes():u===3?r.width=h.readVarint():u===4?r.height=h.readVarint():u===5?r.left=h.readSVarint():u===6?r.top=h.readSVarint():u===7&&(r.advance=h.readVarint())}const pg=Ms;function kp(u){let r=0,h=0;for(const M of u)r+=M.w*M.h,h=Math.max(h,M.w);u.sort((M,k)=>k.h-M.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),h),h:1/0}];let b=0,T=0;for(const M of u)for(let k=m.length-1;k>=0;k--){const D=m[k];if(!(M.w>D.w||M.h>D.h)){if(M.x=D.x,M.y=D.y,T=Math.max(T,M.y+M.h),b=Math.max(b,M.x+M.w),M.w===D.w&&M.h===D.h){const z=m.pop();k<m.length&&(m[k]=z)}else M.h===D.h?(D.x+=M.w,D.w-=M.w):M.w===D.w?(D.y+=M.h,D.h-=M.h):(m.push({x:D.x+M.w,y:D.y,w:D.w-M.w,h:M.h}),D.y+=M.h,D.h-=M.h);break}}return{w:b,h:T,fill:r/(b*T)||0}}const mr=1;class ju{constructor(r,{pixelRatio:h,version:m,stretchX:b,stretchY:T,content:M,textFitWidth:k,textFitHeight:D}){this.paddedRect=r,this.pixelRatio=h,this.stretchX=b,this.stretchY=T,this.content=M,this.version=m,this.textFitWidth=k,this.textFitHeight=D}get tl(){return[this.paddedRect.x+mr,this.paddedRect.y+mr]}get br(){return[this.paddedRect.x+this.paddedRect.w-mr,this.paddedRect.y+this.paddedRect.h-mr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*mr)/this.pixelRatio,(this.paddedRect.h-2*mr)/this.pixelRatio]}}class Ep{constructor(r,h){const m={},b={};this.haveRenderCallbacks=[];const T=[];this.addImages(r,m,T),this.addImages(h,b,T);const{w:M,h:k}=kp(T),D=new en({width:M||1,height:k||1});for(const z in r){const N=r[z],U=m[z].paddedRect;en.copy(N.data,D,{x:0,y:0},{x:U.x+mr,y:U.y+mr},N.data)}for(const z in h){const N=h[z],U=b[z].paddedRect,Z=U.x+mr,$=U.y+mr,Q=N.data.width,J=N.data.height;en.copy(N.data,D,{x:0,y:0},{x:Z,y:$},N.data),en.copy(N.data,D,{x:0,y:J-1},{x:Z,y:$-1},{width:Q,height:1}),en.copy(N.data,D,{x:0,y:0},{x:Z,y:$+J},{width:Q,height:1}),en.copy(N.data,D,{x:Q-1,y:0},{x:Z-1,y:$},{width:1,height:J}),en.copy(N.data,D,{x:0,y:0},{x:Z+Q,y:$},{width:1,height:J})}this.image=D,this.iconPositions=m,this.patternPositions=b}addImages(r,h,m){for(const b in r){const T=r[b],M={x:0,y:0,w:T.data.width+2*mr,h:T.data.height+2*mr};m.push(M),h[b]=new ju(M,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(r,h){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in r.updatedImages)this.patchUpdatedImage(this.iconPositions[m],r.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],r.getImage(m),h)}patchUpdatedImage(r,h,m){if(!r||!h||r.version===h.version)return;r.version=h.version;const[b,T]=r.tl;m.update(h.data,void 0,{x:b,y:T})}}var hs;At("ImagePosition",ju),At("ImageAtlas",Ep),d.al=void 0,(hs=d.al||(d.al={}))[hs.none=0]="none",hs[hs.horizontal=1]="horizontal",hs[hs.vertical=2]="vertical",hs[hs.horizontalOnly=3]="horizontalOnly";const bd=-17;class Ws{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,h,m){const b=new Ws;return b.scale=r||1,b.fontStack=h,b.verticalAlign=m||"bottom",b}static forImage(r,h){const m=new Ws;return m.imageName=r,m.verticalAlign=h||"bottom",m}}class Vu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,h){const m=new Vu;for(let b=0;b<r.sections.length;b++){const T=r.sections[b];T.image?m.addImageSection(T):m.addTextSection(T,h)}return m}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let h="";for(let m=0;m<r.length;m++){const b=r.charCodeAt(m+1)||null,T=r.charCodeAt(m-1)||null;h+=b&&Cu(b)&&!pr[r[m+1]]||T&&Cu(T)&&!pr[r[m-1]]||!pr[r[m]]?r[m]:pr[r[m]]}return h}(this.text)}trim(){let r=0;for(let m=0;m<this.text.length&&Pp[this.text.charCodeAt(m)];m++)r++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=r&&Pp[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(r,h),this.sectionIndex=this.sectionIndex.slice(r,h)}substring(r,h){const m=new Vu;return m.text=this.text.substring(r,h),m.sectionIndex=this.sectionIndex.slice(r,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,h)=>Math.max(r,this.sections[h].scale),0)}getMaxImageSize(r){let h=0,m=0;for(let b=0;b<this.length();b++){const T=this.getSection(b);if(T.imageName){const M=r[T.imageName];if(!M)continue;const k=M.displaySize;h=Math.max(h,k[0]),m=Math.max(m,k[1])}}return{maxImageWidth:h,maxImageHeight:m}}addTextSection(r,h){this.text+=r.text,this.sections.push(Ws.forText(r.scale,r.fontStack||h,r.verticalAlign));const m=this.sections.length-1;for(let b=0;b<r.text.length;++b)this.sectionIndex.push(m)}addImageSection(r){const h=r.image?r.image.name:"";if(h.length===0)return void gs("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Ws.forImage(h,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):gs("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vd(u,r,h,m,b,T,M,k,D,z,N,U,Z,$,Q){const J=Vu.fromFeature(u,b);let oe;U===d.al.vertical&&J.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:Ae}=Qs;if(fe&&J.sections.length===1){oe=[];const re=fe(J.toString(),xd(J,z,T,r,m,$));for(const ye of re){const Ue=new Vu;Ue.text=ye,Ue.sections=J.sections;for(let ut=0;ut<ye.length;ut++)Ue.sectionIndex.push(0);oe.push(Ue)}}else if(Ae){oe=[];const re=Ae(J.text,J.sectionIndex,xd(J,z,T,r,m,$));for(const ye of re){const Ue=new Vu;Ue.text=ye[0],Ue.sectionIndex=ye[1],Ue.sections=J.sections,oe.push(Ue)}}else oe=function(re,ye){const Ue=[],ut=re.text;let Ge=0;for(const Je of ye)Ue.push(re.substring(Ge,Je)),Ge=Je;return Ge<ut.length&&Ue.push(re.substring(Ge,ut.length)),Ue}(J,xd(J,z,T,r,m,$));const pe=[],G={positionedLines:pe,text:J.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:U,iconsInText:!1,verticalizable:!1};return function(re,ye,Ue,ut,Ge,Je,mt,ft,bt,nt,Pt,Kt){let $t=0,Lt=0,gi=0,xn=0;const On=ft==="right"?1:ft==="left"?0:.5,Vs=Ln/Kt;let ho=0;for(const sn of Ge){sn.trim();const Xn=sn.getMaxScale(),fs={positionedGlyphs:[],lineOffset:0};re.positionedLines[ho]=fs;const ns=fs.positionedGlyphs;let Bn=0;if(!sn.length()){Lt+=Je,++ho;continue}const ds=_b(ut,sn,Vs);for(let Cs=0;Cs<sn.length();Cs++){const Mn=sn.getSection(Cs),pn=sn.getSectionIndex(Cs),ps=sn.getCharCode(Cs),Nn=bb(bt,Pt,ps);let Fi;if(Mn.imageName){if(re.iconsInText=!0,Mn.scale=Mn.scale*Vs,Fi=e_(Mn,Nn,Xn,ds,ut),!Fi)continue;Bn=Math.max(Bn,Fi.imageOffset)}else if(Fi=Jy(Mn,ps,Nn,ds,ye,Ue),!Fi)continue;const{rect:ma,metrics:Qu,baselineOffset:Hr}=Fi;ns.push({glyph:ps,imageName:Mn.imageName,x:$t,y:Lt+Hr+bd,vertical:Nn,scale:Mn.scale,fontStack:Mn.fontStack,sectionIndex:pn,metrics:Qu,rect:ma}),Nn?(re.verticalizable=!0,$t+=(Mn.imageName?Qu.advance:Ln)*Mn.scale+nt):$t+=Qu.advance*Mn.scale+nt}ns.length!==0&&(gi=Math.max($t-nt,gi),Xh(ns,0,ns.length-1,On)),$t=0,fs.lineOffset=Math.max(Bn,(Xn-1)*Ln);const dn=Je*Xn+Bn;Lt+=dn,xn=Math.max(dn,xn),++ho}const{horizontalAlign:Ys,verticalAlign:is}=wd(mt);(function(sn,Xn,fs,ns,Bn,ds,dn,Cs,Mn){const pn=(Xn-fs)*Bn;let ps=0;ps=ds!==dn?-Cs*ns-bd:-ns*Mn*dn+.5*dn;for(const Nn of sn)for(const Fi of Nn.positionedGlyphs)Fi.x+=pn,Fi.y+=ps})(re.positionedLines,On,Ys,is,gi,xn,Je,Lt,Ge.length),re.top+=-is*Lt,re.bottom=re.top+Lt,re.left+=-Ys*gi,re.right=re.left+gi}(G,r,h,m,oe,M,k,D,U,z,Z,Q),!function(re){for(const ye of re)if(ye.positionedGlyphs.length!==0)return!1;return!0}(pe)&&G}const Pp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Oc={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Op={40:!0};function Dp(u,r,h,m,b,T){if(r.imageName){const M=m[r.imageName];return M?M.displaySize[0]*r.scale*Ln/T+b:0}{const M=h[r.fontStack],k=M&&M[u];return k?k.metrics.advance*r.scale+b:0}}function Uu(u,r,h,m){const b=Math.pow(u-r,2);return m?u<r?b/2:2*b:b+Math.abs(h)*h}function Ky(u,r,h){let m=0;return u===10&&(m-=1e4),h&&(m+=150),u!==40&&u!==65288||(m+=50),r!==41&&r!==65289||(m+=50),m}function mg(u,r,h,m,b,T){let M=null,k=Uu(r,h,b,T);for(const D of m){const z=Uu(r-D.x,h,b,T)+D.badness;z<=k&&(M=D,k=z)}return{index:u,x:r,priorBreak:M,badness:k}}function gg(u){return u?gg(u.priorBreak).concat(u.index):[]}function xd(u,r,h,m,b,T){if(!u)return[];const M=[],k=function(U,Z,$,Q,J,oe){let fe=0;for(let Ae=0;Ae<U.length();Ae++){const pe=U.getSection(Ae);fe+=Dp(U.getCharCode(Ae),pe,Q,J,Z,oe)}return fe/Math.max(1,Math.ceil(fe/$))}(u,r,h,m,b,T),D=u.text.indexOf("​")>=0;let z=0;for(let U=0;U<u.length();U++){const Z=u.getSection(U),$=u.getCharCode(U);if(Pp[$]||(z+=Dp($,Z,m,b,r,T)),U<u.length()-1){const Q=!((N=$)<11904)&&(!!di["CJK Compatibility Forms"](N)||!!di["CJK Compatibility"](N)||!!di["CJK Strokes"](N)||!!di["CJK Symbols and Punctuation"](N)||!!di["Enclosed CJK Letters and Months"](N)||!!di["Halfwidth and Fullwidth Forms"](N)||!!di["Ideographic Description Characters"](N)||!!di["Vertical Forms"](N)||Rh.test(String.fromCodePoint(N)));(Oc[$]||Q||Z.imageName||U!==u.length()-2&&Op[u.getCharCode(U+1)])&&M.push(mg(U+1,z,k,M,Ky($,u.getCharCode(U+1),Q&&D),!1))}}var N;return gg(mg(u.length(),z,k,M,0,!0))}function wd(u){let r=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:r,verticalAlign:h}}function _b(u,r,h){const m=r.getMaxScale()*Ln,{maxImageWidth:b,maxImageHeight:T}=r.getMaxImageSize(u),M=Math.max(m,T*h);return{verticalLineContentWidth:Math.max(m,b*h),horizontalLineContentHeight:M}}function Yy(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function bb(u,r,h){return!(u===d.al.horizontal||!r&&!Mu(h)||r&&(Pp[h]||(m=h,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(m)))));var m}function Jy(u,r,h,m,b,T){const M=T[u.fontStack],k=function(z,N,U,Z){if(z&&z.rect)return z;const $=N[U.fontStack],Q=$&&$[Z];return Q?{rect:null,metrics:Q.metrics}:null}(M&&M[r],b,u,r);if(k===null)return null;let D;if(h)D=m.verticalLineContentWidth-u.scale*Ln;else{const z=Yy(u.verticalAlign);D=(m.horizontalLineContentHeight-u.scale*Ln)*z}return{rect:k.rect,metrics:k.metrics,baselineOffset:D}}function e_(u,r,h,m,b){const T=b[u.imageName];if(!T)return null;const M=T.paddedRect,k=T.displaySize,D={width:k[0],height:k[1],left:mr,top:-3,advance:r?k[1]:k[0]};let z;if(r)z=m.verticalLineContentWidth-k[1]*u.scale;else{const N=Yy(u.verticalAlign);z=(m.horizontalLineContentHeight-k[1]*u.scale)*N}return{rect:M,metrics:D,baselineOffset:z,imageOffset:(r?k[0]:k[1])*u.scale-Ln*h}}function Xh(u,r,h,m){if(m===0)return;const b=u[h],T=(u[h].x+b.metrics.advance*b.scale)*m;for(let M=r;M<=h;M++)u[M].x-=T}function Rp(u,r,h){const{horizontalAlign:m,verticalAlign:b}=wd(h),T=r[0]-u.displaySize[0]*m,M=r[1]-u.displaySize[1]*b;return{image:u,top:M,bottom:M+u.displaySize[1],left:T,right:T+u.displaySize[0]}}function yg(u){var r,h;let m=u.left,b=u.top,T=u.right-m,M=u.bottom-b;const k=(r=u.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",D=(h=u.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",z=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(D==="proportional"){if(k==="stretchOnly"&&T/M<z||k==="proportional"){const N=Math.ceil(M*z);m*=N/T,T=N}}else if(k==="proportional"&&D==="stretchOnly"&&z!==0&&T/M>z){const N=Math.ceil(T/z);b*=N/M,M=N}return{x1:m,y1:b,x2:m+T,y2:b+M}}function _g(u,r,h,m,b,T){const M=u.image;let k;if(M.content){const oe=M.content,fe=M.pixelRatio||1;k=[oe[0]/fe,oe[1]/fe,M.displaySize[0]-oe[2]/fe,M.displaySize[1]-oe[3]/fe]}const D=r.left*T,z=r.right*T;let N,U,Z,$;h==="width"||h==="both"?($=b[0]+D-m[3],U=b[0]+z+m[1]):($=b[0]+(D+z-M.displaySize[0])/2,U=$+M.displaySize[0]);const Q=r.top*T,J=r.bottom*T;return h==="height"||h==="both"?(N=b[1]+Q-m[0],Z=b[1]+J+m[2]):(N=b[1]+(Q+J-M.displaySize[1])/2,Z=N+M.displaySize[1]),{image:M,top:N,right:U,bottom:Z,left:$,collisionPadding:k}}const Qh=255,fa=128,Xl=Qh*fa;function bg(u,r){const{expression:h}=r;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Hi(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=h;let T=0;for(;T<m.length&&m[T]<=u;)T++;T=Math.max(0,T-1);let M=T;for(;M<m.length&&m[M]<u+1;)M++;M=Math.min(m.length-1,M);const k=m[T],D=m[M];return h.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:D,interpolationType:b}:{kind:"camera",minZoom:k,maxZoom:D,minSize:h.evaluate(new Hi(k)),maxSize:h.evaluate(new Hi(D)),interpolationType:b}}}function Wh(u,r,h){let m="never";const b=u.get(r);return b?m=b:u.get(h)&&(m="always"),m}const t_=Zh.VectorTileFeature.types,i_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $i(u,r,h,m,b,T,M,k,D,z,N,U,Z){const $=k?Math.min(Xl,Math.round(k[0])):0,Q=k?Math.min(Xl,Math.round(k[1])):0;u.emplaceBack(r,h,Math.round(32*m),Math.round(32*b),T,M,($<<1)+(D?1:0),Q,16*z,16*N,256*U,256*Z)}function Sd(u,r,h){u.emplaceBack(r.x,r.y,h),u.emplaceBack(r.x,r.y,h),u.emplaceBack(r.x,r.y,h),u.emplaceBack(r.x,r.y,h)}function vb(u){for(const r of u.sections)if(up(r.text))return!0;return!1}class Ip{constructor(r){this.layoutVertexArray=new qe,this.indexArray=new vt,this.programConfigurations=r,this.segments=new ii,this.dynamicLayoutVertexArray=new it,this.opacityVertexArray=new tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new B}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,h,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,fg.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Gl.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,i_,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}At("SymbolBuffers",Ip);class vg{constructor(r,h,m){this.layoutVertexArray=new r,this.layoutAttributes=h,this.indexArray=new m,this.segments=new ii,this.collisionVertexArray=new wt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,$n.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}At("CollisionBuffers",vg);class Kh{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(M=>M.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bg(this.zoom,h["text-size"]),this.iconSizeData=bg(this.zoom,h["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),T=m.get("symbol-z-order");this.canOverlap=Wh(m,"text-overlap","text-allow-overlap")!=="never"||Wh(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(M=>d.al[M])),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.sourceID=r.sourceID}createArrays(){this.text=new Ip(new Qa(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Ip(new Qa(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new H,this.lineVertexArray=new W,this.symbolInstances=new q,this.textAnchorOffsets=new ue}calculateGlyphDependencies(r,h,m,b,T){for(let M=0;M<r.length;M++)if(h[r.charCodeAt(M)]=!0,(m||b)&&T){const k=pr[r.charAt(M)];k&&(h[k.charCodeAt(0)]=!0)}}populate(r,h,m){const b=this.layers[0],T=b.layout,M=T.get("text-font"),k=T.get("text-field"),D=T.get("icon-image"),z=(k.value.kind!=="constant"||k.value.value instanceof rr&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),N=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,U=T.get("symbol-sort-key");if(this.features=[],!z&&!N)return;const Z=h.iconDependencies,$=h.glyphDependencies,Q=h.availableImages,J=new Hi(this.zoom);for(const{feature:oe,id:fe,index:Ae,sourceLayerIndex:pe}of r){const G=b._featureFilter.needGeometry,re=uo(oe,G);if(!b._featureFilter.filter(J,re,m))continue;let ye,Ue;if(G||(re.geometry=Ts(oe)),z){const Ge=b.getValueAndResolveTokens("text-field",re,m,Q),Je=rr.factory(Ge),mt=this.hasRTLText=this.hasRTLText||vb(Je);(!mt||Qs.getRTLTextPluginStatus()==="unavailable"||mt&&Qs.isParsed())&&(ye=dg(Je,b,re))}if(N){const Ge=b.getValueAndResolveTokens("icon-image",re,m,Q);Ue=Ge instanceof as?Ge:as.fromString(Ge)}if(!ye&&!Ue)continue;const ut=this.sortFeaturesByKey?U.evaluate(re,{},m):void 0;if(this.features.push({id:fe,text:ye,icon:Ue,index:Ae,sourceLayerIndex:pe,geometry:re.geometry,properties:oe.properties,type:t_[oe.type],sortKey:ut}),Ue&&(Z[Ue.name]=!0),ye){const Ge=M.evaluate(re,{},m).join(","),Je=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.al.vertical)>=0;for(const mt of ye.sections)if(mt.image)Z[mt.image.name]=!0;else{const ft=Ol(ye.toString()),bt=mt.fontStack||Ge,nt=$[bt]=$[bt]||{};this.calculateGlyphDependencies(mt.text,nt,Je,this.allowVerticalPlacement,ft)}}}T.get("symbol-placement")==="line"&&(this.features=function(oe){const fe={},Ae={},pe=[];let G=0;function re(Ge){pe.push(oe[Ge]),G++}function ye(Ge,Je,mt){const ft=Ae[Ge];return delete Ae[Ge],Ae[Je]=ft,pe[ft].geometry[0].pop(),pe[ft].geometry[0]=pe[ft].geometry[0].concat(mt[0]),ft}function Ue(Ge,Je,mt){const ft=fe[Je];return delete fe[Je],fe[Ge]=ft,pe[ft].geometry[0].shift(),pe[ft].geometry[0]=mt[0].concat(pe[ft].geometry[0]),ft}function ut(Ge,Je,mt){const ft=mt?Je[0][Je[0].length-1]:Je[0][0];return`${Ge}:${ft.x}:${ft.y}`}for(let Ge=0;Ge<oe.length;Ge++){const Je=oe[Ge],mt=Je.geometry,ft=Je.text?Je.text.toString():null;if(!ft){re(Ge);continue}const bt=ut(ft,mt),nt=ut(ft,mt,!0);if(bt in Ae&&nt in fe&&Ae[bt]!==fe[nt]){const Pt=Ue(bt,nt,mt),Kt=ye(bt,nt,pe[Pt].geometry);delete fe[bt],delete Ae[nt],Ae[ut(ft,pe[Kt].geometry,!0)]=Kt,pe[Pt].geometry=null}else bt in Ae?ye(bt,nt,mt):nt in fe?Ue(bt,nt,mt):(re(Ge),fe[bt]=G-1,Ae[nt]=G-1)}return pe.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,fe)=>oe.sortKey-fe.sortKey)}update(r,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(r,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,h){const m=this.lineVertexArray.length;if(r.segment!==void 0){let b=r.dist(h[r.segment+1]),T=r.dist(h[r.segment]);const M={};for(let k=r.segment+1;k<h.length;k++)M[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:b},k<h.length-1&&(b+=h[k+1].dist(h[k]));for(let k=r.segment||0;k>=0;k--)M[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:T},k>0&&(T+=h[k-1].dist(h[k]));for(let k=0;k<h.length;k++){const D=M[k];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(r,h,m,b,T,M,k,D,z,N,U,Z){const $=r.indexArray,Q=r.layoutVertexArray,J=r.segments.prepareSegment(4*h.length,Q,$,this.canOverlap?M.sortKey:void 0),oe=this.glyphOffsetArray.length,fe=J.vertexLength,Ae=this.allowVerticalPlacement&&k===d.al.vertical?Math.PI/2:0,pe=M.text&&M.text.sections;for(let G=0;G<h.length;G++){const{tl:re,tr:ye,bl:Ue,br:ut,tex:Ge,pixelOffsetTL:Je,pixelOffsetBR:mt,minFontScaleX:ft,minFontScaleY:bt,glyphOffset:nt,isSDF:Pt,sectionIndex:Kt}=h[G],$t=J.vertexLength,Lt=nt[1];$i(Q,D.x,D.y,re.x,Lt+re.y,Ge.x,Ge.y,m,Pt,Je.x,Je.y,ft,bt),$i(Q,D.x,D.y,ye.x,Lt+ye.y,Ge.x+Ge.w,Ge.y,m,Pt,mt.x,Je.y,ft,bt),$i(Q,D.x,D.y,Ue.x,Lt+Ue.y,Ge.x,Ge.y+Ge.h,m,Pt,Je.x,mt.y,ft,bt),$i(Q,D.x,D.y,ut.x,Lt+ut.y,Ge.x+Ge.w,Ge.y+Ge.h,m,Pt,mt.x,mt.y,ft,bt),Sd(r.dynamicLayoutVertexArray,D,Ae),$.emplaceBack($t,$t+2,$t+1),$.emplaceBack($t+1,$t+2,$t+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nt[0]),G!==h.length-1&&Kt===h[G+1].sectionIndex||r.programConfigurations.populatePaintArrays(Q.length,M,M.index,{},Z,pe&&pe[Kt])}r.placedSymbolArray.emplaceBack(D.x,D.y,oe,this.glyphOffsetArray.length-oe,fe,z,N,D.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],k,0,!1,0,U)}_addCollisionDebugVertex(r,h,m,b,T,M){return h.emplaceBack(0,0),r.emplaceBack(m.x,m.y,b,T,Math.round(M.x),Math.round(M.y))}addCollisionDebugVertices(r,h,m,b,T,M,k){const D=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),z=D.vertexLength,N=T.layoutVertexArray,U=T.collisionVertexArray,Z=k.anchorX,$=k.anchorY;this._addCollisionDebugVertex(N,U,M,Z,$,new K(r,h)),this._addCollisionDebugVertex(N,U,M,Z,$,new K(m,h)),this._addCollisionDebugVertex(N,U,M,Z,$,new K(m,b)),this._addCollisionDebugVertex(N,U,M,Z,$,new K(r,b)),D.vertexLength+=4;const Q=T.indexArray;Q.emplaceBack(z,z+1),Q.emplaceBack(z+1,z+2),Q.emplaceBack(z+2,z+3),Q.emplaceBack(z+3,z),D.primitiveLength+=4}addDebugCollisionBoxes(r,h,m,b){for(let T=r;T<h;T++){const M=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(M.x1,M.y1,M.x2,M.y2,b?this.textCollisionBox:this.iconCollisionBox,M.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vg(et,$l.members,rt),this.iconCollisionBox=new vg(et,$l.members,rt);for(let r=0;r<this.symbolInstances.length;r++){const h=this.symbolInstances.get(r);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(r,h,m,b,T,M,k,D,z){const N={};for(let U=h;U<m;U++){const Z=r.get(U);N.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},N.textFeatureIndex=Z.featureIndex;break}for(let U=b;U<T;U++){const Z=r.get(U);N.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},N.verticalTextFeatureIndex=Z.featureIndex;break}for(let U=M;U<k;U++){const Z=r.get(U);N.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},N.iconFeatureIndex=Z.featureIndex;break}for(let U=D;U<z;U++){const Z=r.get(U);N.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},N.verticalIconFeatureIndex=Z.featureIndex;break}return N}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,h){const m=r.placedSymbolArray.get(h),b=m.vertexStartIndex+4*m.numGlyphs;for(let T=m.vertexStartIndex;T<b;T+=4)r.indexArray.emplaceBack(T,T+2,T+1),r.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(r),m=Math.cos(r),b=[],T=[],M=[];for(let k=0;k<this.symbolInstances.length;++k){M.push(k);const D=this.symbolInstances.get(k);b.push(0|Math.round(h*D.anchorX+m*D.anchorY)),T.push(D.featureIndex)}return M.sort((k,D)=>b[k]-b[D]||T[D]-T[k]),M}addToSortKeyRanges(r,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,T,M)=>{b>=0&&M.indexOf(b)===T&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n_,Td;At("SymbolBucket",Kh,{omit:["layers","collisionBoxArray","features","compareText"]}),Kh.MAX_GLYPHS=65535,Kh.addDynamicAttributes=Sd;var Dc={get paint(){return Td=Td||new Bs({"icon-opacity":new Yt(ne.paint_symbol["icon-opacity"]),"icon-color":new Yt(ne.paint_symbol["icon-color"]),"icon-halo-color":new Yt(ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(ne.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yt(ne.paint_symbol["text-opacity"]),"text-color":new Yt(ne.paint_symbol["text-color"],{runtimeType:Vn,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Yt(ne.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(ne.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(ne.paint_symbol["text-halo-blur"]),"text-translate":new jt(ne.paint_symbol["text-translate"]),"text-translate-anchor":new jt(ne.paint_symbol["text-translate-anchor"])})},get layout(){return n_=n_||new Bs({"symbol-placement":new jt(ne.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(ne.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(ne.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(ne.layout_symbol["icon-size"]),"icon-text-fit":new jt(ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(ne.layout_symbol["icon-image"]),"icon-rotate":new Yt(ne.layout_symbol["icon-rotate"]),"icon-padding":new Yt(ne.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(ne.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(ne.layout_symbol["icon-offset"]),"icon-anchor":new Yt(ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(ne.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(ne.layout_symbol["text-field"]),"text-font":new Yt(ne.layout_symbol["text-font"]),"text-size":new Yt(ne.layout_symbol["text-size"]),"text-max-width":new Yt(ne.layout_symbol["text-max-width"]),"text-line-height":new jt(ne.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(ne.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(ne.layout_symbol["text-justify"]),"text-radial-offset":new Yt(ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(ne.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Yt(ne.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Yt(ne.layout_symbol["text-anchor"]),"text-max-angle":new jt(ne.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(ne.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(ne.layout_symbol["text-rotate"]),"text-padding":new jt(ne.layout_symbol["text-padding"]),"text-keep-upright":new jt(ne.layout_symbol["text-keep-upright"]),"text-transform":new Yt(ne.layout_symbol["text-transform"]),"text-offset":new Yt(ne.layout_symbol["text-offset"]),"text-allow-overlap":new jt(ne.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(ne.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(ne.layout_symbol["text-ignore-placement"]),"text-optional":new jt(ne.layout_symbol["text-optional"])})}};class zp{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:Si,this.defaultValue=r}evaluate(r){if(r.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(r.formattedSection))return h.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At("FormatSectionOverride",zp,{omit:["defaultValue"]});class qu extends ws{constructor(r){super(r,Dc)}recalculate(r,h){if(super.recalculate(r,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const T of m)b.indexOf(T)<0&&b.push(T);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,h,m,b){const T=this.layout.get(r).evaluate(h,{},m,b),M=this._unevaluatedLayout._values[r];return M.isDataDriven()||Al(M.value)||!T?T:function(k,D){return D.replace(/{([^{}]+)}/g,(z,N)=>k&&N in k?String(k[N]):"")}(h.properties,T)}createBucket(r){return new Kh(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Dc.paint.overridableProperties){if(!qu.hasPaintOverride(this.layout,r))continue;const h=this.paint.get(r),m=new zp(h),b=new Na(m,h.property.specification);let T=null;T=h.value.kind==="constant"||h.value.kind==="source"?new vu("source",b):new to("composite",b,h.value.zoomStops),this.paint._values[r]=new ur(h.property,T,h.parameters)}}_handleOverridablePaintPropertyUpdate(r,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&qu.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,h){const m=r.get("text-field"),b=Dc.paint.properties[h];let T=!1;const M=k=>{for(const D of k)if(b.overrides&&b.overrides.hasOverride(D))return void(T=!0)};if(m.value.kind==="constant"&&m.value.value instanceof rr)M(m.value.value.sections);else if(m.value.kind==="source"){const k=z=>{T||(z instanceof Os&&mn(z.value)===Ta?M(z.value.sections):z instanceof au?M(z.sections):z.eachChild(k))},D=m.value;D._styleExpression&&k(D._styleExpression.expression)}return T}}let Lp;var Hu={get paint(){return Lp=Lp||new Bs({"background-color":new jt(ne.paint_background["background-color"]),"background-pattern":new Sc(ne.paint_background["background-pattern"]),"background-opacity":new jt(ne.paint_background["background-opacity"])})}};class el extends ws{constructor(r){super(r,Hu)}}let Yh;var xb={get paint(){return Yh=Yh||new Bs({"raster-opacity":new jt(ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(ne.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(ne.paint_raster["raster-saturation"]),"raster-contrast":new jt(ne.paint_raster["raster-contrast"]),"raster-resampling":new jt(ne.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(ne.paint_raster["raster-fade-duration"])})}};class s_ extends ws{constructor(r){super(r,xb)}}class r_ extends ws{constructor(r){super(r,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class o_{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const a_={once:!0},xg=63710088e-1;class tl{constructor(r,h){if(isNaN(r)||isNaN(h))throw new Error(`Invalid LngLat object: (${r}, ${h})`);if(this.lng=+r,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new tl(Nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const h=Math.PI/180,m=this.lat*h,b=r.lat*h,T=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((r.lng-this.lng)*h);return xg*Math.acos(Math.min(T,1))}static convert(r){if(r instanceof tl)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new tl(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new tl(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wg=2*Math.PI*xg;function Sg(u){return wg*Math.cos(u*Math.PI/180)}function l_(u){return(180+u)/360}function Bp(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Np(u,r){return u/Sg(r)}function Tg(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function c_(u,r){return u*Sg(Tg(r))}class Ql{constructor(r,h,m=0){this.x=+r,this.y=+h,this.z=+m}static fromLngLat(r,h=0){const m=tl.convert(r);return new Ql(l_(m.lng),Bp(m.lat),Np(h,m.lat))}toLngLat(){return new tl(360*this.x-180,Tg(this.y))}toAltitude(){return c_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wg*(r=Tg(this.y),1/Math.cos(r*Math.PI/180));var r}}function u_(u,r,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[u*m-2*Math.PI*6378137/2,r*m-2*Math.PI*6378137/2]}class Fp{constructor(r,h,m){if(!function(b,T,M){return!(b<0||b>25||M<0||M>=Math.pow(2,b)||T<0||T>=Math.pow(2,b))}(r,h,m))throw new Error(`x=${h}, y=${m}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=h,this.y=m,this.key=Wl(0,r,r,h,m)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,h,m){const b=(M=this.y,k=this.z,D=u_(256*(T=this.x),256*(M=Math.pow(2,k)-M-1),k),z=u_(256*(T+1),256*(M+1),k),D[0]+","+D[1]+","+z[0]+","+z[1]);var T,M,k,D,z;const N=function(U,Z,$){let Q,J="";for(let oe=U;oe>0;oe--)Q=1<<oe-1,J+=(Z&Q?1:0)+($&Q?2:0);return J}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,b)}isChildOf(r){const h=this.z-r.z;return h>0&&r.x===this.x>>h&&r.y===this.y>>h}getTilePoint(r){const h=Math.pow(2,this.z);return new K((r.x*h-this.x)*_t,(r.y*h-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ci{constructor(r,h){this.wrap=r,this.canonical=h,this.key=Wl(r,h.z,h.z,h.x,h.y)}}class Er{constructor(r,h,m,b,T){if(this.terrainRttPosMatrix32f=null,r<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${m}`);this.overscaledZ=r,this.wrap=h,this.canonical=new Fp(m,+b,+T),this.key=Wl(h,r,m,b,T)}clone(){return new Er(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-r;return r>this.canonical.z?new Er(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Er(r,this.wrap,r,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(r,h){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-r;return r>this.canonical.z?Wl(this.wrap*+h,r,this.canonical.z,this.canonical.x,this.canonical.y):Wl(this.wrap*+h,r,r,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const h=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>h&&r.canonical.y===this.canonical.y>>h}children(r){if(this.overscaledZ>=r)return[new Er(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new Er(h,this.wrap,h,m,b),new Er(h,this.wrap,h,m+1,b),new Er(h,this.wrap,h,m,b+1),new Er(h,this.wrap,h,m+1,b+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Er(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Er(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ci(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Ql(r.x-this.wrap,r.y))}}function Wl(u,r,h,m,b){(u*=2)<0&&(u=-1*u-1);const T=1<<h;return(T*T*u+T*b+m).toString(36)+h.toString(36)+r.toString(36)}At("CanonicalTileID",Fp),At("OverscaledTileID",Er,{omit:["terrainRttPosMatrix32f"]});class jp{constructor(r,h,m,b=1,T=1,M=1,k=0){if(this.uid=r,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void gs(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const D=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=T,this.blueFactor=M,this.baseShift=k;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<D;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(D,z)]=this.data[this._idx(D-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,D)]=this.data[this._idx(z,D-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(D,-1)]=this.data[this._idx(D-1,0)],this.data[this._idx(-1,D)]=this.data[this._idx(0,D-1)],this.data[this._idx(D,D)]=this.data[this._idx(D-1,D-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<D;z++)for(let N=0;N<D;N++){const U=this.get(z,N);U>this.max&&(this.max=U),U<this.min&&(this.min=U)}}get(r,h){const m=new Uint8Array(this.data.buffer),b=4*this._idx(r,h);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,h){if(r<-1||r>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(r+1)}unpack(r,h,m){return r*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new en({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,h,m){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let b=h*this.dim,T=h*this.dim+this.dim,M=m*this.dim,k=m*this.dim+this.dim;switch(h){case-1:b=T-1;break;case 1:T=b+1}switch(m){case-1:M=k-1;break;case 1:k=M+1}const D=-h*this.dim,z=-m*this.dim;for(let N=M;N<k;N++)for(let U=b;U<T;U++)this.data[this._idx(U,N)]=r.data[this._idx(U+D,N+z)]}}At("DEMData",jp);class Mg{constructor(r){this._stringToNumber={},this._numberToString=[];for(let h=0;h<r.length;h++){const m=r[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Vp{constructor(r,h,m,b,T){this.type="Feature",this._vectorTileFeature=r,r._z=h,r._x=m,r._y=b,this.properties=r.properties,this.id=T}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(r[h]=this[h]);return r}}class Jh{constructor(r,h){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new wr(_t,16,0),this.grid3D=new wr(_t,16,0),this.featureIndexArray=new he,this.promoteId=h}insert(r,h,m,b,T,M){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,T);const D=M?this.grid3D:this.grid;for(let z=0;z<h.length;z++){const N=h[z],U=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<N.length;Z++){const $=N[Z];U[0]=Math.min(U[0],$.x),U[1]=Math.min(U[1],$.y),U[2]=Math.max(U[2],$.x),U[3]=Math.max(U[3],$.y)}U[0]<_t&&U[1]<_t&&U[2]>=0&&U[3]>=0&&D.insert(k,U[0],U[1],U[2],U[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Zh.VectorTile(new Ja(this.rawTileData)).layers,this.sourceLayerCoder=new Mg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,h,m,b){this.loadVTLayers();const T=r.params,M=_t/r.tileSize/r.scale,k=Fa(T.filter),D=r.queryGeometry,z=r.queryPadding*M,N=Zu(D),U=this.grid.query(N.minX-z,N.minY-z,N.maxX+z,N.maxY+z),Z=Zu(r.cameraQueryGeometry),$=this.grid3D.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z,(oe,fe,Ae,pe)=>function(G,re,ye,Ue,ut){for(const Je of G)if(re<=Je.x&&ye<=Je.y&&Ue>=Je.x&&ut>=Je.y)return!0;const Ge=[new K(re,ye),new K(re,ut),new K(Ue,ut),new K(Ue,ye)];if(G.length>2){for(const Je of Ge)if(jl(G,Je))return!0}for(let Je=0;Je<G.length-1;Je++)if($m(G[Je],G[Je+1],Ge))return!0;return!1}(r.cameraQueryGeometry,oe-z,fe-z,Ae+z,pe+z));for(const oe of $)U.push(oe);U.sort(h_);const Q={};let J;for(let oe=0;oe<U.length;oe++){const fe=U[oe];if(fe===J)continue;J=fe;const Ae=this.featureIndexArray.get(fe);let pe=null;this.loadMatchingFeature(Q,Ae.bucketIndex,Ae.sourceLayerIndex,Ae.featureIndex,k,T.layers,T.availableImages,h,m,b,(G,re,ye)=>(pe||(pe=Ts(G)),re.queryIntersectsFeature({queryGeometry:D,feature:G,featureState:ye,geometry:pe,zoom:this.z,transform:r.transform,pixelsToTileUnits:M,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation})))}return Q}loadMatchingFeature(r,h,m,b,T,M,k,D,z,N,U){const Z=this.bucketLayerIDs[h];if(M&&!Z.some(oe=>M.has(oe)))return;const $=this.sourceLayerCoder.decode(m),Q=this.vtLayers[$].feature(b);if(T.needGeometry){const oe=uo(Q,!0);if(!T.filter(new Hi(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!T.filter(new Hi(this.tileID.overscaledZ),Q))return;const J=this.getId(Q,$);for(let oe=0;oe<Z.length;oe++){const fe=Z[oe];if(M&&!M.has(fe))continue;const Ae=D[fe];if(!Ae)continue;let pe={};J&&N&&(pe=N.getState(Ae.sourceLayer||"_geojsonTileLayer",J));const G=Ei({},z[fe]);G.paint=Md(G.paint,Ae.paint,Q,pe,k),G.layout=Md(G.layout,Ae.layout,Q,pe,k);const re=!U||U(Q,Ae,pe);if(!re)continue;const ye=new Vp(Q,this.z,this.x,this.y,J);ye.layer=G;let Ue=r[fe];Ue===void 0&&(Ue=r[fe]=[]),Ue.push({featureIndex:b,feature:ye,intersectionZ:re})}}lookupSymbolFeatures(r,h,m,b,T,M,k,D){const z={};this.loadVTLayers();const N=Fa(T);for(const U of r)this.loadMatchingFeature(z,m,b,U,N,M,k,D,h);return z}hasLayer(r){for(const h of this.bucketLayerIDs)for(const m of h)if(r===m)return!0;return!1}getId(r,h){var m;let b=r.id;return this.promoteId&&(b=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof b=="boolean"&&(b=Number(b)),b===void 0&&(!((m=r.properties)===null||m===void 0)&&m.cluster)&&this.promoteId&&(b=Number(r.properties.cluster_id))),b}}function Md(u,r,h,m,b){return ms(u,(T,M)=>{const k=r instanceof Za?r.get(M):null;return k&&k.evaluate?k.evaluate(h,m,b):k})}function Zu(u){let r=1/0,h=1/0,m=-1/0,b=-1/0;for(const T of u)r=Math.min(r,T.x),h=Math.min(h,T.y),m=Math.max(m,T.x),b=Math.max(b,T.y);return{minX:r,minY:h,maxX:m,maxY:b}}function h_(u,r){return r-u}function f_(u,r,h,m,b){const T=[];for(let M=0;M<u.length;M++){const k=u[M];let D;for(let z=0;z<k.length-1;z++){let N=k[z],U=k[z+1];N.x<r&&U.x<r||(N.x<r?N=new K(r,N.y+(r-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x<r&&(U=new K(r,N.y+(r-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y<h&&U.y<h||(N.y<h?N=new K(N.x+(h-N.y)/(U.y-N.y)*(U.x-N.x),h)._round():U.y<h&&(U=new K(N.x+(h-N.y)/(U.y-N.y)*(U.x-N.x),h)._round()),N.x>=m&&U.x>=m||(N.x>=m?N=new K(m,N.y+(m-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x>=m&&(U=new K(m,N.y+(m-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y>=b&&U.y>=b||(N.y>=b?N=new K(N.x+(b-N.y)/(U.y-N.y)*(U.x-N.x),b)._round():U.y>=b&&(U=new K(N.x+(b-N.y)/(U.y-N.y)*(U.x-N.x),b)._round()),D&&N.equals(D[D.length-1])||(D=[N],T.push(D)),D.push(U)))))}}return T}At("FeatureIndex",Jh,{omit:["rawTileData","sourceLayerCoder"]});class Rc extends K{constructor(r,h,m,b){super(r,h),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Rc(this.x,this.y,this.angle,this.segment)}}function Cg(u,r,h,m,b){if(r.segment===void 0||h===0)return!0;let T=r,M=r.segment+1,k=0;for(;k>-h/2;){if(M--,M<0)return!1;k-=u[M].dist(T),T=u[M]}k+=u[M].dist(u[M+1]),M++;const D=[];let z=0;for(;k<h/2;){const N=u[M],U=u[M+1];if(!U)return!1;let Z=u[M-1].angleTo(N)-N.angleTo(U);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:k,angleDelta:Z}),z+=Z;k-D[0].distance>m;)z-=D.shift().angleDelta;if(z>b)return!1;M++,k+=N.dist(U)}return!0}function Ag(u){let r=0;for(let h=0;h<u.length-1;h++)r+=u[h].dist(u[h+1]);return r}function Cd(u,r,h){return u?.6*r*h:0}function nn(u,r){return Math.max(u?u.right-u.left:0,r?r.right-r.left:0)}function kg(u,r,h,m,b,T){const M=Cd(h,b,T),k=nn(h,m)*T;let D=0;const z=Ag(u)/2;for(let N=0;N<u.length-1;N++){const U=u[N],Z=u[N+1],$=U.dist(Z);if(D+$>z){const Q=(z-D)/$,J=Ki.number(U.x,Z.x,Q),oe=Ki.number(U.y,Z.y,Q),fe=new Rc(J,oe,Z.angleTo(U),N);return fe._round(),!M||Cg(u,fe,k,M,r)?fe:void 0}D+=$}}function Ks(u,r,h,m,b,T,M,k,D){const z=Cd(m,T,M),N=nn(m,b),U=N*M,Z=u[0].x===0||u[0].x===D||u[0].y===0||u[0].y===D;return r-U<r/4&&(r=U+r/4),d_(u,Z?r/2*k%r:(N/2+2*T)*M*k%r,r,z,h,U,Z,!1,D)}function d_(u,r,h,m,b,T,M,k,D){const z=T/2,N=Ag(u);let U=0,Z=r-h,$=[];for(let Q=0;Q<u.length-1;Q++){const J=u[Q],oe=u[Q+1],fe=J.dist(oe),Ae=oe.angleTo(J);for(;Z+h<U+fe;){Z+=h;const pe=(Z-U)/fe,G=Ki.number(J.x,oe.x,pe),re=Ki.number(J.y,oe.y,pe);if(G>=0&&G<D&&re>=0&&re<D&&Z-z>=0&&Z+z<=N){const ye=new Rc(G,re,Ae,Q);ye._round(),m&&!Cg(u,ye,T,m,b)||$.push(ye)}}U+=fe}return k||$.length||M||($=d_(u,U/2,h,m,b,T,M,!0,D)),$}At("Anchor",Rc);const Gu=mr;function Up(u,r,h,m){const b=[],T=u.image,M=T.pixelRatio,k=T.paddedRect.w-2*Gu,D=T.paddedRect.h-2*Gu;let z={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const N=T.stretchX||[[0,k]],U=T.stretchY||[[0,D]],Z=(nt,Pt)=>nt+Pt[1]-Pt[0],$=N.reduce(Z,0),Q=U.reduce(Z,0),J=k-$,oe=D-Q;let fe=0,Ae=$,pe=0,G=Q,re=0,ye=J,Ue=0,ut=oe;if(T.content&&m){const nt=T.content,Pt=nt[2]-nt[0],Kt=nt[3]-nt[1];(T.textFitWidth||T.textFitHeight)&&(z=yg(u)),fe=$u(N,0,nt[0]),pe=$u(U,0,nt[1]),Ae=$u(N,nt[0],nt[2]),G=$u(U,nt[1],nt[3]),re=nt[0]-fe,Ue=nt[1]-pe,ye=Pt-Ae,ut=Kt-G}const Ge=z.x1,Je=z.y1,mt=z.x2-Ge,ft=z.y2-Je,bt=(nt,Pt,Kt,$t)=>{const Lt=Ad(nt.stretch-fe,Ae,mt,Ge),gi=ef(nt.fixed-re,ye,nt.stretch,$),xn=Ad(Pt.stretch-pe,G,ft,Je),On=ef(Pt.fixed-Ue,ut,Pt.stretch,Q),Vs=Ad(Kt.stretch-fe,Ae,mt,Ge),ho=ef(Kt.fixed-re,ye,Kt.stretch,$),Ys=Ad($t.stretch-pe,G,ft,Je),is=ef($t.fixed-Ue,ut,$t.stretch,Q),sn=new K(Lt,xn),Xn=new K(Vs,xn),fs=new K(Vs,Ys),ns=new K(Lt,Ys),Bn=new K(gi/M,On/M),ds=new K(ho/M,is/M),dn=r*Math.PI/180;if(dn){const pn=Math.sin(dn),ps=Math.cos(dn),Nn=[ps,-pn,pn,ps];sn._matMult(Nn),Xn._matMult(Nn),ns._matMult(Nn),fs._matMult(Nn)}const Cs=nt.stretch+nt.fixed,Mn=Pt.stretch+Pt.fixed;return{tl:sn,tr:Xn,bl:ns,br:fs,tex:{x:T.paddedRect.x+Gu+Cs,y:T.paddedRect.y+Gu+Mn,w:Kt.stretch+Kt.fixed-Cs,h:$t.stretch+$t.fixed-Mn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bn,pixelOffsetBR:ds,minFontScaleX:ye/M/mt,minFontScaleY:ut/M/ft,isSDF:h}};if(m&&(T.stretchX||T.stretchY)){const nt=Eg(N,J,$),Pt=Eg(U,oe,Q);for(let Kt=0;Kt<nt.length-1;Kt++){const $t=nt[Kt],Lt=nt[Kt+1];for(let gi=0;gi<Pt.length-1;gi++)b.push(bt($t,Pt[gi],Lt,Pt[gi+1]))}}else b.push(bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:D+1}));return b}function $u(u,r,h){let m=0;for(const b of u)m+=Math.max(r,Math.min(h,b[1]))-Math.max(r,Math.min(h,b[0]));return m}function Eg(u,r,h){const m=[{fixed:-1,stretch:0}];for(const[b,T]of u){const M=m[m.length-1];m.push({fixed:b-M.stretch,stretch:M.stretch}),m.push({fixed:b-M.stretch,stretch:M.stretch+(T-b)})}return m.push({fixed:r+Gu,stretch:h}),m}function Ad(u,r,h,m){return u/r*h+m}function ef(u,r,h,m){return u-r*h/m}class tf{constructor(r,h,m,b,T,M,k,D,z,N){var U;if(this.boxStartIndex=r.length,z){let Z=M.top,$=M.bottom;const Q=M.collisionPadding;Q&&(Z-=Q[1],$+=Q[3]);let J=$-Z;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{const Z=!((U=M.image)===null||U===void 0)&&U.content&&(M.image.textFitWidth||M.image.textFitHeight)?yg(M):{x1:M.left,y1:M.top,x2:M.right,y2:M.bottom};Z.y1=Z.y1*k-D[0],Z.y2=Z.y2*k+D[2],Z.x1=Z.x1*k-D[3],Z.x2=Z.x2*k+D[1];const $=M.collisionPadding;if($&&(Z.x1-=$[0]*k,Z.y1-=$[1]*k,Z.x2+=$[2]*k,Z.y2+=$[3]*k),N){const Q=new K(Z.x1,Z.y1),J=new K(Z.x2,Z.y1),oe=new K(Z.x1,Z.y2),fe=new K(Z.x2,Z.y2),Ae=N*Math.PI/180;Q._rotate(Ae),J._rotate(Ae),oe._rotate(Ae),fe._rotate(Ae),Z.x1=Math.min(Q.x,J.x,oe.x,fe.x),Z.x2=Math.max(Q.x,J.x,oe.x,fe.x),Z.y1=Math.min(Q.y,J.y,oe.y,fe.y),Z.y2=Math.max(Q.y,J.y,oe.y,fe.y)}r.emplaceBack(h.x,h.y,Z.x1,Z.y1,Z.x2,Z.y2,m,b,T)}this.boxEndIndex=r.length}}class wb{constructor(r=[],h=(m,b)=>m<b?-1:m>b?1:0){if(this.data=r,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:h,compare:m}=this,b=h[r];for(;r>0;){const T=r-1>>1,M=h[T];if(m(b,M)>=0)break;h[r]=M,r=T}h[r]=b}_down(r){const{data:h,compare:m}=this,b=this.length>>1,T=h[r];for(;r<b;){let M=1+(r<<1);const k=M+1;if(k<this.length&&m(h[k],h[M])<0&&(M=k),m(h[M],T)>=0)break;h[r]=h[M],r=M}h[r]=T}}function p_(u,r=1,h=!1){let m=1/0,b=1/0,T=-1/0,M=-1/0;const k=u[0];for(let $=0;$<k.length;$++){const Q=k[$];(!$||Q.x<m)&&(m=Q.x),(!$||Q.y<b)&&(b=Q.y),(!$||Q.x>T)&&(T=Q.x),(!$||Q.y>M)&&(M=Q.y)}const D=Math.min(T-m,M-b);let z=D/2;const N=new wb([],Sb);if(D===0)return new K(m,b);for(let $=m;$<T;$+=D)for(let Q=b;Q<M;Q+=D)N.push(new Xu($+z,Q+z,z,u));let U=function($){let Q=0,J=0,oe=0;const fe=$[0];for(let Ae=0,pe=fe.length,G=pe-1;Ae<pe;G=Ae++){const re=fe[Ae],ye=fe[G],Ue=re.x*ye.y-ye.x*re.y;J+=(re.x+ye.x)*Ue,oe+=(re.y+ye.y)*Ue,Q+=3*Ue}return new Xu(J/Q,oe/Q,0,$)}(u),Z=N.length;for(;N.length;){const $=N.pop();($.d>U.d||!U.d)&&(U=$,h&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,Z)),$.max-U.d<=r||(z=$.h/2,N.push(new Xu($.p.x-z,$.p.y-z,z,u)),N.push(new Xu($.p.x+z,$.p.y-z,z,u)),N.push(new Xu($.p.x-z,$.p.y+z,z,u)),N.push(new Xu($.p.x+z,$.p.y+z,z,u)),Z+=4)}return h&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${U.d}`)),U.p}function Sb(u,r){return r.max-u.max}function Xu(u,r,h,m){this.p=new K(u,r),this.h=h,this.d=function(b,T){let M=!1,k=1/0;for(let D=0;D<T.length;D++){const z=T[D];for(let N=0,U=z.length,Z=U-1;N<U;Z=N++){const $=z[N],Q=z[Z];$.y>b.y!=Q.y>b.y&&b.x<(Q.x-$.x)*(b.y-$.y)/(Q.y-$.y)+$.x&&(M=!M),k=Math.min(k,us(b,$,Q))}}return(M?1:-1)*Math.sqrt(k)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var js;d.aB=void 0,(js=d.aB||(d.aB={}))[js.center=1]="center",js[js.left=2]="left",js[js.right=3]="right",js[js.top=4]="top",js[js.bottom=5]="bottom",js[js["top-left"]=6]="top-left",js[js["top-right"]=7]="top-right",js[js["bottom-left"]=8]="bottom-left",js[js["bottom-right"]=9]="bottom-right";const Ic=7,il=Number.POSITIVE_INFINITY;function Pg(u,r){return r[1]!==il?function(h,m,b){let T=0,M=0;switch(m=Math.abs(m),b=Math.abs(b),h){case"top-right":case"top-left":case"top":M=b-Ic;break;case"bottom-right":case"bottom-left":case"bottom":M=-b+Ic}switch(h){case"top-right":case"bottom-right":case"right":T=-m;break;case"top-left":case"bottom-left":case"left":T=m}return[T,M]}(u,r[0],r[1]):function(h,m){let b=0,T=0;m<0&&(m=0);const M=m/Math.SQRT2;switch(h){case"top-right":case"top-left":T=M-Ic;break;case"bottom-right":case"bottom-left":T=-M+Ic;break;case"bottom":T=-m+Ic;break;case"top":T=m-Ic}switch(h){case"top-right":case"bottom-right":b=-M;break;case"top-left":case"bottom-left":b=M;break;case"left":b=m;break;case"right":b=-m}return[b,T]}(u,r[0])}function qp(u,r,h){var m;const b=u.layout,T=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(r,{},h);if(T){const k=T.values,D=[];for(let z=0;z<k.length;z+=2){const N=D[z]=k[z],U=k[z+1].map(Z=>Z*Ln);N.startsWith("top")?U[1]-=Ic:N.startsWith("bottom")&&(U[1]+=Ic),D[z+1]=U}return new es(D)}const M=b.get("text-variable-anchor");if(M){let k;k=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(r,{},h)*Ln,il]:b.get("text-offset").evaluate(r,{},h).map(z=>z*Ln);const D=[];for(const z of M)D.push(z,Pg(z,k));return new es(D)}return null}function Og(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Tb(u,r,h,m,b,T,M,k,D,z,N,U){let Z=T.textMaxSize.evaluate(r,{});Z===void 0&&(Z=M);const $=u.layers[0].layout,Q=$.get("icon-offset").evaluate(r,{},N),J=m_(h.horizontal),oe=M/24,fe=u.tilePixelRatio*oe,Ae=u.tilePixelRatio*Z/24,pe=u.tilePixelRatio*k,G=u.tilePixelRatio*$.get("symbol-spacing"),re=$.get("text-padding")*u.tilePixelRatio,ye=function(Kt,$t,Lt,gi=1){const xn=Kt.get("icon-padding").evaluate($t,{},Lt),On=xn&&xn.values;return[On[0]*gi,On[1]*gi,On[2]*gi,On[3]*gi]}($,r,N,u.tilePixelRatio),Ue=$.get("text-max-angle")/180*Math.PI,ut=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Ge=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Je=$.get("symbol-placement"),mt=G/2,ft=$.get("icon-text-fit");let bt;m&&ft!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(bt=_g(m,h.vertical,ft,$.get("icon-text-fit-padding"),Q,oe)),J&&(m=_g(m,J,ft,$.get("icon-text-fit-padding"),Q,oe)));const nt=N?U.line.getGranularityForZoomLevel(N.z):1,Pt=(Kt,$t)=>{$t.x<0||$t.x>=_t||$t.y<0||$t.y>=_t||function(Lt,gi,xn,On,Vs,ho,Ys,is,sn,Xn,fs,ns,Bn,ds,dn,Cs,Mn,pn,ps,Nn,Fi,ma,Qu,Hr,g_){const sf=Lt.addToLineVertexArray(gi,xn);let nl,Kl,Wu,sl,Kp=0,Pd=0,Rg=0,y_=0,rf=-1,l=-1;const p={};let y=Ns("");if(Lt.allowVerticalPlacement&&On.vertical){const Ee=is.layout.get("text-rotate").evaluate(Fi,{},Hr)+90;Wu=new tf(sn,gi,Xn,fs,ns,On.vertical,Bn,ds,dn,Ee),Ys&&(sl=new tf(sn,gi,Xn,fs,ns,Ys,Mn,pn,dn,Ee))}if(Vs){const Ee=is.layout.get("icon-rotate").evaluate(Fi,{}),Le=is.layout.get("icon-text-fit")!=="none",lt=Up(Vs,Ee,Qu,Le),It=Ys?Up(Ys,Ee,Qu,Le):void 0;Kl=new tf(sn,gi,Xn,fs,ns,Vs,Mn,pn,!1,Ee),Kp=4*lt.length;const mi=Lt.iconSizeData;let Ht=null;mi.kind==="source"?(Ht=[fa*is.layout.get("icon-size").evaluate(Fi,{})],Ht[0]>Xl&&gs(`${Lt.layerIds[0]}: Value for "icon-size" is >= ${Qh}. Reduce your "icon-size".`)):mi.kind==="composite"&&(Ht=[fa*ma.compositeIconSizes[0].evaluate(Fi,{},Hr),fa*ma.compositeIconSizes[1].evaluate(Fi,{},Hr)],(Ht[0]>Xl||Ht[1]>Xl)&&gs(`${Lt.layerIds[0]}: Value for "icon-size" is >= ${Qh}. Reduce your "icon-size".`)),Lt.addSymbols(Lt.icon,lt,Ht,Nn,ps,Fi,d.al.none,gi,sf.lineStartIndex,sf.lineLength,-1,Hr),rf=Lt.icon.placedSymbolArray.length-1,It&&(Pd=4*It.length,Lt.addSymbols(Lt.icon,It,Ht,Nn,ps,Fi,d.al.vertical,gi,sf.lineStartIndex,sf.lineLength,-1,Hr),l=Lt.icon.placedSymbolArray.length-1)}const w=Object.keys(On.horizontal);for(const Ee of w){const Le=On.horizontal[Ee];if(!nl){y=Ns(Le.text);const It=is.layout.get("text-rotate").evaluate(Fi,{},Hr);nl=new tf(sn,gi,Xn,fs,ns,Le,Bn,ds,dn,It)}const lt=Le.positionedLines.length===1;if(Rg+=Hp(Lt,gi,Le,ho,is,dn,Fi,Cs,sf,On.vertical?d.al.horizontal:d.al.horizontalOnly,lt?w:[Ee],p,rf,ma,Hr),lt)break}On.vertical&&(y_+=Hp(Lt,gi,On.vertical,ho,is,dn,Fi,Cs,sf,d.al.vertical,["vertical"],p,l,ma,Hr));const E=nl?nl.boxStartIndex:Lt.collisionBoxArray.length,I=nl?nl.boxEndIndex:Lt.collisionBoxArray.length,X=Wu?Wu.boxStartIndex:Lt.collisionBoxArray.length,ie=Wu?Wu.boxEndIndex:Lt.collisionBoxArray.length,we=Kl?Kl.boxStartIndex:Lt.collisionBoxArray.length,$e=Kl?Kl.boxEndIndex:Lt.collisionBoxArray.length,ct=sl?sl.boxStartIndex:Lt.collisionBoxArray.length,pt=sl?sl.boxEndIndex:Lt.collisionBoxArray.length;let Ze=-1;const Ke=(Ee,Le)=>Ee&&Ee.circleDiameter?Math.max(Ee.circleDiameter,Le):Le;Ze=Ke(nl,Ze),Ze=Ke(Wu,Ze),Ze=Ke(Kl,Ze),Ze=Ke(sl,Ze);const oi=Ze>-1?1:0;oi&&(Ze*=g_/Ln),Lt.glyphOffsetArray.length>=Kh.MAX_GLYPHS&&gs("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&Lt.addToSortKeyRanges(Lt.symbolInstances.length,Fi.sortKey);const si=qp(is,Fi,Hr),[hn,Ie]=function(Ee,Le){const lt=Ee.length,It=Le==null?void 0:Le.values;if((It==null?void 0:It.length)>0)for(let mi=0;mi<It.length;mi+=2){const Ht=It[mi+1];Ee.emplaceBack(d.aB[It[mi]],Ht[0],Ht[1])}return[lt,Ee.length]}(Lt.textAnchorOffsets,si);Lt.symbolInstances.emplaceBack(gi.x,gi.y,p.right>=0?p.right:-1,p.center>=0?p.center:-1,p.left>=0?p.left:-1,p.vertical||-1,rf,l,y,E,I,X,ie,we,$e,ct,pt,Xn,Rg,y_,Kp,Pd,oi,0,Bn,Ze,hn,Ie)}(u,$t,Kt,h,m,b,bt,u.layers[0],u.collisionBoxArray,r.index,r.sourceLayerIndex,u.index,fe,[re,re,re,re],ut,D,pe,ye,Ge,Q,r,T,z,N,M)};if(Je==="line")for(const Kt of f_(r.geometry,0,0,_t,_t)){const $t=Hl(Kt,nt),Lt=Ks($t,G,Ue,h.vertical||J,m,24,Ae,u.overscaling,_t);for(const gi of Lt)J&&da(u,J.text,mt,gi)||Pt($t,gi)}else if(Je==="line-center"){for(const Kt of r.geometry)if(Kt.length>1){const $t=Hl(Kt,nt),Lt=kg($t,Ue,h.vertical||J,m,24,Ae);Lt&&Pt($t,Lt)}}else if(r.type==="Polygon")for(const Kt of gh(r.geometry,0)){const $t=p_(Kt,16);Pt(Hl(Kt[0],nt,!0),new Rc($t.x,$t.y,0))}else if(r.type==="LineString")for(const Kt of r.geometry){const $t=Hl(Kt,nt);Pt($t,new Rc($t[0].x,$t[0].y,0))}else if(r.type==="Point")for(const Kt of r.geometry)for(const $t of Kt)Pt([$t],new Rc($t.x,$t.y,0))}function Hp(u,r,h,m,b,T,M,k,D,z,N,U,Z,$,Q){const J=function(Ae,pe,G,re,ye,Ue,ut,Ge){const Je=re.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,mt=[];for(const ft of pe.positionedLines)for(const bt of ft.positionedGlyphs){if(!bt.rect)continue;const nt=bt.rect||{};let Pt=pg+1,Kt=!0,$t=1,Lt=0;const gi=(ye||Ge)&&bt.vertical,xn=bt.metrics.advance*bt.scale/2;if(Ge&&pe.verticalizable&&(Lt=ft.lineOffset/2-(bt.imageName?-(Ln-bt.metrics.width*bt.scale)/2:(bt.scale-1)*Ln)),bt.imageName){const pn=ut[bt.imageName];Kt=pn.sdf,$t=pn.pixelRatio,Pt=mr/$t}const On=ye?[bt.x+xn,bt.y]:[0,0];let Vs=ye?[0,0]:[bt.x+xn+G[0],bt.y+G[1]-Lt],ho=[0,0];gi&&(ho=Vs,Vs=[0,0]);const Ys=bt.metrics.isDoubleResolution?2:1,is=(bt.metrics.left-Pt)*bt.scale-xn+Vs[0],sn=(-bt.metrics.top-Pt)*bt.scale+Vs[1],Xn=is+nt.w/Ys*bt.scale/$t,fs=sn+nt.h/Ys*bt.scale/$t,ns=new K(is,sn),Bn=new K(Xn,sn),ds=new K(is,fs),dn=new K(Xn,fs);if(gi){const pn=new K(-xn,xn-bd),ps=-Math.PI/2,Nn=Ln/2-xn,Fi=new K(5-bd-Nn,-(bt.imageName?Nn:0)),ma=new K(...ho);ns._rotateAround(ps,pn)._add(Fi)._add(ma),Bn._rotateAround(ps,pn)._add(Fi)._add(ma),ds._rotateAround(ps,pn)._add(Fi)._add(ma),dn._rotateAround(ps,pn)._add(Fi)._add(ma)}if(Je){const pn=Math.sin(Je),ps=Math.cos(Je),Nn=[ps,-pn,pn,ps];ns._matMult(Nn),Bn._matMult(Nn),ds._matMult(Nn),dn._matMult(Nn)}const Cs=new K(0,0),Mn=new K(0,0);mt.push({tl:ns,tr:Bn,bl:ds,br:dn,tex:nt,writingMode:pe.writingMode,glyphOffset:On,sectionIndex:bt.sectionIndex,isSDF:Kt,pixelOffsetTL:Cs,pixelOffsetBR:Mn,minFontScaleX:0,minFontScaleY:0})}return mt}(0,h,k,b,T,M,m,u.allowVerticalPlacement),oe=u.textSizeData;let fe=null;oe.kind==="source"?(fe=[fa*b.layout.get("text-size").evaluate(M,{})],fe[0]>Xl&&gs(`${u.layerIds[0]}: Value for "text-size" is >= ${Qh}. Reduce your "text-size".`)):oe.kind==="composite"&&(fe=[fa*$.compositeTextSizes[0].evaluate(M,{},Q),fa*$.compositeTextSizes[1].evaluate(M,{},Q)],(fe[0]>Xl||fe[1]>Xl)&&gs(`${u.layerIds[0]}: Value for "text-size" is >= ${Qh}. Reduce your "text-size".`)),u.addSymbols(u.text,J,fe,k,T,M,z,r,D.lineStartIndex,D.lineLength,Z,Q);for(const Ae of N)U[Ae]=u.text.placedSymbolArray.length-1;return 4*J.length}function m_(u){for(const r in u)return u[r];return null}function da(u,r,h,m){const b=u.compareText;if(r in b){const T=b[r];for(let M=T.length-1;M>=0;M--)if(m.dist(T[M])<h)return!0}else b[r]=[];return b[r].push(m),!1}const Zp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gp{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(r,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const T=Zp[15&m];if(!T)throw new Error("Unrecognized array type.");const[M]=new Uint16Array(r,2,1),[k]=new Uint32Array(r,4,1);return new Gp(k,M,T,r)}constructor(r,h=64,m=Float64Array,b){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const T=Zp.indexOf(this.ArrayType),M=2*r*this.ArrayType.BYTES_PER_ELEMENT,k=r*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-k%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+k+D,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+M+k+D),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+k+D,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=r)}add(r,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=r,this.coords[this._pos++]=h,m}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return $p(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,h,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:M,nodeSize:k}=this,D=[0,T.length-1,0],z=[];for(;D.length;){const N=D.pop()||0,U=D.pop()||0,Z=D.pop()||0;if(U-Z<=k){for(let oe=Z;oe<=U;oe++){const fe=M[2*oe],Ae=M[2*oe+1];fe>=r&&fe<=m&&Ae>=h&&Ae<=b&&z.push(T[oe])}continue}const $=Z+U>>1,Q=M[2*$],J=M[2*$+1];Q>=r&&Q<=m&&J>=h&&J<=b&&z.push(T[$]),(N===0?r<=Q:h<=J)&&(D.push(Z),D.push($-1),D.push(1-N)),(N===0?m>=Q:b>=J)&&(D.push($+1),D.push(U),D.push(1-N))}return z}within(r,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:T,nodeSize:M}=this,k=[0,b.length-1,0],D=[],z=m*m;for(;k.length;){const N=k.pop()||0,U=k.pop()||0,Z=k.pop()||0;if(U-Z<=M){for(let oe=Z;oe<=U;oe++)kd(T[2*oe],T[2*oe+1],r,h)<=z&&D.push(b[oe]);continue}const $=Z+U>>1,Q=T[2*$],J=T[2*$+1];kd(Q,J,r,h)<=z&&D.push(b[$]),(N===0?r-m<=Q:h-m<=J)&&(k.push(Z),k.push($-1),k.push(1-N)),(N===0?r+m>=Q:h+m>=J)&&(k.push($+1),k.push(U),k.push(1-N))}return D}}function $p(u,r,h,m,b,T){if(b-m<=h)return;const M=m+b>>1;nf(u,r,M,m,b,T),$p(u,r,h,m,M-1,1-T),$p(u,r,h,M+1,b,1-T)}function nf(u,r,h,m,b,T){for(;b>m;){if(b-m>600){const z=b-m+1,N=h-m+1,U=Math.log(z),Z=.5*Math.exp(2*U/3),$=.5*Math.sqrt(U*Z*(z-Z)/z)*(N-z/2<0?-1:1);nf(u,r,h,Math.max(m,Math.floor(h-N*Z/z+$)),Math.min(b,Math.floor(h+(z-N)*Z/z+$)),T)}const M=r[2*h+T];let k=m,D=b;for(gr(u,r,m,h),r[2*b+T]>M&&gr(u,r,m,b);k<D;){for(gr(u,r,k,D),k++,D--;r[2*k+T]<M;)k++;for(;r[2*D+T]>M;)D--}r[2*m+T]===M?gr(u,r,m,D):(D++,gr(u,r,D,b)),D<=h&&(m=D+1),h<=D&&(b=D-1)}}function gr(u,r,h,m){Xp(u,h,m),Xp(r,2*h,2*m),Xp(r,2*h+1,2*m+1)}function Xp(u,r,h){const m=u[r];u[r]=u[h],u[h]=m}function kd(u,r,h,m){const b=u-h,T=r-m;return b*b+T*T}var pa;d.cm=void 0,(pa=d.cm||(d.cm={})).create="create",pa.load="load",pa.fullLoad="fullLoad";let Qp=null,Ed=[];const zc=1e3/60,Wp="loadTime",Dg="fullLoadTime",Mb={mark(u){performance.mark(u)},frame(u){const r=u;Qp!=null&&Ed.push(r-Qp),Qp=r},clearMetrics(){Qp=null,Ed=[],performance.clearMeasures(Wp),performance.clearMeasures(Dg);for(const u in d.cm)performance.clearMarks(d.cm[u])},getPerformanceMetrics(){performance.measure(Wp,d.cm.create,d.cm.load),performance.measure(Dg,d.cm.create,d.cm.fullLoad);const u=performance.getEntriesByName(Wp)[0].duration,r=performance.getEntriesByName(Dg)[0].duration,h=Ed.length,m=1/(Ed.reduce((T,M)=>T+M,0)/h/1e3),b=Ed.filter(T=>T>zc).reduce((T,M)=>T+(M-zc)/zc,0);return{loadTime:u,fullLoadTime:r,fps:m,percentDroppedFrames:b/(h+b)*100,totalFrames:h}}};d.$=Ql,d.A=Se,d.B=Ki,d.C=Hi,d.D=jt,d.E=ge,d.F=Jf,d.G=function(u){if(wa==null){const r=u.navigator?u.navigator.userAgent:null;wa=!!u.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return wa},d.H=class{constructor(u,r){this.target=u,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new o_(()=>this.process()),this.subscription=pl(this.target,"message",h=>this.receive(h),!1),this.globalScope=yo(self)?u:window}registerMessageHandler(u,r){this.messageHandlers[u]=r}sendAsync(u,r){return new Promise((h,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10),T=r?pl(r.signal,"abort",()=>{T==null||T.unsubscribe(),delete this.resolveRejects[b];const D={id:b,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(D)},a_):null;this.resolveRejects[b]={resolve:D=>{T==null||T.unsubscribe(),h(D)},reject:D=>{T==null||T.unsubscribe(),m(D)}};const M=[],k=Object.assign(Object.assign({},u),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Su(u.data,M)});this.target.postMessage(k,{transfer:M})})}receive(u){const r=u.data,h=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(yo(self)||r.mustQueue)return this.tasks[h]=r,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,r)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),r=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(u,r)}processTask(u,r){return a(this,void 0,void 0,function*(){if(r.type==="<response>"){const b=this.resolveRejects[u];return delete this.resolveRejects[u],b?void(r.error?b.reject(qa(r.error)):b.resolve(qa(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=qa(r.data),m=new AbortController;this.abortControllers[u]=m;try{const b=yield this.messageHandlers[r.type](r.sourceMapId,h,m);this.completeTask(u,null,b)}catch(b){this.completeTask(u,b)}})}completeTask(u,r,h){const m=[];delete this.abortControllers[u];const b={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?Su(r):null,data:Su(h,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.I=ju,d.J=Uo,d.K=function(){var u=new Se(16);return Se!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},d.L=function(u,r,h){var m,b,T,M,k,D,z,N,U,Z,$,Q,J=h[0],oe=h[1],fe=h[2];return r===u?(u[12]=r[0]*J+r[4]*oe+r[8]*fe+r[12],u[13]=r[1]*J+r[5]*oe+r[9]*fe+r[13],u[14]=r[2]*J+r[6]*oe+r[10]*fe+r[14],u[15]=r[3]*J+r[7]*oe+r[11]*fe+r[15]):(b=r[1],T=r[2],M=r[3],k=r[4],D=r[5],z=r[6],N=r[7],U=r[8],Z=r[9],$=r[10],Q=r[11],u[0]=m=r[0],u[1]=b,u[2]=T,u[3]=M,u[4]=k,u[5]=D,u[6]=z,u[7]=N,u[8]=U,u[9]=Z,u[10]=$,u[11]=Q,u[12]=m*J+k*oe+U*fe+r[12],u[13]=b*J+D*oe+Z*fe+r[13],u[14]=T*J+z*oe+$*fe+r[14],u[15]=M*J+N*oe+Q*fe+r[15]),u},d.M=function(u,r,h){var m=h[0],b=h[1],T=h[2];return u[0]=r[0]*m,u[1]=r[1]*m,u[2]=r[2]*m,u[3]=r[3]*m,u[4]=r[4]*b,u[5]=r[5]*b,u[6]=r[6]*b,u[7]=r[7]*b,u[8]=r[8]*T,u[9]=r[9]*T,u[10]=r[10]*T,u[11]=r[11]*T,u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15],u},d.N=function(u,r,h){var m=r[0],b=r[1],T=r[2],M=r[3],k=r[4],D=r[5],z=r[6],N=r[7],U=r[8],Z=r[9],$=r[10],Q=r[11],J=r[12],oe=r[13],fe=r[14],Ae=r[15],pe=h[0],G=h[1],re=h[2],ye=h[3];return u[0]=pe*m+G*k+re*U+ye*J,u[1]=pe*b+G*D+re*Z+ye*oe,u[2]=pe*T+G*z+re*$+ye*fe,u[3]=pe*M+G*N+re*Q+ye*Ae,u[4]=(pe=h[4])*m+(G=h[5])*k+(re=h[6])*U+(ye=h[7])*J,u[5]=pe*b+G*D+re*Z+ye*oe,u[6]=pe*T+G*z+re*$+ye*fe,u[7]=pe*M+G*N+re*Q+ye*Ae,u[8]=(pe=h[8])*m+(G=h[9])*k+(re=h[10])*U+(ye=h[11])*J,u[9]=pe*b+G*D+re*Z+ye*oe,u[10]=pe*T+G*z+re*$+ye*fe,u[11]=pe*M+G*N+re*Q+ye*Ae,u[12]=(pe=h[12])*m+(G=h[13])*k+(re=h[14])*U+(ye=h[15])*J,u[13]=pe*b+G*D+re*Z+ye*oe,u[14]=pe*T+G*z+re*$+ye*fe,u[15]=pe*M+G*N+re*Q+ye*Ae,u},d.O=function(u,r){const h={};for(let m=0;m<r.length;m++){const b=r[m];b in u&&(h[b]=u[b])}return h},d.P=K,d.Q=tl,d.R=en,d.S=Bp,d.T=Eo,d.U=l_,d.V=je,d.W=ze,d.X=sc,d.Y=Er,d.Z=_t,d._=a,d.a=ys,d.a$=function(u,r,h){var m=Math.sin(h),b=Math.cos(h),T=r[4],M=r[5],k=r[6],D=r[7],z=r[8],N=r[9],U=r[10],Z=r[11];return r!==u&&(u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[4]=T*b+z*m,u[5]=M*b+N*m,u[6]=k*b+U*m,u[7]=D*b+Z*m,u[8]=z*b-T*m,u[9]=N*b-M*m,u[10]=U*b-k*m,u[11]=Z*b-D*m,u},d.a0=25,d.a1=Fp,d.a2=u=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(h=>{r.onloadstart=()=>{h(r)};for(const m of u){const b=window.document.createElement("source");Lr(m)||(r.crossOrigin="Anonymous"),b.src=m,r.appendChild(b)}})},d.a3=We,d.a4=function(){return Ni++},d.a5=O,d.a6=Kh,d.a7=Fa,d.a8=uo,d.a9=Vp,d.aA=function(u,r,h,m,b=!1){if(!h[0]&&!h[1])return[0,0];const T=b?m==="map"?-u.bearingInRadians:0:m==="viewport"?u.bearingInRadians:0;if(T){const M=Math.sin(T),k=Math.cos(T);h=[h[0]*k-h[1]*M,h[0]*M+h[1]*k]}return[b?h[0]:qt(r,h[0],u.zoom),b?h[1]:qt(r,h[1],u.zoom)]},d.aC=Wh,d.aD=Og,d.aE=wd,d.aF=Gp,d.aG=_n,d.aH=Ac,d.aI=de,d.aJ=ii,d.aK=vt,d.aL=Nt,d.aM=Kr,d.aN=c_,d.aO=function(u,r,h){return u[0]=r[0]*h,u[1]=r[1]*h,u[2]=r[2]*h,u},d.aP=function(u,r,h){return u[0]=r[0]+h[0],u[1]=r[1]+h[1],u[2]=r[2]+h[2],u},d.aQ=function(u){var r=new Se(3);return r[0]=u[0],r[1]=u[1],r[2]=u[2],r},d.aR=function(u,r,h){return u[0]=r[0]*h[0],u[1]=r[1]*h[1],u[2]=r[2]*h[2],u[3]=r[3]*h[3],u},d.aS=function(u,r,h){return u[0]=r[0]-h[0],u[1]=r[1]-h[1],u[2]=r[2]-h[2],u},d.aT=function(u,r){var h=r[0],m=r[1],b=r[2],T=h*h+m*m+b*b;return T>0&&(T=1/Math.sqrt(T)),u[0]=r[0]*T,u[1]=r[1]*T,u[2]=r[2]*T,u},d.aU=function(u,r,h){var m=r[0],b=r[1],T=r[2],M=h[0],k=h[1],D=h[2];return u[0]=b*D-T*k,u[1]=T*M-m*D,u[2]=m*k-b*M,u},d.aV=function(u,r){return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]},d.aW=Ci,d.aX=Wl,d.aY=function(u,r,h,m,b){var T,M=1/Math.tan(r/2);return u[0]=M/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=M,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,b!=null&&b!==1/0?(u[10]=(b+m)*(T=1/(m-b)),u[14]=2*b*m*T):(u[10]=-1,u[14]=-2*m),u},d.aZ=function(u){var r=new Se(16);return r[0]=u[0],r[1]=u[1],r[2]=u[2],r[3]=u[3],r[4]=u[4],r[5]=u[5],r[6]=u[6],r[7]=u[7],r[8]=u[8],r[9]=u[9],r[10]=u[10],r[11]=u[11],r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15],r},d.a_=function(u,r,h){var m=Math.sin(h),b=Math.cos(h),T=r[0],M=r[1],k=r[2],D=r[3],z=r[4],N=r[5],U=r[6],Z=r[7];return r!==u&&(u[8]=r[8],u[9]=r[9],u[10]=r[10],u[11]=r[11],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[0]=T*b+z*m,u[1]=M*b+N*m,u[2]=k*b+U*m,u[3]=D*b+Z*m,u[4]=z*b-T*m,u[5]=N*b-M*m,u[6]=U*b-k*m,u[7]=Z*b-D*m,u},d.aa=function(u){const r={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,b,T)=>{const M=b||T;return r[m]=!M||M.toLowerCase(),""}),r["max-age"]){const h=parseInt(r["max-age"],10);isNaN(h)?delete r["max-age"]:r["max-age"]=h}return r},d.ab=function(u){return u*Math.PI/180},d.ac=function(u){return Math.pow(2,u)},d.ad=He,d.ae=Jt,d.af=85.051129,d.ag=Np,d.ah=function(u){return Math.log(u)/Math.LN2},d.ai=function(u){var r=u[0],h=u[1];return r*r+h*h},d.aj=function(u,r){const h=[];for(const m in u)m in r||h.push(m);return h},d.ak=function(u,r){let h=0,m=0;if(u.kind==="constant")m=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:b,minZoom:T,maxZoom:M}=u,k=b?Jt(Is.interpolationFactor(b,r,T,M),0,1):0;u.kind==="camera"?m=Ki.number(u.minSize,u.maxSize,k):h=k}return{uSizeT:h,uSize:m}},d.am=function(u,{uSize:r,uSizeT:h},{lowerSize:m,upperSize:b}){return u.kind==="source"?m/fa:u.kind==="composite"?Ki.number(m/fa,b/fa,h):r},d.an=function(u,r){var h=r[0],m=r[1],b=r[2],T=r[3],M=r[4],k=r[5],D=r[6],z=r[7],N=r[8],U=r[9],Z=r[10],$=r[11],Q=r[12],J=r[13],oe=r[14],fe=r[15],Ae=h*k-m*M,pe=h*D-b*M,G=h*z-T*M,re=m*D-b*k,ye=m*z-T*k,Ue=b*z-T*D,ut=N*J-U*Q,Ge=N*oe-Z*Q,Je=N*fe-$*Q,mt=U*oe-Z*J,ft=U*fe-$*J,bt=Z*fe-$*oe,nt=Ae*bt-pe*ft+G*mt+re*Je-ye*Ge+Ue*ut;return nt?(u[0]=(k*bt-D*ft+z*mt)*(nt=1/nt),u[1]=(b*ft-m*bt-T*mt)*nt,u[2]=(J*Ue-oe*ye+fe*re)*nt,u[3]=(Z*ye-U*Ue-$*re)*nt,u[4]=(D*Je-M*bt-z*Ge)*nt,u[5]=(h*bt-b*Je+T*Ge)*nt,u[6]=(oe*G-Q*Ue-fe*pe)*nt,u[7]=(N*Ue-Z*G+$*pe)*nt,u[8]=(M*ft-k*Je+z*ut)*nt,u[9]=(m*Je-h*ft-T*ut)*nt,u[10]=(Q*ye-J*G+fe*Ae)*nt,u[11]=(U*G-N*ye-$*Ae)*nt,u[12]=(k*Ge-M*mt-D*ut)*nt,u[13]=(h*mt-m*Ge+b*ut)*nt,u[14]=(J*pe-Q*re-oe*Ae)*nt,u[15]=(N*re-U*pe+Z*Ae)*nt,u):null},d.ao=Xe,d.ap=function(u){return Math.hypot(u[0],u[1])},d.aq=function(u){return u[0]=0,u[1]=0,u},d.ar=function(u,r,h){return u[0]=r[0]*h,u[1]=r[1]*h,u},d.as=Sd,d.at=Ft,d.au=function(u,r,h,m){const b=r.y-u.y,T=r.x-u.x,M=m.y-h.y,k=m.x-h.x,D=M*T-k*b;if(D===0)return null;const z=(k*(u.y-h.y)-M*(u.x-h.x))/D;return new K(u.x+z*T,u.y+z*b)},d.av=f_,d.aw=Nh,d.ax=function(u){let r=1/0,h=1/0,m=-1/0,b=-1/0;for(const T of u)r=Math.min(r,T.x),h=Math.min(h,T.y),m=Math.max(m,T.x),b=Math.max(b,T.y);return[r,h,m,b]},d.ay=Ln,d.az=qt,d.b=Rn,d.b$=function(u,r){var h=u[0],m=u[1],b=u[2],T=u[3],M=u[4],k=u[5],D=u[6],z=u[7],N=u[8],U=u[9],Z=u[10],$=u[11],Q=u[12],J=u[13],oe=u[14],fe=u[15],Ae=r[0],pe=r[1],G=r[2],re=r[3],ye=r[4],Ue=r[5],ut=r[6],Ge=r[7],Je=r[8],mt=r[9],ft=r[10],bt=r[11],nt=r[12],Pt=r[13],Kt=r[14],$t=r[15];return Math.abs(h-Ae)<=ke*Math.max(1,Math.abs(h),Math.abs(Ae))&&Math.abs(m-pe)<=ke*Math.max(1,Math.abs(m),Math.abs(pe))&&Math.abs(b-G)<=ke*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(T-re)<=ke*Math.max(1,Math.abs(T),Math.abs(re))&&Math.abs(M-ye)<=ke*Math.max(1,Math.abs(M),Math.abs(ye))&&Math.abs(k-Ue)<=ke*Math.max(1,Math.abs(k),Math.abs(Ue))&&Math.abs(D-ut)<=ke*Math.max(1,Math.abs(D),Math.abs(ut))&&Math.abs(z-Ge)<=ke*Math.max(1,Math.abs(z),Math.abs(Ge))&&Math.abs(N-Je)<=ke*Math.max(1,Math.abs(N),Math.abs(Je))&&Math.abs(U-mt)<=ke*Math.max(1,Math.abs(U),Math.abs(mt))&&Math.abs(Z-ft)<=ke*Math.max(1,Math.abs(Z),Math.abs(ft))&&Math.abs($-bt)<=ke*Math.max(1,Math.abs($),Math.abs(bt))&&Math.abs(Q-nt)<=ke*Math.max(1,Math.abs(Q),Math.abs(nt))&&Math.abs(J-Pt)<=ke*Math.max(1,Math.abs(J),Math.abs(Pt))&&Math.abs(oe-Kt)<=ke*Math.max(1,Math.abs(oe),Math.abs(Kt))&&Math.abs(fe-$t)<=ke*Math.max(1,Math.abs(fe),Math.abs($t))},d.b0=function(){const u=new Float32Array(16);return He(u),u},d.b1=function(){const u=new Float64Array(16);return He(u),u},d.b2=function(){return new Float64Array(16)},d.b3=function(u,r,h){const m=new Float64Array(4);return function(b,T,M,k){var D=.5*Math.PI/180;T*=D,M*=D,k*=D;var z=Math.sin(T),N=Math.cos(T),U=Math.sin(M),Z=Math.cos(M),$=Math.sin(k),Q=Math.cos(k);b[0]=z*Z*Q-N*U*$,b[1]=N*U*Q+z*Z*$,b[2]=N*Z*$-z*U*Q,b[3]=N*Z*Q+z*U*$}(m,u,r-90,h),m},d.b4=function(u,r,h,m){var b,T,M,k,D,z=r[0],N=r[1],U=r[2],Z=r[3],$=h[0],Q=h[1],J=h[2],oe=h[3];return(T=z*$+N*Q+U*J+Z*oe)<0&&(T=-T,$=-$,Q=-Q,J=-J,oe=-oe),1-T>ke?(b=Math.acos(T),M=Math.sin(b),k=Math.sin((1-m)*b)/M,D=Math.sin(m*b)/M):(k=1-m,D=m),u[0]=k*z+D*$,u[1]=k*N+D*Q,u[2]=k*U+D*J,u[3]=k*Z+D*oe,u},d.b5=function(u){const r=new Float64Array(9);var h,m,b,T,M,k,D,z,N,U,Z,$,Q,J,oe,fe,Ae,pe;U=(b=(m=u)[0])*(D=b+b),Z=(T=m[1])*D,Q=(M=m[2])*D,J=M*(z=T+T),fe=(k=m[3])*D,Ae=k*z,pe=k*(N=M+M),(h=r)[0]=1-($=T*z)-(oe=M*N),h[3]=Z-pe,h[6]=Q+Ae,h[1]=Z+pe,h[4]=1-U-oe,h[7]=J-fe,h[2]=Q-Ae,h[5]=J+fe,h[8]=1-U-$;const G=Kr(-Math.asin(Jt(r[2],-1,1)));let re,ye;return Math.hypot(r[5],r[8])<.001?(re=0,ye=-Kr(Math.atan2(r[3],r[4]))):(re=Kr(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),ye=Kr(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:re,pitch:G+90,bearing:ye}},d.b6=function(u,r){return u.roll==r.roll&&u.pitch==r.pitch&&u.bearing==r.bearing},d.b7=hi,d.b8=Xa,d.b9=Cr,d.bA=function(u){if(u.type==="custom")return new r_(u);switch(u.type){case"background":return new el(u);case"circle":return new Ry(u);case"fill":return new Fs(u);case"fill-extrusion":return new md(u);case"heatmap":return new Ly(u);case"hillshade":return new gp(u);case"line":return new Ec(u);case"raster":return new s_(u);case"symbol":return new qu(u)}},d.bB=Es,d.bC=function(u,r){if(!u)return[{command:"setStyle",args:[r]}];let h=[];try{if(!Te(u.version,r.version))return[{command:"setStyle",args:[r]}];Te(u.center,r.center)||h.push({command:"setCenter",args:[r.center]}),Te(u.centerAltitude,r.centerAltitude)||h.push({command:"setCenterAltitude",args:[r.centerAltitude]}),Te(u.zoom,r.zoom)||h.push({command:"setZoom",args:[r.zoom]}),Te(u.bearing,r.bearing)||h.push({command:"setBearing",args:[r.bearing]}),Te(u.pitch,r.pitch)||h.push({command:"setPitch",args:[r.pitch]}),Te(u.roll,r.roll)||h.push({command:"setRoll",args:[r.roll]}),Te(u.sprite,r.sprite)||h.push({command:"setSprite",args:[r.sprite]}),Te(u.glyphs,r.glyphs)||h.push({command:"setGlyphs",args:[r.glyphs]}),Te(u.transition,r.transition)||h.push({command:"setTransition",args:[r.transition]}),Te(u.light,r.light)||h.push({command:"setLight",args:[r.light]}),Te(u.terrain,r.terrain)||h.push({command:"setTerrain",args:[r.terrain]}),Te(u.sky,r.sky)||h.push({command:"setSky",args:[r.sky]}),Te(u.projection,r.projection)||h.push({command:"setProjection",args:[r.projection]});const m={},b=[];(function(M,k,D,z){let N;for(N in k=k||{},M=M||{})Object.prototype.hasOwnProperty.call(M,N)&&(Object.prototype.hasOwnProperty.call(k,N)||Re(N,D,z));for(N in k)Object.prototype.hasOwnProperty.call(k,N)&&(Object.prototype.hasOwnProperty.call(M,N)?Te(M[N],k[N])||(M[N].type==="geojson"&&k[N].type==="geojson"&&St(M,k,N)?Qe(D,{command:"setGeoJSONSourceData",args:[N,k[N].data]}):at(N,k,D,z)):Ye(N,k,D))})(u.sources,r.sources,b,m);const T=[];u.layers&&u.layers.forEach(M=>{"source"in M&&m[M.source]?h.push({command:"removeLayer",args:[M.id]}):T.push(M)}),h=h.concat(b),function(M,k,D){k=k||[];const z=(M=M||[]).map(Vt),N=k.map(Vt),U=M.reduce(Xt,{}),Z=k.reduce(Xt,{}),$=z.slice(),Q=Object.create(null);let J,oe,fe,Ae,pe;for(let G=0,re=0;G<z.length;G++)J=z[G],Object.prototype.hasOwnProperty.call(Z,J)?re++:(Qe(D,{command:"removeLayer",args:[J]}),$.splice($.indexOf(J,re),1));for(let G=0,re=0;G<N.length;G++)J=N[N.length-1-G],$[$.length-1-G]!==J&&(Object.prototype.hasOwnProperty.call(U,J)?(Qe(D,{command:"removeLayer",args:[J]}),$.splice($.lastIndexOf(J,$.length-re),1)):re++,Ae=$[$.length-G],Qe(D,{command:"addLayer",args:[Z[J],Ae]}),$.splice($.length-G,0,J),Q[J]=!0);for(let G=0;G<N.length;G++)if(J=N[G],oe=U[J],fe=Z[J],!Q[J]&&!Te(oe,fe))if(Te(oe.source,fe.source)&&Te(oe["source-layer"],fe["source-layer"])&&Te(oe.type,fe.type)){for(pe in Ct(oe.layout,fe.layout,D,J,null,"setLayoutProperty"),Ct(oe.paint,fe.paint,D,J,null,"setPaintProperty"),Te(oe.filter,fe.filter)||Qe(D,{command:"setFilter",args:[J,fe.filter]}),Te(oe.minzoom,fe.minzoom)&&Te(oe.maxzoom,fe.maxzoom)||Qe(D,{command:"setLayerZoomRange",args:[J,fe.minzoom,fe.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Ct(oe[pe],fe[pe],D,J,pe.slice(6),"setPaintProperty"):Te(oe[pe],fe[pe])||Qe(D,{command:"setLayerProperty",args:[J,pe,fe[pe]]}));for(pe in fe)Object.prototype.hasOwnProperty.call(fe,pe)&&!Object.prototype.hasOwnProperty.call(oe,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?Ct(oe[pe],fe[pe],D,J,pe.slice(6),"setPaintProperty"):Te(oe[pe],fe[pe])||Qe(D,{command:"setLayerProperty",args:[J,pe,fe[pe]]}))}else Qe(D,{command:"removeLayer",args:[J]}),Ae=$[$.lastIndexOf(J)+1],Qe(D,{command:"addLayer",args:[fe,Ae]})}(T,r.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[r]}]}return h},d.bD=function(u){const r=[],h=u.id;return h===void 0&&r.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&r.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&r.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),r},d.bE=function u(r,h){if(Array.isArray(r)){if(!Array.isArray(h)||r.length!==h.length)return!1;for(let m=0;m<r.length;m++)if(!u(r[m],h[m]))return!1;return!0}if(typeof r=="object"&&r!==null&&h!==null){if(typeof h!="object"||Object.keys(r).length!==Object.keys(h).length)return!1;for(const m in r)if(!u(r[m],h[m]))return!1;return!0}return r===h},d.bF=ms,d.bG=dl,d.bH=class extends lo{constructor(u,r){super(u,r),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},d.bI=Tr,d.bJ=class extends lo{constructor(u,r){super(u,r),this.current=oa}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let r=1;r<16;r++)if(u[r]!==this.current[r]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},d.bK=Bl,d.bL=class extends lo{constructor(u,r){super(u,r),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},d.bM=class extends lo{constructor(u,r){super(u,r),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},d.bN=Fe,d.bO=function(u,r){var h=Math.sin(r),m=Math.cos(r);return u[0]=m,u[1]=h,u[2]=0,u[3]=-h,u[4]=m,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},d.bP=function(u,r,h){var m=r[0],b=r[1],T=r[2];return u[0]=m*h[0]+b*h[3]+T*h[6],u[1]=m*h[1]+b*h[4]+T*h[7],u[2]=m*h[2]+b*h[5]+T*h[8],u},d.bQ=function(u,r,h,m,b,T,M){var k=1/(r-h),D=1/(m-b),z=1/(T-M);return u[0]=-2*k,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*D,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*z,u[11]=0,u[12]=(r+h)*k,u[13]=(b+m)*D,u[14]=(M+T)*z,u[15]=1,u},d.bR=class extends sa{},d.bS=Bu,d.bT=class extends Ss{},d.bU=mp,d.bV=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},d.bW=Wm,d.bX=function(u,r,h){var m=r[0],b=r[1],T=r[2],M=h[3]*m+h[7]*b+h[11]*T+h[15];return u[0]=(h[0]*m+h[4]*b+h[8]*T+h[12])/(M=M||1),u[1]=(h[1]*m+h[5]*b+h[9]*T+h[13])/M,u[2]=(h[2]*m+h[6]*b+h[10]*T+h[14])/M,u},d.bY=class extends Sr{},d.bZ=class extends _{},d.b_=function(u,r){return u[0]===r[0]&&u[1]===r[1]&&u[2]===r[2]&&u[3]===r[3]&&u[4]===r[4]&&u[5]===r[5]&&u[6]===r[6]&&u[7]===r[7]&&u[8]===r[8]&&u[9]===r[9]&&u[10]===r[10]&&u[11]===r[11]&&u[12]===r[12]&&u[13]===r[13]&&u[14]===r[14]&&u[15]===r[15]},d.ba=qh,d.bb=Iu,d.bc=ot,d.bd=xt,d.be=Un,d.bf=function(u,r,h,m,b){return ot(m,b,Jt((u-r)/(h-r),0,1))},d.bg=xe,d.bh=function(){return new Float64Array(3)},d.bi=function(u,r,h,m){return u[0]=r[0]+h[0]*m,u[1]=r[1]+h[1]*m,u[2]=r[2]+h[2]*m,u},d.bj=Gt,d.bk=function(){return new Float64Array(4)},d.bl=function(u,r,h,m){var b=[],T=[];return b[0]=r[0]-h[0],b[1]=r[1]-h[1],b[2]=r[2]-h[2],T[0]=b[0]*Math.cos(m)-b[1]*Math.sin(m),T[1]=b[0]*Math.sin(m)+b[1]*Math.cos(m),T[2]=b[2],u[0]=T[0]+h[0],u[1]=T[1]+h[1],u[2]=T[2]+h[2],u},d.bm=function(u,r,h,m){var b=[],T=[];return b[0]=r[0]-h[0],b[1]=r[1]-h[1],b[2]=r[2]-h[2],T[0]=b[0],T[1]=b[1]*Math.cos(m)-b[2]*Math.sin(m),T[2]=b[1]*Math.sin(m)+b[2]*Math.cos(m),u[0]=T[0]+h[0],u[1]=T[1]+h[1],u[2]=T[2]+h[2],u},d.bn=function(u,r,h,m){var b=[],T=[];return b[0]=r[0]-h[0],b[1]=r[1]-h[1],b[2]=r[2]-h[2],T[0]=b[2]*Math.sin(m)+b[0]*Math.cos(m),T[1]=b[1],T[2]=b[2]*Math.cos(m)-b[0]*Math.sin(m),u[0]=T[0]+h[0],u[1]=T[1]+h[1],u[2]=T[2]+h[2],u},d.bo=Et,d.bp=function(u,r,h){var m=Math.sin(h),b=Math.cos(h),T=r[0],M=r[1],k=r[2],D=r[3],z=r[8],N=r[9],U=r[10],Z=r[11];return r!==u&&(u[4]=r[4],u[5]=r[5],u[6]=r[6],u[7]=r[7],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[0]=T*b-z*m,u[1]=M*b-N*m,u[2]=k*b-U*m,u[3]=D*b-Z*m,u[8]=T*m+z*b,u[9]=M*m+N*b,u[10]=k*m+U*b,u[11]=D*m+Z*b,u},d.bq=function(u,r){const h=xe(u,360),m=xe(r,360),b=m-h,T=m>h?b-360:b+360;return Math.abs(b)<Math.abs(T)?b:T},d.br=function(u){return u[0]=0,u[1]=0,u[2]=0,u},d.bs=function(u,r,h,m){const b=Math.sqrt(u*u+r*r),T=Math.sqrt(h*h+m*m);u/=b,r/=b,h/=T,m/=T;const M=Math.acos(u*h+r*m);return-r*h+u*m>0?M:-M},d.bt=function(u,r){return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]+u[3]},d.bu=xg,d.bv=function(u,r){const h=xe(u,2*Math.PI),m=xe(r,2*Math.PI);return Math.min(Math.abs(h-m),Math.abs(h-m+2*Math.PI),Math.abs(h-m-2*Math.PI))},d.bw=function(){const u={},r=ne.$version;for(const h in ne.$root){const m=ne.$root[h];if(m.required){let b=null;b=h==="version"?r:m.type==="array"?[]:{},b!=null&&(u[h]=b)}}return u},d.bx=so,d.by=bo,d.bz=function(u){u=u.slice();const r=Object.create(null);for(let h=0;h<u.length;h++)r[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Ve(u[h],r[u[h].ref]));return u},d.c=Kn,d.c0=function(u,r){return u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3],u[4]=r[4],u[5]=r[5],u[6]=r[6],u[7]=r[7],u[8]=r[8],u[9]=r[9],u[10]=r[10],u[11]=r[11],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15],u},d.c1=u=>u.type==="symbol",d.c2=u=>u.type==="circle",d.c3=u=>u.type==="heatmap",d.c4=u=>u.type==="line",d.c5=u=>u.type==="fill",d.c6=u=>u.type==="fill-extrusion",d.c7=u=>u.type==="hillshade",d.c8=u=>u.type==="raster",d.c9=u=>u.type==="background",d.cA=Zh,d.cB=Ja,d.cC=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},d.cD=function(u,r,h,m,b){return a(this,void 0,void 0,function*(){if(ze())try{return yield sc(u,r,h,m,b)}catch{}return function(T,M,k,D,z){const N=T.width,U=T.height;tr&&br||(tr=new OffscreenCanvas(N,U),br=tr.getContext("2d",{willReadFrequently:!0})),tr.width=N,tr.height=U,br.drawImage(T,0,0,N,U);const Z=br.getImageData(M,k,D,z);return br.clearRect(0,0,N,U),Z.data}(u,r,h,m,b)})},d.cE=jp,d.cF=v,d.cG=L,d.cH=qr,d.cI=_d,d.cJ=vs,d.cK=Qs,d.ca=u=>u.type==="custom",d.cb=Tt,d.cc=function(u,r,h){const m=dt(r.x-h.x,r.y-h.y),b=dt(u.x-h.x,u.y-h.y);var T,M;return Kr(Math.atan2(m[0]*b[1]-m[1]*b[0],(T=m)[0]*(M=b)[0]+T[1]*M[1]))},d.cd=Rt,d.ce=function(u,r){return rc[r]&&(u instanceof MouseEvent||u instanceof WheelEvent)},d.cf=function(u,r){return Jc[r]&&"touches"in u},d.cg=function(u){return Jc[u]||rc[u]},d.ch=function(u,r,h){var m=r[0],b=r[1];return u[0]=h[0]*m+h[4]*b+h[12],u[1]=h[1]*m+h[5]*b+h[13],u},d.ci=function(u,r){const{x:h,y:m}=Ql.fromLngLat(r);return!(u<0||u>25||m<0||m>=1||h<0||h>=1)},d.cj=function(u,r){return u[0]=r[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=r[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=r[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},d.ck=class extends Il{},d.cl=Mb,d.cn=function(u){return u.message===_o},d.co=Sa,d.cp=function(u,r){ys.REGISTERED_PROTOCOLS[u]=r},d.cq=function(u){delete ys.REGISTERED_PROTOCOLS[u]},d.cr=function(u,r){const h={};for(let b=0;b<u.length;b++){const T=r&&r[u[b].id]||To(u[b]);r&&(r[u[b].id]=T);let M=h[T];M||(M=h[T]=[]),M.push(u[b])}const m=[];for(const b in h)m.push(h[b]);return m},d.cs=At,d.ct=Mg,d.cu=Jh,d.cv=Ep,d.cw=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=_t/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const r=u.bucket.layers[0],h=r.layout,m=r._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Hi(u.bucket.zoom+1),u.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Hi(u.bucket.zoom+1),u.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Hi(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:N}=u.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Hi(z),u.canonical),m["text-size"].possiblyEvaluate(new Hi(N),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:N}=u.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Hi(z),u.canonical),m["icon-size"].possiblyEvaluate(new Hi(N),u.canonical)]}const T=h.get("text-line-height")*Ln,M=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",k=h.get("text-keep-upright"),D=h.get("text-size");for(const z of u.bucket.features){const N=h.get("text-font").evaluate(z,{},u.canonical).join(","),U=D.evaluate(z,{},u.canonical),Z=b.layoutTextSize.evaluate(z,{},u.canonical),$=b.layoutIconSize.evaluate(z,{},u.canonical),Q={horizontal:{},vertical:void 0},J=z.text;let oe,fe=[0,0];if(J){const G=J.toString(),re=h.get("text-letter-spacing").evaluate(z,{},u.canonical)*Ln,ye=td(G)?re:0,Ue=h.get("text-anchor").evaluate(z,{},u.canonical),ut=qp(r,z,u.canonical);if(!ut){const ft=h.get("text-radial-offset").evaluate(z,{},u.canonical);fe=ft?Pg(Ue,[ft*Ln,il]):h.get("text-offset").evaluate(z,{},u.canonical).map(bt=>bt*Ln)}let Ge=M?"center":h.get("text-justify").evaluate(z,{},u.canonical);const Je=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(z,{},u.canonical)*Ln:1/0,mt=()=>{u.bucket.allowVerticalPlacement&&Ol(G)&&(Q.vertical=vd(J,u.glyphMap,u.glyphPositions,u.imagePositions,N,Je,T,Ue,"left",ye,fe,d.al.vertical,!0,Z,U))};if(!M&&ut){const ft=new Set;if(Ge==="auto")for(let nt=0;nt<ut.values.length;nt+=2)ft.add(Og(ut.values[nt]));else ft.add(Ge);let bt=!1;for(const nt of ft)if(!Q.horizontal[nt])if(bt)Q.horizontal[nt]=Q.horizontal[0];else{const Pt=vd(J,u.glyphMap,u.glyphPositions,u.imagePositions,N,Je,T,"center",nt,ye,fe,d.al.horizontal,!1,Z,U);Pt&&(Q.horizontal[nt]=Pt,bt=Pt.positionedLines.length===1)}mt()}else{Ge==="auto"&&(Ge=Og(Ue));const ft=vd(J,u.glyphMap,u.glyphPositions,u.imagePositions,N,Je,T,Ue,Ge,ye,fe,d.al.horizontal,!1,Z,U);ft&&(Q.horizontal[Ge]=ft),mt(),Ol(G)&&M&&k&&(Q.vertical=vd(J,u.glyphMap,u.glyphPositions,u.imagePositions,N,Je,T,Ue,Ge,ye,fe,d.al.vertical,!1,Z,U))}}let Ae=!1;if(z.icon&&z.icon.name){const G=u.imageMap[z.icon.name];G&&(oe=Rp(u.imagePositions[z.icon.name],h.get("icon-offset").evaluate(z,{},u.canonical),h.get("icon-anchor").evaluate(z,{},u.canonical)),Ae=!!G.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Ae:u.bucket.sdfIcons!==Ae&&gs("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(G.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const pe=m_(Q.horizontal)||Q.vertical;u.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||oe)&&Tb(u.bucket,z,Q,oe,u.imageMap,b,Z,$,fe,Ae,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},d.cx=Ui,d.cy=ua,d.cz=dd,d.d=Lr,d.e=Ei,d.f=u=>a(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(r)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.g=Yn,d.h=u=>new Promise((r,h)=>{const m=new Image;m.onload=()=>{r(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Yc})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(u)],{type:"image/png"});m.src=u.byteLength?URL.createObjectURL(b):Yc}),d.i=yo,d.j=(u,r)=>_s(Ei(u,{type:"json"}),r),d.k=ae,d.l=te,d.m=_s,d.n=(u,r)=>_s(Ei(u,{type:"arrayBuffer"}),r),d.o=function(u){return new Ja(u).readFields(Pc,[])},d.p=kp,d.q=Zn,d.r=Bs,d.s=pl,d.t=cp,d.u=di,d.v=ne,d.w=gs,d.x=xc,d.y=ko,d.z=function([u,r,h]){return r+=90,r*=Math.PI/180,h*=Math.PI/180,{x:u*Math.cos(r)*Math.sin(h),y:u*Math.sin(r)*Math.sin(h),z:u*Math.cos(h)}}}),o("worker",["./shared"],function(d){class a{constructor(ee){this.keyCache={},ee&&this.replace(ee)}replace(ee){this._layerConfigs={},this._layers={},this.update(ee,[])}update(ee,te){for(const ge of ee){this._layerConfigs[ge.id]=ge;const ne=this._layers[ge.id]=d.bA(ge);ne._featureFilter=d.a7(ne.filter),this.keyCache[ge.id]&&delete this.keyCache[ge.id]}for(const ge of te)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const ae=d.cr(Object.values(this._layerConfigs),this.keyCache);for(const ge of ae){const ne=ge.map(Re=>this._layers[Re.id]),Oe=ne[0];if(Oe.visibility==="none")continue;const Ve=Oe.source||"";let Te=this.familiesBySource[Ve];Te||(Te=this.familiesBySource[Ve]={});const Qe=Oe.sourceLayer||"_geojsonTileLayer";let Ye=Te[Qe];Ye||(Ye=Te[Qe]=[]),Ye.push(ne)}}}class v{constructor(ee){const te={},ae=[];for(const Ve in ee){const Te=ee[Ve],Qe=te[Ve]={};for(const Ye in Te){const Re=Te[+Ye];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const at={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};ae.push(at),Qe[Ye]={rect:at,metrics:Re.metrics}}}const{w:ge,h:ne}=d.p(ae),Oe=new d.q({width:ge||1,height:ne||1});for(const Ve in ee){const Te=ee[Ve];for(const Qe in Te){const Ye=Te[+Qe];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Re=te[Ve][Qe].rect;d.q.copy(Ye.bitmap,Oe,{x:0,y:0},{x:Re.x+1,y:Re.y+1},Ye.bitmap)}}this.image=Oe,this.positions=te}}d.cs("GlyphAtlas",v);class A{constructor(ee){this.tileID=new d.Y(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId,this.inFlightDependencies=[]}parse(ee,te,ae,ge,ne){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=ee,this.collisionBoxArray=new d.a5;const Oe=new d.ct(Object.keys(ee.layers).sort()),Ve=new d.cu(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const Te={},Qe={featureIndex:Ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae,subdivisionGranularity:ne},Ye=te.familiesBySource[this.source];for(const st in Ye){const kt=ee.layers[st];if(!kt)continue;kt.version===1&&d.w(`Vector tile source "${this.source}" layer "${st}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qt=Oe.encode(st),Vn=[];for(let In=0;In<kt.length;In++){const Vi=kt.feature(In),ti=Ve.getId(Vi,st);Vn.push({feature:Vi,id:ti,index:In,sourceLayerIndex:Qt})}for(const In of Ye[st]){const Vi=In[0];Vi.source!==this.source&&d.w(`layer.source = ${Vi.source} does not equal this.source = ${this.source}`),Vi.minzoom&&this.zoom<Math.floor(Vi.minzoom)||Vi.maxzoom&&this.zoom>=Vi.maxzoom||Vi.visibility!=="none"&&(P(In,this.zoom,ae),(Te[Vi.id]=Vi.createBucket({index:Ve.bucketLayerIDs.length,layers:In,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qt,sourceID:this.source})).populate(Vn,Qe,this.tileID.canonical),Ve.bucketLayerIDs.push(In.map(ti=>ti.id)))}}const Re=d.bF(Qe.glyphDependencies,st=>Object.keys(st).map(Number));this.inFlightDependencies.forEach(st=>st==null?void 0:st.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(Re).length){const st=new AbortController;this.inFlightDependencies.push(st),at=ge.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},st)}const St=Object.keys(Qe.iconDependencies);let Ct=Promise.resolve({});if(St.length){const st=new AbortController;this.inFlightDependencies.push(st),Ct=ge.sendAsync({type:"GI",data:{icons:St,source:this.source,tileID:this.tileID,type:"icons"}},st)}const Vt=Object.keys(Qe.patternDependencies);let Xt=Promise.resolve({});if(Vt.length){const st=new AbortController;this.inFlightDependencies.push(st),Xt=ge.sendAsync({type:"GI",data:{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"}},st)}const[We,Wt,_i]=yield Promise.all([at,Ct,Xt]),zi=new v(We),Si=new d.cv(Wt,_i);for(const st in Te){const kt=Te[st];kt instanceof d.a6?(P(kt.layers,this.zoom,ae),d.cw({bucket:kt,glyphMap:We,glyphPositions:zi.positions,imageMap:Wt,imagePositions:Si.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Qe.subdivisionGranularity})):kt.hasPattern&&(kt instanceof d.cx||kt instanceof d.cy||kt instanceof d.cz)&&(P(kt.layers,this.zoom,ae),kt.addFeatures(Qe,this.tileID.canonical,Si.patternPositions))}return this.status="done",{buckets:Object.values(Te).filter(st=>!st.isEmpty()),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zi.image,imageAtlas:Si,glyphMap:this.returnDependencies?We:null,iconMap:this.returnDependencies?Wt:null,glyphPositions:this.returnDependencies?zi.positions:null}})}}function P(De,ee,te){const ae=new d.C(ee);for(const ge of De)ge.recalculate(ae,te)}class L{constructor(ee,te,ae){this.actor=ee,this.layerIndex=te,this.availableImages=ae,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ee,te){return d._(this,void 0,void 0,function*(){const ae=yield d.n(ee.request,te);try{return{vectorTile:new d.cA.VectorTile(new d.cB(ae.data)),rawData:ae.data,cacheControl:ae.cacheControl,expires:ae.expires}}catch(ge){const ne=new Uint8Array(ae.data);let Oe=`Unable to parse the tile at ${ee.request.url}, `;throw Oe+=ne[0]===31&&ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ge.message}`,new Error(Oe)}})}loadTile(ee){return d._(this,void 0,void 0,function*(){const te=ee.uid,ae=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new d.cC(ee.request),ge=new A(ee);this.loading[te]=ge;const ne=new AbortController;ge.abort=ne;try{const Oe=yield this.loadVectorTile(ee,ne);if(delete this.loading[te],!Oe)return null;const Ve=Oe.rawData,Te={};Oe.expires&&(Te.expires=Oe.expires),Oe.cacheControl&&(Te.cacheControl=Oe.cacheControl);const Qe={};if(ae){const Re=ae.finish();Re&&(Qe.resourceTiming=JSON.parse(JSON.stringify(Re)))}ge.vectorTile=Oe.vectorTile;const Ye=ge.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity);this.loaded[te]=ge,this.fetching[te]={rawTileData:Ve,cacheControl:Te,resourceTiming:Qe};try{const Re=yield Ye;return d.e({rawTileData:Ve.slice(0)},Re,Te,Qe)}finally{delete this.fetching[te]}}catch(Oe){throw delete this.loading[te],ge.status="done",this.loaded[te]=ge,Oe}})}reloadTile(ee){return d._(this,void 0,void 0,function*(){const te=ee.uid;if(!this.loaded||!this.loaded[te])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ae=this.loaded[te];if(ae.showCollisionBoxes=ee.showCollisionBoxes,ae.status==="parsing"){const ge=yield ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity);let ne;if(this.fetching[te]){const{rawTileData:Oe,cacheControl:Ve,resourceTiming:Te}=this.fetching[te];delete this.fetching[te],ne=d.e({rawTileData:Oe.slice(0)},ge,Ve,Te)}else ne=ge;return ne}if(ae.status==="done"&&ae.vectorTile)return ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity)})}abortTile(ee){return d._(this,void 0,void 0,function*(){const te=this.loading,ae=ee.uid;te&&te[ae]&&te[ae].abort&&(te[ae].abort.abort(),delete te[ae])})}removeTile(ee){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ee.uid]&&delete this.loaded[ee.uid]})}}class j{constructor(){this.loaded={}}loadTile(ee){return d._(this,void 0,void 0,function*(){const{uid:te,encoding:ae,rawImageData:ge,redFactor:ne,greenFactor:Oe,blueFactor:Ve,baseShift:Te}=ee,Qe=ge.width+2,Ye=ge.height+2,Re=d.b(ge)?new d.R({width:Qe,height:Ye},yield d.cD(ge,-1,-1,Qe,Ye)):ge,at=new d.cE(te,Re,ae,ne,Oe,Ve,Te);return this.loaded=this.loaded||{},this.loaded[te]=at,at})}removeTile(ee){const te=this.loaded,ae=ee.uid;te&&te[ae]&&delete te[ae]}}var F,K,se=function(){if(K)return F;function De(te,ae){if(te.length!==0){ee(te[0],ae);for(var ge=1;ge<te.length;ge++)ee(te[ge],!ae)}}function ee(te,ae){for(var ge=0,ne=0,Oe=0,Ve=te.length,Te=Ve-1;Oe<Ve;Te=Oe++){var Qe=(te[Oe][0]-te[Te][0])*(te[Te][1]+te[Oe][1]),Ye=ge+Qe;ne+=Math.abs(ge)>=Math.abs(Qe)?ge-Ye+Qe:Qe-Ye+ge,ge=Ye}ge+ne>=0!=!!ae&&te.reverse()}return K=1,F=function te(ae,ge){var ne,Oe=ae&&ae.type;if(Oe==="FeatureCollection")for(ne=0;ne<ae.features.length;ne++)te(ae.features[ne],ge);else if(Oe==="GeometryCollection")for(ne=0;ne<ae.geometries.length;ne++)te(ae.geometries[ne],ge);else if(Oe==="Feature")te(ae.geometry,ge);else if(Oe==="Polygon")De(ae.coordinates,ge);else if(Oe==="MultiPolygon")for(ne=0;ne<ae.coordinates.length;ne++)De(ae.coordinates[ne],ge);return ae}}(),le=d.cF(se);const ve=d.cA.VectorTileFeature.prototype.toGeoJSON;class Be{constructor(ee){this._feature=ee,this.extent=d.Z,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const te of this._feature.geometry)ee.push([new d.P(te[0],te[1])]);return ee}{const ee=[];for(const te of this._feature.geometry){const ae=[];for(const ge of te)ae.push(new d.P(ge[0],ge[1]));ee.push(ae)}return ee}}toGeoJSON(ee,te,ae){return ve.call(this,ee,te,ae)}}class je{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.Z,this.length=ee.length,this._features=ee}feature(ee){return new Be(this._features[ee])}}var ze,ke,Se,Fe={exports:{}},He=function(){if(Se)return Fe.exports;Se=1;var De=d.cI(),ee=function(){if(ke)return ze;ke=1;var Ye=d.cG(),Re=d.cH().VectorTileFeature;function at(Ct,Vt){this.options=Vt||{},this.features=Ct,this.length=Ct.length}function St(Ct,Vt){this.id=typeof Ct.id=="number"?Ct.id:void 0,this.type=Ct.type,this.rawGeometry=Ct.type===1?[Ct.geometry]:Ct.geometry,this.properties=Ct.tags,this.extent=Vt||4096}return ze=at,at.prototype.feature=function(Ct){return new St(this.features[Ct],this.options.extent)},St.prototype.loadGeometry=function(){var Ct=this.rawGeometry;this.geometry=[];for(var Vt=0;Vt<Ct.length;Vt++){for(var Xt=Ct[Vt],We=[],Wt=0;Wt<Xt.length;Wt++)We.push(new Ye(Xt[Wt][0],Xt[Wt][1]));this.geometry.push(We)}return this.geometry},St.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ct=this.geometry,Vt=1/0,Xt=-1/0,We=1/0,Wt=-1/0,_i=0;_i<Ct.length;_i++)for(var zi=Ct[_i],Si=0;Si<zi.length;Si++){var st=zi[Si];Vt=Math.min(Vt,st.x),Xt=Math.max(Xt,st.x),We=Math.min(We,st.y),Wt=Math.max(Wt,st.y)}return[Vt,We,Xt,Wt]},St.prototype.toGeoJSON=Re.prototype.toGeoJSON,ze}();function te(Ye){var Re=new De;return function(at,St){for(var Ct in at.layers)St.writeMessage(3,ae,at.layers[Ct])}(Ye,Re),Re.finish()}function ae(Ye,Re){var at;Re.writeVarintField(15,Ye.version||1),Re.writeStringField(1,Ye.name||""),Re.writeVarintField(5,Ye.extent||4096);var St={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<Ye.length;at++)St.feature=Ye.feature(at),Re.writeMessage(2,ge,St);var Ct=St.keys;for(at=0;at<Ct.length;at++)Re.writeStringField(3,Ct[at]);var Vt=St.values;for(at=0;at<Vt.length;at++)Re.writeMessage(4,Qe,Vt[at])}function ge(Ye,Re){var at=Ye.feature;at.id!==void 0&&Re.writeVarintField(1,at.id),Re.writeMessage(2,ne,Ye),Re.writeVarintField(3,at.type),Re.writeMessage(4,Te,at)}function ne(Ye,Re){var at=Ye.feature,St=Ye.keys,Ct=Ye.values,Vt=Ye.keycache,Xt=Ye.valuecache;for(var We in at.properties){var Wt=at.properties[We],_i=Vt[We];if(Wt!==null){_i===void 0&&(St.push(We),Vt[We]=_i=St.length-1),Re.writeVarint(_i);var zi=typeof Wt;zi!=="string"&&zi!=="boolean"&&zi!=="number"&&(Wt=JSON.stringify(Wt));var Si=zi+":"+Wt,st=Xt[Si];st===void 0&&(Ct.push(Wt),Xt[Si]=st=Ct.length-1),Re.writeVarint(st)}}}function Oe(Ye,Re){return(Re<<3)+(7&Ye)}function Ve(Ye){return Ye<<1^Ye>>31}function Te(Ye,Re){for(var at=Ye.loadGeometry(),St=Ye.type,Ct=0,Vt=0,Xt=at.length,We=0;We<Xt;We++){var Wt=at[We],_i=1;St===1&&(_i=Wt.length),Re.writeVarint(Oe(1,_i));for(var zi=St===3?Wt.length-1:Wt.length,Si=0;Si<zi;Si++){Si===1&&St!==1&&Re.writeVarint(Oe(2,zi-1));var st=Wt[Si].x-Ct,kt=Wt[Si].y-Vt;Re.writeVarint(Ve(st)),Re.writeVarint(Ve(kt)),Ct+=st,Vt+=kt}St===3&&Re.writeVarint(Oe(7,1))}}function Qe(Ye,Re){var at=typeof Ye;at==="string"?Re.writeStringField(1,Ye):at==="boolean"?Re.writeBooleanField(7,Ye):at==="number"&&(Ye%1!=0?Re.writeDoubleField(3,Ye):Ye<0?Re.writeSVarintField(6,Ye):Re.writeVarintField(5,Ye))}return Fe.exports=te,Fe.exports.fromVectorTileJs=te,Fe.exports.fromGeojsonVt=function(Ye,Re){Re=Re||{};var at={};for(var St in Ye)at[St]=new ee(Ye[St].features,Re),at[St].name=St,at[St].version=Re.version,at[St].extent=Re.extent;return te({layers:at})},Fe.exports.GeoJSONWrapper=ee,Fe.exports}(),gt=d.cF(He);const Et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},Mt=Math.fround||(ht=new Float32Array(1),De=>(ht[0]=+De,ht[0]));var ht;const Gt=3,Ft=5,ei=6;class Xe{constructor(ee){this.options=Object.assign(Object.create(Et),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:te,minZoom:ae,maxZoom:ge}=this.options;te&&console.time("total time");const ne=`prepare ${ee.length} points`;te&&console.time(ne),this.points=ee;const Oe=[];for(let Te=0;Te<ee.length;Te++){const Qe=ee[Te];if(!Qe.geometry)continue;const[Ye,Re]=Qe.geometry.coordinates,at=Mt(qt(Ye)),St=Mt(xe(Re));Oe.push(at,St,1/0,Te,-1,1),this.options.reduce&&Oe.push(0)}let Ve=this.trees[ge+1]=this._createTree(Oe);te&&console.timeEnd(ne);for(let Te=ge;Te>=ae;Te--){const Qe=+Date.now();Ve=this.trees[Te]=this._createTree(this._cluster(Ve,Te)),te&&console.log("z%d: %d clusters in %dms",Te,Ve.numItems,+Date.now()-Qe)}return te&&console.timeEnd("total time"),this}getClusters(ee,te){let ae=((ee[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,ee[1]));let ne=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)ae=-180,ne=180;else if(ae>ne){const Re=this.getClusters([ae,ge,180,Oe],te),at=this.getClusters([-180,ge,ne,Oe],te);return Re.concat(at)}const Ve=this.trees[this._limitZoom(te)],Te=Ve.range(qt(ae),xe(Oe),qt(ne),xe(ge)),Qe=Ve.data,Ye=[];for(const Re of Te){const at=this.stride*Re;Ye.push(Qe[at+Ft]>1?dt(Qe,at,this.clusterProps):this.points[Qe[at+Gt]])}return Ye}getChildren(ee){const te=this._getOriginId(ee),ae=this._getOriginZoom(ee),ge="No cluster with the specified id.",ne=this.trees[ae];if(!ne)throw new Error(ge);const Oe=ne.data;if(te*this.stride>=Oe.length)throw new Error(ge);const Ve=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Te=ne.within(Oe[te*this.stride],Oe[te*this.stride+1],Ve),Qe=[];for(const Ye of Te){const Re=Ye*this.stride;Oe[Re+4]===ee&&Qe.push(Oe[Re+Ft]>1?dt(Oe,Re,this.clusterProps):this.points[Oe[Re+Gt]])}if(Qe.length===0)throw new Error(ge);return Qe}getLeaves(ee,te,ae){const ge=[];return this._appendLeaves(ge,ee,te=te||10,ae=ae||0,0),ge}getTile(ee,te,ae){const ge=this.trees[this._limitZoom(ee)],ne=Math.pow(2,ee),{extent:Oe,radius:Ve}=this.options,Te=Ve/Oe,Qe=(ae-Te)/ne,Ye=(ae+1+Te)/ne,Re={features:[]};return this._addTileFeatures(ge.range((te-Te)/ne,Qe,(te+1+Te)/ne,Ye),ge.data,te,ae,ne,Re),te===0&&this._addTileFeatures(ge.range(1-Te/ne,Qe,1,Ye),ge.data,ne,ae,ne,Re),te===ne-1&&this._addTileFeatures(ge.range(0,Qe,Te/ne,Ye),ge.data,-1,ae,ne,Re),Re.features.length?Re:null}getClusterExpansionZoom(ee){let te=this._getOriginZoom(ee)-1;for(;te<=this.options.maxZoom;){const ae=this.getChildren(ee);if(te++,ae.length!==1)break;ee=ae[0].properties.cluster_id}return te}_appendLeaves(ee,te,ae,ge,ne){const Oe=this.getChildren(te);for(const Ve of Oe){const Te=Ve.properties;if(Te&&Te.cluster?ne+Te.point_count<=ge?ne+=Te.point_count:ne=this._appendLeaves(ee,Te.cluster_id,ae,ge,ne):ne<ge?ne++:ee.push(Ve),ee.length===ae)break}return ne}_createTree(ee){const te=new d.aF(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<ee.length;ae+=this.stride)te.add(ee[ae],ee[ae+1]);return te.finish(),te.data=ee,te}_addTileFeatures(ee,te,ae,ge,ne,Oe){for(const Ve of ee){const Te=Ve*this.stride,Qe=te[Te+Ft]>1;let Ye,Re,at;if(Qe)Ye=_t(te,Te,this.clusterProps),Re=te[Te],at=te[Te+1];else{const Vt=this.points[te[Te+Gt]];Ye=Vt.properties;const[Xt,We]=Vt.geometry.coordinates;Re=qt(Xt),at=xe(We)}const St={type:1,geometry:[[Math.round(this.options.extent*(Re*ne-ae)),Math.round(this.options.extent*(at*ne-ge))]],tags:Ye};let Ct;Ct=Qe||this.options.generateId?te[Te+Gt]:this.points[te[Te+Gt]].id,Ct!==void 0&&(St.id=Ct),Oe.features.push(St)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,te){const{radius:ae,extent:ge,reduce:ne,minPoints:Oe}=this.options,Ve=ae/(ge*Math.pow(2,te)),Te=ee.data,Qe=[],Ye=this.stride;for(let Re=0;Re<Te.length;Re+=Ye){if(Te[Re+2]<=te)continue;Te[Re+2]=te;const at=Te[Re],St=Te[Re+1],Ct=ee.within(Te[Re],Te[Re+1],Ve),Vt=Te[Re+Ft];let Xt=Vt;for(const We of Ct){const Wt=We*Ye;Te[Wt+2]>te&&(Xt+=Te[Wt+Ft])}if(Xt>Vt&&Xt>=Oe){let We,Wt=at*Vt,_i=St*Vt,zi=-1;const Si=((Re/Ye|0)<<5)+(te+1)+this.points.length;for(const st of Ct){const kt=st*Ye;if(Te[kt+2]<=te)continue;Te[kt+2]=te;const Qt=Te[kt+Ft];Wt+=Te[kt]*Qt,_i+=Te[kt+1]*Qt,Te[kt+4]=Si,ne&&(We||(We=this._map(Te,Re,!0),zi=this.clusterProps.length,this.clusterProps.push(We)),ne(We,this._map(Te,kt)))}Te[Re+4]=Si,Qe.push(Wt/Xt,_i/Xt,1/0,Si,-1,Xt),ne&&Qe.push(zi)}else{for(let We=0;We<Ye;We++)Qe.push(Te[Re+We]);if(Xt>1)for(const We of Ct){const Wt=We*Ye;if(!(Te[Wt+2]<=te)){Te[Wt+2]=te;for(let _i=0;_i<Ye;_i++)Qe.push(Te[Wt+_i])}}}}return Qe}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,te,ae){if(ee[te+Ft]>1){const Oe=this.clusterProps[ee[te+ei]];return ae?Object.assign({},Oe):Oe}const ge=this.points[ee[te+Gt]].properties,ne=this.options.map(ge);return ae&&ne===ge?Object.assign({},ne):ne}}function dt(De,ee,te){return{type:"Feature",id:De[ee+Gt],properties:_t(De,ee,te),geometry:{type:"Point",coordinates:[(ae=De[ee],360*(ae-.5)),ot(De[ee+1])]}};var ae}function _t(De,ee,te){const ae=De[ee+Ft],ge=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,ne=De[ee+ei],Oe=ne===-1?{}:Object.assign({},te[ne]);return Object.assign(Oe,{cluster:!0,cluster_id:De[ee+Gt],point_count:ae,point_count_abbreviated:ge})}function qt(De){return De/360+.5}function xe(De){const ee=Math.sin(De*Math.PI/180),te=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return te<0?0:te>1?1:te}function ot(De){const ee=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function xt(De,ee,te,ae){let ge=ae;const ne=ee+(te-ee>>1);let Oe,Ve=te-ee;const Te=De[ee],Qe=De[ee+1],Ye=De[te],Re=De[te+1];for(let at=ee+3;at<te;at+=3){const St=Tt(De[at],De[at+1],Te,Qe,Ye,Re);if(St>ge)Oe=at,ge=St;else if(St===ge){const Ct=Math.abs(at-ne);Ct<Ve&&(Oe=at,Ve=Ct)}}ge>ae&&(Oe-ee>3&&xt(De,ee,Oe,ae),De[Oe+2]=ge,te-Oe>3&&xt(De,Oe,te,ae))}function Tt(De,ee,te,ae,ge,ne){let Oe=ge-te,Ve=ne-ae;if(Oe!==0||Ve!==0){const Te=((De-te)*Oe+(ee-ae)*Ve)/(Oe*Oe+Ve*Ve);Te>1?(te=ge,ae=ne):Te>0&&(te+=Oe*Te,ae+=Ve*Te)}return Oe=De-te,Ve=ee-ae,Oe*Oe+Ve*Ve}function Rt(De,ee,te,ae){const ge={id:De??null,type:ee,geometry:te,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Jt(ge,te);else if(ee==="Polygon")Jt(ge,te[0]);else if(ee==="MultiLineString")for(const ne of te)Jt(ge,ne);else if(ee==="MultiPolygon")for(const ne of te)Jt(ge,ne[0]);return ge}function Jt(De,ee){for(let te=0;te<ee.length;te+=3)De.minX=Math.min(De.minX,ee[te]),De.minY=Math.min(De.minY,ee[te+1]),De.maxX=Math.max(De.maxX,ee[te]),De.maxY=Math.max(De.maxY,ee[te+1])}function Nt(De,ee,te,ae){if(!ee.geometry)return;const ge=ee.geometry.coordinates;if(ge&&ge.length===0)return;const ne=ee.geometry.type,Oe=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2);let Ve=[],Te=ee.id;if(te.promoteId?Te=ee.properties[te.promoteId]:te.generateId&&(Te=ae||0),ne==="Point")Ei(ge,Ve);else if(ne==="MultiPoint")for(const Qe of ge)Ei(Qe,Ve);else if(ne==="LineString")Ni(ge,Ve,Oe,!1);else if(ne==="MultiLineString"){if(te.lineMetrics){for(const Qe of ge)Ve=[],Ni(Qe,Ve,Oe,!1),De.push(Rt(Te,"LineString",Ve,ee.properties));return}ms(ge,Ve,Oe,!1)}else if(ne==="Polygon")ms(ge,Ve,Oe,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(const Qe of ee.geometry.geometries)Nt(De,{id:Te,geometry:Qe,properties:ee.properties},te,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of ge){const Ye=[];ms(Qe,Ye,Oe,!0),Ve.push(Ye)}}De.push(Rt(Te,ne,Ve,ee.properties))}function Ei(De,ee){ee.push(dl(De[0]),Es(De[1]),0)}function Ni(De,ee,te,ae){let ge,ne,Oe=0;for(let Te=0;Te<De.length;Te++){const Qe=dl(De[Te][0]),Ye=Es(De[Te][1]);ee.push(Qe,Ye,0),Te>0&&(Oe+=ae?(ge*Ye-Qe*ne)/2:Math.sqrt(Math.pow(Qe-ge,2)+Math.pow(Ye-ne,2))),ge=Qe,ne=Ye}const Ve=ee.length-3;ee[2]=1,xt(ee,0,Ve,te),ee[Ve+2]=1,ee.size=Math.abs(Oe),ee.start=0,ee.end=ee.size}function ms(De,ee,te,ae){for(let ge=0;ge<De.length;ge++){const ne=[];Ni(De[ge],ne,te,ae),ee.push(ne)}}function dl(De){return De/360+.5}function Es(De){const ee=Math.sin(De*Math.PI/180),te=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return te<0?0:te>1?1:te}function Hs(De,ee,te,ae,ge,ne,Oe,Ve){if(ae/=ee,ne>=(te/=ee)&&Oe<ae)return De;if(Oe<te||ne>=ae)return null;const Te=[];for(const Qe of De){const Ye=Qe.geometry;let Re=Qe.type;const at=ge===0?Qe.minX:Qe.minY,St=ge===0?Qe.maxX:Qe.maxY;if(at>=te&&St<ae){Te.push(Qe);continue}if(St<te||at>=ae)continue;let Ct=[];if(Re==="Point"||Re==="MultiPoint")gs(Ye,Ct,te,ae,ge);else if(Re==="LineString")ji(Ye,Ct,te,ae,ge,!1,Ve.lineMetrics);else if(Re==="MultiLineString")wa(Ye,Ct,te,ae,ge,!1);else if(Re==="Polygon")wa(Ye,Ct,te,ae,ge,!0);else if(Re==="MultiPolygon")for(const Vt of Ye){const Xt=[];wa(Vt,Xt,te,ae,ge,!0),Xt.length&&Ct.push(Xt)}if(Ct.length){if(Ve.lineMetrics&&Re==="LineString"){for(const Vt of Ct)Te.push(Rt(Qe.id,Re,Vt,Qe.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(Ct.length===1?(Re="LineString",Ct=Ct[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=Ct.length===3?"Point":"MultiPoint"),Te.push(Rt(Qe.id,Re,Ct,Qe.tags))}}return Te.length?Te:null}function gs(De,ee,te,ae,ge){for(let ne=0;ne<De.length;ne+=3){const Oe=De[ne+ge];Oe>=te&&Oe<=ae&&Rn(ee,De[ne],De[ne+1],De[ne+2])}}function ji(De,ee,te,ae,ge,ne,Oe){let Ve=yo(De);const Te=ge===0?Yc:sc;let Qe,Ye,Re=De.start;for(let Xt=0;Xt<De.length-3;Xt+=3){const We=De[Xt],Wt=De[Xt+1],_i=De[Xt+2],zi=De[Xt+3],Si=De[Xt+4],st=ge===0?We:Wt,kt=ge===0?zi:Si;let Qt=!1;Oe&&(Qe=Math.sqrt(Math.pow(We-zi,2)+Math.pow(Wt-Si,2))),st<te?kt>te&&(Ye=Te(Ve,We,Wt,zi,Si,te),Oe&&(Ve.start=Re+Qe*Ye)):st>ae?kt<ae&&(Ye=Te(Ve,We,Wt,zi,Si,ae),Oe&&(Ve.start=Re+Qe*Ye)):Rn(Ve,We,Wt,_i),kt<te&&st>=te&&(Ye=Te(Ve,We,Wt,zi,Si,te),Qt=!0),kt>ae&&st<=ae&&(Ye=Te(Ve,We,Wt,zi,Si,ae),Qt=!0),!ne&&Qt&&(Oe&&(Ve.end=Re+Qe*Ye),ee.push(Ve),Ve=yo(De)),Oe&&(Re+=Qe)}let at=De.length-3;const St=De[at],Ct=De[at+1],Vt=ge===0?St:Ct;Vt>=te&&Vt<=ae&&Rn(Ve,St,Ct,De[at+2]),at=Ve.length-3,ne&&at>=3&&(Ve[at]!==Ve[0]||Ve[at+1]!==Ve[1])&&Rn(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&ee.push(Ve)}function yo(De){const ee=[];return ee.size=De.size,ee.start=De.start,ee.end=De.end,ee}function wa(De,ee,te,ae,ge,ne){for(const Oe of De)ji(Oe,ee,te,ae,ge,ne,!1)}function Rn(De,ee,te,ae){De.push(ee,te,ae)}function Yc(De,ee,te,ae,ge,ne){const Oe=(ne-ee)/(ae-ee);return Rn(De,ne,te+(ge-te)*Oe,1),Oe}function sc(De,ee,te,ae,ge,ne){const Oe=(ne-te)/(ge-te);return Rn(De,ee+(ae-ee)*Oe,ne,1),Oe}function tr(De,ee){const te=[];for(let ae=0;ae<De.length;ae++){const ge=De[ae],ne=ge.type;let Oe;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Oe=br(ge.geometry,ee);else if(ne==="MultiLineString"||ne==="Polygon"){Oe=[];for(const Ve of ge.geometry)Oe.push(br(Ve,ee))}else if(ne==="MultiPolygon"){Oe=[];for(const Ve of ge.geometry){const Te=[];for(const Qe of Ve)Te.push(br(Qe,ee));Oe.push(Te)}}te.push(Rt(ge.id,ne,Oe,ge.tags))}return te}function br(De,ee){const te=[];te.size=De.size,De.start!==void 0&&(te.start=De.start,te.end=De.end);for(let ae=0;ae<De.length;ae+=3)te.push(De[ae]+ee,De[ae+1],De[ae+2]);return te}function pl(De,ee){if(De.transformed)return De;const te=1<<De.z,ae=De.x,ge=De.y;for(const ne of De.features){const Oe=ne.geometry,Ve=ne.type;if(ne.geometry=[],Ve===1)for(let Te=0;Te<Oe.length;Te+=2)ne.geometry.push(Kr(Oe[Te],Oe[Te+1],ee,te,ae,ge));else for(let Te=0;Te<Oe.length;Te++){const Qe=[];for(let Ye=0;Ye<Oe[Te].length;Ye+=2)Qe.push(Kr(Oe[Te][Ye],Oe[Te][Ye+1],ee,te,ae,ge));ne.geometry.push(Qe)}}return De.transformed=!0,De}function Kr(De,ee,te,ae,ge,ne){return[Math.round(te*(De*ae-ge)),Math.round(te*(ee*ae-ne))]}function Jc(De,ee,te,ae,ge){const ne=ee===ge.maxZoom?0:ge.tolerance/((1<<ee)*ge.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:te,y:ae,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of De)rc(Oe,Ve,ne,ge);return Oe}function rc(De,ee,te,ae){const ge=ee.geometry,ne=ee.type,Oe=[];if(De.minX=Math.min(De.minX,ee.minX),De.minY=Math.min(De.minY,ee.minY),De.maxX=Math.max(De.maxX,ee.maxX),De.maxY=Math.max(De.maxY,ee.maxY),ne==="Point"||ne==="MultiPoint")for(let Ve=0;Ve<ge.length;Ve+=3)Oe.push(ge[Ve],ge[Ve+1]),De.numPoints++,De.numSimplified++;else if(ne==="LineString")_o(Oe,ge,De,te,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(let Ve=0;Ve<ge.length;Ve++)_o(Oe,ge[Ve],De,te,ne==="Polygon",Ve===0);else if(ne==="MultiPolygon")for(let Ve=0;Ve<ge.length;Ve++){const Te=ge[Ve];for(let Qe=0;Qe<Te.length;Qe++)_o(Oe,Te[Qe],De,te,!0,Qe===0)}if(Oe.length){let Ve=ee.tags||null;if(ne==="LineString"&&ae.lineMetrics){Ve={};for(const Qe in ee.tags)Ve[Qe]=ee.tags[Qe];Ve.mapbox_clip_start=ge.start/ge.size,Ve.mapbox_clip_end=ge.end/ge.size}const Te={geometry:Oe,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:Ve};ee.id!==null&&(Te.id=ee.id),De.features.push(Te)}}function _o(De,ee,te,ae,ge,ne){const Oe=ae*ae;if(ae>0&&ee.size<(ge?Oe:ae))return void(te.numPoints+=ee.length/3);const Ve=[];for(let Te=0;Te<ee.length;Te+=3)(ae===0||ee[Te+2]>Oe)&&(te.numSimplified++,Ve.push(ee[Te],ee[Te+1])),te.numPoints++;ge&&function(Te,Qe){let Ye=0;for(let Re=0,at=Te.length,St=at-2;Re<at;St=Re,Re+=2)Ye+=(Te[Re]-Te[St])*(Te[Re+1]+Te[St+1]);if(Ye>0===Qe)for(let Re=0,at=Te.length;Re<at/2;Re+=2){const St=Te[Re],Ct=Te[Re+1];Te[Re]=Te[at-2-Re],Te[Re+1]=Te[at-1-Re],Te[at-2-Re]=St,Te[at-1-Re]=Ct}}(Ve,ne),De.push(Ve)}const Kn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ys{constructor(ee,te){const ae=(te=this.options=function(ne,Oe){for(const Ve in Oe)ne[Ve]=Oe[Ve];return ne}(Object.create(Kn),te)).debug;if(ae&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");let ge=function(ne,Oe){const Ve=[];if(ne.type==="FeatureCollection")for(let Te=0;Te<ne.features.length;Te++)Nt(Ve,ne.features[Te],Oe,Te);else Nt(Ve,ne.type==="Feature"?ne:{geometry:ne},Oe);return Ve}(ee,te);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(ne,Oe){const Ve=Oe.buffer/Oe.extent;let Te=ne;const Qe=Hs(ne,1,-1-Ve,Ve,0,-1,2,Oe),Ye=Hs(ne,1,1-Ve,2+Ve,0,-1,2,Oe);return(Qe||Ye)&&(Te=Hs(ne,1,-Ve,1+Ve,0,-1,2,Oe)||[],Qe&&(Te=tr(Qe,1).concat(Te)),Ye&&(Te=Te.concat(tr(Ye,-1)))),Te}(ge,te),ge.length&&this.splitTile(ge,0,0,0),ae&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,te,ae,ge,ne,Oe,Ve){const Te=[ee,te,ae,ge],Qe=this.options,Ye=Qe.debug;for(;Te.length;){ge=Te.pop(),ae=Te.pop(),te=Te.pop(),ee=Te.pop();const Re=1<<te,at=Yn(te,ae,ge);let St=this.tiles[at];if(!St&&(Ye>1&&console.time("creation"),St=this.tiles[at]=Jc(ee,te,ae,ge,Qe),this.tileCoords.push({z:te,x:ae,y:ge}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,ae,ge,St.numFeatures,St.numPoints,St.numSimplified),console.timeEnd("creation"));const Qt=`z${te}`;this.stats[Qt]=(this.stats[Qt]||0)+1,this.total++}if(St.source=ee,ne==null){if(te===Qe.indexMaxZoom||St.numPoints<=Qe.indexMaxPoints)continue}else{if(te===Qe.maxZoom||te===ne)continue;if(ne!=null){const Qt=ne-te;if(ae!==Oe>>Qt||ge!==Ve>>Qt)continue}}if(St.source=null,ee.length===0)continue;Ye>1&&console.time("clipping");const Ct=.5*Qe.buffer/Qe.extent,Vt=.5-Ct,Xt=.5+Ct,We=1+Ct;let Wt=null,_i=null,zi=null,Si=null,st=Hs(ee,Re,ae-Ct,ae+Xt,0,St.minX,St.maxX,Qe),kt=Hs(ee,Re,ae+Vt,ae+We,0,St.minX,St.maxX,Qe);ee=null,st&&(Wt=Hs(st,Re,ge-Ct,ge+Xt,1,St.minY,St.maxY,Qe),_i=Hs(st,Re,ge+Vt,ge+We,1,St.minY,St.maxY,Qe),st=null),kt&&(zi=Hs(kt,Re,ge-Ct,ge+Xt,1,St.minY,St.maxY,Qe),Si=Hs(kt,Re,ge+Vt,ge+We,1,St.minY,St.maxY,Qe),kt=null),Ye>1&&console.timeEnd("clipping"),Te.push(Wt||[],te+1,2*ae,2*ge),Te.push(_i||[],te+1,2*ae,2*ge+1),Te.push(zi||[],te+1,2*ae+1,2*ge),Te.push(Si||[],te+1,2*ae+1,2*ge+1)}}getTile(ee,te,ae){ee=+ee,te=+te,ae=+ae;const ge=this.options,{extent:ne,debug:Oe}=ge;if(ee<0||ee>24)return null;const Ve=1<<ee,Te=Yn(ee,te=te+Ve&Ve-1,ae);if(this.tiles[Te])return pl(this.tiles[Te],ne);Oe>1&&console.log("drilling down to z%d-%d-%d",ee,te,ae);let Qe,Ye=ee,Re=te,at=ae;for(;!Qe&&Ye>0;)Ye--,Re>>=1,at>>=1,Qe=this.tiles[Yn(Ye,Re,at)];return Qe&&Qe.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",Ye,Re,at),console.time("drilling down")),this.splitTile(Qe.source,Ye,Re,at,ee,te,ae),Oe>1&&console.timeEnd("drilling down"),this.tiles[Te]?pl(this.tiles[Te],ne):null):null}}function Yn(De,ee,te){return 32*((1<<De)*te+ee)+De}function Uo(De,ee){return ee?De.properties[ee]:De.id}function Sa(De,ee){if(De==null)return!0;if(De.type==="Feature")return Uo(De,ee)!=null;if(De.type==="FeatureCollection"){const te=new Set;for(const ae of De.features){const ge=Uo(ae,ee);if(ge==null||te.has(ge))return!1;te.add(ge)}return!0}return!1}function bo(De,ee){const te=new Map;if(De!=null)if(De.type==="Feature")te.set(Uo(De,ee),De);else for(const ae of De.features)te.set(Uo(ae,ee),ae);return te}class _s extends L{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ee,te){return d._(this,void 0,void 0,function*(){const ae=ee.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ge=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ge)return null;const ne=new je(ge.features);let Oe=gt(ne);return Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),{vectorTile:ne,rawData:Oe.buffer}})}loadData(ee){return d._(this,void 0,void 0,function*(){var te;(te=this._pendingRequest)===null||te===void 0||te.abort();const ae=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new d.cC(ee.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ee,this._pendingRequest),this._geoJSONIndex=ee.cluster?new Xe(function({superclusterOptions:Oe,clusterProperties:Ve}){if(!Ve||!Oe)return Oe;const Te={},Qe={},Ye={accumulated:null,zoom:0},Re={properties:null},at=Object.keys(Ve);for(const St of at){const[Ct,Vt]=Ve[St],Xt=d.cJ(Vt),We=d.cJ(typeof Ct=="string"?[Ct,["accumulated"],["get",St]]:Ct);Te[St]=Xt.value,Qe[St]=We.value}return Oe.map=St=>{Re.properties=St;const Ct={};for(const Vt of at)Ct[Vt]=Te[Vt].evaluate(Ye,Re);return Ct},Oe.reduce=(St,Ct)=>{Re.properties=Ct;for(const Vt of at)Ye.accumulated=St[Vt],St[Vt]=Qe[Vt].evaluate(Ye,Re)},Oe}(ee)).load((yield this._pendingData).features):(ge=yield this._pendingData,new ys(ge,ee.geojsonVtOptions)),this.loaded={};const ne={};if(ae){const Oe=ae.finish();Oe&&(ne.resourceTiming={},ne.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Oe)))}return ne}catch(ne){if(delete this._pendingRequest,d.cn(ne))return{abandoned:!0};throw ne}var ge})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ee){const te=this.loaded;return te&&te[ee.uid]?super.reloadTile(ee):this.loadTile(ee)}loadAndProcessGeoJSON(ee,te){return d._(this,void 0,void 0,function*(){let ae=yield this.loadGeoJSON(ee,te);if(delete this._pendingRequest,typeof ae!="object")throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(le(ae,!0),ee.filter){const ge=d.cJ(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(Oe=>`${Oe.key}: ${Oe.message}`).join(", "));ae={type:"FeatureCollection",features:ae.features.filter(Oe=>ge.value.evaluate({zoom:0},Oe))}}return ae})}loadGeoJSON(ee,te){return d._(this,void 0,void 0,function*(){const{promoteId:ae}=ee;if(ee.request){const ge=yield d.j(ee.request,te);return this._dataUpdateable=Sa(ge.data,ae)?bo(ge.data,ae):void 0,ge.data}if(typeof ee.data=="string")try{const ge=JSON.parse(ee.data);return this._dataUpdateable=Sa(ge,ae)?bo(ge,ae):void 0,ge}catch{throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`)}if(!ee.dataDiff)throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ee.source}`);return function(ge,ne,Oe){var Ve,Te,Qe,Ye;if(ne.removeAll&&ge.clear(),ne.remove)for(const Re of ne.remove)ge.delete(Re);if(ne.add)for(const Re of ne.add){const at=Uo(Re,Oe);at!=null&&ge.set(at,Re)}if(ne.update)for(const Re of ne.update){let at=ge.get(Re.id);if(at==null)continue;const St=!Re.removeAllProperties&&(((Ve=Re.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0||((Te=Re.addOrUpdateProperties)===null||Te===void 0?void 0:Te.length)>0);if((Re.newGeometry||Re.removeAllProperties||St)&&(at=Object.assign({},at),ge.set(Re.id,at),St&&(at.properties=Object.assign({},at.properties))),Re.newGeometry&&(at.geometry=Re.newGeometry),Re.removeAllProperties)at.properties={};else if(((Qe=Re.removeProperties)===null||Qe===void 0?void 0:Qe.length)>0)for(const Ct of Re.removeProperties)Object.prototype.hasOwnProperty.call(at.properties,Ct)&&delete at.properties[Ct];if(((Ye=Re.addOrUpdateProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const{key:Ct,value:Vt}of Re.addOrUpdateProperties)at.properties[Ct]=Vt}}(this._dataUpdateable,ee.dataDiff,ae),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ee){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ee){return this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId)}getClusterChildren(ee){return this._geoJSONIndex.getChildren(ee.clusterId)}getClusterLeaves(ee){return this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset)}}class Lr{constructor(ee){this.self=ee,this.actor=new d.H(ee),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(te,ae)=>{if(this.externalWorkerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.externalWorkerSourceTypes[te]=ae},this.self.addProtocol=d.cp,this.self.removeProtocol=d.cq,this.self.registerRTLTextPlugin=te=>{d.cK.setMethods(te)},this.actor.registerMessageHandler("LDT",(te,ae)=>this._getDEMWorkerSource(te,ae.source).loadTile(ae)),this.actor.registerMessageHandler("RDT",(te,ae)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(te,ae.source).removeTile(ae)})),this.actor.registerMessageHandler("GCEZ",(te,ae)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(te,ae.type,ae.source).getClusterExpansionZoom(ae)})),this.actor.registerMessageHandler("GCC",(te,ae)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(te,ae.type,ae.source).getClusterChildren(ae)})),this.actor.registerMessageHandler("GCL",(te,ae)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(te,ae.type,ae.source).getClusterLeaves(ae)})),this.actor.registerMessageHandler("LD",(te,ae)=>this._getWorkerSource(te,ae.type,ae.source).loadData(ae)),this.actor.registerMessageHandler("GD",(te,ae)=>this._getWorkerSource(te,ae.type,ae.source).getData()),this.actor.registerMessageHandler("LT",(te,ae)=>this._getWorkerSource(te,ae.type,ae.source).loadTile(ae)),this.actor.registerMessageHandler("RT",(te,ae)=>this._getWorkerSource(te,ae.type,ae.source).reloadTile(ae)),this.actor.registerMessageHandler("AT",(te,ae)=>this._getWorkerSource(te,ae.type,ae.source).abortTile(ae)),this.actor.registerMessageHandler("RMT",(te,ae)=>this._getWorkerSource(te,ae.type,ae.source).removeTile(ae)),this.actor.registerMessageHandler("RS",(te,ae)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[te]||!this.workerSources[te][ae.type]||!this.workerSources[te][ae.type][ae.source])return;const ge=this.workerSources[te][ae.type][ae.source];delete this.workerSources[te][ae.type][ae.source],ge.removeSource!==void 0&&ge.removeSource(ae)})),this.actor.registerMessageHandler("RM",te=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te]})),this.actor.registerMessageHandler("SR",(te,ae)=>d._(this,void 0,void 0,function*(){this.referrer=ae})),this.actor.registerMessageHandler("SRPS",(te,ae)=>this._syncRTLPluginState(te,ae)),this.actor.registerMessageHandler("IS",(te,ae)=>d._(this,void 0,void 0,function*(){this.self.importScripts(ae)})),this.actor.registerMessageHandler("SI",(te,ae)=>this._setImages(te,ae)),this.actor.registerMessageHandler("UL",(te,ae)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(te).update(ae.layers,ae.removedIds)})),this.actor.registerMessageHandler("SL",(te,ae)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(te).replace(ae)}))}_setImages(ee,te){return d._(this,void 0,void 0,function*(){this.availableImages[ee]=te;for(const ae in this.workerSources[ee]){const ge=this.workerSources[ee][ae];for(const ne in ge)ge[ne].availableImages=te}})}_syncRTLPluginState(ee,te){return d._(this,void 0,void 0,function*(){return yield d.cK.syncState(te,this.self.importScripts)})}_getAvailableImages(ee){let te=this.availableImages[ee];return te||(te=[]),te}_getLayerIndex(ee){let te=this.layerIndexes[ee];return te||(te=this.layerIndexes[ee]=new a),te}_getWorkerSource(ee,te,ae){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][te]||(this.workerSources[ee][te]={}),!this.workerSources[ee][te][ae]){const ge={sendAsync:(ne,Oe)=>(ne.targetMapId=ee,this.actor.sendAsync(ne,Oe))};switch(te){case"vector":this.workerSources[ee][te][ae]=new L(ge,this._getLayerIndex(ee),this._getAvailableImages(ee));break;case"geojson":this.workerSources[ee][te][ae]=new _s(ge,this._getLayerIndex(ee),this._getAvailableImages(ee));break;default:this.workerSources[ee][te][ae]=new this.externalWorkerSourceTypes[te](ge,this._getLayerIndex(ee),this._getAvailableImages(ee))}}return this.workerSources[ee][te][ae]}_getDEMWorkerSource(ee,te){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][te]||(this.demWorkerSources[ee][te]=new j),this.demWorkerSources[ee][te]}}return d.i(self)&&(self.worker=new Lr(self)),Lr}),o("index",["exports","./shared"],function(d,a){var v="5.4.0";function A(){var x=new a.A(4);return a.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let P,L;const j={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x,i,c){const g=requestAnimationFrame(S=>{_(),i(S)}),{unsubscribe:_}=a.s(x.signal,"abort",()=>{_(),cancelAnimationFrame(g),c(a.c())},!1)},frameAsync(x){return new Promise((i,c)=>{this.frame(x,i,c)})},getImageData(x,i=0){return this.getImageCanvasContext(x).getImageData(-i,-i,x.width+2*i,x.height+2*i)},getImageCanvasContext(x){const i=window.document.createElement("canvas"),c=i.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return i.width=x.width,i.height=x.height,c.drawImage(x,0,0,x.width,x.height),c},resolveURL:x=>(P||(P=document.createElement("a")),P.href=x,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(L==null&&(L=matchMedia("(prefers-reduced-motion: reduce)")),L.matches)}};class F{static testProp(i){if(!F.docStyle)return i[0];for(let c=0;c<i.length;c++)if(i[c]in F.docStyle)return i[c];return i[0]}static create(i,c,g){const _=window.document.createElement(i);return c!==void 0&&(_.className=c),g&&g.appendChild(_),_}static createNS(i,c){return window.document.createElementNS(i,c)}static disableDrag(){F.docStyle&&F.selectProp&&(F.userSelect=F.docStyle[F.selectProp],F.docStyle[F.selectProp]="none")}static enableDrag(){F.docStyle&&F.selectProp&&(F.docStyle[F.selectProp]=F.userSelect)}static setTransform(i,c){i.style[F.transformProp]=c}static addEventListener(i,c,g,_={}){i.addEventListener(c,g,"passive"in _?_:_.capture)}static removeEventListener(i,c,g,_={}){i.removeEventListener(c,g,"passive"in _?_:_.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",F.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",F.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",F.suppressClickInternal,!0)},0)}static getScale(i){const c=i.getBoundingClientRect();return{x:c.width/i.offsetWidth||1,y:c.height/i.offsetHeight||1,boundingClientRect:c}}static getPoint(i,c,g){const _=c.boundingClientRect;return new a.P((g.clientX-_.left)/c.x-i.clientLeft,(g.clientY-_.top)/c.y-i.clientTop)}static mousePos(i,c){const g=F.getScale(i);return F.getPoint(i,g,c)}static touchPos(i,c){const g=[],_=F.getScale(i);for(let S=0;S<c.length;S++)g.push(F.getPoint(i,_,c[S]));return g}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}static sanitize(i){const c=new DOMParser().parseFromString(i,"text/html").body||document.createElement("body"),g=c.querySelectorAll("script");for(const _ of g)_.remove();return F.clean(c),c.innerHTML}static isPossiblyDangerous(i,c){const g=c.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(i)||!g.includes("javascript:")&&!g.includes("data:"))||!!i.startsWith("on")||void 0}static clean(i){const c=i.children;for(const g of c)F.removeAttributes(g),F.clean(g)}static removeAttributes(i){for(const{name:c,value:g}of i.attributes)F.isPossiblyDangerous(c,g)&&i.removeAttribute(c)}}F.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,F.selectProp=F.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),F.transformProp=F.testProp(["transform","WebkitTransform"]);const K={supported:!1,testSupport:function(x){!ve&&le&&(Be?je(x):se=x)}};let se,le,ve=!1,Be=!1;function je(x){const i=x.createTexture();x.bindTexture(x.TEXTURE_2D,i);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,le),x.isContextLost())return;K.supported=!0}catch{}x.deleteTexture(i),ve=!0}var ze;typeof document<"u"&&(le=document.createElement("img"),le.onload=()=>{se&&je(se),se=null,Be=!0},le.onerror=()=>{ve=!0,se=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let i,c,g,_;x.resetRequestQueue=()=>{i=[],c=0,g=0,_={}},x.addThrottleControl=R=>{const B=g++;return _[B]=R,B},x.removeThrottleControl=R=>{delete _[R],C()},x.getImage=(R,B,V=!0)=>new Promise((q,H)=>{K.supported&&(R.headers||(R.headers={}),R.headers.accept="image/webp,*/*"),a.e(R,{type:"image"}),i.push({abortController:B,requestParameters:R,supportImageRefresh:V,state:"queued",onError:W=>{H(W)},onSuccess:W=>{q(W)}}),C()});const S=R=>a._(this,void 0,void 0,function*(){R.state="running";const{requestParameters:B,supportImageRefresh:V,onError:q,onSuccess:H,abortController:W}=R,Y=V===!1&&!a.i(self)&&!a.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce((he,de)=>he&&de==="accept",!0));c++;const ue=Y?O(B,W):a.m(B,W);try{const he=yield ue;delete R.abortController,R.state="completed",he.data instanceof HTMLImageElement||a.b(he.data)?H(he):he.data&&H({data:yield(ce=he.data,typeof createImageBitmap=="function"?a.f(ce):a.h(ce)),cacheControl:he.cacheControl,expires:he.expires})}catch(he){delete R.abortController,q(he)}finally{c--,C()}var ce}),C=()=>{const R=(()=>{for(const B of Object.keys(_))if(_[B]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=c;B<R&&i.length>0;B++){const V=i.shift();V.abortController.signal.aborted?B--:S(V)}},O=(R,B)=>new Promise((V,q)=>{const H=new Image,W=R.url,Y=R.credentials;Y&&Y==="include"?H.crossOrigin="use-credentials":(Y&&Y==="same-origin"||!a.d(W))&&(H.crossOrigin="anonymous"),B.signal.addEventListener("abort",()=>{H.src="",q(a.c())}),H.fetchPriority="high",H.onload=()=>{H.onerror=H.onload=null,V({data:H})},H.onerror=()=>{H.onerror=H.onload=null,B.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},H.src=W})}(ze||(ze={})),ze.resetRequestQueue();class ke{constructor(i){this._transformRequestFn=i}transformRequest(i,c){return this._transformRequestFn&&this._transformRequestFn(i,c)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function Se(x){const i=[];if(typeof x=="string")i.push({id:"default",url:x});else if(x&&x.length>0){const c=[];for(const{id:g,url:_}of x){const S=`${g}${_}`;c.indexOf(S)===-1&&(c.push(S),i.push({id:g,url:_}))}}return i}function Fe(x,i,c){try{const g=new URL(x);return g.pathname+=`${i}${c}`,g.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class He{constructor(i,c,g,_){this.context=i,this.format=g,this.texture=i.gl.createTexture(),this.update(c,_)}update(i,c,g){const{width:_,height:S}=i,C=!(this.size&&this.size[0]===_&&this.size[1]===S||g),{context:O}=this,{gl:R}=O;if(this.useMipmap=!!(c&&c.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),O.pixelStoreUnpackFlipY.set(!1),O.pixelStoreUnpack.set(1),O.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!c||c.premultiply!==!1)),C)this.size=[_,S],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||a.b(i)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,i):R.texImage2D(R.TEXTURE_2D,0,this.format,_,S,0,this.format,R.UNSIGNED_BYTE,i.data);else{const{x:B,y:V}=g||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||a.b(i)?R.texSubImage2D(R.TEXTURE_2D,0,B,V,R.RGBA,R.UNSIGNED_BYTE,i):R.texSubImage2D(R.TEXTURE_2D,0,B,V,_,S,R.RGBA,R.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D),O.pixelStoreUnpackFlipY.setDefault(),O.pixelStoreUnpack.setDefault(),O.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,c,g){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),g!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=S.LINEAR),i!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,i),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,g||i),this.filter=i),c!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,c),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function gt(x){const{userImage:i}=x;return!!(i&&i.render&&i.render())&&(x.data.replace(new Uint8Array(i.data.buffer)),!0)}class Et extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:c,promiseResolve:g}of this.requestors)g(this._getImagesForIds(c));this.requestors=[]}}getImage(i){const c=this.images[i];if(c&&!c.data&&c.spriteData){const g=c.spriteData;c.data=new a.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),c.spriteData=null}return c}addImage(i,c){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,c)&&(this.images[i]=c)}_validate(i,c){let g=!0;const _=c.data||c.spriteData;return this._validateStretch(c.stretchX,_&&_.width)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,_&&_.height)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "content" value`))),g=!1),g}_validateStretch(i,c){if(!i)return!0;let g=0;for(const _ of i){if(_[0]<g||_[1]<_[0]||c<_[1])return!1;g=_[1]}return!0}_validateContent(i,c){if(!i)return!0;if(i.length!==4)return!1;const g=c.spriteData,_=g&&g.width||c.data.width,S=g&&g.height||c.data.height;return!(i[0]<0||_<i[0]||i[1]<0||S<i[1]||i[2]<0||_<i[2]||i[3]<0||S<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,c,g=!0){const _=this.getImage(i);if(g&&(_.data.width!==c.data.width||_.data.height!==c.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=_.version+1,this.images[i]=c,this.updatedImages[i]=!0}removeImage(i){const c=this.images[i];delete this.images[i],delete this.patterns[i],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((c,g)=>{let _=!0;if(!this.isLoaded())for(const S of i)this.images[S]||(_=!1);this.isLoaded()||_?c(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:c})})}_getImagesForIds(i){const c={};for(const g of i){let _=this.getImage(g);_||(this.fire(new a.l("styleimagemissing",{id:g})),_=this.getImage(g)),_?c[g]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,textFitWidth:_.textFitWidth,textFitHeight:_.textFitHeight,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return c}getPixelSize(){const{width:i,height:c}=this.atlasImage;return{width:i,height:c}}getPattern(i){const c=this.patterns[i],g=this.getImage(i);if(!g)return null;if(c&&c.position.version===g.version)return c.position;if(c)c.position.version=g.version;else{const _={w:g.data.width+2,h:g.data.height+2,x:0,y:0},S=new a.I(_,g);this.patterns[i]={bin:_,position:S}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const c=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new He(i,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const S in this.patterns)i.push(this.patterns[S].bin);const{w:c,h:g}=a.p(i),_=this.atlasImage;_.resize({width:c||1,height:g||1});for(const S in this.patterns){const{bin:C}=this.patterns[S],O=C.x+1,R=C.y+1,B=this.getImage(S).data,V=B.width,q=B.height;a.R.copy(B,_,{x:0,y:0},{x:O,y:R},{width:V,height:q}),a.R.copy(B,_,{x:0,y:q-1},{x:O,y:R-1},{width:V,height:1}),a.R.copy(B,_,{x:0,y:0},{x:O,y:R+q},{width:V,height:1}),a.R.copy(B,_,{x:V-1,y:0},{x:O-1,y:R},{width:1,height:q}),a.R.copy(B,_,{x:0,y:0},{x:O+V,y:R},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const c of i){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const g=this.getImage(c);g||a.w(`Image with ID: "${c}" was not found`),gt(g)&&this.updateImage(c,g)}}}const Mt=1e20;function ht(x,i,c,g,_,S,C,O,R){for(let B=i;B<i+g;B++)Gt(x,c*S+B,S,_,C,O,R);for(let B=c;B<c+_;B++)Gt(x,B*S+i,1,g,C,O,R)}function Gt(x,i,c,g,_,S,C){S[0]=0,C[0]=-1e20,C[1]=Mt,_[0]=x[i];for(let O=1,R=0,B=0;O<g;O++){_[O]=x[i+O*c];const V=O*O;do{const q=S[R];B=(_[O]-_[q]+V-q*q)/(O-q)/2}while(B<=C[R]&&--R>-1);R++,S[R]=O,C[R]=B,C[R+1]=Mt}for(let O=0,R=0;O<g;O++){for(;C[R+1]<O;)R++;const B=S[R],V=O-B;x[i+O*c]=_[B]+V*V}}class Ft{constructor(i,c){this.requestManager=i,this.localIdeographFontFamily=c,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return a._(this,void 0,void 0,function*(){const c=[];for(const S in i)for(const C of i[S])c.push(this._getAndCacheGlyphsPromise(S,C));const g=yield Promise.all(c),_={};for(const{stack:S,id:C,glyph:O}of g)_[S]||(_[S]={}),_[S][C]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};return _})}_getAndCacheGlyphsPromise(i,c){return a._(this,void 0,void 0,function*(){let g=this.entries[i];g||(g=this.entries[i]={glyphs:{},requests:{},ranges:{}});let _=g.glyphs[c];if(_!==void 0)return{stack:i,id:c,glyph:_};if(_=this._tinySDF(g,i,c),_)return g.glyphs[c]=_,{stack:i,id:c,glyph:_};const S=Math.floor(c/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[S])return{stack:i,id:c,glyph:_};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[S]){const O=Ft.loadGlyphRange(i,S,this.url,this.requestManager);g.requests[S]=O}const C=yield g.requests[S];for(const O in C)this._doesCharSupportLocalGlyph(+O)||(g.glyphs[+O]=C[+O]);return g.ranges[S]=!0,{stack:i,id:c,glyph:C[c]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))||a.u["CJK Unified Ideographs"](i)||a.u["Hangul Syllables"](i)||a.u.Hiragana(i)||a.u.Katakana(i)||a.u["CJK Symbols and Punctuation"](i)||a.u["Halfwidth and Fullwidth Forms"](i))}_tinySDF(i,c,g){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(g))return;let S=i.tinySDF;if(!S){let O="400";/bold/i.test(c)?O="900":/medium/i.test(c)?O="500":/light/i.test(c)&&(O="200"),S=i.tinySDF=new Ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:O})}const C=S.draw(String.fromCharCode(g));return{id:g,bitmap:new a.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ft.loadGlyphRange=function(x,i,c,g){return a._(this,void 0,void 0,function*(){const _=256*i,S=_+255,C=g.transformRequest(c.replace("{fontstack}",x).replace("{range}",`${_}-${S}`),"Glyphs"),O=yield a.n(C,new AbortController);if(!O||!O.data)throw new Error(`Could not load glyph range. range: ${i}, ${_}-${S}`);const R={};for(const B of a.o(O.data))R[B.id]=B;return R})},Ft.TinySDF=class{constructor({fontSize:x=24,buffer:i=3,radius:c=8,cutoff:g=.25,fontFamily:_="sans-serif",fontWeight:S="normal",fontStyle:C="normal"}={}){this.buffer=i,this.cutoff=g,this.radius=c;const O=this.size=x+4*i,R=this._createCanvas(O),B=this.ctx=R.getContext("2d",{willReadFrequently:!0});B.font=`${C} ${S} ${x}px ${_}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(x){const i=document.createElement("canvas");return i.width=i.height=x,i}draw(x){const{width:i,actualBoundingBoxAscent:c,actualBoundingBoxDescent:g,actualBoundingBoxLeft:_,actualBoundingBoxRight:S}=this.ctx.measureText(x),C=Math.ceil(c),O=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-_))),R=Math.min(this.size-this.buffer,C+Math.ceil(g)),B=O+2*this.buffer,V=R+2*this.buffer,q=Math.max(B*V,0),H=new Uint8ClampedArray(q),W={data:H,width:B,height:V,glyphWidth:O,glyphHeight:R,glyphTop:C,glyphLeft:0,glyphAdvance:i};if(O===0||R===0)return W;const{ctx:Y,buffer:ue,gridInner:ce,gridOuter:he}=this;Y.clearRect(ue,ue,O,R),Y.fillText(x,ue,ue+C);const de=Y.getImageData(ue,ue,O,R);he.fill(Mt,0,q),ce.fill(0,0,q);for(let _e=0;_e<R;_e++)for(let be=0;be<O;be++){const Me=de.data[4*(_e*O+be)+3]/255;if(Me===0)continue;const Pe=(_e+ue)*B+be+ue;if(Me===1)he[Pe]=0,ce[Pe]=Mt;else{const Ce=.5-Me;he[Pe]=Ce>0?Ce*Ce:0,ce[Pe]=Ce<0?Ce*Ce:0}}ht(he,0,0,B,V,B,this.f,this.v,this.z),ht(ce,ue,ue,O,R,B,this.f,this.v,this.z);for(let _e=0;_e<q;_e++){const be=Math.sqrt(he[_e])-Math.sqrt(ce[_e]);H[_e]=Math.round(255-255*(be/this.radius+this.cutoff))}return W}};class ei{constructor(){this.specification=a.v.light.position}possiblyEvaluate(i,c){return a.z(i.expression.evaluate(c))}interpolate(i,c,g){return{x:a.B.number(i.x,c.x,g),y:a.B.number(i.y,c.y,g),z:a.B.number(i.z,c.z,g)}}}let Xe;class dt extends a.E{constructor(i){super(),Xe=Xe||new a.r({anchor:new a.D(a.v.light.anchor),position:new ei,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Xe),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c={}){if(!this._validate(a.t,i,c))for(const g in i){const _=i[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),_):this._transitionable.setValue(g,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,g){return(!g||g.validate!==!1)&&a.x(this,i.call(a.y,{value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const _t=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class qt extends a.E{constructor(i){super(),this._transitionable=new a.T(_t),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0))}setSky(i,c={}){if(!this._validate(a.F,i,c)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const g in i){const _=i[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),_):this._transitionable.setValue(g,_)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,g={}){return(g==null?void 0:g.validate)!==!1&&a.x(this,i.call(a.y,a.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class xe{constructor(i,c){this.width=i,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,c){const g=i.join(",")+String(c);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(i,c)),this.dashEntry[g]}getDashRanges(i,c,g){const _=[];let S=i.length%2==1?-i[i.length-1]*g:0,C=i[0]*g,O=!0;_.push({left:S,right:C,isDash:O,zeroLength:i[0]===0});let R=i[0];for(let B=1;B<i.length;B++){O=!O;const V=i[B];S=R*g,R+=V,C=R*g,_.push({left:S,right:C,isDash:O,zeroLength:V===0})}return _}addRoundDash(i,c,g){const _=c/2;for(let S=-g;S<=g;S++){const C=this.width*(this.nextRow+g+S);let O=0,R=i[O];for(let B=0;B<this.width;B++){B/R.right>1&&(R=i[++O]);const V=Math.abs(B-R.left),q=Math.abs(B-R.right),H=Math.min(V,q);let W;const Y=S/g*(_+1);if(R.isDash){const ue=_-Math.abs(Y);W=Math.sqrt(H*H+ue*ue)}else W=_-Math.sqrt(H*H+Y*Y);this.data[C+B]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(i){for(let O=i.length-1;O>=0;--O){const R=i[O],B=i[O+1];R.zeroLength?i.splice(O,1):B&&B.isDash===R.isDash&&(B.left=R.left,i.splice(O,1))}const c=i[0],g=i[i.length-1];c.isDash===g.isDash&&(c.left=g.left-this.width,g.right=c.right+this.width);const _=this.width*this.nextRow;let S=0,C=i[S];for(let O=0;O<this.width;O++){O/C.right>1&&(C=i[++S]);const R=Math.abs(O-C.left),B=Math.abs(O-C.right),V=Math.min(R,B);this.data[_+O]=Math.max(0,Math.min(255,(C.isDash?V:-V)+128))}}addDash(i,c){const g=c?7:0,_=2*g+1;if(this.nextRow+_>this.height)return a.w("LineAtlas out of space"),null;let S=0;for(let O=0;O<i.length;O++)S+=i[O];if(S!==0){const O=this.width/S,R=this.getDashRanges(i,this.width,O);c?this.addRoundDash(R,O,g):this.addRegularDash(R)}const C={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:S};return this.nextRow+=_,this.dirty=!0,C}bind(i){const c=i.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}const ot="maplibre_preloaded_worker_pool";class xt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<xt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ot]}numActive(){return Object.keys(this.active).length}}const Tt=Math.floor(j.hardwareConcurrency/2);let Rt,Jt;function Nt(){return Rt||(Rt=new xt),Rt}xt.workerCount=a.G(globalThis)?Math.max(Math.min(Tt,3),1):1;class Ei{constructor(i,c){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=c;const g=this.workerPool.acquire(c);for(let _=0;_<g.length;_++){const S=new a.H(g[_],c);S.name=`Worker ${_}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,c){const g=[];for(const _ of this.actors)g.push(_.sendAsync({type:i,data:c}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(c=>{c.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,c){for(const g of this.actors)g.registerMessageHandler(i,c)}}function Ni(){return Jt||(Jt=new Ei(Nt(),a.J),Jt.registerMessageHandler("GR",(x,i,c)=>a.m(i,c))),Jt}function ms(x,i){const c=a.K();return a.L(c,c,[1,1,0]),a.M(c,c,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?a.N(c,c,x.calculatePosMatrix(i.toUnwrapped())):c}function dl(x,i,c,g,_,S,C){var O;const R=function(H,W,Y){if(H)for(const ue of H){const ce=W[ue];if(ce&&ce.source===Y&&ce.type==="fill-extrusion")return!0}else for(const ue in W){const ce=W[ue];if(ce.source===Y&&ce.type==="fill-extrusion")return!0}return!1}((O=_==null?void 0:_.layers)!==null&&O!==void 0?O:null,i,x.id),B=S.maxPitchScaleFactor(),V=x.tilesIn(g,B,R);V.sort(Es);const q=[];for(const H of V)q.push({wrappedTileID:H.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(i,c,x._state,H.queryGeometry,H.cameraQueryGeometry,H.scale,_,S,B,ms(x.transform,H.tileID),C?(W,Y)=>C(H.tileID,W,Y):void 0)});return function(H,W){for(const Y in H)for(const ue of H[Y])Hs(ue,W);return H}(function(H){const W={},Y={};for(const ue of H){const ce=ue.queryResults,he=ue.wrappedTileID,de=Y[he]=Y[he]||{};for(const _e in ce){const be=ce[_e],Me=de[_e]=de[_e]||{},Pe=W[_e]=W[_e]||[];for(const Ce of be)Me[Ce.featureIndex]||(Me[Ce.featureIndex]=!0,Pe.push(Ce))}}return W}(q),x)}function Es(x,i){const c=x.tileID,g=i.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function Hs(x,i){const c=x.feature,g=i.getFeatureState(c.layer["source-layer"],c.id);c.source=c.layer.source,c.layer["source-layer"]&&(c.sourceLayer=c.layer["source-layer"]),c.state=g}function gs(x,i,c){return a._(this,void 0,void 0,function*(){let g=x;if(x.url?g=(yield a.j(i.transformRequest(x.url,"Source"),c)).data:yield j.frameAsync(c),!g)return null;const _=a.O(a.e(g,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(_.vectorLayerIds=g.vector_layers.map(S=>S.id)),_})}class ji{constructor(i,c){i&&(c?this.setSouthWest(i).setNorthEast(c):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof a.Q?new a.Q(i.lng,i.lat):a.Q.convert(i),this}setSouthWest(i){return this._sw=i instanceof a.Q?new a.Q(i.lng,i.lat):a.Q.convert(i),this}extend(i){const c=this._sw,g=this._ne;let _,S;if(i instanceof a.Q)_=i,S=i;else{if(!(i instanceof ji))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ji.convert(i)):this.extend(a.Q.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(a.Q.convert(i)):this;if(_=i._sw,S=i._ne,!_||!S)return this}return c||g?(c.lng=Math.min(_.lng,c.lng),c.lat=Math.min(_.lat,c.lat),g.lng=Math.max(S.lng,g.lng),g.lat=Math.max(S.lat,g.lat)):(this._sw=new a.Q(_.lng,_.lat),this._ne=new a.Q(S.lng,S.lat)),this}getCenter(){return new a.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.Q(this.getWest(),this.getNorth())}getSouthEast(){return new a.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:c,lat:g}=a.Q.convert(i);let _=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&_}static convert(i){return i instanceof ji?i:i&&new ji(i)}static fromLngLat(i,c=0){const g=360*c/40075017,_=g/Math.cos(Math.PI/180*i.lat);return new ji(new a.Q(i.lng-_,i.lat-g),new a.Q(i.lng+_,i.lat+g))}adjustAntiMeridian(){const i=new a.Q(this._sw.lng,this._sw.lat),c=new a.Q(this._ne.lng,this._ne.lat);return new ji(i,i.lng>c.lng?new a.Q(c.lng+360,c.lat):c)}}class yo{constructor(i,c,g){this.bounds=ji.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const c=Math.pow(2,i.z),g=Math.floor(a.U(this.bounds.getWest())*c),_=Math.floor(a.S(this.bounds.getNorth())*c),S=Math.ceil(a.U(this.bounds.getEast())*c),C=Math.ceil(a.S(this.bounds.getSouth())*c);return i.x>=g&&i.x<S&&i.y>=_&&i.y<C}}class wa extends a.E{constructor(i,c,g,_){if(super(),this.id=i,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.O(c,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield gs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(a.e(this,i),i.bounds&&(this.tileBounds=new yo(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new a.k(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(i){return a._(this,void 0,void 0,function*(){const c=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(c,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};g.request.collectResourceTiming=this._collectResourceTiming;let _="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((S,C)=>{i.reloadPromise={resolve:S,reject:C}})}else i.actor=this.dispatcher.getActor(),_="LT";i.abortController=new AbortController;try{const S=yield i.actor.sendAsync({type:_,data:g},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,S)}catch(S){if(delete i.abortController,i.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,c){if(c&&c.resourceTiming&&(i.resourceTiming=c.resourceTiming),c&&this.map._refreshExpiredTiles&&i.setExpiryData(c),i.loadVectorData(c,this.map.painter),i.reloadPromise){const g=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(g.resolve).catch(g.reject)}}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Rn extends a.E{constructor(i,c,g,_){super(),this.id=i,this.dispatcher=g,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},c),a.e(this,a.O(c,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(i=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield gs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,c&&(a.e(this,c),c.bounds&&(this.tileBounds=new yo(c.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:i})))}catch(c){this._tileJSONRequest=null,this.fire(new a.k(c))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load(!0)}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return a.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return a._(this,void 0,void 0,function*(){const c=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const g=yield ze.getImage(this.map._requestManager.transformRequest(c,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&i.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const _=this.map.painter.context,S=_.gl,C=g.data;i.texture=this.map.painter.getTileTexture(C.width),i.texture?i.texture.update(C,{useMipmap:!0}):(i.texture=new He(_,C,S.RGBA,{useMipmap:!0}),i.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(g){if(delete i.abortController,i.aborted)i.state="unloaded";else if(g)throw i.state="errored",g}})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class Yc extends Rn{constructor(i,c,g,_){super(i,c,g,_),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox",this.redFactor=c.redFactor,this.greenFactor=c.greenFactor,this.blueFactor=c.blueFactor,this.baseShift=c.baseShift}loadTile(i){return a._(this,void 0,void 0,function*(){const c=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(c,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const _=yield ze.getImage(g,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(_&&_.data){const S=_.data;this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&i.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const C=a.b(S)&&a.V()?S:yield this.readImageNow(S),O={type:this.type,uid:i.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const R=yield i.actor.sendAsync({type:"LDT",data:O});i.dem=R,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(_){if(delete i.abortController,i.aborted)i.state="unloaded";else if(_)throw i.state="errored",_}})}readImageNow(i){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.W()){const c=i.width+2,g=i.height+2;try{return new a.R({width:c,height:g},yield a.X(i,-1,-1,c,g))}catch{}}return j.getImageData(i,1)})}_getNeighboringTiles(i){const c=i.canonical,g=Math.pow(2,c.z),_=(c.x-1+g)%g,S=c.x===0?i.wrap-1:i.wrap,C=(c.x+1+g)%g,O=c.x+1===g?i.wrap+1:i.wrap,R={};return R[new a.Y(i.overscaledZ,S,c.z,_,c.y).key]={backfilled:!1},R[new a.Y(i.overscaledZ,O,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(R[new a.Y(i.overscaledZ,S,c.z,_,c.y-1).key]={backfilled:!1},R[new a.Y(i.overscaledZ,i.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},R[new a.Y(i.overscaledZ,O,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<g&&(R[new a.Y(i.overscaledZ,S,c.z,_,c.y+1).key]={backfilled:!1},R[new a.Y(i.overscaledZ,i.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},R[new a.Y(i.overscaledZ,O,c.z,C,c.y+1).key]={backfilled:!1}),R}unloadTile(i){return a._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class sc extends a.E{constructor(i,c,g,_){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=g.getActor(),this.setEventedParent(_),this._data=c.data,this._options=a.e({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId,c.clusterMaxZoom!==void 0&&this.maxzoom<=c.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${c.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(c.buffer!==void 0?c.buffer:128),tolerance:this._pixelsToTileUnits(c.tolerance!==void 0?c.tolerance:.375),extent:a.Z,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:a.Z,radius:this._pixelsToTileUnits(c.clusterRadius||50),log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(i){return i*(a.Z/this.tileSize)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return a._(this,void 0,void 0,function*(){const i=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}getCoordinatesFromGeometry(i){return i.type==="GeometryCollection"?i.geometries.map(c=>c.coordinates).flat(1/0):i.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const i=new ji,c=yield this.getData();let g;switch(c.type){case"FeatureCollection":g=c.features.map(_=>this.getCoordinatesFromGeometry(_.geometry)).flat(1/0);break;case"Feature":g=this.getCoordinatesFromGeometry(c.geometry);break;default:g=this.getCoordinatesFromGeometry(c)}if(g.length==0)return i;for(let _=0;_<g.length-1;_+=2)i.extend([g[_],g[_+1]]);return i})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(i.clusterRadius)),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,c,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:c,offset:g}})}_updateWorkerData(i){return a._(this,void 0,void 0,function*(){const c=a.e({type:this.type},this.workerOptions);i?c.dataDiff=i:typeof this._data=="string"?(c.request=this.map._requestManager.transformRequest(j.resolveURL(this._data),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.l("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:c});if(this._pendingLoads--,this._removed||g.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));let _=null;g.resourceTiming&&g.resourceTiming[this.id]&&(_=g.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&a.e(S,{resourceTiming:_}),this.fire(new a.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(g){if(this._pendingLoads--,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(g))}})}loaded(){return this._pendingLoads===0}loadTile(i){return a._(this,void 0,void 0,function*(){const c=i.actor?"RT":"LT";i.actor=this.actor;const g={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.abortController=new AbortController;const _=yield this.actor.sendAsync({type:c,data:g},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(_,this.map.painter,c==="RT")})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class tr extends a.E{constructor(i,c,g,_){super(),this.flippedWindingOrder=!1,this.id=i,this.dispatcher=g,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=c}load(i){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const c=yield ze.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,c&&c.data&&(this.image=c.data,i&&(this.coordinates=i),this._finishLoading())}catch(c){this._request=null,this._loaded=!0,this.fire(new a.k(c))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const c=i.map(a.$.fromLngLat);var g;return this.tileID=function(_){let S=1/0,C=1/0,O=-1/0,R=-1/0;for(const H of _)S=Math.min(S,H.x),C=Math.min(C,H.y),O=Math.max(O,H.x),R=Math.max(R,H.y);const B=Math.max(O-S,R-C),V=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),q=Math.pow(2,V);return new a.a1(V,Math.floor((S+O)/2*q),Math.floor((C+R)/2*q))}(c),this.terrainTileRanges=this._getOverlappingTileRanges(c),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=c.map(_=>this.tileID.getTilePoint(_)._round()),this.flippedWindingOrder=((g=this.tileCoords)[1].x-g[0].x)*(g[2].y-g[0].y)-(g[1].y-g[0].y)*(g[2].x-g[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,c=i.gl;this.texture||(this.texture=new He(i,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let g=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,g=!0)}g&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(i){let c=1/0,g=1/0,_=-1/0,S=-1/0;for(const O of i)c=Math.min(c,O.x),g=Math.min(g,O.y),_=Math.max(_,O.x),S=Math.max(S,O.y);const C={};for(let O=0;O<=a.a0;O++){const R=Math.pow(2,O),B=Math.floor(c*R),V=Math.floor(g*R),q=Math.floor(_*R),H=Math.floor(S*R);C[O]={minTileX:B,minTileY:V,maxTileX:q,maxTileY:H}}return C}}class br extends tr{constructor(i,c,g,_){super(i,c,g,_),this.roundZoom=!0,this.type="video",this.options=c}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const c of i.urls)this.urls.push(this.map._requestManager.transformRequest(c,"Source").url);try{const c=yield a.a2(this.urls);if(this._loaded=!0,!c)return;this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(c){this.fire(new a.k(c))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const c=this.video.seekable;i<c.start(0)||i>c.end(0)?this.fire(new a.k(new a.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,c=i.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new He(i,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let g=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,g=!0)}g&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class pl extends tr{constructor(i,c,g,_){super(i,c,g,_),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(C=>typeof C!="number"))||this.fire(new a.k(new a.a3(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a3(`sources.${i}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new a.k(new a.a3(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a3(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a3(`sources.${i}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context,g=c.gl;this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new He(c,this.canvas,g.RGBA,{premultiply:!0});let _=!1;for(const S in this.tiles){const C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,_=!0)}_&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Kr={},Jc=x=>{switch(x){case"geojson":return sc;case"image":return tr;case"raster":return Rn;case"raster-dem":return Yc;case"vector":return wa;case"video":return br;case"canvas":return pl}return Kr[x]},rc="RTLPluginLoaded";class _o extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ni()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(c=>{throw this.status="error",c})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return a._(this,arguments,void 0,function*(c,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(c),!this.url)throw new Error(`requested url ${c} is invalid`);if(this.status==="unavailable"){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(rc))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Kn=null;function ys(){return Kn||(Kn=new _o),Kn}class Yn{constructor(i,c){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=a.a4(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const c=i+this.timeAdded;c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,c,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(_,S){const C={};if(!S)return C;for(const O of _){const R=O.layerIds.map(B=>S.getLayer(B)).filter(Boolean);if(R.length!==0){O.layers=R,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map(B=>R.filter(V=>V.id===B)[0]));for(const B of R)C[B.id]=O}}return C}(i.buckets,c==null?void 0:c.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const S=this.buckets[_];if(S instanceof a.a6){if(this.hasSymbolBuckets=!0,!g)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const S=this.buckets[_];if(S instanceof a.a6&&S.hasRTLText){this.hasRTLText=!0,ys().lazyLoad();break}}this.queryPadding=0;for(const _ in this.buckets){const S=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(_).queryRadius(S))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const g in this.buckets){const _=this.buckets[g];_.uploadPending()&&_.upload(i)}const c=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new He(i,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new He(i,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,c,g,_,S,C,O,R,B,V,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:S,scale:C,tileSize:this.tileSize,pixelPosMatrix:V,transform:R,params:O,queryPadding:this.queryPadding*B,getElevation:q},i,c,g):{}}querySourceFeatures(i,c){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const _=g.loadVTLayers(),S=c&&c.sourceLayer?c.sourceLayer:"",C=_._geojsonTileLayer||_[S];if(!C)return;const O=a.a7(c&&c.filter),{z:R,x:B,y:V}=this.tileID.canonical,q={z:R,x:B,y:V};for(let H=0;H<C.length;H++){const W=C.feature(H);if(O.needGeometry){const ce=a.a8(W,!0);if(!O.filter(new a.C(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!O.filter(new a.C(this.tileID.overscaledZ),W))continue;const Y=g.getId(W,S),ue=new a.a9(W,R,B,V,Y);ue.tile=q,i.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const g=a.aa(i.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const g=Date.now();let _=!1;if(this.expirationTime>g)_=!1;else if(c)if(this.expirationTime<c)_=!0;else{const S=this.expirationTime-c;S?this.expirationTime=g+Math.max(S,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!c.style.hasLayer(_))continue;const S=this.buckets[_],C=S.layers[0].sourceLayer||"_geojsonTileLayer",O=g[C],R=i[C];if(!O||!R||Object.keys(R).length===0)continue;S.update(R,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=c&&c.style&&c.style.getLayer(_);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=j.now()+i}setDependencies(i,c){const g={};for(const _ of c)g[_]=!0;this.dependencies[i]=g}hasDependency(i,c){for(const g of i){const _=this.dependencies[g];if(_){for(const S of c)if(_[S])return!0}}return!1}}class Uo{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,g){const _=i.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const S={value:c,timeout:void 0};if(g!==void 0&&(S.timeout=setTimeout(()=>{this.remove(i,S)},g)),this.data[_].push(S),this.order.push(_),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const g=i.wrapped().key,_=c===void 0?0:this.data[g].indexOf(c),S=this.data[g][_];return this.data[g].splice(_,1),S.timeout&&clearTimeout(S.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(S.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const g in this.data)for(const _ of this.data[g])i(_.value)||c.push(_);for(const g of c)this.remove(g.value.tileID,g)}}class Sa{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,g){const _=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][_]=this.stateChanges[i][_]||{},a.e(this.stateChanges[i][_],g),this.deletedStates[i]===null){this.deletedStates[i]={};for(const S in this.state[i])S!==_&&(this.deletedStates[i][S]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][_]===null){this.deletedStates[i][_]={};for(const S in this.state[i][_])g[S]||(this.deletedStates[i][_][S]=null)}else for(const S in g)this.deletedStates[i]&&this.deletedStates[i][_]&&this.deletedStates[i][_][S]===null&&delete this.deletedStates[i][_][S]}removeFeatureState(i,c,g){if(this.deletedStates[i]===null)return;const _=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},g&&c!==void 0)this.deletedStates[i][_]!==null&&(this.deletedStates[i][_]=this.deletedStates[i][_]||{},this.deletedStates[i][_][g]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][_])for(g in this.deletedStates[i][_]={},this.stateChanges[i][_])this.deletedStates[i][_][g]=null;else this.deletedStates[i][_]=null;else this.deletedStates[i]=null}getState(i,c){const g=String(c),_=a.e({},(this.state[i]||{})[g],(this.stateChanges[i]||{})[g]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const S=this.deletedStates[i][c];if(S===null)return{};for(const C in S)delete _[C]}return _}initializeTileState(i,c){i.setFeatureState(this.state,c)}coalesceChanges(i,c){const g={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const S={};for(const C in this.stateChanges[_])this.state[_][C]||(this.state[_][C]={}),a.e(this.state[_][C],this.stateChanges[_][C]),S[C]=this.state[_][C];g[_]=S}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const S={};if(this.deletedStates[_]===null)for(const C in this.state[_])S[C]={},this.state[_][C]={};else for(const C in this.deletedStates[_]){if(this.deletedStates[_][C]===null)this.state[_][C]={};else for(const O of Object.keys(this.deletedStates[_][C]))delete this.state[_][C][O];S[C]=this.state[_][C]}g[_]=g[_]||{},a.e(g[_],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const _ in i)i[_].setFeatureState(g,c)}}const bo=89.25;function _s(x,i){const c=a.ae(i.lat,-85.051129,a.af);return new a.P(a.U(i.lng)*x,a.S(c)*x)}function Lr(x,i){return new a.$(i.x/x,i.y/x).toLngLat()}function De(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(a.ab(90-x.pitch)),Math.tan(a.ab(bo-x.pitch)))}function ee(x,i){const c=x.canonical,g=i/a.ac(c.z),_=c.x+Math.pow(2,c.z)*x.wrap,S=a.ad(new Float64Array(16));return a.L(S,S,[_*g,c.y*g,0]),a.M(S,S,[g/a.Z,g/a.Z,1]),S}function te(x,i,c,g,_){const S=a.$.fromLngLat(x,i),C=_*a.ag(1,x.lat),O=C*Math.cos(a.ab(c)),R=Math.sqrt(C*C-O*O),B=R*Math.sin(a.ab(-g)),V=R*Math.cos(a.ab(-g));return new a.$(S.x+B,S.y+V,S.z+O)}function ae(x,i,c){const g=i.intersectsFrustum(x);if(!c)return g;const _=i.intersectsPlane(c);return g===0||_===0?0:g===2&&_===2?2:1}function ge(x,i,c){let g=0;const _=(c-i)/10;for(let S=0;S<10;S++)g+=_*Math.pow(Math.cos(i+(S+.5)/10*(c-i)),x);return g}function ne(x,i){return function(c,g,_,S,C){const O=2*((x-1)/a.ah(Math.cos(a.ab(bo-C))/Math.cos(a.ab(bo)))-1),R=Math.acos(_/S),B=2*ge(O-1,0,a.ab(C/2)),V=Math.min(a.ab(bo),R+a.ab(C/2)),q=ge(O-1,Math.min(V,R-a.ab(C/2)),V),H=Math.atan(g/_),W=Math.hypot(g,_);let Y=c;return Y+=a.ah(S/W/Math.max(.5,Math.cos(a.ab(C/2)))),Y+=O*a.ah(Math.cos(H))/2,Y-=a.ah(Math.max(1,q/B/i))/2,Y}}const Oe=ne(9.314,3);function Ve(x,i){const c=(i.roundZoom?Math.round:Math.floor)(x.zoom+a.ah(x.tileSize/i.tileSize));return Math.max(0,c)}function Te(x,i){const c=x.getCameraFrustum(),g=x.getClippingPlane(),_=x.screenPointToMercatorCoordinate(x.getCameraPoint()),S=a.$.fromLngLat(x.center,x.elevation);_.z=S.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;const C=x.getCoveringTilesDetailsProvider(),O=C.allowVariableZoom(x,i),R=Ve(x,i),B=i.minzoom||0,V=i.maxzoom!==void 0?i.maxzoom:x.maxZoom,q=Math.min(Math.max(0,R),V),H=Math.pow(2,q),W=[H*_.x,H*_.y,0],Y=[H*S.x,H*S.y,0],ue=Math.hypot(S.x-_.x,S.y-_.y),ce=Math.abs(S.z-_.z),he=Math.hypot(ue,ce),de=Me=>({zoom:0,x:0,y:0,wrap:Me,fullyVisible:!1}),_e=[],be=[];if(x.renderWorldCopies&&C.allowWorldCopies())for(let Me=1;Me<=3;Me++)_e.push(de(-Me)),_e.push(de(Me));for(_e.push(de(0));_e.length>0;){const Me=_e.pop(),Pe=Me.x,Ce=Me.y;let Ne=Me.fullyVisible;const qe={x:Pe,y:Ce,z:Me.zoom},it=C.getTileAABB(qe,Me.wrap,x.elevation,i);if(!Ne){const vt=ae(c,it,g);if(vt===0)continue;Ne=vt===2}const tt=C.distanceToTile2d(_.x,_.y,qe,it);let et=R;O&&(et=(i.calculateTileZoom||Oe)(x.zoom+a.ah(x.tileSize/i.tileSize),tt,ce,he,x.fov)),et=(i.roundZoom?Math.round:Math.floor)(et),et=Math.max(0,et);const wt=Math.min(et,V);if(Me.wrap=C.getWrap(S,qe,Me.wrap),Me.zoom>=wt){if(Me.zoom<B)continue;const vt=q-Me.zoom,rt=W[0]-.5-(Pe<<vt),zt=W[1]-.5-(Ce<<vt),ci=i.reparseOverscaled?Math.max(Me.zoom,et):Me.zoom;be.push({tileID:new a.Y(Me.zoom===V?ci:Me.zoom,Me.wrap,Me.zoom,Pe,Ce),distanceSq:a.ai([Y[0]-.5-Pe,Y[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(rt*rt+zt*zt)})}else for(let vt=0;vt<4;vt++)_e.push({zoom:Me.zoom+1,x:(Pe<<1)+vt%2,y:(Ce<<1)+(vt>>1),wrap:Me.wrap,fullyVisible:Ne})}return be.sort((Me,Pe)=>Me.distanceSq-Pe.distanceSq).map(Me=>Me.tileID)}class Qe extends a.E{constructor(i,c,g){super(),this.id=i,this.dispatcher=g,this.on("data",_=>this._dataHandler(_)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((_,S,C,O)=>{const R=new(Jc(S.type))(_,S,C,O);if(R.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${R.id}`);return R})(i,c,g,this),this._tiles={},this._cache=new Uo(0,_=>this._unloadTile(_)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Sa,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const c=this._tiles[i];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,c,g){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,c,g)}catch(_){i.state="errored",_.status!==404?this._source.fire(new a.k(_,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new a.l("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const g=this._tiles[c];g.upload(i),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Ye).map(i=>i.key)}getRenderableIds(i){const c=[];for(const g in this._tiles)this._isIdRenderable(g,i)&&c.push(this._tiles[g]);return i?c.sort((g,_)=>{const S=g.tileID,C=_.tileID,O=new a.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),R=new a.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-C.overscaledZ||R.y-O.y||R.x-O.x}).map(g=>g.tileID.key):c.map(g=>g.tileID).sort(Ye).map(g=>g.key)}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())}reload(i){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)(i||this._tiles[c].state!=="errored")&&this._reloadTile(c,"reloading")}}_reloadTile(i,c){return a._(this,void 0,void 0,function*(){const g=this._tiles[i];g&&(g.state!=="loading"&&(g.state=c),yield this._loadTile(g,i,c))})}_tileLoaded(i,c,g){i.timeAdded=j.now(),g==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const c=this.getRenderableIds();for(let _=0;_<c.length;_++){const S=c[_];if(i.neighboringTiles&&i.neighboringTiles[S]){const C=this.getTileByID(S);g(i,C),g(C,i)}}function g(_,S){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let C=S.tileID.canonical.x-_.tileID.canonical.x;const O=S.tileID.canonical.y-_.tileID.canonical.y,R=Math.pow(2,_.tileID.canonical.z),B=S.tileID.key;C===0&&O===0||Math.abs(O)>1||(Math.abs(C)>1&&(Math.abs(C+R)===1?C+=R:Math.abs(C-R)===1&&(C-=R)),S.dem&&_.dem&&(_.dem.backfillBorder(S.dem,C,O),_.neighboringTiles&&_.neighboringTiles[B]&&(_.neighboringTiles[B].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,g,_){for(const S in this._tiles){let C=this._tiles[S];if(_[S]||!C.hasData()||C.tileID.overscaledZ<=c||C.tileID.overscaledZ>g)continue;let O=C.tileID;for(;C&&C.tileID.overscaledZ>c+1;){const B=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[B.key],C&&C.hasData()&&(O=B)}let R=O;for(;R.overscaledZ>c;)if(R=R.scaledTo(R.overscaledZ-1),i[R.key]||i[R.canonical.key]){_[O.key]=O;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const g=this._loadedParentTiles[i.key];return g&&g.tileID.overscaledZ>=c?g:null}for(let g=i.overscaledZ-1;g>=c;g--){const _=i.scaledTo(g),S=this._getLoadedTile(_);if(S)return S}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const c=Math.ceil(i.width/this._source.tileSize)+1,g=Math.ceil(i.height/this._source.tileSize)+1,_=Math.floor(c*g*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(S)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const g={};for(const _ in this._tiles){const S=this._tiles[_];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),g[S.tileID.key]=S}this._tiles=g;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}_updateCoveredAndRetainedTiles(i,c,g,_,S,C){const O={},R={},B=Object.keys(i),V=j.now();for(const q of B){const H=i[q],W=this._tiles[q];if(!W||W.fadeEndTime!==0&&W.fadeEndTime<=V)continue;const Y=this.findLoadedParent(H,c),ue=this.findLoadedSibling(H),ce=Y||ue||null;ce&&(this._addTile(ce.tileID),O[ce.tileID.key]=ce.tileID),R[q]=H}this._retainLoadedChildren(R,_,g,i);for(const q in O)i[q]||(this._coveredTiles[q]=!0,i[q]=O[q]);if(C){const q={},H={};for(const W of S)this._tiles[W.key].hasData()?q[W.key]=W:H[W.key]=W;for(const W in H){const Y=H[W].children(this._source.maxzoom);this._tiles[Y[0].key]&&this._tiles[Y[1].key]&&this._tiles[Y[2].key]&&this._tiles[Y[3].key]&&(q[Y[0].key]=i[Y[0].key]=Y[0],q[Y[1].key]=i[Y[1].key]=Y[1],q[Y[2].key]=i[Y[2].key]=Y[2],q[Y[3].key]=i[Y[3].key]=Y[3],delete H[W])}for(const W in H){const Y=H[W],ue=this.findLoadedParent(Y,this._source.minzoom),ce=this.findLoadedSibling(Y),he=ue||ce||null;if(he){q[he.tileID.key]=i[he.tileID.key]=he.tileID;for(const de in q)q[de].isChildOf(he.tileID)&&delete q[de]}}for(const W in this._tiles)q[W]||(this._coveredTiles[W]=!0)}}update(i,c){if(!this._sourceLoaded||this._paused)return;let g;this.transform=i,this.terrain=c,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new a.Y(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(g=Te(i,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(g=g.filter(V=>this._source.hasTile(V)))):g=[];const _=Ve(i,this._source),S=Math.max(_-Qe.maxOverzooming,this._source.minzoom),C=Math.max(_+Qe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const q of g)if(q.canonical.z>this._source.minzoom){const H=q.scaledTo(q.canonical.z-1);V[H.key]=H;const W=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));V[W.key]=W}g=g.concat(Object.values(V))}const O=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,O&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(g,_);Re(this._source.type)&&this._updateCoveredAndRetainedTiles(R,S,C,_,g,c);for(const V in R)this._tiles[V].clearFadeHold();const B=a.aj(this._tiles,R);for(const V of B){const q=this._tiles[V];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,c){var g;const _={},S={},C=Math.max(c-Qe.maxOverzooming,this._source.minzoom),O=Math.max(c+Qe.maxUnderzooming,this._source.minzoom),R={};for(const B of i){const V=this._addTile(B);_[B.key]=B,V.hasData()||c<this._source.maxzoom&&(R[B.key]=B)}this._retainLoadedChildren(R,c,O,_);for(const B of i){let V=this._tiles[B.key];if(V.hasData())continue;if(c+1>this._source.maxzoom){const H=B.children(this._source.maxzoom)[0],W=this.getTile(H);if(W&&W.hasData()){_[H.key]=H;continue}}else{const H=B.children(this._source.maxzoom);if(_[H[0].key]&&_[H[1].key]&&_[H[2].key]&&_[H[3].key])continue}let q=V.wasRequested();for(let H=B.overscaledZ-1;H>=C;--H){const W=B.scaledTo(H);if(S[W.key])break;if(S[W.key]=!0,V=this.getTile(W),!V&&q&&(V=this._addTile(W)),V){const Y=V.hasData();if((Y||!(!((g=this.map)===null||g===void 0)&&g.cancelPendingTileRequestsWhileZooming)||q)&&(_[W.key]=W),q=V.wasRequested(),Y)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let g,_=this._tiles[i].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){g=this._loadedParentTiles[_.key];break}c.push(_.key);const S=_.scaledTo(_.overscaledZ-1);if(g=this._getLoadedTile(S),g)break;_=S}for(const S of c)this._loadedParentTiles[S]=g}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const c=this._tiles[i].tileID,g=this._getLoadedTile(c);this._loadedSiblingTiles[c.key]=g}}_addTile(i){let c=this._tiles[i.key];if(c)return c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const g=c;return c||(c=new Yn(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(c,i.key,c.state)),c.uses++,this._tiles[i.key]=c,g||this._source.fire(new a.l("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const g=c.getExpiryTimeout();g&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},g))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}_dataHandler(i){const c=i.sourceDataType;i.dataType==="source"&&c==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&c==="content"&&(this.reload(i.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,c,g){const _=[],S=this.transform;if(!S)return _;const C=g?S.getCameraQueryGeometry(i):i,O=i.map(Y=>S.screenPointToMercatorCoordinate(Y,this.terrain)),R=C.map(Y=>S.screenPointToMercatorCoordinate(Y,this.terrain)),B=this.getIds();let V=1/0,q=1/0,H=-1/0,W=-1/0;for(const Y of R)V=Math.min(V,Y.x),q=Math.min(q,Y.y),H=Math.max(H,Y.x),W=Math.max(W,Y.y);for(let Y=0;Y<B.length;Y++){const ue=this._tiles[B[Y]];if(ue.holdingForFade())continue;const ce=S.getCoveringTilesDetailsProvider().allowWorldCopies()?ue.tileID:ue.tileID.unwrapTo(0),he=Math.pow(2,S.zoom-ue.tileID.overscaledZ),de=c*ue.queryPadding*a.Z/ue.tileSize/he,_e=[ce.getTilePoint(new a.$(V,q)),ce.getTilePoint(new a.$(H,W))];if(_e[0].x-de<a.Z&&_e[0].y-de<a.Z&&_e[1].x+de>=0&&_e[1].y+de>=0){const be=O.map(Pe=>ce.getTilePoint(Pe)),Me=R.map(Pe=>ce.getTilePoint(Pe));_.push({tile:ue,tileID:ce,queryGeometry:be,cameraQueryGeometry:Me,scale:he})}}return _}getVisibleCoordinates(i){const c=this.getRenderableIds(i).map(g=>this._tiles[g].tileID);return this.transform&&this.transform.populateCache(c),c}hasTransition(){if(this._source.hasTransition())return!0;if(Re(this._source.type)){const i=j.now();for(const c in this._tiles)if(this._tiles[c].fadeEndTime>=i)return!0}return!1}setFeatureState(i,c,g){this._state.updateState(i=i||"_geojsonTileLayer",c,g)}removeFeatureState(i,c,g){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,g)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,g){const _=this._tiles[i];_&&_.setDependencies(c,g)}reloadTilesForDependencies(i,c){for(const g in this._tiles)this._tiles[g].hasDependency(i,c)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(i,c))}}function Ye(x,i){const c=Math.abs(2*x.wrap)-+(x.wrap<0),g=Math.abs(2*i.wrap)-+(i.wrap<0);return x.overscaledZ-i.overscaledZ||g-c||i.canonical.y-x.canonical.y||i.canonical.x-x.canonical.x}function Re(x){return x==="raster"||x==="image"||x==="video"}Qe.maxOverzooming=10,Qe.maxUnderzooming=3;class at{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.ae(i,0,1);let c=1,g=this._distances[c];const _=i*this.paddedLength+this.padding;for(;g<_&&c<this._distances.length;)g=this._distances[++c];const S=c-1,C=this._distances[S],O=g-C,R=O>0?(_-C)/O:0;return this.points[S].mult(1-R).add(this.points[c].mult(R))}}function St(x,i){let c=!0;return x==="always"||x!=="never"&&i!=="never"||(c=!1),c}class Ct{constructor(i,c,g){const _=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(i/g),this.yCellCount=Math.ceil(c/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)_.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,g,_,S){this._forEachCell(c,g,_,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(_),this.bboxes.push(S)}insertCircle(i,c,g,_){this._forEachCell(c-_,g-_,c+_,g+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(g),this.circles.push(_)}_insertBoxCell(i,c,g,_,S,C){this.boxCells[S].push(C)}_insertCircleCell(i,c,g,_,S,C){this.circleCells[S].push(C)}_query(i,c,g,_,S,C,O){if(g<0||i>this.width||_<0||c>this.height)return[];const R=[];if(i<=0&&c<=0&&this.width<=g&&this.height<=_){if(S)return[{key:null,x1:i,y1:c,x2:g,y2:_}];for(let B=0;B<this.boxKeys.length;B++)R.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const V=this.circles[3*B],q=this.circles[3*B+1],H=this.circles[3*B+2];R.push({key:this.circleKeys[B],x1:V-H,y1:q-H,x2:V+H,y2:q+H})}}else this._forEachCell(i,c,g,_,this._queryCell,R,{hitTest:S,overlapMode:C,seenUids:{box:{},circle:{}}},O);return R}query(i,c,g,_){return this._query(i,c,g,_,!1,null)}hitTest(i,c,g,_,S,C){return this._query(i,c,g,_,!0,S,C).length>0}hitTestCircle(i,c,g,_,S){const C=i-g,O=i+g,R=c-g,B=c+g;if(O<0||C>this.width||B<0||R>this.height)return!1;const V=[];return this._forEachCell(C,R,O,B,this._queryCellCircle,V,{hitTest:!0,overlapMode:_,circle:{x:i,y:c,radius:g},seenUids:{box:{},circle:{}}},S),V.length>0}_queryCell(i,c,g,_,S,C,O,R){const{seenUids:B,hitTest:V,overlapMode:q}=O,H=this.boxCells[S];if(H!==null){const Y=this.bboxes;for(const ue of H)if(!B.box[ue]){B.box[ue]=!0;const ce=4*ue,he=this.boxKeys[ue];if(i<=Y[ce+2]&&c<=Y[ce+3]&&g>=Y[ce+0]&&_>=Y[ce+1]&&(!R||R(he))&&(!V||!St(q,he.overlapMode))&&(C.push({key:he,x1:Y[ce],y1:Y[ce+1],x2:Y[ce+2],y2:Y[ce+3]}),V))return!0}}const W=this.circleCells[S];if(W!==null){const Y=this.circles;for(const ue of W)if(!B.circle[ue]){B.circle[ue]=!0;const ce=3*ue,he=this.circleKeys[ue];if(this._circleAndRectCollide(Y[ce],Y[ce+1],Y[ce+2],i,c,g,_)&&(!R||R(he))&&(!V||!St(q,he.overlapMode))){const de=Y[ce],_e=Y[ce+1],be=Y[ce+2];if(C.push({key:he,x1:de-be,y1:_e-be,x2:de+be,y2:_e+be}),V)return!0}}}return!1}_queryCellCircle(i,c,g,_,S,C,O,R){const{circle:B,seenUids:V,overlapMode:q}=O,H=this.boxCells[S];if(H!==null){const Y=this.bboxes;for(const ue of H)if(!V.box[ue]){V.box[ue]=!0;const ce=4*ue,he=this.boxKeys[ue];if(this._circleAndRectCollide(B.x,B.y,B.radius,Y[ce+0],Y[ce+1],Y[ce+2],Y[ce+3])&&(!R||R(he))&&!St(q,he.overlapMode))return C.push(!0),!0}}const W=this.circleCells[S];if(W!==null){const Y=this.circles;for(const ue of W)if(!V.circle[ue]){V.circle[ue]=!0;const ce=3*ue,he=this.circleKeys[ue];if(this._circlesCollide(Y[ce],Y[ce+1],Y[ce+2],B.x,B.y,B.radius)&&(!R||R(he))&&!St(q,he.overlapMode))return C.push(!0),!0}}}_forEachCell(i,c,g,_,S,C,O,R){const B=this._convertToXCellCoord(i),V=this._convertToYCellCoord(c),q=this._convertToXCellCoord(g),H=this._convertToYCellCoord(_);for(let W=B;W<=q;W++)for(let Y=V;Y<=H;Y++)if(S.call(this,i,c,g,_,this.xCellCount*Y+W,C,O,R))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,g,_,S,C){const O=_-i,R=S-c,B=g+C;return B*B>O*O+R*R}_circleAndRectCollide(i,c,g,_,S,C,O){const R=(C-_)/2,B=Math.abs(i-(_+R));if(B>R+g)return!1;const V=(O-S)/2,q=Math.abs(c-(S+V));if(q>V+g)return!1;if(B<=R||q<=V)return!0;const H=B-R,W=q-V;return H*H+W*W<=g*g}}function Vt(x,i,c){const g=a.K();if(!x){const{vecSouth:q,vecEast:H}=We(i),W=A();W[0]=H[0],W[1]=H[1],W[2]=q[0],W[3]=q[1],_=W,(V=(C=(S=W)[0])*(B=S[3])-(R=S[2])*(O=S[1]))&&(_[0]=B*(V=1/V),_[1]=-O*V,_[2]=-R*V,_[3]=C*V),g[0]=W[0],g[1]=W[1],g[4]=W[2],g[5]=W[3]}var _,S,C,O,R,B,V;return a.M(g,g,[1/c,1/c,1]),g}function Xt(x,i,c,g){if(x){const _=a.K();if(!i){const{vecSouth:S,vecEast:C}=We(c);_[0]=C[0],_[1]=C[1],_[4]=S[0],_[5]=S[1]}return a.M(_,_,[g,g,1]),_}return c.pixelsToClipSpaceMatrix}function We(x){const i=Math.cos(x.rollInRadians),c=Math.sin(x.rollInRadians),g=Math.cos(x.pitchInRadians),_=Math.cos(x.bearingInRadians),S=Math.sin(x.bearingInRadians),C=a.ao();C[0]=-_*g*c-S*i,C[1]=-S*g*c+_*i;const O=a.ap(C);O<1e-9?a.aq(C):a.ar(C,C,1/O);const R=a.ao();R[0]=_*g*i-S*c,R[1]=S*g*i+_*c;const B=a.ap(R);return B<1e-9?a.aq(R):a.ar(R,R,1/B),{vecEast:R,vecSouth:C}}function Wt(x,i,c,g){let _;g?(_=[x,i,g(x,i),1],a.at(_,_,c)):(_=[x,i,0,1],Wi(_,_,c));const S=_[3];return{point:new a.P(_[0]/S,_[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function _i(x,i){return .5+x/i*.5}function zi(x,i){return x.x>=-i[0]&&x.x<=i[0]&&x.y>=-i[1]&&x.y<=i[1]}function Si(x,i,c,g,_,S,C,O,R,B,V,q,H){const W=c?x.textSizeData:x.iconSizeData,Y=a.ak(W,i.transform.zoom),ue=[256/i.width*2+1,256/i.height*2+1],ce=c?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;ce.clear();const he=x.lineVertexArray,de=c?x.text.placedSymbolArray:x.icon.placedSymbolArray,_e=i.transform.width/i.transform.height;let be=!1;for(let Me=0;Me<de.length;Me++){const Pe=de.get(Me);if(Pe.hidden||Pe.writingMode===a.al.vertical&&!be){os(Pe.numGlyphs,ce);continue}be=!1;const Ce=new a.P(Pe.anchorX,Pe.anchorY),Ne={getElevation:H,pitchedLabelPlaneMatrix:g,lineVertexArray:he,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:Ce,unwrappedTileID:R,width:B,height:V,translation:q},qe=En(Pe.anchorX,Pe.anchorY,Ne);if(!zi(qe.point,ue)){os(Pe.numGlyphs,ce);continue}const it=_i(i.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),tt=a.am(W,Y,Pe),et=S?tt*i.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,R)/it:tt*it,wt=Qt({projectionContext:Ne,pitchedLabelPlaneMatrixInverse:_,symbol:Pe,fontSize:et,flip:!1,keepUpright:C,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:ce,aspectRatio:_e,rotateToLine:O});be=wt.useVertical,(wt.notEnoughRoom||be||wt.needsFlipping&&Qt({projectionContext:Ne,pitchedLabelPlaneMatrixInverse:_,symbol:Pe,fontSize:et,flip:!0,keepUpright:C,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:ce,aspectRatio:_e,rotateToLine:O}).notEnoughRoom)&&os(Pe.numGlyphs,ce)}c?x.text.dynamicLayoutVertexBuffer.updateData(ce):x.icon.dynamicLayoutVertexBuffer.updateData(ce)}function st(x,i,c,g,_,S,C,O){const R=S.glyphStartIndex+S.numGlyphs,B=S.lineStartIndex,V=S.lineStartIndex+S.lineLength,q=i.getoffsetX(S.glyphStartIndex),H=i.getoffsetX(R-1),W=ir(x*q,c,g,_,S.segment,B,V,O,C);if(!W)return null;const Y=ir(x*H,c,g,_,S.segment,B,V,O,C);return Y?O.projectionCache.anyProjectionOccluded?null:{first:W,last:Y}:null}function kt(x,i,c,g){return x===a.al.horizontal&&Math.abs(c.y-i.y)>Math.abs(c.x-i.x)*g?{useVertical:!0}:(x===a.al.vertical?i.y<c.y:i.x>c.x)?{needsFlipping:!0}:null}function Qt(x){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:c,symbol:g,fontSize:_,flip:S,keepUpright:C,glyphOffsetArray:O,dynamicLayoutVertexArray:R,aspectRatio:B,rotateToLine:V}=x,q=_/24,H=g.lineOffsetX*q,W=g.lineOffsetY*q;let Y;if(g.numGlyphs>1){const ue=g.glyphStartIndex+g.numGlyphs,ce=g.lineStartIndex,he=g.lineStartIndex+g.lineLength,de=st(q,O,H,W,S,g,V,i);if(!de)return{notEnoughRoom:!0};const _e=ti(de.first.point.x,de.first.point.y,i,c),be=ti(de.last.point.x,de.last.point.y,i,c);if(C&&!S){const Me=kt(g.writingMode,_e,be,B);if(Me)return Me}Y=[de.first];for(let Me=g.glyphStartIndex+1;Me<ue-1;Me++)Y.push(ir(q*O.getoffsetX(Me),H,W,S,g.segment,ce,he,i,V));Y.push(de.last)}else{if(C&&!S){const ce=Vi(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,he=g.lineStartIndex+g.segment+1,de=new a.P(i.lineVertexArray.getx(he),i.lineVertexArray.gety(he)),_e=Vi(de.x,de.y,i),be=_e.signedDistanceFromCamera>0?_e.point:Vn(i.tileAnchorPoint,de,ce,1,i),Me=ti(ce.x,ce.y,i,c),Pe=ti(be.x,be.y,i,c),Ce=kt(g.writingMode,Me,Pe,B);if(Ce)return Ce}const ue=ir(q*O.getoffsetX(g.glyphStartIndex),H,W,S,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,i,V);if(!ue||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Y=[ue]}for(const ue of Y)a.as(R,ue.point,ue.angle);return{}}function Vn(x,i,c,g,_){const S=x.add(x.sub(i)._unit()),C=Vi(S.x,S.y,_).point,O=c.sub(C);return c.add(O._mult(g/O.mag()))}function In(x,i,c){const g=i.projectionCache;if(g.projections[x])return g.projections[x];const _=new a.P(i.lineVertexArray.getx(x),i.lineVertexArray.gety(x)),S=Vi(_.x,_.y,i);if(S.signedDistanceFromCamera>0)return g.projections[x]=S.point,g.anyProjectionOccluded=g.anyProjectionOccluded||S.isOccluded,S.point;const C=x-c.direction;return Vn(c.distanceFromAnchor===0?i.tileAnchorPoint:new a.P(i.lineVertexArray.getx(C),i.lineVertexArray.gety(C)),_,c.previousVertex,c.absOffsetX-c.distanceFromAnchor+1,i)}function Vi(x,i,c){const g=x+c.translation[0],_=i+c.translation[1];let S;return c.pitchWithMap?(S=Wt(g,_,c.pitchedLabelPlaneMatrix,c.getElevation),S.isOccluded=!1):(S=c.transform.projectTileCoordinates(g,_,c.unwrappedTileID,c.getElevation),S.point.x=(.5*S.point.x+.5)*c.width,S.point.y=(.5*-S.point.y+.5)*c.height),S}function ti(x,i,c,g){if(c.pitchWithMap){const _=[x,i,0,1];return a.at(_,_,g),c.transform.projectTileCoordinates(_[0]/_[3],_[1]/_[3],c.unwrappedTileID,c.getElevation).point}return{x:x/c.width*2-1,y:i/c.height*2-1}}function En(x,i,c){return c.transform.projectTileCoordinates(x,i,c.unwrappedTileID,c.getElevation)}function Ta(x,i,c){return x._unit()._perp()._mult(i*c)}function eu(x,i,c,g,_,S,C,O,R){if(O.projectionCache.offsets[x])return O.projectionCache.offsets[x];const B=c.add(i);if(x+R.direction<g||x+R.direction>=_)return O.projectionCache.offsets[x]=B,B;const V=In(x+R.direction,O,R),q=Ta(V.sub(c),C,R.direction),H=c.add(q),W=V.add(q);return O.projectionCache.offsets[x]=a.au(S,B,H,W)||B,O.projectionCache.offsets[x]}function ir(x,i,c,g,_,S,C,O,R){const B=g?x-i:x+i;let V=B>0?1:-1,q=0;g&&(V*=-1,q=Math.PI),V<0&&(q+=Math.PI);let H,W=V>0?S+_:S+_+1;O.projectionCache.cachedAnchorPoint?H=O.projectionCache.cachedAnchorPoint:(H=Vi(O.tileAnchorPoint.x,O.tileAnchorPoint.y,O).point,O.projectionCache.cachedAnchorPoint=H);let Y,ue,ce=H,he=H,de=0,_e=0;const be=Math.abs(B),Me=[];let Pe;for(;de+_e<=be;){if(W+=V,W<S||W>=C)return null;de+=_e,he=ce,ue=Y;const qe={absOffsetX:be,direction:V,distanceFromAnchor:de,previousVertex:he};if(ce=In(W,O,qe),c===0)Me.push(he),Pe=ce.sub(he);else{let it;const tt=ce.sub(he);it=tt.mag()===0?Ta(In(W+V,O,qe).sub(ce),c,V):Ta(tt,c,V),ue||(ue=he.add(it)),Y=eu(W,it,ce,S,C,ue,c,O,qe),Me.push(ue),Pe=Y.sub(ue)}_e=Pe.mag()}const Ce=Pe._mult((be-de)/_e)._add(ue||he),Ne=q+Math.atan2(ce.y-he.y,ce.x-he.x);return Me.push(Ce),{point:Ce,angle:R?Ne:0,path:Me}}const qo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function os(x,i){for(let c=0;c<x;c++){const g=i.length;i.resize(g+4),i.float32.set(qo,3*g)}}function Wi(x,i,c){const g=i[0],_=i[1];return x[0]=c[0]*g+c[4]*_+c[12],x[1]=c[1]*g+c[5]*_+c[13],x[3]=c[3]*g+c[7]*_+c[15],x}const Jn=100;class tu{constructor(i,c=new Ct(i.width+200,i.height+200,25),g=new Ct(i.width+200,i.height+200,25)){this.transform=i,this.grid=c,this.ignoredGrid=g,this.pitchFactor=Math.cos(i.pitch*Math.PI/180)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Jn,this.screenBottomBoundary=i.height+Jn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,c,g,_,S,C,O,R,B,V,q,H){const W=this.projectAndGetPerspectiveRatio(i.anchorPointX+R[0],i.anchorPointY+R[1],S,V,H),Y=g*W.perspectiveRatio;let ue;if(C||O)ue=this._projectCollisionBox(i,Y,_,S,C,O,R,W,V,q,H);else{const Pe=W.x+(q?q.x*Y:0),Ce=W.y+(q?q.y*Y:0);ue={allPointsOccluded:!1,box:[Pe+i.x1*Y,Ce+i.y1*Y,Pe+i.x2*Y,Ce+i.y2*Y]}}const[ce,he,de,_e]=ue.box,be=C?ue.allPointsOccluded:W.isOccluded;let Me=be;return Me||(Me=W.perspectiveRatio<this.perspectiveRatioCutoff),Me||(Me=!this.isInsideGrid(ce,he,de,_e)),Me||c!=="always"&&this.grid.hitTest(ce,he,de,_e,c,B)?{box:[ce,he,de,_e],placeable:!1,offscreen:!1,occluded:be}:{box:[ce,he,de,_e],placeable:!0,offscreen:this.isOffscreen(ce,he,de,_e),occluded:be}}placeCollisionCircles(i,c,g,_,S,C,O,R,B,V,q,H,W,Y){const ue=[],ce=new a.P(c.anchorX,c.anchorY),he=this.getPerspectiveRatio(ce.x,ce.y,C,Y),de=(B?S*this.transform.getPitchedTextCorrection(c.anchorX,c.anchorY,C)/he:S*he)/a.ay,_e={getElevation:Y,pitchedLabelPlaneMatrix:O,lineVertexArray:g,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ce,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:W},be=st(de,_,c.lineOffsetX*de,c.lineOffsetY*de,!1,c,!1,_e);let Me=!1,Pe=!1,Ce=!0;if(be){const Ne=.5*q*he+H,qe=new a.P(-100,-100),it=new a.P(this.screenRightBoundary,this.screenBottomBoundary),tt=new at,et=be.first,wt=be.last;let vt=[];for(let ci=et.path.length-1;ci>=1;ci--)vt.push(et.path[ci]);for(let ci=1;ci<wt.path.length;ci++)vt.push(wt.path[ci]);const rt=2.5*Ne;if(B){const ci=this.projectPathToScreenSpace(vt,_e);vt=ci.some(ii=>ii.signedDistanceFromCamera<=0)?[]:ci.map(ii=>ii.point)}let zt=[];if(vt.length>0){const ci=vt[0].clone(),ii=vt[0].clone();for(let cn=1;cn<vt.length;cn++)ci.x=Math.min(ci.x,vt[cn].x),ci.y=Math.min(ci.y,vt[cn].y),ii.x=Math.max(ii.x,vt[cn].x),ii.y=Math.max(ii.y,vt[cn].y);zt=ci.x>=qe.x&&ii.x<=it.x&&ci.y>=qe.y&&ii.y<=it.y?[vt]:ii.x<qe.x||ci.x>it.x||ii.y<qe.y||ci.y>it.y?[]:a.av([vt],qe.x,qe.y,it.x,it.y)}for(const ci of zt){tt.reset(ci,.25*Ne);let ii=0;ii=tt.length<=.5*Ne?1:Math.ceil(tt.paddedLength/rt)+1;for(let cn=0;cn<ii;cn++){const Ii=cn/Math.max(ii-1,1),un=tt.lerp(Ii),Zi=un.x+Jn,Li=un.y+Jn;ue.push(Zi,Li,Ne,0);const Oi=Zi-Ne,qn=Li-Ne,Hn=Zi+Ne,cs=Li+Ne;if(Ce=Ce&&this.isOffscreen(Oi,qn,Hn,cs),Pe=Pe||this.isInsideGrid(Oi,qn,Hn,cs),i!=="always"&&this.grid.hitTestCircle(Zi,Li,Ne,i,V)&&(Me=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!R&&Me||!Pe||he<this.perspectiveRatioCutoff?[]:ue,offscreen:Ce,collisionDetected:Me}}projectPathToScreenSpace(i,c){const g=function(_,S){const C=a.K();return a.an(C,S.pitchedLabelPlaneMatrix),_.map(O=>{const R=Wt(O.x,O.y,C,S.getElevation),B=S.transform.projectTileCoordinates(R.point.x,R.point.y,S.unwrappedTileID,S.getElevation);return B.point.x=(.5*B.point.x+.5)*S.width,B.point.y=(.5*-B.point.y+.5)*S.height,B})}(i,c);return function(_){let S=0,C=0,O=0,R=0;for(let B=0;B<_.length;B++)_[B].isOccluded?(O=B+1,R=0):(R++,R>C&&(C=R,S=O));return _.slice(S,S+C)}(g)}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let g=1/0,_=1/0,S=-1/0,C=-1/0;for(const V of i){const q=new a.P(V.x+Jn,V.y+Jn);g=Math.min(g,q.x),_=Math.min(_,q.y),S=Math.max(S,q.x),C=Math.max(C,q.y),c.push(q)}const O=this.grid.query(g,_,S,C).concat(this.ignoredGrid.query(g,_,S,C)),R={},B={};for(const V of O){const q=V.key;if(R[q.bucketInstanceId]===void 0&&(R[q.bucketInstanceId]={}),R[q.bucketInstanceId][q.featureIndex])continue;const H=[new a.P(V.x1,V.y1),new a.P(V.x2,V.y1),new a.P(V.x2,V.y2),new a.P(V.x1,V.y2)];a.aw(c,H)&&(R[q.bucketInstanceId][q.featureIndex]=!0,B[q.bucketInstanceId]===void 0&&(B[q.bucketInstanceId]=[]),B[q.bucketInstanceId].push(q.featureIndex))}return B}insertCollisionBox(i,c,g,_,S,C){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:S,collisionGroupID:C,overlapMode:c},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,g,_,S,C){const O=g?this.ignoredGrid:this.grid,R={bucketInstanceId:_,featureIndex:S,collisionGroupID:C,overlapMode:c};for(let B=0;B<i.length;B+=4)O.insertCircle(R,i[B],i[B+1],i[B+2])}projectAndGetPerspectiveRatio(i,c,g,_,S){if(S){let C;_?(C=[i,c,_(i,c),1],a.at(C,C,S)):(C=[i,c,0,1],Wi(C,C,S));const O=C[3];return{x:(C[0]/O+1)/2*this.transform.width+Jn,y:(-C[1]/O+1)/2*this.transform.height+Jn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O*.5,isOccluded:!1,signedDistanceFromCamera:O}}{const C=this.transform.projectTileCoordinates(i,c,g,_);return{x:(C.point.x+1)/2*this.transform.width+Jn,y:(1-C.point.y)/2*this.transform.height+Jn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(i,c,g,_){const S=this.transform.projectTileCoordinates(i,c,g,_);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(i,c,g,_){return g<Jn||i>=this.screenRightBoundary||_<Jn||c>this.screenBottomBoundary}isInsideGrid(i,c,g,_){return g>=0&&i<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=a.ad([]);return a.L(i,i,[-100,-100,0]),i}_projectCollisionBox(i,c,g,_,S,C,O,R,B,V,q){let H=1,W=0,Y=0,ue=1;const ce=i.anchorPointX+O[0],he=i.anchorPointY+O[1];if(C&&!S){const vt=this.projectAndGetPerspectiveRatio(ce+1,he,_,B,q),rt=vt.x-R.x,zt=Math.atan((vt.y-R.y)/rt)+(rt<0?Math.PI:0),ci=Math.sin(zt),ii=Math.cos(zt);H=ii,W=ci,Y=-ci,ue=ii}else if(!C&&S){const vt=We(this.transform);H=vt.vecEast[0],W=vt.vecEast[1],Y=vt.vecSouth[0],ue=vt.vecSouth[1]}let de=R.x,_e=R.y,be=c;S&&(de=ce,_e=he,be=Math.pow(2,-(this.transform.zoom-g.overscaledZ)),be*=this.transform.getPitchedTextCorrection(ce,he,_),V||(be*=a.ae(.5+R.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),V&&(de+=H*V.x*be+Y*V.y*be,_e+=W*V.x*be+ue*V.y*be);const Me=i.x1*be,Pe=i.x2*be,Ce=(Me+Pe)/2,Ne=i.y1*be,qe=i.y2*be,it=(Ne+qe)/2,tt=[{offsetX:Me,offsetY:Ne},{offsetX:Ce,offsetY:Ne},{offsetX:Pe,offsetY:Ne},{offsetX:Pe,offsetY:it},{offsetX:Pe,offsetY:qe},{offsetX:Ce,offsetY:qe},{offsetX:Me,offsetY:qe},{offsetX:Me,offsetY:it}];let et=[];for(const{offsetX:vt,offsetY:rt}of tt)et.push(new a.P(de+H*vt+Y*rt,_e+W*vt+ue*rt));let wt=!1;if(S){const vt=et.map(rt=>this.projectAndGetPerspectiveRatio(rt.x,rt.y,_,B,q));wt=vt.some(rt=>!rt.isOccluded),et=vt.map(rt=>new a.P(rt.x,rt.y))}else wt=!0;return{box:a.ax(et),allPointsOccluded:!wt}}}class ml{constructor(i,c,g,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):_&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class nr{constructor(i,c,g,_,S){this.text=new ml(i?i.text:null,c,g,S),this.icon=new ml(i?i.icon:null,c,_,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zs{constructor(i,c,g){this.text=i,this.icon=c,this.skipFade=g}}class ah{constructor(i,c,g,_,S){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=_,this.tileID=S}}class Ef{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[i]}}function Ma(x,i,c,g,_){const{horizontalAlign:S,verticalAlign:C}=a.aE(x);return new a.P(-(S-.5)*i+g[0]*_,-(C-.5)*c+g[1]*_)}class Ca{constructor(i,c,g,_,S){this.transform=i.clone(),this.terrain=c,this.collisionIndex=new tu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Ef(_),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const c=this.terrain;return c?(g,_)=>c.getElevation(i,g,_):null}getBucketParts(i,c,g,_){const S=g.getBucket(c),C=g.latestFeatureIndex;if(!S||!C||c.id!==S.layerIds[0])return;const O=g.collisionBoxArray,R=S.layers[0].layout,B=S.layers[0].paint,V=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),q=g.tileSize/a.Z,H=g.tileID.toUnwrapped(),W=R.get("text-rotation-alignment")==="map",Y=a.az(g,1,this.transform.zoom),ue=a.aA(this.collisionIndex.transform,g,B.get("text-translate"),B.get("text-translate-anchor")),ce=a.aA(this.collisionIndex.transform,g,B.get("icon-translate"),B.get("icon-translate-anchor")),he=Vt(W,this.transform,Y);this.retainedQueryData[S.bucketInstanceId]=new ah(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,g.tileID);const de={bucket:S,layout:R,translationText:ue,translationIcon:ce,unwrappedTileID:H,pitchedLabelPlaneMatrix:he,scale:V,textPixelRatio:q,holdingForFade:g.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:a.ak(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(_)for(const _e of S.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Me,symbolInstanceEnd:Pe}=_e;i.push({sortKey:be,symbolInstanceStart:Me,symbolInstanceEnd:Pe,parameters:de})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:de})}attemptAnchorPlacement(i,c,g,_,S,C,O,R,B,V,q,H,W,Y,ue,ce,he,de,_e,be){const Me=a.aB[i.textAnchor],Pe=[i.textOffset0,i.textOffset1],Ce=Ma(Me,g,_,Pe,S),Ne=this.collisionIndex.placeCollisionBox(c,H,R,B,V,O,C,ce,q.predicate,_e,Ce,be);if((!de||this.collisionIndex.placeCollisionBox(de,H,R,B,V,O,C,he,q.predicate,_e,Ce,be).placeable)&&Ne.placeable){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:Pe,width:g,height:_,anchor:Me,textBoxScale:S,prevAnchor:qe},this.markUsedJustification(Y,Me,W,ue),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,ue,W),this.placedOrientations[W.crossTileID]=ue),{shift:Ce,placedGlyphBoxes:Ne}}}placeLayerBucketPart(i,c,g){const{bucket:_,layout:S,translationText:C,translationIcon:O,unwrappedTileID:R,pitchedLabelPlaneMatrix:B,textPixelRatio:V,holdingForFade:q,collisionBoxArray:H,partiallyEvaluatedTextSize:W,collisionGroup:Y}=i.parameters,ue=S.get("text-optional"),ce=S.get("icon-optional"),he=a.aC(S,"text-overlap","text-allow-overlap"),de=he==="always",_e=a.aC(S,"icon-overlap","icon-allow-overlap"),be=_e==="always",Me=S.get("text-rotation-alignment")==="map",Pe=S.get("text-pitch-alignment")==="map",Ce=S.get("icon-text-fit")!=="none",Ne=S.get("symbol-z-order")==="viewport-y",qe=de&&(be||!_.hasIconData()||ce),it=be&&(de||!_.hasTextData()||ue);!_.collisionArrays&&H&&_.deserializeCollisionBoxes(H);const tt=this.retainedQueryData[_.bucketInstanceId].tileID,et=this._getTerrainElevationFunc(tt),wt=this.transform.getFastPathSimpleProjectionMatrix(tt),vt=(rt,zt,ci)=>{var ii,cn;if(c[rt.crossTileID])return;if(q)return void(this.placements[rt.crossTileID]=new Zs(!1,!1,!1));let Ii=!1,un=!1,Zi=!0,Li=null,Oi={box:null,placeable:!1,offscreen:null,occluded:!1},qn={placeable:!1},Hn=null,cs=null,Ns=null,Ur=0,ra=0,Oo=0;zt.textFeatureIndex?Ur=zt.textFeatureIndex:rt.useRuntimeCollisionCircles&&(Ur=rt.featureIndex),zt.verticalTextFeatureIndex&&(ra=zt.verticalTextFeatureIndex);const ao=zt.textBox;if(ao){const Tr=Yi=>{let Ji=a.al.horizontal;if(_.allowVerticalPlacement&&!Yi&&this.prevPlacement){const Tn=this.prevPlacement.placedOrientations[rt.crossTileID];Tn&&(this.placedOrientations[rt.crossTileID]=Tn,Ji=Tn,this.markUsedOrientation(_,Ji,rt))}return Ji},oa=(Yi,Ji)=>{if(_.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&zt.verticalTextBox){for(const Tn of _.writingModes)if(Tn===a.al.vertical?(Oi=Ji(),qn=Oi):Oi=Yi(),Oi&&Oi.placeable)break}else Oi=Yi()},Mr=rt.textAnchorOffsetStartIndex,co=rt.textAnchorOffsetEndIndex;if(co===Mr){const Yi=(Ji,Tn)=>{const Gi=this.collisionIndex.placeCollisionBox(Ji,he,V,tt,R,Pe,Me,C,Y.predicate,et,void 0,wt);return Gi&&Gi.placeable&&(this.markUsedOrientation(_,Tn,rt),this.placedOrientations[rt.crossTileID]=Tn),Gi};oa(()=>Yi(ao,a.al.horizontal),()=>{const Ji=zt.verticalTextBox;return _.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&Ji?Yi(Ji,a.al.vertical):{box:null,offscreen:null}}),Tr(Oi&&Oi.placeable)}else{let Yi=a.aB[(cn=(ii=this.prevPlacement)===null||ii===void 0?void 0:ii.variableOffsets[rt.crossTileID])===null||cn===void 0?void 0:cn.anchor];const Ji=(Gi,rd,Qa)=>{const Gm=Gi.x2-Gi.x1,Nl=Gi.y2-Gi.y1,Fl=rt.textBoxScale,Du=Ce&&_e==="never"?rd:null;let Ts=null,uo=he==="never"?1:2,Bh="never";Yi&&uo++;for(let od=0;od<uo;od++){for(let Do=Mr;Do<co;Do++){const Nh=_.textAnchorOffsets.get(Do);if(Yi&&Nh.textAnchor!==Yi)continue;const hr=this.attemptAnchorPlacement(Nh,Gi,Gm,Nl,Fl,Me,Pe,V,tt,R,Y,Bh,rt,_,Qa,C,O,Du,et);if(hr&&(Ts=hr.placedGlyphBoxes,Ts&&Ts.placeable))return Ii=!0,Li=hr.shift,Ts}Yi?Yi=null:Bh=he}return g&&!Ts&&(Ts={box:this.collisionIndex.placeCollisionBox(ao,"always",V,tt,R,Pe,Me,C,Y.predicate,et,void 0,wt).box,offscreen:!1,placeable:!1,occluded:!1}),Ts};oa(()=>Ji(ao,zt.iconBox,a.al.horizontal),()=>{const Gi=zt.verticalTextBox;return _.allowVerticalPlacement&&(!Oi||!Oi.placeable)&&rt.numVerticalGlyphVertices>0&&Gi?Ji(Gi,zt.verticalIconBox,a.al.vertical):{box:null,occluded:!0,offscreen:null}}),Oi&&(Ii=Oi.placeable,Zi=Oi.offscreen);const Tn=Tr(Oi&&Oi.placeable);if(!Ii&&this.prevPlacement){const Gi=this.prevPlacement.variableOffsets[rt.crossTileID];Gi&&(this.variableOffsets[rt.crossTileID]=Gi,this.markUsedJustification(_,Gi.anchor,rt,Tn))}}}if(Hn=Oi,Ii=Hn&&Hn.placeable,Zi=Hn&&Hn.offscreen,rt.useRuntimeCollisionCircles){const Tr=_.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex),oa=a.am(_.textSizeData,W,Tr),Mr=S.get("text-padding");cs=this.collisionIndex.placeCollisionCircles(he,Tr,_.lineVertexArray,_.glyphOffsetArray,oa,R,B,g,Pe,Y.predicate,rt.collisionCircleDiameter,Mr,C,et),cs.circles.length&&cs.collisionDetected&&!g&&a.w("Collisions detected, but collision boxes are not shown"),Ii=de||cs.circles.length>0&&!cs.collisionDetected,Zi=Zi&&cs.offscreen}if(zt.iconFeatureIndex&&(Oo=zt.iconFeatureIndex),zt.iconBox){const Tr=oa=>this.collisionIndex.placeCollisionBox(oa,_e,V,tt,R,Pe,Me,O,Y.predicate,et,Ce&&Li?Li:void 0,wt);qn&&qn.placeable&&zt.verticalIconBox?(Ns=Tr(zt.verticalIconBox),un=Ns.placeable):(Ns=Tr(zt.iconBox),un=Ns.placeable),Zi=Zi&&Ns.offscreen}const lo=ue||rt.numHorizontalGlyphVertices===0&&rt.numVerticalGlyphVertices===0,Xa=ce||rt.numIconVertices===0;lo||Xa?Xa?lo||(un=un&&Ii):Ii=un&&Ii:un=Ii=un&&Ii;const Bl=un&&Ns.placeable;if(Ii&&Hn.placeable&&this.collisionIndex.insertCollisionBox(Hn.box,he,S.get("text-ignore-placement"),_.bucketInstanceId,qn&&qn.placeable&&ra?ra:Ur,Y.ID),Bl&&this.collisionIndex.insertCollisionBox(Ns.box,_e,S.get("icon-ignore-placement"),_.bucketInstanceId,Oo,Y.ID),cs&&Ii&&this.collisionIndex.insertCollisionCircles(cs.circles,he,S.get("text-ignore-placement"),_.bucketInstanceId,Ur,Y.ID),g&&this.storeCollisionData(_.bucketInstanceId,ci,zt,Hn,Ns,cs),rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[rt.crossTileID]=new Zs((Ii||qe)&&!(Hn!=null&&Hn.occluded),(un||it)&&!(Ns!=null&&Ns.occluded),Zi||_.justReloaded),c[rt.crossTileID]=!0};if(Ne){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const rt=_.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let zt=rt.length-1;zt>=0;--zt){const ci=rt[zt];vt(_.symbolInstances.get(ci),_.collisionArrays[ci],ci)}}else for(let rt=i.symbolInstanceStart;rt<i.symbolInstanceEnd;rt++)vt(_.symbolInstances.get(rt),_.collisionArrays[rt],rt);_.justReloaded=!1}storeCollisionData(i,c,g,_,S,C){if(g.textBox||g.iconBox){let O,R;this.collisionBoxArrays.has(i)?O=this.collisionBoxArrays.get(i):(O=new Map,this.collisionBoxArrays.set(i,O)),O.has(c)?R=O.get(c):(R={text:null,icon:null},O.set(c,R)),g.textBox&&(R.text=_.box),g.iconBox&&(R.icon=S.box)}if(C){let O=this.collisionCircleArrays[i];O===void 0&&(O=this.collisionCircleArrays[i]=[]);for(let R=0;R<C.circles.length;R+=4)O.push(C.circles[R+0]-Jn),O.push(C.circles[R+1]-Jn),O.push(C.circles[R+2]),O.push(C.collisionDetected?1:0)}}markUsedJustification(i,c,g,_){let S;S=_===a.al.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[a.aD(c)];const C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const O of C)O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:g.crossTileID)}markUsedOrientation(i,c,g){const _=c===a.al.horizontal||c===a.al.horizontalOnly?c:0,S=c===a.al.vertical?c:0,C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const O of C)i.text.placedSymbolArray.get(O).placedOrientation=_;g.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const _=c?c.symbolFadeChange(i):1,S=c?c.opacities:{},C=c?c.variableOffsets:{},O=c?c.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],V=S[R];V?(this.opacities[R]=new nr(V,_,B.text,B.icon),g=g||B.text!==V.text.placed||B.icon!==V.icon.placed):(this.opacities[R]=new nr(null,_,B.text,B.icon,B.skipFade),g=g||B.text||B.icon)}for(const R in S){const B=S[R];if(!this.opacities[R]){const V=new nr(B,_,!1,!1);V.isHidden()||(this.opacities[R]=V,g=g||B.text.placed||B.icon.placed)}}for(const R in C)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=C[R]);for(const R in O)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=O[R]);if(c&&c.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c){const g={};for(const _ of c){const S=_.getBucket(i);S&&_.latestFeatureIndex&&i.id===S.layerIds[0]&&this.updateBucketOpacities(S,_.tileID,g,_.collisionBoxArray)}}updateBucketOpacities(i,c,g,_){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const S=i.layers[0],C=S.layout,O=new nr(null,0,!1,!1,!0),R=C.get("text-allow-overlap"),B=C.get("icon-allow-overlap"),V=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=C.get("text-rotation-alignment")==="map",H=C.get("text-pitch-alignment")==="map",W=C.get("icon-text-fit")!=="none",Y=new nr(null,0,R&&(B||!i.hasIconData()||C.get("icon-optional")),B&&(R||!i.hasTextData()||C.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const ue=(he,de,_e)=>{for(let be=0;be<de/4;be++)he.opacityVertexArray.emplaceBack(_e);he.hasVisibleVertices=he.hasVisibleVertices||_e!==gl},ce=this.collisionBoxArrays.get(i.bucketInstanceId);for(let he=0;he<i.symbolInstances.length;he++){const de=i.symbolInstances.get(he),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:be,crossTileID:Me}=de;let Pe=this.opacities[Me];g[Me]?Pe=O:Pe||(Pe=Y,this.opacities[Me]=Pe),g[Me]=!0;const Ce=de.numIconVertices>0,Ne=this.placedOrientations[de.crossTileID],qe=Ne===a.al.vertical,it=Ne===a.al.horizontal||Ne===a.al.horizontalOnly;if(_e>0||be>0){const et=ac(Pe.text);ue(i.text,_e,qe?gl:et),ue(i.text,be,it?gl:et);const wt=Pe.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(zt=>{zt>=0&&(i.text.placedSymbolArray.get(zt).hidden=wt||qe?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=wt||it?1:0);const vt=this.variableOffsets[de.crossTileID];vt&&this.markUsedJustification(i,vt.anchor,de,Ne);const rt=this.placedOrientations[de.crossTileID];rt&&(this.markUsedJustification(i,"left",de,rt),this.markUsedOrientation(i,rt,de))}if(Ce){const et=ac(Pe.icon),wt=!(W&&de.verticalPlacedIconSymbolIndex&&qe);de.placedIconSymbolIndex>=0&&(ue(i.icon,de.numIconVertices,wt?et:gl),i.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(ue(i.icon,de.numVerticalIconVertices,wt?gl:et),i.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const tt=ce&&ce.has(he)?ce.get(he):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const et=i.collisionArrays[he];if(et){let wt=new a.P(0,0);if(et.textBox||et.verticalTextBox){let vt=!0;if(V){const rt=this.variableOffsets[Me];rt?(wt=Ma(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale),q&&wt._rotate(H?-this.transform.bearingInRadians:this.transform.bearingInRadians)):vt=!1}if(et.textBox||et.verticalTextBox){let rt;et.textBox&&(rt=qe),et.verticalTextBox&&(rt=it),iu(i.textCollisionBox.collisionVertexArray,Pe.text.placed,!vt||rt,tt.text,wt.x,wt.y)}}if(et.iconBox||et.verticalIconBox){const vt=!!(!it&&et.verticalIconBox);let rt;et.iconBox&&(rt=vt),et.verticalIconBox&&(rt=!vt),iu(i.iconCollisionBox.collisionVertexArray,Pe.icon.placed,rt,tt.icon,W?wt.x:0,W?wt.y:0)}}}}if(i.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);i.bucketInstanceId in this.collisionCircleArrays&&(i.collisionCircleArray=this.collisionCircleArrays[i.bucketInstanceId],delete this.collisionCircleArrays[i.bucketInstanceId])}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>i}setStale(){this.stale=!0}}function iu(x,i,c,g,_,S){g&&g.length!==0||(g=[0,0,0,0]);const C=g[0]-Jn,O=g[1]-Jn,R=g[2]-Jn,B=g[3]-Jn;x.emplaceBack(i?1:0,c?1:0,_||0,S||0,C,O),x.emplaceBack(i?1:0,c?1:0,_||0,S||0,R,O),x.emplaceBack(i?1:0,c?1:0,_||0,S||0,R,B),x.emplaceBack(i?1:0,c?1:0,_||0,S||0,C,B)}const Um=Math.pow(2,25),Yd=Math.pow(2,24),Br=Math.pow(2,17),Pf=Math.pow(2,16),Jd=Math.pow(2,9),oc=Math.pow(2,8),lh=Math.pow(2,1);function ac(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const i=x.placed?1:0,c=Math.floor(127*x.opacity);return c*Um+i*Yd+c*Br+i*Pf+c*Jd+i*oc+c*lh+i}const gl=0;class sr{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,c,g,_,S){const C=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(C,_,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((O,R)=>O.sortKey-R.sortKey));this._currentPartIndex<C.length;)if(c.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,S())return!0;return!1}}class lc{constructor(i,c,g,_,S,C,O,R){this.placement=new Ca(i,c,C,O,R),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(i,c,g){const _=j.now(),S=()=>!this._forceFullPlacement&&j.now()-_>2;for(;this._currentPlacementIndex>=0;){const C=c[i[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=O)&&(!C.maxzoom||C.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new sr(C)),this._inProgressLayer.continuePlacement(g[C.source],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const yl=512/a.Z/2;class Aa{constructor(i,c,g){this.tileID=i,this.bucketInstanceId=g,this._symbolsByKey={};const _=new Map;for(let S=0;S<c.length;S++){const C=c.get(S),O=C.key,R=_.get(O);R?R.push(C):_.set(O,[C])}for(const[S,C]of _){const O={positions:C.map(R=>({x:Math.floor(R.anchorX*yl),y:Math.floor(R.anchorY*yl)})),crossTileIDs:C.map(R=>R.crossTileID)};if(O.positions.length>128){const R=new a.aF(O.positions.length,16,Uint16Array);for(const{x:B,y:V}of O.positions)R.add(B,V);R.finish(),delete O.positions,O.index=R}this._symbolsByKey[S]=O}}getScaledCoordinates(i,c){const{x:g,y:_,z:S}=this.tileID.canonical,{x:C,y:O,z:R}=c.canonical,B=yl/Math.pow(2,R-S),V=(O*a.Z+i.anchorY)*B,q=_*a.Z*yl;return{x:Math.floor((C*a.Z+i.anchorX)*B-g*a.Z*yl),y:Math.floor(V-q)}}findMatches(i,c,g){const _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let S=0;S<i.length;S++){const C=i.get(S);if(C.crossTileID)continue;const O=this._symbolsByKey[C.key];if(!O)continue;const R=this.getScaledCoordinates(C,c);if(O.index){const B=O.index.range(R.x-_,R.y-_,R.x+_,R.y+_).sort();for(const V of B){const q=O.crossTileIDs[V];if(!g[q]){g[q]=!0,C.crossTileID=q;break}}}else if(O.positions)for(let B=0;B<O.positions.length;B++){const V=O.positions[B],q=O.crossTileIDs[B];if(Math.abs(V.x-R.x)<=_&&Math.abs(V.y-R.y)<=_&&!g[q]){g[q]=!0,C.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class _l{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ep{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(c!==0)for(const g in this.indexes){const _=this.indexes[g],S={};for(const C in _){const O=_[C];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+c),S[O.tileID.key]=O}this.indexes[g]=S}this.lng=i}addBucket(i,c,g){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let S=0;S<c.symbolInstances.length;S++)c.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const _=this.usedCrossTileIDs[i.overscaledZ];for(const S in this.indexes){const C=this.indexes[S];if(Number(S)>i.overscaledZ)for(const O in C){const R=C[O];R.tileID.isChildOf(i)&&R.findMatches(c.symbolInstances,i,_)}else{const O=C[i.scaledTo(Number(S)).key];O&&O.findMatches(c.symbolInstances,i,_)}}for(let S=0;S<c.symbolInstances.length;S++){const C=c.symbolInstances.get(S);C.crossTileID||(C.crossTileID=g.generate(),_[C.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Aa(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const g of c.getCrossTileIDsLists())for(const _ of g)delete this.usedCrossTileIDs[i][_]}removeStaleBuckets(i){let c=!1;for(const g in this.indexes){const _=this.indexes[g];for(const S in _)i[_[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,_[S]),delete _[S],c=!0)}return c}}class vo{constructor(){this.layerIndexes={},this.crossTileIDs=new _l,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,g){let _=this.layerIndexes[i.id];_===void 0&&(_=this.layerIndexes[i.id]=new ep);let S=!1;const C={};_.handleWrapJump(g);for(const O of c){const R=O.getBucket(i);R&&i.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(O.tileID,R,this.crossTileIDs)&&(S=!0),C[R.bucketInstanceId]=!0)}return _.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(i){const c={};i.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}var Yr="void main() {fragColor=vec4(1.0);}";const hi={prelude:bi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:bi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:bi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:bi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:bi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:bi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:bi(Yr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:bi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:bi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:bi(Yr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:bi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:bi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:bi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:bi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:bi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:bi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:bi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:bi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:bi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:bi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:bi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:bi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:bi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:bi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:bi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:bi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:bi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:bi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function bi(x,i){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=i.match(/in ([\w]+) ([\w]+)/g),_=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=S?S.concat(_):_,O={};return{fragmentSource:x=x.replace(c,(R,B,V,q,H)=>(O[H]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${V} ${q} ${H};
#else
uniform ${V} ${q} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${V} ${q} ${H} = u_${H};
#endif
`)),vertexSource:i=i.replace(c,(R,B,V,q,H)=>{const W=q==="float"?"vec2":"vec4",Y=H.match(/color/)?"color":W;return O[H]?B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${V} ${W} a_${H};
out ${V} ${q} ${H};
#else
uniform ${V} ${q} u_${H};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${V} ${q} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${Y}(a_${H}, u_${H}_t);
#else
    ${V} ${q} ${H} = u_${H};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${V} ${W} a_${H};
#else
uniform ${V} ${q} u_${H};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${V} ${q} ${H} = a_${H};
#else
    ${V} ${q} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${V} ${q} ${H} = unpack_mix_${Y}(a_${H}, u_${H}_t);
#else
    ${V} ${q} ${H} = u_${H};
#endif
`}),staticAttributes:g,staticUniforms:C}}class bl{constructor(i,c,g){this.vertexBuffer=i,this.indexBuffer=c,this.segments=g}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Nr=a.aG([{name:"a_pos",type:"Int16",components:2}]);const rr="#define PROJECTION_MERCATOR",Ps="mercator";class rn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ps}get shaderDefine(){return rr}get shaderPreludeCode(){return hi.projectionMercator}get vertexShaderPreludeCode(){return hi.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(i){}getMeshFromTileID(i,c,g,_,S){if(this._cachedMesh)return this._cachedMesh;const C=new a.aI;C.emplaceBack(0,0),C.emplaceBack(a.Z,0),C.emplaceBack(0,a.Z),C.emplaceBack(a.Z,a.Z);const O=i.createVertexBuffer(C,Nr.members),R=a.aJ.simpleSegment(0,0,4,2),B=new a.aK;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const V=i.createIndexBuffer(B);return this._cachedMesh=new bl(O,V,R),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(i){}}class vl{constructor(i=0,c=0,g=0,_=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=g,this.right=_}interpolate(i,c,g){return c.top!=null&&i.top!=null&&(this.top=a.B.number(i.top,c.top,g)),c.bottom!=null&&i.bottom!=null&&(this.bottom=a.B.number(i.bottom,c.bottom,g)),c.left!=null&&i.left!=null&&(this.left=a.B.number(i.left,c.left,g)),c.right!=null&&i.right!=null&&(this.right=a.B.number(i.right,c.right,g)),this}getCenter(i,c){const g=a.ae((this.left+i-this.right)/2,0,i),_=a.ae((this.top+c-this.bottom)/2,0,c);return new a.P(g,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new vl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function es(x,i){if(!x.renderWorldCopies||x.lngRange)return;const c=i.lng-x.center.lng;i.lng+=c>180?-360:c<-180?360:0}function as(x){return Math.max(0,Math.floor(x))}class Un{constructor(i,c,g,_,S,C){this._callbacks=i,this._tileSize=512,this._renderWorldCopies=C===void 0||!!C,this._minZoom=c||0,this._maxZoom=g||22,this._minPitch=_??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=as(this._zoom),this._scale=a.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new vl,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(i,c,g){this._latRange=i.latRange,this._lngRange=i.lngRange,this._width=i.width,this._height=i.height,this._center=i.center,this._elevation=i.elevation,this._minElevationForCurrentTile=i.minElevationForCurrentTile,this._zoom=i.zoom,this._tileZoom=as(this._zoom),this._scale=a.ac(this._zoom),this._bearingInRadians=i.bearingInRadians,this._fovInRadians=i.fovInRadians,this._pitchInRadians=i.pitchInRadians,this._rollInRadians=i.rollInRadians,this._unmodified=i.unmodified,this._edgeInsets=new vl(i.padding.top,i.padding.bottom,i.padding.left,i.padding.right),this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._minPitch=i.minPitch,this._maxPitch=i.maxPitch,this._renderWorldCopies=i.renderWorldCopies,this._cameraToCenterDistance=i.cameraToCenterDistance,this._nearZ=i.nearZ,this._farZ=i.farZ,this._autoCalculateNearFarZ=!g&&i.autoCalculateNearFarZ,c&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(i){this._minElevationForCurrentTile=i}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(i){this._minZoom!==i&&(this._minZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(i){this._minPitch!==i&&(this._minPitch=i,this.setPitch(Math.max(this.pitch,i)))}get maxPitch(){return this._maxPitch}setMaxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.setPitch(Math.min(this.pitch,i)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(i){const c=a.aL(i,-180,180)*Math.PI/180;var g,_,S,C,O,R,B,V,q;this._bearingInRadians!==c&&(this._unmodified=!1,this._bearingInRadians=c,this._calcMatrices(),this._rotationMatrix=A(),g=this._rotationMatrix,S=-this._bearingInRadians,C=(_=this._rotationMatrix)[0],O=_[1],R=_[2],B=_[3],V=Math.sin(S),q=Math.cos(S),g[0]=C*q+R*V,g[1]=O*q+B*V,g[2]=C*-V+R*q,g[3]=O*-V+B*q)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(i){const c=a.ae(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==c&&(this._unmodified=!1,this._pitchInRadians=c,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(i){const c=i/180*Math.PI;this._rollInRadians!==c&&(this._unmodified=!1,this._rollInRadians=c,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aM(this._fovInRadians)}setFov(i){i=a.ae(i,.1,150),this.fov!==i&&(this._unmodified=!1,this._fovInRadians=a.ab(i),this._calcMatrices())}get zoom(){return this._zoom}setZoom(i){const c=this.getConstrained(this._center,i).zoom;this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this._tileZoom=Math.max(0,Math.floor(c)),this._scale=a.ac(c),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(i,c){this._autoCalculateNearFarZ=!1,this._nearZ=i,this._farZ=c,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,g){this._unmodified=!1,this._edgeInsets.interpolate(i,c,g),this._constrain(),this._calcMatrices()}resize(i,c,g=!0){this._width=i,this._height=c,g&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ji([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(i){i?(this._lngRange=[i.getWest(),i.getEast()],this._latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.af])}getConstrained(i,c){return this._callbacks.getConstrained(i,c)}getCameraQueryGeometry(i,c){if(c.length===1)return[c[0],i];{let g=i.x,_=i.y,S=i.x,C=i.y;for(const O of c)g=Math.min(g,O.x),_=Math.min(_,O.y),S=Math.max(S,O.x),C=Math.max(C,O.y);return[new a.P(g,_),new a.P(S,_),new a.P(S,C),new a.P(g,C),new a.P(g,_)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:c,zoom:g}=this.getConstrained(this.center,this.zoom);this.setCenter(c),this.setZoom(g),this._unmodified=i,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let i=a.ad(new Float64Array(16));a.M(i,i,[this._width/2,-this._height/2,1]),a.L(i,i,[1,-1,0]),this._clipSpaceToPixelsMatrix=i,i=a.ad(new Float64Array(16)),a.M(i,i,[1,-1,1]),a.L(i,i,[-1,-1,0]),a.M(i,i,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=i,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(i,c,g,_){const S=g!==void 0?g:this.bearing,C=_=_!==void 0?_:this.pitch,O=a.$.fromLngLat(i,c),R=-Math.cos(a.ab(C)),B=Math.sin(a.ab(C)),V=B*Math.sin(a.ab(S)),q=-B*Math.cos(a.ab(S));let H=this.elevation;const W=c-H;let Y;R*W>=0||Math.abs(R)<.1?(Y=1e4,H=c+Y*R):Y=-W/R;let ue,ce,he=a.aN(1,O.y),de=0;do{if(de+=1,de>10)break;ce=Y/he,ue=new a.$(O.x+V*ce,O.y+q*ce),he=1/ue.meterInMercatorCoordinateUnits()}while(Math.abs(Y-ce*he)>1e-12);return{center:ue.toLngLat(),elevation:H,zoom:a.ah(this.height/2/Math.tan(this.fovInRadians/2)/ce/this.tileSize)}}recalculateZoomAndCenter(i){if(this.elevation-i==0)return;const c=a.ag(1,this.center.lat)*this.worldSize,g=this.cameraToCenterDistance/c,_=a.$.fromLngLat(this.center,this.elevation),S=te(this.center,this.elevation,this.pitch,this.bearing,g);this._elevation=i;const C=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),a.aN(S.z,_.y),this.bearing,this.pitch);this._elevation=C.elevation,this._center=C.center,this.setZoom(C.zoom)}getCameraPoint(){const i=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(i*Math.sin(this.rollInRadians),i*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const i=a.ag(1,this.center.lat)*this.worldSize;return te(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/i).toLngLat()}getMercatorTileCoordinates(i){if(!i)return[0,0,1,1];const c=i.canonical.z>=0?1<<i.canonical.z:Math.pow(2,i.canonical.z);return[i.canonical.x/c,i.canonical.y/c,1/c/a.Z,1/c/a.Z]}}class Ho{constructor(i,c){this.min=i,this.max=c,this.center=a.aO([],a.aP([],this.min,this.max),.5)}quadrant(i){const c=[i%2==0,i<2],g=a.aQ(this.min),_=a.aQ(this.max);for(let S=0;S<c.length;S++)g[S]=c[S]?this.min[S]:this.center[S],_[S]=c[S]?this.center[S]:this.max[S];return _[2]=this.max[2],new Ho(g,_)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersectsFrustum(i){let c=!0;for(let g=0;g<i.planes.length;g++){const _=this.intersectsPlane(i.planes[g]);if(_===0)return 0;_===1&&(c=!1)}return c?2:i.aabb.min[0]>this.max[0]||i.aabb.min[1]>this.max[1]||i.aabb.min[2]>this.max[2]||i.aabb.max[0]<this.min[0]||i.aabb.max[1]<this.min[1]||i.aabb.max[2]<this.min[2]?0:1}intersectsPlane(i){let c=i[3],g=i[3];for(let _=0;_<3;_++)i[_]>0?(c+=i[_]*this.min[_],g+=i[_]*this.max[_]):(g+=i[_]*this.min[_],c+=i[_]*this.max[_]);return c>=0?2:g<0?0:1}}class xl{distanceToTile2d(i,c,g,_){const S=_.distanceX([i,c]),C=_.distanceY([i,c]);return Math.hypot(S,C)}getWrap(i,c,g){return g}getTileAABB(i,c,g,_){var S,C;let O=g,R=g;if(_.terrain){const V=new a.Y(i.z,c,i.z,i.x,i.y),q=_.terrain.getMinMaxElevation(V);O=(S=q.minElevation)!==null&&S!==void 0?S:g,R=(C=q.maxElevation)!==null&&C!==void 0?C:g}const B=1<<i.z;return new Ho([c+i.x/B,i.y/B,O],[c+(i.x+1)/B,(i.y+1)/B,R])}allowVariableZoom(i,c){const g=i.fov*(Math.abs(Math.cos(i.rollInRadians))*i.height+Math.abs(Math.sin(i.rollInRadians))*i.width)/i.height,_=a.ae(78.5-g/2,0,60);return!!c.terrain||i.pitch>_}allowWorldCopies(){return!0}recalculateCache(){}}class mn{constructor(i,c,g){this.points=i,this.planes=c,this.aabb=g}static fromInvProjectionMatrix(i,c=1,g=0){const _=Math.pow(2,g),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const V=1/(B=a.at([],B,i))[3]/c*_;return a.aR(B,B,[V,V,1/B[3],V])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const V=a.aS([],S[B[0]],S[B[1]]),q=a.aS([],S[B[2]],S[B[1]]),H=a.aT([],a.aU([],V,q)),W=-a.aV(H,S[B[1]]);return H.concat(W)}),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const B of S)for(let V=0;V<3;V++)O[V]=Math.min(O[V],B[V]),R[V]=Math.max(R[V],B[V]);return new mn(S,C,new Ho(O,R))}}class or{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,c,g){return this._helper.interpolatePadding(i,c,g)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,c,g=!0){this._helper.resize(i,c,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,c){this._helper.overrideNearFarZ(i,c)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i,c){}constructor(i,c,g,_,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(C,O)=>this.getConstrained(C,O)},i,c,g,_,S),this._coveringTilesDetailsProvider=new xl}clone(){const i=new or;return i.apply(this),i}apply(i,c,g){this._helper.apply(i,c,g)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(i){const c=[new a.aW(0,i)];if(this._helper._renderWorldCopies){const g=this.screenPointToMercatorCoordinate(new a.P(0,0)),_=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),O=Math.floor(Math.min(g.x,_.x,S.x,C.x)),R=Math.floor(Math.max(g.x,_.x,S.x,C.x)),B=1;for(let V=O-B;V<=R+B;V++)V!==0&&c.push(new a.aW(V,i))}return c}getCameraFrustum(){return mn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){const c=this.screenPointToLocation(this.centerPoint,i),g=i?i.getElevationForLngLatZoom(c,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(g)}setLocationAtPoint(i,c){const g=a.ag(this.elevation,this.center.lat),_=this.screenPointToMercatorCoordinateAtZ(c,g),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,g),C=a.$.fromLngLat(i),O=new a.$(C.x-(_.x-S.x),C.y-(_.y-S.y));this.setCenter(O==null?void 0:O.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(i,c){return c?this.coordinatePoint(a.$.fromLngLat(i),c.getElevationForLngLatZoom(i,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.$.fromLngLat(i))}screenPointToLocation(i,c){var g;return(g=this.screenPointToMercatorCoordinate(i,c))===null||g===void 0?void 0:g.toLngLat()}screenPointToMercatorCoordinate(i,c){if(c){const g=c.pointCoordinate(i);if(g!=null)return g}return this.screenPointToMercatorCoordinateAtZ(i)}screenPointToMercatorCoordinateAtZ(i,c){const g=c||0,_=[i.x,i.y,0,1],S=[i.x,i.y,1,1];a.at(_,_,this._pixelMatrixInverse),a.at(S,S,this._pixelMatrixInverse);const C=_[3],O=S[3],R=_[1]/C,B=S[1]/O,V=_[2]/C,q=S[2]/O,H=V===q?0:(g-V)/(q-V);return new a.$(a.B.number(_[0]/C,S[0]/O,H)/this.worldSize,a.B.number(R,B,H)/this.worldSize,g)}coordinatePoint(i,c=0,g=this._pixelMatrix){const _=[i.x*this.worldSize,i.y*this.worldSize,c,1];return a.at(_,_,g),new a.P(_[0]/_[3],_[1]/_[3])}getBounds(){const i=Math.max(0,this._helper._height/2-De(this));return new ji().extend(this.screenPointToLocation(new a.P(0,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(i,c){return c?c.pointCoordinate(i)!=null:i.y>this.height/2-De(this)}calculatePosMatrix(i,c=!1,g){var _;const S=(_=i.key)!==null&&_!==void 0?_:a.aX(i.wrap,i.canonical.z,i.canonical.z,i.canonical.x,i.canonical.y),C=c?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(S)){const B=C.get(S);return g?B.f32:B.f64}const O=ee(i,this.worldSize);a.N(O,c?this._alignedProjMatrix:this._viewProjMatrix,O);const R={f64:O,f32:new Float32Array(O)};return C.set(S,R),g?R.f32:R.f64}calculateFogMatrix(i){const c=i.key,g=this._fogMatrixCacheF32;if(g.has(c))return g.get(c);const _=ee(i,this.worldSize);return a.N(_,this._fogMatrix,_),g.set(c,new Float32Array(_)),g.get(c)}getConstrained(i,c){c=a.ae(+c,this.minZoom,this.maxZoom);const g={center:new a.Q(i.lng,i.lat),zoom:c};let _=this._helper._lngRange;this._helper._renderWorldCopies||_!==null||(_=[-179.9999999999,180-1e-10]);const S=this.tileSize*a.ac(g.zoom);let C=0,O=S,R=0,B=S,V=0,q=0;const{x:H,y:W}=this.size;if(this._helper._latRange){const _e=this._helper._latRange;C=a.S(_e[1])*S,O=a.S(_e[0])*S,O-C<W&&(V=W/(O-C))}_&&(R=a.aL(a.U(_[0])*S,0,S),B=a.aL(a.U(_[1])*S,0,S),B<R&&(B+=S),B-R<H&&(q=H/(B-R)));const{x:Y,y:ue}=_s(S,i);let ce,he;const de=Math.max(q||0,V||0);if(de){const _e=new a.P(q?(B+R)/2:Y,V?(O+C)/2:ue);return g.center=Lr(S,_e).wrap(),g.zoom+=a.ah(de),g}if(this._helper._latRange){const _e=W/2;ue-_e<C&&(he=C+_e),ue+_e>O&&(he=O-_e)}if(_){const _e=(R+B)/2;let be=Y;this._helper._renderWorldCopies&&(be=a.aL(Y,_e-S/2,_e+S/2));const Me=H/2;be-Me<R&&(ce=R+Me),be+Me>B&&(ce=B-Me)}if(ce!==void 0||he!==void 0){const _e=new a.P(ce??Y,he??ue);g.center=Lr(S,_e).wrap()}return g}calculateCenterFromCameraLngLatAlt(i,c,g,_){return this._helper.calculateCenterFromCameraLngLatAlt(i,c,g,_)}_calculateNearFarZIfNeeded(i,c,g){if(!this._helper.autoCalculateNearFarZ)return;const _=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=i-_*this._helper._pixelPerMeter/Math.cos(c),C=_<0?S:i,O=Math.PI/2+this.pitchInRadians,R=a.ab(this.fov)*(Math.abs(Math.cos(a.ab(this.roll)))*this.height+Math.abs(Math.sin(a.ab(this.roll)))*this.width)/this.height*(.5+g.y/this.height),B=Math.sin(R)*C/Math.sin(a.ae(Math.PI-O-R,.01,Math.PI-.01)),V=De(this),q=Math.atan(V/this._helper.cameraToCenterDistance),H=a.ab(.75),W=q>H?2*q*(.5+g.y/(2*V)):H,Y=Math.sin(W)*C/Math.sin(a.ae(Math.PI-O-W,.01,Math.PI-.01)),ue=Math.min(B,Y);this._helper._farZ=1.01*(Math.cos(Math.PI/2-c)*ue+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const i=this.centerOffset,c=_s(this.worldSize,this.center),g=c.x,_=c.y;this._helper._pixelPerMeter=a.ag(1,this.center.lat)*this.worldSize;const S=a.ab(Math.min(this.pitch,bo)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let O;this._calculateNearFarZIfNeeded(C,S,i),O=new Float64Array(16),a.aY(O,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.an(this._invProjMatrix,O),O[8]=2*-i.x/this._helper._width,O[9]=2*i.y/this._helper._height,this._projectionMatrix=a.aZ(O),a.M(O,O,[1,-1,1]),a.L(O,O,[0,0,-this._helper.cameraToCenterDistance]),a.a_(O,O,-this.rollInRadians),a.a$(O,O,this.pitchInRadians),a.a_(O,O,-this.bearingInRadians),a.L(O,O,[-g,-_,0]),this._mercatorMatrix=a.M([],O,[this.worldSize,this.worldSize,this.worldSize]),a.M(O,O,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,O),a.L(O,O,[0,0,-this.elevation]),this._viewProjMatrix=O,this._invViewProjMatrix=a.an([],O);const R=[0,0,-1,1];a.at(R,R,this._invViewProjMatrix),this._cameraPosition=[R[0]/R[3],R[1]/R[3],R[2]/R[3]],this._fogMatrix=new Float64Array(16),a.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-i.x/this.width,this._fogMatrix[9]=2*i.y/this.height,a.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.L(this._fogMatrix,this._fogMatrix,[-g,-_,0]),a.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,O);const B=this._helper._width%2/2,V=this._helper._height%2/2,q=Math.cos(this.bearingInRadians),H=Math.sin(-this.bearingInRadians),W=g-Math.round(g)+q*B+H*V,Y=_-Math.round(_)+q*V+H*B,ue=new Float64Array(O);if(a.L(ue,ue,[W>.5?W-1:W,Y>.5?Y-1:Y,0]),this._alignedProjMatrix=ue,O=a.an(new Float64Array(16),this._pixelMatrix),!O)throw new Error("failed to invert matrix");this._pixelMatrixInverse=O,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const i=this.screenPointToMercatorCoordinate(new a.P(0,0)),c=[i.x*this.worldSize,i.y*this.worldSize,0,1];return a.at(c,c,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const i=a.ag(1,this.center.lat)*this.worldSize;return te(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/i).toLngLat()}lngLatToCameraDepth(i,c){const g=a.$.fromLngLat(i),_=[g.x*this.worldSize,g.y*this.worldSize,c,1];return a.at(_,_,this._viewProjMatrix),_[2]/_[3]}getProjectionData(i){const{overscaledTileID:c,aligned:g,applyTerrainMatrix:_}=i,S=this._helper.getMercatorTileCoordinates(c),C=c?this.calculatePosMatrix(c,g,!0):null;let O;return O=c&&c.terrainRttPosMatrix32f&&_?c.terrainRttPosMatrix32f:C||a.b0(),{mainMatrix:O,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:O}}isLocationOccluded(i){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(i,c,g){return 1}transformLightDirection(i){return a.aQ(i)}getRayDirectionFromPixel(i){throw new Error("Not implemented.")}projectTileCoordinates(i,c,g,_){const S=this.calculatePosMatrix(g);let C;_?(C=[i,c,_(i,c),1],a.at(C,C,S)):(C=[i,c,0,1],Wi(C,C,S));const O=C[3];return{point:new a.P(C[0]/O,C[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}populateCache(i){for(const c of i)this.calculatePosMatrix(c)}getMatrixForModel(i,c){const g=a.$.fromLngLat(i,c),_=g.meterInMercatorCoordinateUnits(),S=a.b1();return a.L(S,S,[g.x,g.y,g.z]),a.a_(S,S,Math.PI),a.a$(S,S,Math.PI/2),a.M(S,S,[-_,_,_]),S}getProjectionDataForCustomLayer(i=!0){const c=new a.Y(0,0,0,0,0),g=this.getProjectionData({overscaledTileID:c,applyGlobeMatrix:i}),_=ee(c,this.worldSize);a.N(_,this._viewProjMatrix,_),g.tileMercatorCoords=[0,0,1,1];const S=[a.Z,a.Z,this.worldSize/this._helper.pixelsPerMeter],C=a.b2();return a.M(C,_,S),g.fallbackMatrix=C,g.mainMatrix=C,g}getFastPathSimpleProjectionMatrix(i){return this.calculatePosMatrix(i)}}function Os(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function wl(x){if(x.useSlerp)if(x.k<1){const i=a.b3(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),c=a.b3(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),g=new Float64Array(4);a.b4(g,i,c,x.k);const _=a.b5(g);x.tr.setRoll(_.roll),x.tr.setPitch(_.pitch),x.tr.setBearing(_.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(a.B.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(a.B.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(a.B.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function Ds(x,i,c,g,_){const S=_.padding,C=_s(_.worldSize,c.getNorthWest()),O=_s(_.worldSize,c.getNorthEast()),R=_s(_.worldSize,c.getSouthEast()),B=_s(_.worldSize,c.getSouthWest()),V=a.ab(-g),q=C.rotate(V),H=O.rotate(V),W=R.rotate(V),Y=B.rotate(V),ue=new a.P(Math.max(q.x,H.x,Y.x,W.x),Math.max(q.y,H.y,Y.y,W.y)),ce=new a.P(Math.min(q.x,H.x,Y.x,W.x),Math.min(q.y,H.y,Y.y,W.y)),he=ue.sub(ce),de=(_.width-(S.left+S.right+i.left+i.right))/he.x,_e=(_.height-(S.top+S.bottom+i.top+i.bottom))/he.y;if(_e<0||de<0)return void Os();const be=Math.min(a.ah(_.scale*Math.min(de,_e)),x.maxZoom),Me=a.P.convert(x.offset),Pe=new a.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(a.ab(g)),Ce=Me.add(Pe).mult(_.scale/a.ac(be));return{center:Lr(_.worldSize,C.add(R).div(2).sub(Ce)),zoom:be,bearing:g}}class Fr{get useGlobeControls(){return!1}handlePanInertia(i,c){return{easingOffset:i,easingCenter:c.center}}handleMapControlsRollPitchBearingZoom(i,c){i.bearingDelta&&c.setBearing(c.bearing+i.bearingDelta),i.pitchDelta&&c.setPitch(c.pitch+i.pitchDelta),i.rollDelta&&c.setRoll(c.roll+i.rollDelta),i.zoomDelta&&c.setZoom(c.zoom+i.zoomDelta)}handleMapControlsPan(i,c,g){i.around.distSqr(c.centerPoint)<.01||c.setLocationAtPoint(g,i.around)}cameraForBoxAndBearing(i,c,g,_,S){return Ds(i,c,g,_,S)}handleJumpToCenterZoom(i,c){i.zoom!==(c.zoom!==void 0?+c.zoom:i.zoom)&&i.setZoom(+c.zoom),c.center!==void 0&&i.setCenter(a.Q.convert(c.center))}handleEaseTo(i,c){const g=i.zoom,_=i.padding,S={roll:i.roll,pitch:i.pitch,bearing:i.bearing},C={roll:c.roll===void 0?i.roll:c.roll,pitch:c.pitch===void 0?i.pitch:c.pitch,bearing:c.bearing===void 0?i.bearing:c.bearing},O=c.zoom!==void 0,R=!i.isPaddingEqual(c.padding);let B=!1;const V=O?+c.zoom:i.zoom;let q=i.centerPoint.add(c.offsetAsPoint);const H=i.screenPointToLocation(q),{center:W,zoom:Y}=i.getConstrained(a.Q.convert(c.center||H),V??g);es(i,W);const ue=_s(i.worldSize,H),ce=_s(i.worldSize,W).sub(ue),he=a.ac(Y-g);return B=Y!==g,{easeFunc:de=>{if(B&&i.setZoom(a.B.number(g,Y,de)),a.b6(S,C)||wl({startEulerAngles:S,endEulerAngles:C,tr:i,k:de,useSlerp:S.roll!=C.roll}),R&&(i.interpolatePadding(_,c.padding,de),q=i.centerPoint.add(c.offsetAsPoint)),c.around)i.setLocationAtPoint(c.around,c.aroundPoint);else{const _e=a.ac(i.zoom-g),be=Y>g?Math.min(2,he):Math.max(.5,he),Me=Math.pow(be,1-de),Pe=Lr(i.worldSize,ue.add(ce.mult(de*Me)).mult(_e));i.setLocationAtPoint(i.renderWorldCopies?Pe.wrap():Pe,q)}},isZooming:B,elevationCenter:W}}handleFlyTo(i,c){const g=c.zoom!==void 0,_=i.zoom,S=i.getConstrained(a.Q.convert(c.center||c.locationAtOffset),g?+c.zoom:_),C=S.center,O=S.zoom;es(i,C);const R=_s(i.worldSize,c.locationAtOffset),B=_s(i.worldSize,C).sub(R),V=B.mag(),q=a.ac(O-_);let H;if(c.minZoom!==void 0){const W=Math.min(+c.minZoom,_,O),Y=i.getConstrained(C,W).zoom;H=a.ac(Y-_)}return{easeFunc:(W,Y,ue,ce)=>{i.setZoom(W===1?O:_+a.ah(Y));const he=W===1?C:Lr(i.worldSize,R.add(B.mult(ue)).mult(Y));i.setLocationAtPoint(i.renderWorldCopies?he.wrap():he,ce)},scaleOfZoom:q,targetCenter:C,scaleOfMinZoom:H,pixelPathLength:V}}}class Ai{constructor(i,c,g){this.blendFunction=i,this.blendColor=c,this.mask=g}}Ai.Replace=[1,0],Ai.disabled=new Ai(Ai.Replace,a.b7.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,a.b7.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,771],a.b7.transparent,[!0,!0,!0,!0]);const cc=2305;class Ti{constructor(i,c,g){this.enable=i,this.mode=c,this.frontFace=g}}Ti.disabled=new Ti(!1,1029,cc),Ti.backCCW=new Ti(!0,1029,cc),Ti.frontCCW=new Ti(!0,1028,cc);class ri{constructor(i,c,g){this.func=i,this.mask=c,this.range=g}}ri.ReadOnly=!1,ri.ReadWrite=!0,ri.disabled=new ri(519,ri.ReadOnly,[0,1]);const Zo=7680;class vi{constructor(i,c,g,_,S,C){this.test=i,this.ref=c,this.mask=g,this.fail=_,this.depthFail=S,this.pass=C}}vi.disabled=new vi({func:519,mask:0},0,0,Zo,Zo,Zo);const ls=new WeakMap;function bs(x){var i;if(ls.has(x))return ls.get(x);{const c=(i=x.getParameter(x.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return ls.set(x,c),c}}class Go{get awaitingQuery(){return!!this._readbackQueue}constructor(i){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=i;const c=i.context,g=c.gl;this._texFormat=g.RGBA,this._texType=g.UNSIGNED_BYTE;const _=new a.aI;_.emplaceBack(-1,-1),_.emplaceBack(2,-1),_.emplaceBack(-1,2);const S=new a.aK;S.emplaceBack(0,1,2),this._fullscreenTriangle=new bl(c.createVertexBuffer(_,Nr.members),c.createIndexBuffer(S),a.aJ.simpleSegment(0,0,_.length,S.length)),this._resultBuffer=new Uint8Array(4),c.activeTexture.set(g.TEXTURE1);const C=g.createTexture();g.bindTexture(g.TEXTURE_2D,C),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texImage2D(g.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=c.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),bs(g)&&(this._pbo=g.createBuffer(),g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.bufferData(g.PIXEL_PACK_BUFFER,4,g.STREAM_READ),g.bindBuffer(g.PIXEL_PACK_BUFFER,null))}destroy(){const i=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),i.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(i,c){const g=this._updateCount;return this._readbackQueue?g>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():g>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(i,c),this._updateCount++,this._measuredError}_bindFramebuffer(){const i=this._cachedRenderContext.context,c=i.gl;i.activeTexture.set(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,this._fbo.colorAttachment.get()),i.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(i,c){const g=this._cachedRenderContext.context,_=g.gl;if(this._bindFramebuffer(),g.viewport.set([0,0,this._texWidth,this._texHeight]),g.clear({color:a.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(g,_.TRIANGLES,ri.disabled,vi.disabled,Ai.unblended,Ti.disabled,((S,C)=>({u_input:S,u_output_expected:C}))(i,c),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&bs(_)){_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.readBuffer(_.COLOR_ATTACHMENT0),_.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,null);const S=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0);_.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const i=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&bs(i)){const c=i.clientWaitSync(this._readbackQueue.sync,0,0);if(c===i.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(c===i.TIMEOUT_EXPIRED)return;i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),i.bindBuffer(i.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Go._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(i){let c=0;return c+=i[0]/256,c+=i[1]/65536,c+=i[2]/16777216,i[3]<127&&(c=-c),c/128}}const ka=a.Z/128;function ch(x,i){const c=x.granularity!==void 0?Math.max(x.granularity,1):1,g=c+(x.generateBorders?2:0),_=c+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),S=g+1,C=_+1,O=x.generateBorders?-1:0,R=x.generateBorders||x.extendToNorthPole?-1:0,B=c+(x.generateBorders?1:0),V=c+(x.generateBorders||x.extendToSouthPole?1:0),q=S*C,H=g*_*6,W=S*C>65536;if(W&&i==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Y=W||i==="32bit",ue=new Int16Array(2*q);let ce=0;for(let _e=R;_e<=V;_e++)for(let be=O;be<=B;be++){let Me=be/c*a.Z;be===-1&&(Me=-64),be===c+1&&(Me=a.Z+ka);let Pe=_e/c*a.Z;_e===-1&&(Pe=x.extendToNorthPole?a.b9:-64),_e===c+1&&(Pe=x.extendToSouthPole?a.ba:a.Z+ka),ue[ce++]=Me,ue[ce++]=Pe}const he=Y?new Uint32Array(H):new Uint16Array(H);let de=0;for(let _e=0;_e<_;_e++)for(let be=0;be<g;be++){const Me=be+1+_e*S,Pe=be+(_e+1)*S,Ce=be+1+(_e+1)*S;he[de++]=be+_e*S,he[de++]=Pe,he[de++]=Me,he[de++]=Me,he[de++]=Pe,he[de++]=Ce}return{vertices:ue.buffer.slice(0),indices:he.buffer.slice(0),uses32bitIndices:Y}}const Ea=new a.aH({fill:new a.bb(128,2),line:new a.bb(512,0),tile:new a.bb(128,32),stencil:new a.bb(128,1),circle:3});class Sl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return hi.projectionGlobe}get vertexShaderPreludeCode(){return hi.projectionMercator.vertexSource}get subdivisionGranularity(){return Ea}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(i){this._errorMeasurement||(this._errorMeasurement=new Go(i));const c=a.S(this._errorQueryLatitudeDegrees),g=2*Math.atan(Math.exp(Math.PI-c*Math.PI*2))-.5*Math.PI,_=this._errorMeasurement.updateErrorLoop(c,g),S=j.now();_!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=_,this._errorMeasurementLastChangeTime=S);const C=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bd(C))}_getMeshKey(i){return`${i.granularity.toString(36)}_${i.generateBorders?"b":""}${i.extendToNorthPole?"n":""}${i.extendToSouthPole?"s":""}`}getMeshFromTileID(i,c,g,_,S){const C=(S==="stencil"?Ea.stencil:Ea.tile).getGranularityForZoomLevel(c.z);return this._getMesh(i,{granularity:C,generateBorders:g,extendToNorthPole:c.y===0&&_,extendToSouthPole:c.y===(1<<c.z)-1&&_})}_getMesh(i,c){const g=this._getMeshKey(c);if(g in this._tileMeshCache)return this._tileMeshCache[g];const _=function(S,C){const O=ch(C,"16bit"),R=a.aI.deserialize({arrayBuffer:O.vertices,length:O.vertices.byteLength/2/2}),B=a.aK.deserialize({arrayBuffer:O.indices,length:O.indices.byteLength/2/3});return new bl(S.createVertexBuffer(R,Nr.members),S.createIndexBuffer(B),a.aJ.simpleSegment(0,0,R.length,B.length))}(i,c);return this._tileMeshCache[g]=_,_}recalculate(i){}hasTransition(){const i=j.now();let c=!1;return c=c||(i-this._errorMeasurementLastChangeTime)/1e3<.7,c=c||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,c}setErrorQueryLatitudeDegrees(i){this._errorQueryLatitudeDegrees=i}}const $o=new a.r({type:new a.D(a.v.projection.type)});class nu extends a.E{constructor(i){super(),this._transitionable=new a.T($o),this.setProjection(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0)),this._mercatorProjection=new rn,this._verticalPerspectiveProjection=new Sl}get transitionState(){const i=this.properties.get("type");if(typeof i=="string"&&i==="mercator")return 0;if(typeof i=="string"&&i==="vertical-perspective")return 1;if(i instanceof a.be){if(i.from==="vertical-perspective"&&i.to==="mercator")return 1-i.transition;if(i.from==="mercator"&&i.to==="vertical-perspective")return i.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(i){this._mercatorProjection.updateGPUdependent(i),this._verticalPerspectiveProjection.updateGPUdependent(i)}getMeshFromTileID(i,c,g,_,S){return this.currentProjection.getMeshFromTileID(i,c,g,_,S)}setProjection(i){this._transitionable.setValue("type",(i==null?void 0:i.type)||"mercator")}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}setErrorQueryLatitudeDegrees(i){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(i),this._mercatorProjection.setErrorQueryLatitudeDegrees(i)}}function su(x){const i=uh(x.worldSize,x.center.lat);return 2*Math.PI*i}function uc(x,i,c,g,_){const S=1/(1<<_),C=i/a.Z*S+g*S,O=a.bg((x/a.Z*S+c*S)*Math.PI*2+Math.PI,2*Math.PI),R=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,B=Math.cos(R),V=new Float64Array(3);return V[0]=Math.sin(O)*B,V[1]=Math.sin(R),V[2]=Math.cos(O)*B,V}function Rs(x){return function(i,c){const g=Math.cos(c),_=new Float64Array(3);return _[0]=Math.sin(i)*g,_[1]=Math.sin(c),_[2]=Math.cos(i)*g,_}(x.lng*Math.PI/180,x.lat*Math.PI/180)}function uh(x,i){return x/(2*Math.PI)/Math.cos(i*Math.PI/180)}function Is(x){const i=Math.asin(x[1])/Math.PI*180,c=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(c>1e-6){const g=x[0]/c,_=Math.acos(x[2]/c),S=(g>0?_:-_)/Math.PI*180;return new a.Q(a.aL(S,-180,180),i)}return new a.Q(0,i)}function hc(x){return Math.cos(x*Math.PI/180)}function Ki(x,i){const c=hc(x),g=hc(i);return a.ah(g/c)}function ru(x,i){const c=x.rotate(i.bearingInRadians),g=i.zoom+Ki(i.center.lat,0),_=a.bc(1/hc(i.center.lat),1/hc(Math.min(Math.abs(i.center.lat),60)),a.bf(g,7,3,0,1)),S=360/su({worldSize:i.worldSize,center:{lat:i.center.lat}});return new a.Q(i.center.lng-c.x*S*_,a.ae(i.center.lat+c.y*S,-85.051129,a.af))}function hh(x){const i=.5*x,c=Math.sin(i),g=Math.cos(i);return Math.log(c+g)-Math.log(g-c)}function Of(x,i,c,g){const _=x.lat+c*g;if(Math.abs(c)>1){const S=(Math.sign(x.lat+c)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,C=Math.abs(x.lat+c)*Math.PI/180,O=hh(S+g*(C-S)),R=hh(S),B=hh(C);return new a.Q(x.lng+i*((O-R)/(B-R)),_)}return new a.Q(x.lng+i*g,_)}class Tl{constructor(i){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=i}recalculateCache(){if(!this._hadAnyChanges)return;const i=this._cachePrevious;this._cachePrevious=this._cache,this._cache=i,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(i,c,g,_){const S=`${i.z}_${i.x}_${i.y}`,C=this._cache.get(S);if(C)return C;const O=this._cachePrevious.get(S);if(O)return this._cache.set(S,O),O;const R=this._aabbFactory(i,c,g,_);return this._cache.set(S,R),this._hadAnyChanges=!0,R}}function fh(x,i,c){const g=x-i;return g<0?-g:Math.max(0,g-c)}function Df(x,i,c,g,_){const S=x-c;let C;return C=S<0?Math.min(-S,1+S-_):S>1?Math.min(Math.max(S-_,0),1-S):0,Math.max(C,fh(i,g,_))}class qm{constructor(){this._aabbCache=new Tl(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(i,c,g,_){const S=1<<g.z,C=1/S,O=g.x/S,R=g.y/S;let B=2;return B=Math.min(B,Df(i,c,O,R,C)),B=Math.min(B,Df(i,c,O+.5,-R-C,C)),B=Math.min(B,Df(i,c,O+.5,2-R-C,C)),B}getWrap(i,c,g){const _=1<<c.z,S=1/_,C=c.x/_,O=fh(i.x,C,S),R=fh(i.x,C-1,S),B=fh(i.x,C+1,S),V=Math.min(O,R,B);return V===B?1:V===R?-1:0}allowVariableZoom(i,c){return Ve(i,c)>4}allowWorldCopies(){return!1}getTileAABB(i,c,g,_){return this._aabbCache.getTileAABB(i,c,g,_)}_computeTileAABB(i,c,g,_){if(i.z<=0)return new Ho([-1,-1,-1],[1,1,1]);if(i.z===1)return new Ho([i.x===0?-1:0,i.y===0?0:-1,-1],[i.x===0?0:1,i.y===0?1:0,1]);{const S=[uc(0,0,i.x,i.y,i.z),uc(a.Z,0,i.x,i.y,i.z),uc(a.Z,a.Z,i.x,i.y,i.z),uc(0,a.Z,i.x,i.y,i.z)],C=[1,1,1],O=[-1,-1,-1];for(const R of S)for(let B=0;B<3;B++)C[B]=Math.min(C[B],R[B]),O[B]=Math.max(O[B],R[B]);if(i.y===0||i.y===(1<<i.z)-1){const R=[0,i.y===0?1:-1,0];for(let B=0;B<3;B++)C[B]=Math.min(C[B],R[B]),O[B]=Math.max(O[B],R[B])}return new Ho(C,O)}}}class dh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,c,g){return this._helper.interpolatePadding(i,c,g)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,c){this._helper.resize(i,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,c){this._helper.overrideNearFarZ(i,c)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i){}constructor(){this._cachedClippingPlane=a.bk(),this._projectionMatrix=a.b1(),this._globeViewProjMatrix32f=a.b0(),this._globeViewProjMatrixNoCorrection=a.b1(),this._globeViewProjMatrixNoCorrectionInverted=a.b1(),this._globeProjMatrixInverted=a.b1(),this._cameraPosition=a.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,c)=>this.getConstrained(i,c)}),this._coveringTilesDetailsProvider=new qm}clone(){const i=new dh;return i.apply(this),i}apply(i,c){this._globeLatitudeErrorCorrectionRadians=c||0,this._helper.apply(i)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const i=a.bh();return i[0]=this._cameraPosition[0],i[1]=this._cameraPosition[1],i[2]=this._cameraPosition[2],i}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(i){const{overscaledTileID:c,applyGlobeMatrix:g}=i,_=this._helper.getMercatorTileCoordinates(c);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:_,clippingPlane:this._cachedClippingPlane,projectionTransition:g?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(i){const c=this.pitchInRadians,g=this.cameraToCenterDistance/i,_=Math.sin(c)*g,S=Math.cos(c)*g+1,C=1/Math.sqrt(_*_+S*S)*1;let O=-_,R=S;const B=Math.sqrt(O*O+R*R);O/=B,R/=B;const V=[0,O,R];a.bl(V,V,[0,0,0],-this.bearingInRadians),a.bm(V,V,[0,0,0],-1*this.center.lat*Math.PI/180),a.bn(V,V,[0,0,0],this.center.lng*Math.PI/180);const q=1/a.bo(V);return a.aO(V,V,q),[...V,-C*q]}isLocationOccluded(i){return!this.isSurfacePointVisible(Rs(i))}transformLightDirection(i){const c=this._helper._center.lng*Math.PI/180,g=this._helper._center.lat*Math.PI/180,_=Math.cos(g),S=[Math.sin(c)*_,Math.sin(g),Math.cos(c)*_],C=[S[2],0,-S[0]],O=[0,0,0];a.aU(O,C,S),a.aT(C,C),a.aT(O,O);const R=[0,0,0];return a.aT(R,[C[0]*i[0]+O[0]*i[1]+S[0]*i[2],C[1]*i[0]+O[1]*i[1]+S[1]*i[2],C[2]*i[0]+O[2]*i[1]+S[2]*i[2]]),R}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(i,c,g){const _=function(O,R,B){const V=1/(1<<B.z);return new a.$(O/a.Z*V+B.x*V,R/a.Z*V+B.y*V)}(i,c,g.canonical),S=(C=_.y,[a.bg(_.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(i,c,g,_){const S=g.canonical,C=uc(i,c,S.x,S.y,S.z),O=1+(_?_(i,c):0)/a.bu,R=[C[0]*O,C[1]*O,C[2]*O,1];a.at(R,R,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,V=B[0]*C[0]+B[1]*C[1]+B[2]*C[2]+B[3]<0;return{point:new a.P(R[0]/R[3],R[1]/R[3]),signedDistanceFromCamera:R[3],isOccluded:V}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const i=uh(this.worldSize,this.center.lat),c=a.b2(),g=a.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*i),a.aY(c,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const _=this.centerOffset;c[8]=2*-_.x/this._helper._width,c[9]=2*_.y/this._helper._height,this._projectionMatrix=a.aZ(c),this._globeProjMatrixInverted=a.b2(),a.an(this._globeProjMatrixInverted,c),a.L(c,c,[0,0,-this.cameraToCenterDistance]),a.a_(c,c,this.rollInRadians),a.a$(c,c,-this.pitchInRadians),a.a_(c,c,this.bearingInRadians),a.L(c,c,[0,0,-i]);const S=a.bh();S[0]=i,S[1]=i,S[2]=i,a.a$(g,c,this.center.lat*Math.PI/180),a.bp(g,g,-this.center.lng*Math.PI/180),a.M(g,g,S),this._globeViewProjMatrixNoCorrection=g,a.a$(c,c,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bp(c,c,-this.center.lng*Math.PI/180),a.M(c,c,S),this._globeViewProjMatrix32f=new Float32Array(c),this._globeViewProjMatrixNoCorrectionInverted=a.b2(),a.an(this._globeViewProjMatrixNoCorrectionInverted,g);const C=a.bh();this._cameraPosition=a.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/i,a.bl(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),a.bm(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),a.bl(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),a.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bm(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),a.bn(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(i);const O=a.aZ(this._globeViewProjMatrixNoCorrectionInverted);a.M(O,O,[1,1,-1]),this._cachedFrustum=mn.fromInvProjectionMatrix(O)}calculateFogMatrix(i){a.w("calculateFogMatrix is not supported on globe projection.");const c=a.b2();return a.ad(c),c}getVisibleUnwrappedCoordinates(i){return[new a.aW(0,i)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){i&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,c){if(!this._globeViewProjMatrixNoCorrection)return 1;const g=Rs(i);a.aO(g,g,1+c/a.bu);const _=a.bk();return a.at(_,[g[0],g[1],g[2],1],this._globeViewProjMatrixNoCorrection),_[2]/_[3]}populateCache(i){}getBounds(){const i=.5*this.width,c=.5*this.height,g=[new a.P(0,0),new a.P(i,0),new a.P(this.width,0),new a.P(this.width,c),new a.P(this.width,this.height),new a.P(i,this.height),new a.P(0,this.height),new a.P(0,c)],_=[];for(const q of g)_.push(this.unprojectScreenPoint(q));let S=0,C=0,O=0,R=0;const B=this.center;for(const q of _){const H=a.bq(B.lng,q.lng),W=a.bq(B.lat,q.lat);H<C&&(C=H),H>S&&(S=H),W<R&&(R=W),W>O&&(O=W)}const V=[B.lng+C,B.lat+R,B.lng+S,B.lat+O];return this.isSurfacePointOnScreen([0,1,0])&&(V[3]=90,V[0]=-180,V[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(V[1]=-90,V[0]=-180,V[2]=180),new ji(V)}getConstrained(i,c){const g=a.ae(i.lat,-85.051129,a.af),_=a.ae(+c,this.minZoom+Ki(0,g),this.maxZoom);return{center:new a.Q(i.lng,g),zoom:_}}calculateCenterFromCameraLngLatAlt(i,c,g,_){return this._helper.calculateCenterFromCameraLngLatAlt(i,c,g,_)}setLocationAtPoint(i,c){const g=Rs(this.unprojectScreenPoint(c)),_=Rs(i),S=a.bh();a.br(S);const C=a.bh();a.bn(C,g,S,-this.center.lng*Math.PI/180),a.bm(C,C,S,this.center.lat*Math.PI/180);const O=_[0]*_[0]+_[2]*_[2],R=C[0]*C[0];if(O<R)return;const B=Math.sqrt(O-R),V=-B,q=a.bs(_[0],_[2],C[0],B),H=a.bs(_[0],_[2],C[0],V),W=a.bh();a.bn(W,_,S,-q);const Y=a.bs(W[1],W[2],C[1],C[2]),ue=a.bh();a.bn(ue,_,S,-H);const ce=a.bs(ue[1],ue[2],C[1],C[2]),he=.5*Math.PI,de=Y>=-he&&Y<=he,_e=ce>=-he&&ce<=he;let be,Me;if(de&&_e){const qe=this.center.lng*Math.PI/180,it=this.center.lat*Math.PI/180;a.bv(q,qe)+a.bv(Y,it)<a.bv(H,qe)+a.bv(ce,it)?(be=q,Me=Y):(be=H,Me=ce)}else if(de)be=q,Me=Y;else{if(!_e)return;be=H,Me=ce}const Pe=be/Math.PI*180,Ce=Me/Math.PI*180,Ne=this.center.lat;this.setCenter(new a.Q(Pe,a.ae(Ce,-90,90))),this.setZoom(this.zoom+Ki(Ne,this.center.lat))}locationToScreenPoint(i,c){const g=Rs(i);if(c){const _=c.getElevationForLngLatZoom(i,this._helper._tileZoom);a.aO(g,g,1+_/a.bu)}return this._projectSurfacePointToScreen(g)}_projectSurfacePointToScreen(i){const c=a.bk();return a.at(c,[...i,1],this._globeViewProjMatrixNoCorrection),c[0]/=c[3],c[1]/=c[3],new a.P((.5*c[0]+.5)*this.width,(.5*-c[1]+.5)*this.height)}screenPointToMercatorCoordinate(i,c){if(c){const g=c.pointCoordinate(i);if(g)return g}return a.$.fromLngLat(this.unprojectScreenPoint(i))}screenPointToLocation(i,c){var g;return(g=this.screenPointToMercatorCoordinate(i,c))===null||g===void 0?void 0:g.toLngLat()}isPointOnMapSurface(i,c){const g=this._cameraPosition,_=this.getRayDirectionFromPixel(i);return!!this.rayPlanetIntersection(g,_)}getRayDirectionFromPixel(i){const c=a.bk();c[0]=i.x/this.width*2-1,c[1]=-1*(i.y/this.height*2-1),c[2]=1,c[3]=1,a.at(c,c,this._globeViewProjMatrixNoCorrectionInverted),c[0]/=c[3],c[1]/=c[3],c[2]/=c[3];const g=a.bh();g[0]=c[0]-this._cameraPosition[0],g[1]=c[1]-this._cameraPosition[1],g[2]=c[2]-this._cameraPosition[2];const _=a.bh();return a.aT(_,g),_}isSurfacePointVisible(i){const c=this._cachedClippingPlane;return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]+c[3]>=0}isSurfacePointOnScreen(i){if(!this.isSurfacePointVisible(i))return!1;const c=a.bk();return a.at(c,[...i,1],this._globeViewProjMatrixNoCorrection),c[0]/=c[3],c[1]/=c[3],c[2]/=c[3],c[0]>-1&&c[0]<1&&c[1]>-1&&c[1]<1&&c[2]>-1&&c[2]<1}rayPlanetIntersection(i,c){const g=a.aV(i,c),_=a.bh(),S=a.bh();a.aO(S,c,g),a.aS(_,i,S);const C=1-a.aV(_,_);if(C<0)return null;const O=a.aV(i,i)-1,R=-g+(g<0?1:-1)*Math.sqrt(C),B=O/R,V=R;return{tMin:Math.min(B,V),tMax:Math.max(B,V)}}unprojectScreenPoint(i){const c=this._cameraPosition,g=this.getRayDirectionFromPixel(i),_=this.rayPlanetIntersection(c,g);if(_){const V=a.bh();a.aP(V,c,[g[0]*_.tMin,g[1]*_.tMin,g[2]*_.tMin]);const q=a.bh();return a.aT(q,V),Is(q)}const S=this._cachedClippingPlane,C=S[0]*g[0]+S[1]*g[1]+S[2]*g[2],O=-a.bt(S,c)/C,R=a.bh();if(O>0)a.aP(R,c,[g[0]*O,g[1]*O,g[2]*O]);else{const V=a.bh();a.aP(V,c,[2*g[0],2*g[1],2*g[2]]);const q=a.bt(this._cachedClippingPlane,V);a.aS(R,V,[this._cachedClippingPlane[0]*q,this._cachedClippingPlane[1]*q,this._cachedClippingPlane[2]*q])}const B=function(V){const q=a.bh();return q[0]=V[0]*-V[3],q[1]=V[1]*-V[3],q[2]=V[2]*-V[3],{center:q,radius:Math.sqrt(1-V[3]*V[3])}}(S);return Is(function(V,q,H){const W=a.bh();a.aS(W,H,V);const Y=a.bh();return a.bi(Y,V,W,q/a.bj(W)),Y}(B.center,B.radius,R))}getMatrixForModel(i,c){const g=a.Q.convert(i),_=1/a.bu,S=a.b1();return a.bp(S,S,g.lng/180*Math.PI),a.a$(S,S,-g.lat/180*Math.PI),a.L(S,S,[0,0,1+c/a.bu]),a.a$(S,S,.5*Math.PI),a.M(S,S,[_,_,_]),S}getProjectionDataForCustomLayer(i=!0){const c=this.getProjectionData({overscaledTileID:new a.Y(0,0,0,0,0),applyGlobeMatrix:i});return c.tileMercatorCoords=[0,0,1,1],c}getFastPathSimpleProjectionMatrix(i){}}class fc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,c,g){return this._helper.interpolatePadding(i,c,g)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,c,g=!0){this._helper.resize(i,c,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,c){this._helper.overrideNearFarZ(i,c)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(i,c){this._globeness=i,this._globeLatitudeErrorCorrectionRadians=c,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Un({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,c)=>this.getConstrained(i,c)}),this._globeness=1,this._mercatorTransform=new or,this._verticalPerspectiveTransform=new dh}clone(){const i=new fc;return i._globeness=this._globeness,i._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,i.apply(this),i}apply(i){this._helper.apply(i),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(i){const c=this._mercatorTransform.getProjectionData(i),g=this._verticalPerspectiveTransform.getProjectionData(i);return{mainMatrix:this.isGlobeRendering?g.mainMatrix:c.mainMatrix,clippingPlane:g.clippingPlane,tileMercatorCoords:g.tileMercatorCoords,projectionTransition:i.applyGlobeMatrix?this._globeness:0,fallbackMatrix:c.fallbackMatrix}}isLocationOccluded(i){return this.currentTransform.isLocationOccluded(i)}transformLightDirection(i){return this.currentTransform.transformLightDirection(i)}getPixelScale(){return a.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(i,c,g){const _=this._mercatorTransform.getPitchedTextCorrection(i,c,g),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(i,c,g);return a.bc(_,S,this._globeness)}projectTileCoordinates(i,c,g,_){return this.currentTransform.projectTileCoordinates(i,c,g,_)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(i){return this.currentTransform.calculateFogMatrix(i)}getVisibleUnwrappedCoordinates(i){return this.currentTransform.getVisibleUnwrappedCoordinates(i)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(i){this._mercatorTransform.recalculateZoomAndCenter(i),this._verticalPerspectiveTransform.recalculateZoomAndCenter(i)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,c){return this.currentTransform.lngLatToCameraDepth(i,c)}populateCache(i){this._mercatorTransform.populateCache(i),this._verticalPerspectiveTransform.populateCache(i)}getBounds(){return this.currentTransform.getBounds()}getConstrained(i,c){return this.currentTransform.getConstrained(i,c)}calculateCenterFromCameraLngLatAlt(i,c,g,_){return this._helper.calculateCenterFromCameraLngLatAlt(i,c,g,_)}setLocationAtPoint(i,c){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(i,c),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(i,c),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(i,c){return this.currentTransform.locationToScreenPoint(i,c)}screenPointToMercatorCoordinate(i,c){return this.currentTransform.screenPointToMercatorCoordinate(i,c)}screenPointToLocation(i,c){return this.currentTransform.screenPointToLocation(i,c)}isPointOnMapSurface(i,c){return this.currentTransform.isPointOnMapSurface(i,c)}getRayDirectionFromPixel(i){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(i)}getMatrixForModel(i,c){return this.currentTransform.getMatrixForModel(i,c)}getProjectionDataForCustomLayer(i=!0){const c=this._mercatorTransform.getProjectionDataForCustomLayer(i);if(!this.isGlobeRendering)return c;const g=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(i);return g.fallbackMatrix=c.mainMatrix,g}getFastPathSimpleProjectionMatrix(i){return this.currentTransform.getFastPathSimpleProjectionMatrix(i)}}class Jr{get useGlobeControls(){return!0}handlePanInertia(i,c){const g=ru(i,c);return Math.abs(g.lng-c.center.lng)>180&&(g.lng=c.center.lng+179.5*Math.sign(g.lng-c.center.lng)),{easingCenter:g,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(i,c){const g=i.around,_=c.screenPointToLocation(g);i.bearingDelta&&c.setBearing(c.bearing+i.bearingDelta),i.pitchDelta&&c.setPitch(c.pitch+i.pitchDelta),i.rollDelta&&c.setRoll(c.roll+i.rollDelta);const S=c.zoom;i.zoomDelta&&c.setZoom(c.zoom+i.zoomDelta);const C=c.zoom-S;if(C===0)return;const O=a.bq(c.center.lng,_.lng),R=O/(Math.abs(O/180)+1),B=a.bq(c.center.lat,_.lat),V=c.getRayDirectionFromPixel(g),q=c.cameraPosition,H=-1*a.aV(q,V),W=a.bh();a.aP(W,q,[V[0]*H,V[1]*H,V[2]*H]);const Y=a.bo(W)-1,ue=Math.exp(.5*-Math.max(Y-.3,0)),ce=uh(c.worldSize,c.center.lat)/Math.min(c.width,c.height),he=a.bf(ce,.9,.5,1,.25),de=(1-a.ac(-C))*Math.min(ue,he),_e=c.center.lat,be=c.zoom,Me=new a.Q(c.center.lng+R*de,a.ae(c.center.lat+B*de,-85.051129,a.af));c.setLocationAtPoint(_,g);const Pe=c.center,Ce=a.bf(Math.abs(O),45,85,0,1),Ne=a.bf(ce,.75,.35,0,1),qe=Math.pow(Math.max(Ce,Ne),.25),it=a.bq(Pe.lng,Me.lng),tt=a.bq(Pe.lat,Me.lat);c.setCenter(new a.Q(Pe.lng+it*qe,Pe.lat+tt*qe).wrap()),c.setZoom(be+Ki(_e,c.center.lat))}handleMapControlsPan(i,c,g){if(!i.panDelta)return;const _=c.center.lat,S=c.zoom;c.setCenter(ru(i.panDelta,c).wrap()),c.setZoom(S+Ki(_,c.center.lat))}cameraForBoxAndBearing(i,c,g,_,S){const C=Ds(i,c,g,_,S),O=c.left/S.width*2-1,R=(S.width-c.right)/S.width*2-1,B=c.top/S.height*-2+1,V=(S.height-c.bottom)/S.height*-2+1,q=a.bq(g.getWest(),g.getEast())<0,H=q?g.getEast():g.getWest(),W=q?g.getWest():g.getEast(),Y=Math.max(g.getNorth(),g.getSouth()),ue=Math.min(g.getNorth(),g.getSouth()),ce=H+.5*a.bq(H,W),he=Y+.5*a.bq(Y,ue),de=S.clone();de.setCenter(C.center),de.setBearing(C.bearing),de.setPitch(0),de.setRoll(0),de.setZoom(C.zoom);const _e=de.modelViewProjectionMatrix,be=[Rs(g.getNorthWest()),Rs(g.getNorthEast()),Rs(g.getSouthWest()),Rs(g.getSouthEast()),Rs(new a.Q(W,he)),Rs(new a.Q(H,he)),Rs(new a.Q(ce,Y)),Rs(new a.Q(ce,ue))],Me=Rs(C.center);let Pe=Number.POSITIVE_INFINITY;for(const Ce of be)O<0&&(Pe=Jr.getLesserNonNegativeNonNull(Pe,Jr.solveVectorScale(Ce,Me,_e,"x",O))),R>0&&(Pe=Jr.getLesserNonNegativeNonNull(Pe,Jr.solveVectorScale(Ce,Me,_e,"x",R))),B>0&&(Pe=Jr.getLesserNonNegativeNonNull(Pe,Jr.solveVectorScale(Ce,Me,_e,"y",B))),V<0&&(Pe=Jr.getLesserNonNegativeNonNull(Pe,Jr.solveVectorScale(Ce,Me,_e,"y",V)));if(Number.isFinite(Pe)&&Pe!==0)return C.zoom=de.zoom+a.ah(Pe),C;Os()}handleJumpToCenterZoom(i,c){const g=i.center.lat,_=i.getConstrained(c.center?a.Q.convert(c.center):i.center,i.zoom).center;i.setCenter(_.wrap());const S=c.zoom!==void 0?+c.zoom:i.zoom+Ki(g,_.lat);i.zoom!==S&&i.setZoom(S)}handleEaseTo(i,c){const g=i.zoom,_=i.center,S=i.padding,C={roll:i.roll,pitch:i.pitch,bearing:i.bearing},O={roll:c.roll===void 0?i.roll:c.roll,pitch:c.pitch===void 0?i.pitch:c.pitch,bearing:c.bearing===void 0?i.bearing:c.bearing},R=c.zoom!==void 0,B=!i.isPaddingEqual(c.padding);let V=!1;const q=c.center?a.Q.convert(c.center):_,H=i.getConstrained(q,g).center;es(i,H);const W=i.clone();W.setCenter(H),W.setZoom(R?+c.zoom:g+Ki(_.lat,q.lat)),W.setBearing(c.bearing);const Y=new a.P(a.ae(i.centerPoint.x+c.offsetAsPoint.x,0,i.width),a.ae(i.centerPoint.y+c.offsetAsPoint.y,0,i.height));W.setLocationAtPoint(H,Y);const ue=(c.offset&&c.offsetAsPoint.mag())>0?W.center:H,ce=R?+c.zoom:g+Ki(_.lat,ue.lat),he=g+Ki(_.lat,0),de=ce+Ki(ue.lat,0),_e=a.bq(_.lng,ue.lng),be=a.bq(_.lat,ue.lat),Me=a.ac(de-he);return V=ce!==g,{easeFunc:Pe=>{if(a.b6(C,O)||wl({startEulerAngles:C,endEulerAngles:O,tr:i,k:Pe,useSlerp:C.roll!=O.roll}),B&&i.interpolatePadding(S,c.padding,Pe),c.around)a.w("Easing around a point is not supported under globe projection."),i.setLocationAtPoint(c.around,c.aroundPoint);else{const Ce=de>he?Math.min(2,Me):Math.max(.5,Me),Ne=Math.pow(Ce,1-Pe),qe=Of(_,_e,be,Pe*Ne);i.setCenter(qe.wrap())}if(V){const Ce=a.B.number(he,de,Pe)+Ki(0,i.center.lat);i.setZoom(Ce)}},isZooming:V,elevationCenter:ue}}handleFlyTo(i,c){const g=c.zoom!==void 0,_=i.center,S=i.zoom,C=i.padding,O=!i.isPaddingEqual(c.padding),R=i.getConstrained(a.Q.convert(c.center||c.locationAtOffset),S).center,B=g?+c.zoom:i.zoom+Ki(i.center.lat,R.lat),V=i.clone();V.setCenter(R),V.setZoom(B),V.setBearing(c.bearing);const q=new a.P(a.ae(i.centerPoint.x+c.offsetAsPoint.x,0,i.width),a.ae(i.centerPoint.y+c.offsetAsPoint.y,0,i.height));V.setLocationAtPoint(R,q);const H=V.center;es(i,H);const W=function(be,Me,Pe){const Ce=Rs(Me),Ne=Rs(Pe),qe=a.aV(Ce,Ne),it=Math.acos(qe),tt=su(be);return it/(2*Math.PI)*tt}(i,_,H),Y=S+Ki(_.lat,0),ue=B+Ki(H.lat,0),ce=a.ac(ue-Y);let he;if(typeof c.minZoom=="number"){const be=+c.minZoom+Ki(H.lat,0),Me=Math.min(be,Y,ue)+Ki(0,H.lat),Pe=i.getConstrained(H,Me).zoom+Ki(H.lat,0);he=a.ac(Pe-Y)}const de=a.bq(_.lng,H.lng),_e=a.bq(_.lat,H.lat);return{easeFunc:(be,Me,Pe,Ce)=>{const Ne=Of(_,de,_e,Pe);O&&i.interpolatePadding(C,c.padding,be);const qe=be===1?H:Ne;i.setCenter(qe.wrap());const it=Y+a.ah(Me);i.setZoom(be===1?B:it+Ki(0,qe.lat))},scaleOfZoom:ce,targetCenter:H,scaleOfMinZoom:he,pixelPathLength:W}}static solveVectorScale(i,c,g,_,S){const C=_==="x"?[g[0],g[4],g[8],g[12]]:[g[1],g[5],g[9],g[13]],O=[g[3],g[7],g[11],g[15]],R=i[0]*C[0]+i[1]*C[1]+i[2]*C[2],B=i[0]*O[0]+i[1]*O[1]+i[2]*O[2],V=c[0]*C[0]+c[1]*C[1]+c[2]*C[2],q=c[0]*O[0]+c[1]*O[1]+c[2]*O[2];return V+S*B===R+S*q||O[3]*(R-V)+C[3]*(q-B)+R*q==V*B?null:(V+C[3]-S*q-S*O[3])/(V-R-S*q+S*B)}static getLesserNonNegativeNonNull(i,c){return c!==null&&c>=0&&c<i?c:i}}class ou{constructor(i){this._globe=i,this._mercatorCameraHelper=new Fr,this._verticalPerspectiveCameraHelper=new Jr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(i,c){return this.currentHelper.handlePanInertia(i,c)}handleMapControlsRollPitchBearingZoom(i,c){return this.currentHelper.handleMapControlsRollPitchBearingZoom(i,c)}handleMapControlsPan(i,c,g){this.currentHelper.handleMapControlsPan(i,c,g)}cameraForBoxAndBearing(i,c,g,_,S){return this.currentHelper.cameraForBoxAndBearing(i,c,g,_,S)}handleJumpToCenterZoom(i,c){this.currentHelper.handleJumpToCenterZoom(i,c)}handleEaseTo(i,c){return this.currentHelper.handleEaseTo(i,c)}handleFlyTo(i,c){return this.currentHelper.handleFlyTo(i,c)}}const dc=(x,i)=>a.x(x,i&&i.filter(c=>c.identifier!=="source.canvas")),au=a.bw();class lu extends a.E{constructor(i,c={}){super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const _=this.sourceCaches[g].getSource().type;_!=="vector"&&_!=="geojson"||this.sourceCaches[g].reload()}},this.map=i,this.dispatcher=new Ei(Nt(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(g,_)=>this.getGlyphs(g,_)),this.dispatcher.registerMessageHandler("GI",(g,_)=>this.getImages(g,_)),this.imageManager=new Et,this.imageManager.setEventedParent(this),this.glyphManager=new Ft(i._requestManager,c.localIdeographFontFamily),this.lineAtlas=new xe(256,512),this.crossTileSymbolIndex=new vo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.by()),ys().on(rc,this._rtlPluginLoaded),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const _=this.sourceCaches[g.sourceId];if(!_)return;const S=_.getSource();if(S&&S.vectorLayerIds)for(const C in this._layers){const O=this._layers[C];O.source===S.id&&this._validateLayer(O)}})}loadURL(i,c={},g){this.fire(new a.l("dataloading",{dataType:"style"})),c.validate=typeof c.validate!="boolean"||c.validate;const _=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;a.j(_,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,c,g)}).catch(C=>{this._loadStyleRequest=null,C&&!S.signal.aborted&&this.fire(new a.k(C))})}loadJSON(i,c={},g){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,c.validate=c.validate!==!1,this._load(i,c,g)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(au,{validate:!1})}_load(i,c,g){var _,S;const C=c.transformStyle?c.transformStyle(g,i):i;if(!c.validate||!dc(this,a.y(C))){this._loaded=!0,this.stylesheet=C;for(const O in C.sources)this.addSource(O,C.sources[O],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new dt(this.stylesheet.light),this._setProjectionInternal(((_=this.stylesheet.projection)===null||_===void 0?void 0:_.type)||"mercator"),this.sky=new qt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const i=a.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(c=>c.id),this._layers={},this._serializedLayers=null;for(const c of i){const g=a.bA(c);g.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=g}}_loadSprite(i,c=!1,g=void 0){let _;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,C,O,R){return a._(this,void 0,void 0,function*(){const B=Se(S),V=O>1?"@2x":"",q={},H={};for(const{id:W,url:Y}of B){const ue=C.transformRequest(Fe(Y,V,".json"),"SpriteJSON");q[W]=a.j(ue,R);const ce=C.transformRequest(Fe(Y,V,".png"),"SpriteImage");H[W]=ze.getImage(ce,R)}return yield Promise.all([...Object.values(q),...Object.values(H)]),function(W,Y){return a._(this,void 0,void 0,function*(){const ue={};for(const ce in W){ue[ce]={};const he=j.getImageCanvasContext((yield Y[ce]).data),de=(yield W[ce]).data;for(const _e in de){const{width:be,height:Me,x:Pe,y:Ce,sdf:Ne,pixelRatio:qe,stretchX:it,stretchY:tt,content:et,textFitWidth:wt,textFitHeight:vt}=de[_e];ue[ce][_e]={data:null,pixelRatio:qe,sdf:Ne,stretchX:it,stretchY:tt,content:et,textFitWidth:wt,textFitHeight:vt,spriteData:{width:be,height:Me,x:Pe,y:Ce,context:he}}}}return ue})}(q,H)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const C in S){this._spritesImagesIds[C]=[];const O=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(R=>!(R in S)):[];for(const R of O)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in S[C]){const B=C==="default"?R:`${C}:${R}`;this._spritesImagesIds[C].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,S[C][R],!1):this.imageManager.addImage(B,S[C][R]),c&&(this._changedImages[B]=!0)}}}).catch(S=>{this._spriteRequest=null,_=S,this.fire(new a.k(_))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),c&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),g&&g(_)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(i){const c=this.sourceCaches[i.source];if(!c)return;const g=i.sourceLayer;if(!g)return;const _=c.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.k(new Error(`Source layer "${g}" does not exist on source "${_.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,c=!1){const g=this._serializedAllLayers();if(!i||i.length===0)return Object.values(c?a.bB(g):g);const _=[];for(const S of i)if(g[S]){const C=c?a.bB(g[S]):g[S];_.push(C)}return _}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const c=Object.keys(this._layers);for(const g of c){const _=this._layers[g];_.type!=="custom"&&(i[g]=_.serialize())}return i}hasTransitions(){var i,c,g;if(!((i=this.light)===null||i===void 0)&&i.hasTransition()||!((c=this.sky)===null||c===void 0)&&c.hasTransition()||!((g=this.projection)===null||g===void 0)&&g.hasTransition())return!0;for(const _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(const _ in this._layers)if(this._layers[_].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const c=this._changed;if(c){const _=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(_.length||S.length)&&this._updateWorkerLayers(_,S);for(const C in this._updatedSources){const O=this._updatedSources[C];if(O==="reload")this._reloadSource(C);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const g={};for(const _ in this.sourceCaches){const S=this.sourceCaches[_];g[_]=S.used,S.used=!1}for(const _ of this._order){const S=this._layers[_];S.recalculate(i,this._availableImages),!S.isHidden(i.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const _ in g){const S=this.sourceCaches[_];!!g[_]!=!!S.used&&S.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(i),this.sky.recalculate(i),this.projection.recalculate(i),this.z=i.zoom,c&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,c){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,c={}){var g;this._checkLoaded();const _=this.serialize();if(i=c.transformStyle?c.transformStyle(_,i):i,((g=c.validate)===null||g===void 0||g)&&dc(this,a.y(i)))return!1;(i=a.bB(i)).layers=a.bz(i.layers);const S=a.bC(_,i),C=this._getOperationsToPerform(S);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const O of C.operations)O();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const c=[],g=[];for(const _ of i)switch(_.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":c.push(()=>this.addLayer.apply(this,_.args));break;case"removeLayer":c.push(()=>this.removeLayer.apply(this,_.args));break;case"setPaintProperty":c.push(()=>this.setPaintProperty.apply(this,_.args));break;case"setLayoutProperty":c.push(()=>this.setLayoutProperty.apply(this,_.args));break;case"setFilter":c.push(()=>this.setFilter.apply(this,_.args));break;case"addSource":c.push(()=>this.addSource.apply(this,_.args));break;case"removeSource":c.push(()=>this.removeSource.apply(this,_.args));break;case"setLayerZoomRange":c.push(()=>this.setLayerZoomRange.apply(this,_.args));break;case"setLight":c.push(()=>this.setLight.apply(this,_.args));break;case"setGeoJSONSourceData":c.push(()=>this.setGeoJSONSourceData.apply(this,_.args));break;case"setGlyphs":c.push(()=>this.setGlyphs.apply(this,_.args));break;case"setSprite":c.push(()=>this.setSprite.apply(this,_.args));break;case"setTerrain":c.push(()=>this.map.setTerrain.apply(this,_.args));break;case"setSky":c.push(()=>this.setSky.apply(this,_.args));break;case"setProjection":this.setProjection.apply(this,_.args);break;case"setTransition":c.push(()=>{});break;default:g.push(_.command)}return{operations:c,unimplemented:g}}addImage(i,c){if(this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,c),this._afterImageUpdated(i)}updateImage(i,c){this.imageManager.updateImage(i,c)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,c,g={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(a.y.source,`sources.${i}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const _=this.sourceCaches[i]=new Qe(i,c,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:i})),_.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===i)return this.fire(new a.k(new Error(`Source "${i}" cannot be removed while layer "${g}" is using it.`)));const c=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],c.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,c){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const g=this.sourceCaches[i].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(c),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,c,g={}){this._checkLoaded();const _=i.id;if(this.getLayer(_))return void this.fire(new a.k(new Error(`Layer "${_}" already exists on this map.`)));let S;if(i.type==="custom"){if(dc(this,a.bD(i)))return;S=a.bA(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(_,i.source),i=a.bB(i),i=a.e(i,{source:_})),this._validate(a.y.layer,`layers.${_}`,i,{arrayIndex:-1},g))return;S=a.bA(i),this._validateLayer(S),S.setEventedParent(this,{layer:{id:_}})}const C=c?this._order.indexOf(c):this._order.length;if(c&&C===-1)this.fire(new a.k(new Error(`Cannot add layer "${_}" before non-existing layer "${c}".`)));else{if(this._order.splice(C,0,_),this._layerOrderChanged=!0,this._layers[_]=S,this._removedLayers[_]&&S.source&&S.type!=="custom"){const O=this._removedLayers[_];delete this._removedLayers[_],O.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(i,c){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.k(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===c)return;const g=this._order.indexOf(i);this._order.splice(g,1);const _=c?this._order.indexOf(c):this._order.length;c&&_===-1?this.fire(new a.k(new Error(`Cannot move layer "${i}" before non-existing layer "${c}".`))):(this._order.splice(_,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const c=this._layers[i];if(!c)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${i}".`)));c.setEventedParent(null);const g=this._order.indexOf(i);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=c,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],c.onRemove&&c.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,c,g){this._checkLoaded();const _=this.getLayer(i);_?_.minzoom===c&&_.maxzoom===g||(c!=null&&(_.minzoom=c),g!=null&&(_.maxzoom=g),this._updateLayer(_)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,c,g={}){this._checkLoaded();const _=this.getLayer(i);if(_){if(!a.bE(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(a.y.filter,`layers.${_.id}.filter`,c,null,g)||(_.filter=a.bB(c),this._updateLayer(_)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return a.bB(this.getLayer(i).filter)}setLayoutProperty(i,c,g,_={}){this._checkLoaded();const S=this.getLayer(i);S?a.bE(S.getLayoutProperty(c),g)||(S.setLayoutProperty(c,g,_),this._updateLayer(S)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,c){const g=this.getLayer(i);if(g)return g.getLayoutProperty(c);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,c,g,_={}){this._checkLoaded();const S=this.getLayer(i);S?a.bE(S.getPaintProperty(c),g)||(S.setPaintProperty(c,g,_)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,c){return this.getLayer(i).getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();const g=i.source,_=i.sourceLayer,S=this.sourceCaches[g];if(S===void 0)return void this.fire(new a.k(new Error(`The source '${g}' does not exist in the map's style.`)));const C=S.getSource().type;C==="geojson"&&_?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||_?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(_,i.id,c)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,c){this._checkLoaded();const g=i.source,_=this.sourceCaches[g];if(_===void 0)return void this.fire(new a.k(new Error(`The source '${g}' does not exist in the map's style.`)));const S=_.getSource().type,C=S==="vector"?i.sourceLayer:void 0;S!=="vector"||C?c&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(C,i.id,c):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const c=i.source,g=i.sourceLayer,_=this.sourceCaches[c];if(_!==void 0)return _.getSource().type!=="vector"||g?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),_.getFeatureState(g,i.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=a.bF(this.sourceCaches,S=>S.serialize()),c=this._serializeByIds(this._order,!0),g=this.map.getTerrain()||void 0,_=this.stylesheet;return a.bG({version:_.version,name:_.name,metadata:_.metadata,light:_.light,sky:_.sky,center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,sprite:_.sprite,glyphs:_.glyphs,transition:_.transition,projection:_.projection,sources:i,layers:c,terrain:g},S=>S!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const c=C=>this._layers[C].type==="fill-extrusion",g={},_=[];for(let C=this._order.length-1;C>=0;C--){const O=this._order[C];if(c(O)){g[O]=C;for(const R of i){const B=R[O];if(B)for(const V of B)_.push(V)}}}_.sort((C,O)=>O.intersectionZ-C.intersectionZ);const S=[];for(let C=this._order.length-1;C>=0;C--){const O=this._order[C];if(c(O))for(let R=_.length-1;R>=0;R--){const B=_[R].feature;if(g[B.layer.id]<C)break;S.push(B),_.pop()}else for(const R of i){const B=R[O];if(B)for(const V of B)S.push(V.feature)}}return S}queryRenderedFeatures(i,c,g){c&&c.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",c.filter,null,c);const _={};if(c&&c.layers){if(!(Array.isArray(c.layers)||c.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of c.layers){const V=this._layers[B];if(!V)return this.fire(new a.k(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];_[V.source]=!0}}const S=[];c.availableImages=this._availableImages;const C=this._serializedAllLayers(),O=c.layers instanceof Set?c.layers:Array.isArray(c.layers)?new Set(c.layers):null,R=Object.assign(Object.assign({},c),{layers:O});for(const B in this.sourceCaches)c.layers&&!_[B]||S.push(dl(this.sourceCaches[B],this._layers,C,i,R,g,this.map.terrain?(V,q,H)=>this.map.terrain.getElevation(V,q,H):void 0));return this.placement&&S.push(function(B,V,q,H,W,Y,ue){const ce={},he=Y.queryRenderedSymbols(H),de=[];for(const _e of Object.keys(he).map(Number))de.push(ue[_e]);de.sort(Es);for(const _e of de){const be=_e.featureIndex.lookupSymbolFeatures(he[_e.bucketInstanceId],V,_e.bucketIndex,_e.sourceLayerIndex,W.filter,W.layers,W.availableImages,B);for(const Me in be){const Pe=ce[Me]=ce[Me]||[],Ce=be[Me];Ce.sort((Ne,qe)=>{const it=_e.featureSortOrder;if(it){const tt=it.indexOf(Ne.featureIndex);return it.indexOf(qe.featureIndex)-tt}return qe.featureIndex-Ne.featureIndex});for(const Ne of Ce)Pe.push(Ne)}}return function(_e,be,Me){for(const Pe in _e)for(const Ce of _e[Pe])Hs(Ce,Me[be[Pe].source]);return _e}(ce,B,q)}(this._layers,C,this.sourceCaches,i,R,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(i,c){c&&c.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",c.filter,null,c);const g=this.sourceCaches[i];return g?function(_,S){const C=_.getRenderableIds().map(B=>_.getTileByID(B)),O=[],R={};for(let B=0;B<C.length;B++){const V=C[B],q=V.tileID.canonical.key;R[q]||(R[q]=!0,V.querySourceFeatures(O,S))}return O}(g,c):[]}getLight(){return this.light.getLight()}setLight(i,c={}){this._checkLoaded();const g=this.light.getLight();let _=!1;for(const C in i)if(!a.bE(i[C],g[C])){_=!0;break}if(!_)return;const S={now:j.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,c),this.light.updateTransitions(S)}getProjection(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.projection}setProjection(i){if(this._checkLoaded(),this.projection){if(this.projection.name===i.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=i,this._setProjectionInternal(i.type)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,c={}){this._checkLoaded();const g=this.getSky();let _=!1;if(!i&&!g)return;if(i&&!g)_=!0;else if(!i&&g)_=!0;else for(const C in i)if(!a.bE(i[C],g[C])){_=!0;break}if(!_)return;const S={now:j.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,c),this.sky.updateTransitions(S)}_setProjectionInternal(i){const c=function(g){if(Array.isArray(g)){const _=new nu({type:g});return{projection:_,transform:new fc,cameraHelper:new ou(_)}}switch(g){case"mercator":return{projection:new rn,transform:new or,cameraHelper:new Fr};case"globe":{const _=new nu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:_,transform:new fc,cameraHelper:new ou(_)}}case"vertical-perspective":return{projection:new Sl,transform:new dh,cameraHelper:new Jr};default:return a.w(`Unknown projection name: ${g}. Falling back to mercator projection.`),{projection:new rn,transform:new or,cameraHelper:new Fr}}}(i);this.projection=c.projection,this.map.migrateProjection(c.transform,c.cameraHelper);for(const g in this.sourceCaches)this.sourceCaches[g].reload()}_validate(i,c,g,_,S={}){return(!S||S.validate!==!1)&&dc(this,i.call(a.y,a.e({key:c,style:this.serialize(),value:g,styleSpec:a.v},_)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ys().off(rc,this._rtlPluginLoaded);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this.sourceCaches){const g=this.sourceCaches[c];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const c in this.sourceCaches)this.sourceCaches[c].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,c,g,_,S=!1){let C=!1,O=!1;const R={};for(const B of this._order){const V=this._layers[B];if(V.type!=="symbol")continue;if(!R[V.source]){const H=this.sourceCaches[V.source];R[V.source]=H.getRenderableIds(!0).map(W=>H.getTileByID(W)).sort((W,Y)=>Y.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(Y.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,R[V.source],i.center.lng);C=C||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(j.now(),i.zoom))&&(this.pauseablePlacement=new lc(i,this.map.terrain,this._order,S,c,g,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(j.now()),O=!0),C&&this.pauseablePlacement.placement.setStale()),O||C)for(const B of this._order){const V=this._layers[B];V.type==="symbol"&&this.placement.updateLayerOpacities(V,R[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(j.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,c){return a._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(c.icons);this._updateTilesForChangedImages();const _=this.sourceCaches[c.source];return _&&_.setDependencies(c.tileID.key,c.type,c.icons),g})}getGlyphs(i,c){return a._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(c.stacks),_=this.sourceCaches[c.source];return _&&_.setDependencies(c.tileID.key,c.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,c={}){this._checkLoaded(),i&&this._validate(a.y.glyphs,"glyphs",i,null,c)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,c,g={},_){this._checkLoaded();const S=[{id:i,url:c}],C=[...Se(this.stylesheet.sprite),...S];this._validate(a.y.sprite,"sprite",C,null,g)||(this.stylesheet.sprite=C,this._loadSprite(S,!0,_))}removeSprite(i){this._checkLoaded();const c=Se(this.stylesheet.sprite);if(c.find(g=>g.id===i)){if(this._spritesImagesIds[i])for(const g of this._spritesImagesIds[i])this.imageManager.removeImage(g),this._changedImages[g]=!0;c.splice(c.findIndex(g=>g.id===i),1),this.stylesheet.sprite=c.length>0?c:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Se(this.stylesheet.sprite)}setSprite(i,c={},g){this._checkLoaded(),i&&this._validate(a.y.sprite,"sprite",i,null,c)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,g):(this._unloadSprite(),g&&g(null)))}}var Rf=a.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class xo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,c,g,_,S,C,O,R,B){this.context=i;let V=this.boundPaintVertexBuffers.length!==_.length;for(let q=0;!V&&q<_.length;q++)this.boundPaintVertexBuffers[q]!==_[q]&&(V=!0);!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||V||this.boundIndexBuffer!==S||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==O||this.boundDynamicVertexBuffer2!==R||this.boundDynamicVertexBuffer3!==B?this.freshBind(c,g,_,S,C,O,R,B):(i.bindVertexArray.set(this.vao),O&&O.bind(),S&&S.dynamicDraw&&S.bind(),R&&R.bind(),B&&B.bind())}freshBind(i,c,g,_,S,C,O,R){const B=i.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=_,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=R,c.enableAttributes(q,i);for(const H of g)H.enableAttributes(q,i);C&&C.enableAttributes(q,i),O&&O.enableAttributes(q,i),R&&R.enableAttributes(q,i),c.bind(),c.setVertexAttribPointers(q,i,S);for(const H of g)H.bind(),H.setVertexAttribPointers(q,i,S);C&&(C.bind(),C.setVertexAttribPointers(q,i,S)),_&&_.bind(),O&&(O.bind(),O.setVertexAttribPointers(q,i,S)),R&&(R.bind(),R.setVertexAttribPointers(q,i,S)),V.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Hm=(x,i,c,g,_)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:i,u_fog_color:c?c.properties.get("fog-color"):a.b7.white,u_fog_ground_blend:c?c.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?0:c?c.calculateFogBlendOpacity(g):0,u_horizon_color:c?c.properties.get("horizon-color"):a.b7.white,u_horizon_fog_blend:c?c.properties.get("horizon-fog-blend"):1,u_is_globe_mode:_?1:0}),If={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Pa(x){const i=[];for(let c=0;c<x.length;c++){if(x[c]===null)continue;const g=x[c].split(" ");i.push(g.pop())}return i}class cu{constructor(i,c,g,_,S,C,O,R){const B=i.gl;this.program=B.createProgram();const V=Pa(c.staticAttributes),q=g?g.getBinderAttributes():[],H=V.concat(q),W=hi.prelude.staticUniforms?Pa(hi.prelude.staticUniforms):[],Y=O.staticUniforms?Pa(O.staticUniforms):[],ue=c.staticUniforms?Pa(c.staticUniforms):[],ce=g?g.getBinderUniforms():[],he=W.concat(Y).concat(ue).concat(ce),de=[];for(const qe of he)de.indexOf(qe)<0&&de.push(qe);const _e=g?g.defines():[];bs(B)&&_e.unshift("#version 300 es"),S&&_e.push("#define OVERDRAW_INSPECTOR;"),C&&_e.push("#define TERRAIN3D;"),R&&_e.push(R);let be=_e.concat(hi.prelude.fragmentSource,O.fragmentSource,c.fragmentSource).join(`
`),Me=_e.concat(hi.prelude.vertexSource,O.vertexSource,c.vertexSource).join(`
`);bs(B)||(be=function(qe){return qe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(be),Me=function(qe){return qe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Me));const Pe=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Pe,be),B.compileShader(Pe),!B.getShaderParameter(Pe,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(Pe)}`);B.attachShader(this.program,Pe);const Ce=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ce,Me),B.compileShader(Ce),!B.getShaderParameter(Ce,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(Ce)}`);B.attachShader(this.program,Ce),this.attributes={};const Ne={};this.numAttributes=H.length;for(let qe=0;qe<this.numAttributes;qe++)H[qe]&&(B.bindAttribLocation(this.program,qe,H[qe]),this.attributes[H[qe]]=qe);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(Ce),B.deleteShader(Pe);for(let qe=0;qe<de.length;qe++){const it=de[qe];if(it&&!Ne[it]){const tt=B.getUniformLocation(this.program,it);tt&&(Ne[it]=tt)}}this.fixedUniforms=_(i,Ne),this.terrainUniforms=((qe,it)=>({u_depth:new a.bH(qe,it.u_depth),u_terrain:new a.bH(qe,it.u_terrain),u_terrain_dim:new a.b8(qe,it.u_terrain_dim),u_terrain_matrix:new a.bJ(qe,it.u_terrain_matrix),u_terrain_unpack:new a.bK(qe,it.u_terrain_unpack),u_terrain_exaggeration:new a.b8(qe,it.u_terrain_exaggeration)}))(i,Ne),this.projectionUniforms=((qe,it)=>({u_projection_matrix:new a.bJ(qe,it.u_projection_matrix),u_projection_tile_mercator_coords:new a.bK(qe,it.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bK(qe,it.u_projection_clipping_plane),u_projection_transition:new a.b8(qe,it.u_projection_transition),u_projection_fallback_matrix:new a.bJ(qe,it.u_projection_fallback_matrix)}))(i,Ne),this.binderUniforms=g?g.getUniforms(i,Ne):[]}draw(i,c,g,_,S,C,O,R,B,V,q,H,W,Y,ue,ce,he,de,_e){const be=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(g),i.setStencilMode(_),i.setColorMode(S),i.setCullFace(C),R){i.activeTexture.set(be.TEXTURE2),be.bindTexture(be.TEXTURE_2D,R.depthTexture),i.activeTexture.set(be.TEXTURE3),be.bindTexture(be.TEXTURE_2D,R.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(R[Pe])}if(B)for(const Pe in B)this.projectionUniforms[If[Pe]].set(B[Pe]);if(O)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(O[Pe]);ce&&ce.setUniforms(i,this.binderUniforms,Y,{zoom:ue});let Me=0;switch(c){case be.LINES:Me=2;break;case be.TRIANGLES:Me=3;break;case be.LINE_STRIP:Me=1}for(const Pe of W.get()){const Ce=Pe.vaos||(Pe.vaos={});(Ce[V]||(Ce[V]=new xo)).bind(i,this,q,ce?ce.getPaintVertexBuffers():[],H,Pe.vertexOffset,he,de,_e),be.drawElements(c,Pe.primitiveLength*Me,be.UNSIGNED_SHORT,Pe.primitiveOffset*Me*2)}}}function tp(x,i,c){const g=1/a.az(c,1,i.transform.tileZoom),_=Math.pow(2,c.tileID.overscaledZ),S=c.tileSize*Math.pow(2,i.transform.tileZoom)/_,C=S*(c.tileID.canonical.x+c.tileID.wrap*_),O=S*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[g,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[C>>16,O>>16],u_pixel_coord_lower:[65535&C,65535&O]}}const uu=(x,i,c,g)=>{const _=x.style.light,S=_.properties.get("position"),C=[S.x,S.y,S.z],O=a.bN();_.properties.get("anchor")==="viewport"&&a.bO(O,x.transform.bearingInRadians),a.bP(C,C,O);const R=x.transform.transformLightDirection(C),B=_.properties.get("color");return{u_lightpos:C,u_lightpos_globe:R,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+i,u_opacity:c,u_fill_translate:g}},zf=(x,i,c,g,_,S,C)=>a.e(uu(x,i,c,g),tp(S,x,C),{u_height_factor:-Math.pow(2,_.overscaledZ)/C.tileSize/8}),eo=(x,i,c,g)=>a.e(tp(i,x,c),{u_fill_translate:g}),Zm=(x,i)=>({u_world:x,u_fill_translate:i}),Lf=(x,i,c,g,_)=>a.e(eo(x,i,c,_),{u_world:g}),ip=(x,i,c,g,_)=>{const S=x.transform;let C,O,R=0;if(c.paint.get("circle-pitch-alignment")==="map"){const B=a.az(i,1,S.zoom);C=!0,O=[B,B],R=B/(a.Z*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*_}else C=!1,O=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:O,u_globe_extrude_scale:R,u_translate:g}},Bf=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),ph=x=>({u_viewport_size:[x.width,x.height]}),mh=(x,i=1)=>({u_color:x,u_overlay:0,u_overlay_scale:i}),Oa=(x,i,c,g)=>{const _=a.az(x,1,i)/(a.Z*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*g;return{u_extrude_scale:a.az(x,1,i),u_intensity:c,u_globe_extrude_scale:_}},Nf=(x,i,c,g)=>{const _=a.K();a.bQ(_,0,x.width,x.height,0,0,1);const S=x.context.gl;return{u_matrix:_,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:c,u_color_ramp:g,u_opacity:i.paint.get("heatmap-opacity")}},np=(x,i,c)=>{const g=c.paint.get("hillshade-shadow-color"),_=c.paint.get("hillshade-highlight-color"),S=c.paint.get("hillshade-accent-color");let C=c.paint.get("hillshade-illumination-direction")*(Math.PI/180);return c.paint.get("hillshade-illumination-anchor")==="viewport"&&(C+=x.transform.bearingInRadians),{u_image:0,u_latrange:Ff(0,i.tileID),u_light:[c.paint.get("hillshade-exaggeration"),C],u_shadow:g,u_highlight:_,u_accent:S}},Ml=(x,i)=>{const c=i.stride,g=a.K();return a.bQ(g,0,a.Z,-8192,0,0,1),a.L(g,g,[0,-8192,0]),{u_matrix:g,u_image:1,u_dimension:[c,c],u_zoom:x.overscaledZ,u_unpack:i.getUnpackVector()}};function Ff(x,i){const c=Math.pow(2,i.canonical.z),g=i.canonical.y;return[new a.$(0,g/c).toLngLat().lat,new a.$(0,(g+1)/c).toLngLat().lat]}const hu=(x,i,c,g)=>{const _=x.transform;return{u_translation:jf(x,i,c),u_ratio:g/a.az(i,1,_.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Xo=(x,i,c,g,_)=>a.e(hu(x,i,c,g),{u_image:0,u_image_height:_}),fu=(x,i,c,g,_)=>{const S=x.transform,C=du(i,S);return{u_translation:jf(x,i,c),u_texsize:i.imageAtlasTexture.size,u_ratio:g/a.az(i,1,S.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[C,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},gh=(x,i,c,g,_,S)=>{const C=x.lineAtlas,O=du(i,x.transform),R=c.layout.get("line-cap")==="round",B=C.getDash(_.from,R),V=C.getDash(_.to,R),q=B.width*S.fromScale,H=V.width*S.toScale;return a.e(hu(x,i,c,g),{u_patternscale_a:[O/q,-B.height/2],u_patternscale_b:[O/H,-V.height/2],u_sdfgamma:C.width/(256*Math.min(q,H)*x.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:V.y,u_mix:S.t})};function du(x,i){return 1/a.az(x,1,i.tileZoom)}function jf(x,i,c){return a.aA(x.transform,i,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Vf=(x,i,c,g,_)=>{return{u_tl_parent:x,u_scale_parent:i,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(S=g.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:yh(g.paint.get("raster-hue-rotate")),u_coords_top:[_[0].x,_[0].y,_[1].x,_[1].y],u_coords_bottom:[_[3].x,_[3].y,_[2].x,_[2].y]};var S,C};function yh(x){x*=Math.PI/180;const i=Math.sin(x),c=Math.cos(x);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const pu=(x,i,c,g,_,S,C,O,R,B,V,q,H)=>{const W=C.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:W.cameraToCenterDistance,u_pitch:W.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:W.width/W.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:O,u_coord_matrix:R,u_is_text:+V,u_pitch_with_map:+g,u_is_along_line:_,u_is_variable_anchor:S,u_texsize:q,u_texture:0,u_translation:B,u_pitched_scale:H}},mu=(x,i,c,g,_,S,C,O,R,B,V,q,H,W)=>{const Y=C.transform;return a.e(pu(x,i,c,g,_,S,C,O,R,B,V,q,W),{u_gamma_scale:g?Math.cos(Y.pitch*Math.PI/180)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Uf=(x,i,c,g,_,S,C,O,R,B,V,q,H)=>a.e(mu(x,i,c,g,_,S,C,O,R,B,!0,V,0,H),{u_texsize_icon:q,u_texture_icon:1}),gu=(x,i)=>({u_opacity:x,u_color:i}),Qo=(x,i,c,g,_)=>a.e(function(S,C,O,R){const B=O.imageManager.getPattern(S.from.toString()),V=O.imageManager.getPattern(S.to.toString()),{width:q,height:H}=O.imageManager.getPixelSize(),W=Math.pow(2,R.tileID.overscaledZ),Y=R.tileSize*Math.pow(2,O.transform.tileZoom)/W,ue=Y*(R.tileID.canonical.x+R.tileID.wrap*W),ce=Y*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[q,H],u_mix:C.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/a.az(R,1,O.transform.tileZoom),u_pixel_coord_upper:[ue>>16,ce>>16],u_pixel_coord_lower:[65535&ue,65535&ce]}}(c,_,i,g),{u_opacity:x}),_h=(x,i)=>{},qf={fillExtrusion:(x,i)=>({u_lightpos:new a.bL(x,i.u_lightpos),u_lightpos_globe:new a.bL(x,i.u_lightpos_globe),u_lightintensity:new a.b8(x,i.u_lightintensity),u_lightcolor:new a.bL(x,i.u_lightcolor),u_vertical_gradient:new a.b8(x,i.u_vertical_gradient),u_opacity:new a.b8(x,i.u_opacity),u_fill_translate:new a.bM(x,i.u_fill_translate)}),fillExtrusionPattern:(x,i)=>({u_lightpos:new a.bL(x,i.u_lightpos),u_lightpos_globe:new a.bL(x,i.u_lightpos_globe),u_lightintensity:new a.b8(x,i.u_lightintensity),u_lightcolor:new a.bL(x,i.u_lightcolor),u_vertical_gradient:new a.b8(x,i.u_vertical_gradient),u_height_factor:new a.b8(x,i.u_height_factor),u_opacity:new a.b8(x,i.u_opacity),u_fill_translate:new a.bM(x,i.u_fill_translate),u_image:new a.bH(x,i.u_image),u_texsize:new a.bM(x,i.u_texsize),u_pixel_coord_upper:new a.bM(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(x,i.u_pixel_coord_lower),u_scale:new a.bL(x,i.u_scale),u_fade:new a.b8(x,i.u_fade)}),fill:(x,i)=>({u_fill_translate:new a.bM(x,i.u_fill_translate)}),fillPattern:(x,i)=>({u_image:new a.bH(x,i.u_image),u_texsize:new a.bM(x,i.u_texsize),u_pixel_coord_upper:new a.bM(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(x,i.u_pixel_coord_lower),u_scale:new a.bL(x,i.u_scale),u_fade:new a.b8(x,i.u_fade),u_fill_translate:new a.bM(x,i.u_fill_translate)}),fillOutline:(x,i)=>({u_world:new a.bM(x,i.u_world),u_fill_translate:new a.bM(x,i.u_fill_translate)}),fillOutlinePattern:(x,i)=>({u_world:new a.bM(x,i.u_world),u_image:new a.bH(x,i.u_image),u_texsize:new a.bM(x,i.u_texsize),u_pixel_coord_upper:new a.bM(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(x,i.u_pixel_coord_lower),u_scale:new a.bL(x,i.u_scale),u_fade:new a.b8(x,i.u_fade),u_fill_translate:new a.bM(x,i.u_fill_translate)}),circle:(x,i)=>({u_camera_to_center_distance:new a.b8(x,i.u_camera_to_center_distance),u_scale_with_map:new a.bH(x,i.u_scale_with_map),u_pitch_with_map:new a.bH(x,i.u_pitch_with_map),u_extrude_scale:new a.bM(x,i.u_extrude_scale),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_globe_extrude_scale:new a.b8(x,i.u_globe_extrude_scale),u_translate:new a.bM(x,i.u_translate)}),collisionBox:(x,i)=>({u_pixel_extrude_scale:new a.bM(x,i.u_pixel_extrude_scale)}),collisionCircle:(x,i)=>({u_viewport_size:new a.bM(x,i.u_viewport_size)}),debug:(x,i)=>({u_color:new a.bI(x,i.u_color),u_overlay:new a.bH(x,i.u_overlay),u_overlay_scale:new a.b8(x,i.u_overlay_scale)}),depth:_h,clippingMask:_h,heatmap:(x,i)=>({u_extrude_scale:new a.b8(x,i.u_extrude_scale),u_intensity:new a.b8(x,i.u_intensity),u_globe_extrude_scale:new a.b8(x,i.u_globe_extrude_scale)}),heatmapTexture:(x,i)=>({u_matrix:new a.bJ(x,i.u_matrix),u_world:new a.bM(x,i.u_world),u_image:new a.bH(x,i.u_image),u_color_ramp:new a.bH(x,i.u_color_ramp),u_opacity:new a.b8(x,i.u_opacity)}),hillshade:(x,i)=>({u_image:new a.bH(x,i.u_image),u_latrange:new a.bM(x,i.u_latrange),u_light:new a.bM(x,i.u_light),u_shadow:new a.bI(x,i.u_shadow),u_highlight:new a.bI(x,i.u_highlight),u_accent:new a.bI(x,i.u_accent)}),hillshadePrepare:(x,i)=>({u_matrix:new a.bJ(x,i.u_matrix),u_image:new a.bH(x,i.u_image),u_dimension:new a.bM(x,i.u_dimension),u_zoom:new a.b8(x,i.u_zoom),u_unpack:new a.bK(x,i.u_unpack)}),line:(x,i)=>({u_translation:new a.bM(x,i.u_translation),u_ratio:new a.b8(x,i.u_ratio),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_units_to_pixels:new a.bM(x,i.u_units_to_pixels)}),lineGradient:(x,i)=>({u_translation:new a.bM(x,i.u_translation),u_ratio:new a.b8(x,i.u_ratio),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_units_to_pixels:new a.bM(x,i.u_units_to_pixels),u_image:new a.bH(x,i.u_image),u_image_height:new a.b8(x,i.u_image_height)}),linePattern:(x,i)=>({u_translation:new a.bM(x,i.u_translation),u_texsize:new a.bM(x,i.u_texsize),u_ratio:new a.b8(x,i.u_ratio),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_image:new a.bH(x,i.u_image),u_units_to_pixels:new a.bM(x,i.u_units_to_pixels),u_scale:new a.bL(x,i.u_scale),u_fade:new a.b8(x,i.u_fade)}),lineSDF:(x,i)=>({u_translation:new a.bM(x,i.u_translation),u_ratio:new a.b8(x,i.u_ratio),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_units_to_pixels:new a.bM(x,i.u_units_to_pixels),u_patternscale_a:new a.bM(x,i.u_patternscale_a),u_patternscale_b:new a.bM(x,i.u_patternscale_b),u_sdfgamma:new a.b8(x,i.u_sdfgamma),u_image:new a.bH(x,i.u_image),u_tex_y_a:new a.b8(x,i.u_tex_y_a),u_tex_y_b:new a.b8(x,i.u_tex_y_b),u_mix:new a.b8(x,i.u_mix)}),raster:(x,i)=>({u_tl_parent:new a.bM(x,i.u_tl_parent),u_scale_parent:new a.b8(x,i.u_scale_parent),u_buffer_scale:new a.b8(x,i.u_buffer_scale),u_fade_t:new a.b8(x,i.u_fade_t),u_opacity:new a.b8(x,i.u_opacity),u_image0:new a.bH(x,i.u_image0),u_image1:new a.bH(x,i.u_image1),u_brightness_low:new a.b8(x,i.u_brightness_low),u_brightness_high:new a.b8(x,i.u_brightness_high),u_saturation_factor:new a.b8(x,i.u_saturation_factor),u_contrast_factor:new a.b8(x,i.u_contrast_factor),u_spin_weights:new a.bL(x,i.u_spin_weights),u_coords_top:new a.bK(x,i.u_coords_top),u_coords_bottom:new a.bK(x,i.u_coords_bottom)}),symbolIcon:(x,i)=>({u_is_size_zoom_constant:new a.bH(x,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(x,i.u_is_size_feature_constant),u_size_t:new a.b8(x,i.u_size_t),u_size:new a.b8(x,i.u_size),u_camera_to_center_distance:new a.b8(x,i.u_camera_to_center_distance),u_pitch:new a.b8(x,i.u_pitch),u_rotate_symbol:new a.bH(x,i.u_rotate_symbol),u_aspect_ratio:new a.b8(x,i.u_aspect_ratio),u_fade_change:new a.b8(x,i.u_fade_change),u_label_plane_matrix:new a.bJ(x,i.u_label_plane_matrix),u_coord_matrix:new a.bJ(x,i.u_coord_matrix),u_is_text:new a.bH(x,i.u_is_text),u_pitch_with_map:new a.bH(x,i.u_pitch_with_map),u_is_along_line:new a.bH(x,i.u_is_along_line),u_is_variable_anchor:new a.bH(x,i.u_is_variable_anchor),u_texsize:new a.bM(x,i.u_texsize),u_texture:new a.bH(x,i.u_texture),u_translation:new a.bM(x,i.u_translation),u_pitched_scale:new a.b8(x,i.u_pitched_scale)}),symbolSDF:(x,i)=>({u_is_size_zoom_constant:new a.bH(x,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(x,i.u_is_size_feature_constant),u_size_t:new a.b8(x,i.u_size_t),u_size:new a.b8(x,i.u_size),u_camera_to_center_distance:new a.b8(x,i.u_camera_to_center_distance),u_pitch:new a.b8(x,i.u_pitch),u_rotate_symbol:new a.bH(x,i.u_rotate_symbol),u_aspect_ratio:new a.b8(x,i.u_aspect_ratio),u_fade_change:new a.b8(x,i.u_fade_change),u_label_plane_matrix:new a.bJ(x,i.u_label_plane_matrix),u_coord_matrix:new a.bJ(x,i.u_coord_matrix),u_is_text:new a.bH(x,i.u_is_text),u_pitch_with_map:new a.bH(x,i.u_pitch_with_map),u_is_along_line:new a.bH(x,i.u_is_along_line),u_is_variable_anchor:new a.bH(x,i.u_is_variable_anchor),u_texsize:new a.bM(x,i.u_texsize),u_texture:new a.bH(x,i.u_texture),u_gamma_scale:new a.b8(x,i.u_gamma_scale),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_is_halo:new a.bH(x,i.u_is_halo),u_translation:new a.bM(x,i.u_translation),u_pitched_scale:new a.b8(x,i.u_pitched_scale)}),symbolTextAndIcon:(x,i)=>({u_is_size_zoom_constant:new a.bH(x,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(x,i.u_is_size_feature_constant),u_size_t:new a.b8(x,i.u_size_t),u_size:new a.b8(x,i.u_size),u_camera_to_center_distance:new a.b8(x,i.u_camera_to_center_distance),u_pitch:new a.b8(x,i.u_pitch),u_rotate_symbol:new a.bH(x,i.u_rotate_symbol),u_aspect_ratio:new a.b8(x,i.u_aspect_ratio),u_fade_change:new a.b8(x,i.u_fade_change),u_label_plane_matrix:new a.bJ(x,i.u_label_plane_matrix),u_coord_matrix:new a.bJ(x,i.u_coord_matrix),u_is_text:new a.bH(x,i.u_is_text),u_pitch_with_map:new a.bH(x,i.u_pitch_with_map),u_is_along_line:new a.bH(x,i.u_is_along_line),u_is_variable_anchor:new a.bH(x,i.u_is_variable_anchor),u_texsize:new a.bM(x,i.u_texsize),u_texsize_icon:new a.bM(x,i.u_texsize_icon),u_texture:new a.bH(x,i.u_texture),u_texture_icon:new a.bH(x,i.u_texture_icon),u_gamma_scale:new a.b8(x,i.u_gamma_scale),u_device_pixel_ratio:new a.b8(x,i.u_device_pixel_ratio),u_is_halo:new a.bH(x,i.u_is_halo),u_translation:new a.bM(x,i.u_translation),u_pitched_scale:new a.b8(x,i.u_pitched_scale)}),background:(x,i)=>({u_opacity:new a.b8(x,i.u_opacity),u_color:new a.bI(x,i.u_color)}),backgroundPattern:(x,i)=>({u_opacity:new a.b8(x,i.u_opacity),u_image:new a.bH(x,i.u_image),u_pattern_tl_a:new a.bM(x,i.u_pattern_tl_a),u_pattern_br_a:new a.bM(x,i.u_pattern_br_a),u_pattern_tl_b:new a.bM(x,i.u_pattern_tl_b),u_pattern_br_b:new a.bM(x,i.u_pattern_br_b),u_texsize:new a.bM(x,i.u_texsize),u_mix:new a.b8(x,i.u_mix),u_pattern_size_a:new a.bM(x,i.u_pattern_size_a),u_pattern_size_b:new a.bM(x,i.u_pattern_size_b),u_scale_a:new a.b8(x,i.u_scale_a),u_scale_b:new a.b8(x,i.u_scale_b),u_pixel_coord_upper:new a.bM(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(x,i.u_pixel_coord_lower),u_tile_units_to_pixels:new a.b8(x,i.u_tile_units_to_pixels)}),terrain:(x,i)=>({u_texture:new a.bH(x,i.u_texture),u_ele_delta:new a.b8(x,i.u_ele_delta),u_fog_matrix:new a.bJ(x,i.u_fog_matrix),u_fog_color:new a.bI(x,i.u_fog_color),u_fog_ground_blend:new a.b8(x,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.b8(x,i.u_fog_ground_blend_opacity),u_horizon_color:new a.bI(x,i.u_horizon_color),u_horizon_fog_blend:new a.b8(x,i.u_horizon_fog_blend),u_is_globe_mode:new a.b8(x,i.u_is_globe_mode)}),terrainDepth:(x,i)=>({u_ele_delta:new a.b8(x,i.u_ele_delta)}),terrainCoords:(x,i)=>({u_texture:new a.bH(x,i.u_texture),u_terrain_coords_id:new a.b8(x,i.u_terrain_coords_id),u_ele_delta:new a.b8(x,i.u_ele_delta)}),projectionErrorMeasurement:(x,i)=>({u_input:new a.b8(x,i.u_input),u_output_expected:new a.b8(x,i.u_output_expected)}),atmosphere:(x,i)=>({u_sun_pos:new a.bL(x,i.u_sun_pos),u_atmosphere_blend:new a.b8(x,i.u_atmosphere_blend),u_globe_position:new a.bL(x,i.u_globe_position),u_globe_radius:new a.b8(x,i.u_globe_radius),u_inv_proj_matrix:new a.bJ(x,i.u_inv_proj_matrix)}),sky:(x,i)=>({u_sky_color:new a.bI(x,i.u_sky_color),u_horizon_color:new a.bI(x,i.u_horizon_color),u_horizon:new a.bM(x,i.u_horizon),u_horizon_normal:new a.bM(x,i.u_horizon_normal),u_sky_horizon_blend:new a.b8(x,i.u_sky_horizon_blend),u_sky_blend:new a.b8(x,i.u_sky_blend)})};class Hf{constructor(i,c,g){this.context=i;const _=i.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gs{constructor(i,c,g,_){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.context=i;const S=i.gl;this.buffer=S.createBuffer(),i.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let g=0;g<this.attributes.length;g++){const _=c.attributes[this.attributes[g].name];_!==void 0&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,c,g){for(let _=0;_<this.attributes.length;_++){const S=this.attributes[_],C=c.attributes[S.name];C!==void 0&&i.vertexAttribPointer(C,S.components,i[sp[S.type]],!1,this.itemSize,S.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bh extends fi{getDefault(){return a.b7.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class rp extends fi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class op extends fi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ap extends fi{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Zf extends fi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class lp extends fi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class pc extends fi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class vh extends fi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Da extends fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class mc extends fi{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class yu extends fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class Wo extends fi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class jr extends fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class Ra extends fi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class vr extends fi{getDefault(){return a.b7.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Ia extends fi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Gf extends fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class xh extends fi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class za extends fi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class wh extends fi{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Sh extends fi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class _u extends fi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class bu extends fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class $f extends fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class La extends fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class zs extends fi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Xf extends fi{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ar extends fi{getDefault(){return null}set(i){var c;if(i===this.current&&!this.dirty)return;const g=this.gl;bs(g)?g.bindVertexArray(i):(c=g.getExtension("OES_vertex_array_object"))===null||c===void 0||c.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class ai extends fi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Ko extends fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Qf extends fi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Cl extends fi{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Ba extends Cl{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Wf extends Cl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class gc extends Cl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}const Th="Framebuffer is not complete";class Mh{constructor(i,c,g,_,S){this.context=i,this.width=c,this.height=g;const C=i.gl,O=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Ba(i,O),_)this.depthAttachment=S?new gc(i,O):new Wf(i,O);else if(S)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Th)}destroy(){const i=this.context.gl,c=this.colorAttachment.get();if(c&&i.deleteTexture(c),this.depthAttachment){const g=this.depthAttachment.get();g&&i.deleteRenderbuffer(g)}i.deleteFramebuffer(this.framebuffer)}}class Na{constructor(i){var c,g;if(this.gl=i,this.clearColor=new bh(this),this.clearDepth=new rp(this),this.clearStencil=new op(this),this.colorMask=new ap(this),this.depthMask=new Zf(this),this.stencilMask=new lp(this),this.stencilFunc=new pc(this),this.stencilOp=new vh(this),this.stencilTest=new Da(this),this.depthRange=new mc(this),this.depthTest=new yu(this),this.depthFunc=new Wo(this),this.blend=new jr(this),this.blendFunc=new Ra(this),this.blendColor=new vr(this),this.blendEquation=new Ia(this),this.cullFace=new Gf(this),this.cullFaceSide=new xh(this),this.frontFace=new za(this),this.program=new wh(this),this.activeTexture=new Sh(this),this.viewport=new _u(this),this.bindFramebuffer=new bu(this),this.bindRenderbuffer=new $f(this),this.bindTexture=new La(this),this.bindVertexBuffer=new zs(this),this.bindElementBuffer=new Xf(this),this.bindVertexArray=new ar(this),this.pixelStoreUnpack=new ai(this),this.pixelStoreUnpackPremultiplyAlpha=new Ko(this),this.pixelStoreUnpackFlipY=new Qf(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),bs(i)){this.HALF_FLOAT=i.HALF_FLOAT;const _=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(c=i.RGBA16F)!==null&&c!==void 0?c:_==null?void 0:_.RGBA16F_EXT,this.RGB16F=(g=i.RGB16F)!==null&&g!==void 0?g:_==null?void 0:_.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const _=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=_==null?void 0:_.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c){return new Hf(this,i,c)}createVertexBuffer(i,c,g){return new Gs(this,i,c,g)}createRenderbuffer(i,c,g){const _=this.gl,S=_.createRenderbuffer();return this.bindRenderbuffer.set(S),_.renderbufferStorage(_.RENDERBUFFER,i,c,g),this.bindRenderbuffer.set(null),S}createFramebuffer(i,c,g,_){return new Mh(this,i,c,g,_)}clear({color:i,depth:c,stencil:g}){const _=this.gl;let S=0;i&&(S|=_.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(S|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),g!==void 0&&(S|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),_.clear(S)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.bE(i.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return bs(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var c;return bs(this.gl)?this.gl.deleteVertexArray(i):(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}let Al;function vs(x,i,c,g,_){const S=x.context,C=x.transform,O=S.gl,R=x.useProgram("collisionBox"),B=[];let V=0,q=0;for(let he=0;he<g.length;he++){const de=g[he],_e=i.getTile(de).getBucket(c);if(!_e)continue;const be=_?_e.textCollisionBox:_e.iconCollisionBox,Me=_e.collisionCircleArray;Me.length>0&&(B.push({circleArray:Me,circleOffset:q,coord:de}),V+=Me.length/4,q=V),be&&R.draw(S,O.LINES,ri.disabled,vi.disabled,x.colorModeForRenderPass(),Ti.disabled,Bf(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(de),C.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),c.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,x.transform.zoom,null,null,be.collisionVertexBuffer)}if(!_||!B.length)return;const H=x.useProgram("collisionCircle"),W=new a.bR;W.resize(4*V),W._trim();let Y=0;for(const he of B)for(let de=0;de<he.circleArray.length/4;de++){const _e=4*de,be=he.circleArray[_e+0],Me=he.circleArray[_e+1],Pe=he.circleArray[_e+2],Ce=he.circleArray[_e+3];W.emplace(Y++,be,Me,Pe,Ce,0),W.emplace(Y++,be,Me,Pe,Ce,1),W.emplace(Y++,be,Me,Pe,Ce,2),W.emplace(Y++,be,Me,Pe,Ce,3)}(!Al||Al.length<2*V)&&(Al=function(he){const de=2*he,_e=new a.bT;_e.resize(de),_e._trim();for(let be=0;be<de;be++){const Me=6*be;_e.uint16[Me+0]=4*be+0,_e.uint16[Me+1]=4*be+1,_e.uint16[Me+2]=4*be+2,_e.uint16[Me+3]=4*be+2,_e.uint16[Me+4]=4*be+3,_e.uint16[Me+5]=4*be+0}return _e}(V));const ue=S.createIndexBuffer(Al,!0),ce=S.createVertexBuffer(W,a.bS.members,!0);for(const he of B){const de=ph(x.transform);H.draw(S,O.TRIANGLES,ri.disabled,vi.disabled,x.colorModeForRenderPass(),Ti.disabled,de,x.style.map.terrain&&x.style.map.terrain.getTerrainData(he.coord),null,c.id,ce,ue,a.aJ.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,x.transform.zoom,null,null,null)}ce.destroy(),ue.destroy()}const vu=a.ad(new Float32Array(16));function to(x,i,c,g,_,S){const{horizontalAlign:C,verticalAlign:O}=a.aE(x);return new a.P((-(C-.5)*i/_+g[0])*S,(-(O-.5)*c/_+g[1])*S)}function Kf(x,i,c,g,_,S){const C=i.tileAnchorPoint.add(new a.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let O=g.mult(S);c||(O=O.rotate(-_));const R=C.add(O);return Wt(R.x,R.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(c){const O=Vi(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(x),R=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0);return x.add(g.rotate(R))}return x.add(g)}function kl(x,i,c,g,_,S,C,O,R,B,V,q){const H=x.text.placedSymbolArray,W=x.text.dynamicLayoutVertexArray,Y=x.icon.dynamicLayoutVertexArray,ue={};W.clear();for(let ce=0;ce<H.length;ce++){const he=H.get(ce),de=he.hidden||!he.crossTileID||x.allowVerticalPlacement&&!he.placedOrientation?null:g[he.crossTileID];if(de){const _e=new a.P(he.anchorX,he.anchorY),be={getElevation:q,width:_.width,height:_.height,pitchedLabelPlaneMatrix:S,pitchWithMap:c,transform:_,tileAnchorPoint:_e,translation:B,unwrappedTileID:V},Me=c?En(_e.x,_e.y,be):Vi(_e.x,_e.y,be),Pe=_i(_.cameraToCenterDistance,Me.signedDistanceFromCamera);let Ce=a.am(x.textSizeData,O,he)*Pe/a.ay;c&&(Ce*=x.tilePixelRatio/C);const{width:Ne,height:qe,anchor:it,textOffset:tt,textBoxScale:et}=de,wt=to(it,Ne,qe,tt,et,Ce),vt=_.getPitchedTextCorrection(_e.x+B[0],_e.y+B[1],V),rt=Kf(Me.point,be,i,wt,-_.bearingInRadians,vt),zt=x.allowVerticalPlacement&&he.placedOrientation===a.al.vertical?Math.PI/2:0;for(let ci=0;ci<he.numGlyphs;ci++)a.as(W,rt,zt);R&&he.associatedIconIndex>=0&&(ue[he.associatedIconIndex]={shiftedAnchor:rt,angle:zt})}else os(he.numGlyphs,W)}if(R){Y.clear();const ce=x.icon.placedSymbolArray;for(let he=0;he<ce.length;he++){const de=ce.get(he);if(de.hidden)os(de.numGlyphs,Y);else{const _e=ue[he];if(_e)for(let be=0;be<de.numGlyphs;be++)a.as(Y,_e.shiftedAnchor,_e.angle);else os(de.numGlyphs,Y)}}x.icon.dynamicLayoutVertexBuffer.updateData(Y)}x.text.dynamicLayoutVertexBuffer.updateData(W)}function wo(x,i,c){return c.iconsInText&&i?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function yc(x,i,c,g,_,S,C,O,R,B,V,q,H){const W=x.context,Y=W.gl,ue=x.transform,ce=O==="map",he=R==="map",de=O!=="viewport"&&c.layout.get("symbol-placement")!=="point",_e=ce&&!he&&!de,be=!c.layout.get("symbol-sort-key").isConstant();let Me=!1;const Pe=x.getDepthModeForSublayer(0,ri.ReadOnly),Ce=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ne=[],qe=ue.getCircleRadiusCorrection();for(const it of g){const tt=i.getTile(it),et=tt.getBucket(c);if(!et)continue;const wt=_?et.text:et.icon;if(!wt||!wt.segments.get().length||!wt.hasVisibleVertices)continue;const vt=wt.programConfigurations.get(c.id),rt=_||et.sdfIcons,zt=_?et.textSizeData:et.iconSizeData,ci=he||ue.pitch!==0,ii=x.useProgram(wo(rt,_,et),vt),cn=a.ak(zt,ue.zoom),Ii=x.style.map.terrain&&x.style.map.terrain.getTerrainData(it);let un,Zi,Li,Oi,qn=[0,0],Hn=null;if(_)Zi=tt.glyphAtlasTexture,Li=Y.LINEAR,un=tt.glyphAtlasTexture.size,et.iconsInText&&(qn=tt.imageAtlasTexture.size,Hn=tt.imageAtlasTexture,Oi=ci||x.options.rotating||x.options.zooming||zt.kind==="composite"||zt.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const Yi=c.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;Zi=tt.imageAtlasTexture,Li=rt||x.options.rotating||x.options.zooming||Yi||ci?Y.LINEAR:Y.NEAREST,un=tt.imageAtlasTexture.size}const cs=a.az(tt,1,x.transform.zoom),Ns=Vt(ce,x.transform,cs),Ur=a.K();a.an(Ur,Ns);const ra=Xt(he,ce,x.transform,cs),Oo=a.aA(ue,tt,S,C),ao=ue.getProjectionData({overscaledTileID:it,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),lo=Ce&&et.hasTextData(),Xa=c.layout.get("icon-text-fit")!=="none"&&lo&&et.hasIconData();if(de){const Yi=x.style.map.terrain?(Tn,Gi)=>x.style.map.terrain.getElevation(it,Tn,Gi):null,Ji=c.layout.get("text-rotation-alignment")==="map";Si(et,x,_,Ns,Ur,he,B,Ji,it.toUnwrapped(),ue.width,ue.height,Oo,Yi)}const Bl=_&&Ce||Xa,Tr=de||Bl?vu:he?Ns:x.transform.clipSpaceToPixelsMatrix,oa=rt&&c.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mr;Mr=rt?et.iconsInText?Uf(zt.kind,cn,_e,he,de,Bl,x,Tr,ra,Oo,un,qn,qe):mu(zt.kind,cn,_e,he,de,Bl,x,Tr,ra,Oo,_,un,0,qe):pu(zt.kind,cn,_e,he,de,Bl,x,Tr,ra,Oo,_,un,qe);const co={program:ii,buffers:wt,uniformValues:Mr,projectionData:ao,atlasTexture:Zi,atlasTextureIcon:Hn,atlasInterpolation:Li,atlasInterpolationIcon:Oi,isSDF:rt,hasHalo:oa};if(be&&et.canOverlap){Me=!0;const Yi=wt.segments.get();for(const Ji of Yi)Ne.push({segments:new a.aJ([Ji]),sortKey:Ji.sortKey,state:co,terrainData:Ii})}else Ne.push({segments:wt.segments,sortKey:0,state:co,terrainData:Ii})}Me&&Ne.sort((it,tt)=>it.sortKey-tt.sortKey);for(const it of Ne){const tt=it.state;if(W.activeTexture.set(Y.TEXTURE0),tt.atlasTexture.bind(tt.atlasInterpolation,Y.CLAMP_TO_EDGE),tt.atlasTextureIcon&&(W.activeTexture.set(Y.TEXTURE1),tt.atlasTextureIcon&&tt.atlasTextureIcon.bind(tt.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),tt.isSDF){const et=tt.uniformValues;tt.hasHalo&&(et.u_is_halo=1,Ch(tt.buffers,it.segments,c,x,tt.program,Pe,V,q,et,tt.projectionData,it.terrainData)),et.u_is_halo=0}Ch(tt.buffers,it.segments,c,x,tt.program,Pe,V,q,tt.uniformValues,tt.projectionData,it.terrainData)}}function Ch(x,i,c,g,_,S,C,O,R,B,V){const q=g.context;_.draw(q,q.gl.TRIANGLES,S,C,O,Ti.backCCW,R,V,B,c.id,x.layoutVertexBuffer,x.indexBuffer,i,c.paint,g.transform.zoom,x.programConfigurations.get(c.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function Fa(x,i,c,g,_){const S=x.context,C=S.gl,O=vi.disabled,R=new Ai([C.ONE,C.ONE],a.b7.transparent,[!0,!0,!0,!0]),B=i.getBucket(c);if(!B)return;const V=g.key;let q=c.heatmapFbos.get(V);q||(q=bc(S,i.tileSize,i.tileSize),c.heatmapFbos.set(V,q)),S.bindFramebuffer.set(q.framebuffer),S.viewport.set([0,0,i.tileSize,i.tileSize]),S.clear({color:a.b7.transparent});const H=B.programConfigurations.get(c.id),W=x.useProgram("heatmap",H,!_),Y=x.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=x.style.map.terrain.getTerrainData(g);W.draw(S,C.TRIANGLES,ri.disabled,O,R,Ti.disabled,Oa(i,x.transform.zoom,c.paint.get("heatmap-intensity"),1),ue,Y,c.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,c.paint,x.transform.zoom,H)}function _c(x,i,c,g,_){const S=x.context,C=S.gl,O=x.transform;S.setColorMode(x.colorModeForRenderPass());const R=ja(S,i),B=c.key,V=i.heatmapFbos.get(B);if(!V)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,V.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1),R.bind(C.LINEAR,C.CLAMP_TO_EDGE);const q=O.getProjectionData({overscaledTileID:c,applyTerrainMatrix:_,applyGlobeMatrix:!g});x.useProgram("heatmapTexture").draw(S,C.TRIANGLES,ri.disabled,vi.disabled,x.colorModeForRenderPass(),Ti.disabled,Nf(x,i,0,1),null,q,i.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,i.paint,O.zoom),V.destroy(),i.heatmapFbos.delete(B)}function bc(x,i,c){var g,_;const S=x.gl,C=S.createTexture();S.bindTexture(S.TEXTURE_2D,C),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const O=(g=x.HALF_FLOAT)!==null&&g!==void 0?g:S.UNSIGNED_BYTE,R=(_=x.RGBA16F)!==null&&_!==void 0?_:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,R,i,c,0,S.RGBA,O,null);const B=x.createFramebuffer(i,c,!1,!1);return B.colorAttachment.set(C),B}function ja(x,i){return i.colorRampTexture||(i.colorRampTexture=new He(x,i.colorRamp,x.gl.RGBA)),i.colorRampTexture}function $s(x,i,c,g,_){if(!c||!g||!g.imageAtlas)return;const S=g.imageAtlas.patternPositions;let C=S[c.to.toString()],O=S[c.from.toString()];if(!C&&O&&(C=O),!O&&C&&(O=C),!C||!O){const R=_.getPaintProperty(i);C=S[R],O=S[R]}C&&O&&x.setConstantPatternPositions(C,O)}function lr(x,i,c,g,_,S,C,O){const R=x.context.gl,B="fill-pattern",V=c.paint.get(B),q=V&&V.constantOr(1),H=c.getCrossfadeParameters();let W,Y,ue,ce,he;const de=x.transform,_e=c.paint.get("fill-translate"),be=c.paint.get("fill-translate-anchor");C?(Y=q&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=R.LINES):(Y=q?"fillPattern":"fill",W=R.TRIANGLES);const Me=V.constantOr(null);for(const Pe of g){const Ce=i.getTile(Pe);if(q&&!Ce.patternsLoaded())continue;const Ne=Ce.getBucket(c);if(!Ne)continue;const qe=Ne.programConfigurations.get(c.id),it=x.useProgram(Y,qe),tt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Pe);q&&(x.context.activeTexture.set(R.TEXTURE0),Ce.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),qe.updatePaintBuffers(H)),$s(qe,B,Me,Ce,c);const et=de.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),wt=a.aA(de,Ce,_e,be);if(C){ce=Ne.indexBuffer2,he=Ne.segments2;const rt=[R.drawingBufferWidth,R.drawingBufferHeight];ue=Y==="fillOutlinePattern"&&q?Lf(x,H,Ce,rt,wt):Zm(rt,wt)}else ce=Ne.indexBuffer,he=Ne.segments,ue=q?eo(x,H,Ce,wt):{u_fill_translate:wt};let vt;if(x.renderPass==="translucent"&&O){const[rt]=x.getStencilConfigForOverlapAndUpdateStencilID(g);vt=rt[Pe.overscaledZ]}else vt=x.stencilModeForClipping(Pe);it.draw(x.context,W,_,vt,S,Ti.backCCW,ue,tt,et,c.id,Ne.layoutVertexBuffer,ce,he,c.paint,x.transform.zoom,qe)}}function So(x,i,c,g,_,S,C,O){const R=x.context,B=R.gl,V="fill-extrusion-pattern",q=c.paint.get(V),H=q.constantOr(1),W=c.getCrossfadeParameters(),Y=c.paint.get("fill-extrusion-opacity"),ue=q.constantOr(null),ce=x.transform;for(const he of g){const de=i.getTile(he),_e=de.getBucket(c);if(!_e)continue;const be=x.style.map.terrain&&x.style.map.terrain.getTerrainData(he),Me=_e.programConfigurations.get(c.id),Pe=x.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Me);H&&(x.context.activeTexture.set(B.TEXTURE0),de.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Me.updatePaintBuffers(W));const Ce=ce.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!O,applyTerrainMatrix:!0});$s(Me,V,ue,de,c);const Ne=a.aA(ce,de,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),qe=c.paint.get("fill-extrusion-vertical-gradient"),it=H?zf(x,qe,Y,Ne,he,W,de):uu(x,qe,Y,Ne);Pe.draw(R,R.gl.TRIANGLES,_,S,C,Ti.backCCW,it,be,Ce,c.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,c.paint,x.transform.zoom,Me,x.style.map.terrain&&_e.centroidVertexBuffer)}}function cr(x,i,c,g,_,S,C,O,R){var B;const V=x.style.projection,q=x.context,H=x.transform,W=q.gl,Y=x.useProgram("hillshade"),ue=!x.options.moving;for(const ce of g){const he=i.getTile(ce),de=he.fbo;if(!de)continue;const _e=V.getMeshFromTileID(q,ce.canonical,O,!0,"raster"),be=(B=x.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(ce);q.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,de.colorAttachment.get());const Me=H.getProjectionData({overscaledTileID:ce,aligned:ue,applyGlobeMatrix:!R,applyTerrainMatrix:!0});Y.draw(q,W.TRIANGLES,S,_[ce.overscaledZ],C,Ti.backCCW,np(x,he,c),be,Me,c.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}const xr=[new a.P(0,0),new a.P(a.Z,0),new a.P(a.Z,a.Z),new a.P(0,a.Z)];function To(x,i,c,g,_,S,C,O,R=!1,B=!1){const V=g[g.length-1].overscaledZ,q=x.context,H=q.gl,W=x.useProgram("raster"),Y=x.transform,ue=x.style.projection,ce=x.colorModeForRenderPass(),he=!x.options.moving;for(const de of g){const _e=x.getDepthModeForSublayer(de.overscaledZ-V,c.paint.get("raster-opacity")===1?ri.ReadWrite:ri.ReadOnly,H.LESS),be=i.getTile(de);be.registerFadeDuration(c.paint.get("raster-fade-duration"));const Me=i.findLoadedParent(de,0),Pe=i.findLoadedSibling(de),Ce=Yf(be,Me||Pe||null,i,c,x.transform,x.style.map.terrain);let Ne,qe;const it=c.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;q.activeTexture.set(H.TEXTURE0),be.texture.bind(it,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(H.TEXTURE1),Me?(Me.texture.bind(it,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ne=Math.pow(2,Me.tileID.overscaledZ-be.tileID.overscaledZ),qe=[be.tileID.canonical.x*Ne%1,be.tileID.canonical.y*Ne%1]):be.texture.bind(it,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),be.texture.useMipmap&&q.extTextureFilterAnisotropic&&x.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const tt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(de),et=Y.getProjectionData({overscaledTileID:de,aligned:he,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),wt=Vf(qe||[0,0],Ne||1,Ce,c,O),vt=ue.getMeshFromTileID(q,de.canonical,S,C,"raster");W.draw(q,H.TRIANGLES,_e,_?_[de.overscaledZ]:vi.disabled,ce,R?Ti.frontCCW:Ti.backCCW,wt,tt,et,c.id,vt.vertexBuffer,vt.indexBuffer,vt.segments)}}function Yf(x,i,c,g,_,S){const C=g.paint.get("raster-fade-duration");if(!S&&C>0){const O=j.now(),R=(O-x.timeAdded)/C,B=i?(O-i.timeAdded)/C:-1,V=c.getSource(),q=Ve(_,{tileSize:V.tileSize,roundZoom:V.roundZoom}),H=!i||Math.abs(i.tileID.overscaledZ-q)>Math.abs(x.tileID.overscaledZ-q),W=H&&x.refreshedUponExpiration?1:a.ae(H?R:1-B,0,1);return x.refreshedUponExpiration&&R>=1&&(x.refreshedUponExpiration=!1),i?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}const gn=new a.b7(1,0,0,1),Yo=new a.b7(0,1,0,1),on=new a.b7(0,0,1,1),yn=new a.b7(1,0,1,1),Pi=new a.b7(0,1,1,1);function Jo(x,i,c,g){Mo(x,0,i+c/2,x.transform.width,c,g)}function Ls(x,i,c,g){Mo(x,i-c/2,0,c,x.transform.height,g)}function Mo(x,i,c,g,_,S){const C=x.context,O=C.gl;O.enable(O.SCISSOR_TEST),O.scissor(i*x.pixelRatio,c*x.pixelRatio,g*x.pixelRatio,_*x.pixelRatio),C.clear({color:S}),O.disable(O.SCISSOR_TEST)}function ea(x,i,c){const g=x.context,_=g.gl,S=x.useProgram("debug"),C=ri.disabled,O=vi.disabled,R=x.colorModeForRenderPass(),B="$debug",V=x.style.map.terrain&&x.style.map.terrain.getTerrainData(c);g.activeTexture.set(_.TEXTURE0);const q=i.getTileByID(c.key).latestRawTileData,H=Math.floor((q&&q.byteLength||0)/1024),W=i.getTile(c).tileSize,Y=512/Math.min(W,512)*(c.overscaledZ/x.transform.zoom)*.5;let ue=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ue+=` => ${c.overscaledZ}`),function(he,de){he.initDebugOverlayCanvas();const _e=he.debugOverlayCanvas,be=he.context.gl,Me=he.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,_e.width,_e.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText(de,5,5),Me.strokeText(de,5,5),he.debugOverlayTexture.update(_e),he.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(x,`${ue} ${H}kB`);const ce=x.transform.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(g,_.TRIANGLES,C,O,Ai.alphaBlended,Ti.disabled,mh(a.b7.transparent,Y),null,ce,B,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),S.draw(g,_.LINE_STRIP,C,O,R,Ti.disabled,mh(a.b7.red),V,ce,B,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Ah(x,i,c,g){const{isRenderingGlobe:_}=g,S=x.context,C=S.gl,O=x.transform,R=x.colorModeForRenderPass(),B=x.getDepthModeFor3D(),V=x.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,x.width,x.height]);for(const q of c){const H=i.getTerrainMesh(q.tileID),W=x.renderToTexture.getTexture(q),Y=i.getTerrainData(q.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,W.texture);const ue=i.getMeshFrameDelta(O.zoom),ce=O.calculateFogMatrix(q.tileID.toUnwrapped()),he=Hm(ue,ce,x.style.sky,O.pitch,_),de=O.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});V.draw(S,C.TRIANGLES,B,vi.disabled,R,Ti.backCCW,he,Y,de,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}}function kh(x,i){if(!i.mesh){const c=new a.aI;c.emplaceBack(-1,-1),c.emplaceBack(1,-1),c.emplaceBack(1,1),c.emplaceBack(-1,1);const g=new a.aK;g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),i.mesh=new bl(x.createVertexBuffer(c,Nr.members),x.createIndexBuffer(g),a.aJ.simpleSegment(0,0,c.length,g.length))}return i.mesh}class vc{constructor(i,c){this.context=new Na(i),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Qe.maxUnderzooming+Qe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vo}resize(i,c,g){if(this.width=Math.floor(i*g),this.height=Math.floor(c*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const i=this.context,c=new a.aI;c.emplaceBack(0,0),c.emplaceBack(a.Z,0),c.emplaceBack(0,a.Z),c.emplaceBack(a.Z,a.Z),this.tileExtentBuffer=i.createVertexBuffer(c,Nr.members),this.tileExtentSegments=a.aJ.simpleSegment(0,0,4,2);const g=new a.aI;g.emplaceBack(0,0),g.emplaceBack(a.Z,0),g.emplaceBack(0,a.Z),g.emplaceBack(a.Z,a.Z),this.debugBuffer=i.createVertexBuffer(g,Nr.members),this.debugSegments=a.aJ.simpleSegment(0,0,4,5);const _=new a.bY;_.emplaceBack(0,0,0,0),_.emplaceBack(a.Z,0,a.Z,0),_.emplaceBack(0,a.Z,0,a.Z),_.emplaceBack(a.Z,a.Z,a.Z,a.Z),this.rasterBoundsBuffer=i.createVertexBuffer(_,Rf.members),this.rasterBoundsSegments=a.aJ.simpleSegment(0,0,4,2);const S=new a.aI;S.emplaceBack(0,0),S.emplaceBack(a.Z,0),S.emplaceBack(0,a.Z),S.emplaceBack(a.Z,a.Z),this.rasterBoundsBufferPosOnly=i.createVertexBuffer(S,Nr.members),this.rasterBoundsSegmentsPosOnly=a.aJ.simpleSegment(0,0,4,5);const C=new a.aI;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(C,Nr.members),this.viewportSegments=a.aJ.simpleSegment(0,0,4,2);const O=new a.bZ;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(O);const R=new a.aK;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(R);const B=this.context.gl;this.stencilClearMode=new vi({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new bl(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const i=this.context,c=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=a.K();a.bQ(g,0,this.width,this.height,0,0,1),a.M(g,g,[c.drawingBufferWidth,c.drawingBufferHeight,0]);const _={mainMatrix:g,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g};this.useProgram("clippingMask",null,!0).draw(i,c.TRIANGLES,ri.disabled,this.stencilClearMode,Ai.disabled,Ti.disabled,null,null,_,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,c,g){if(this.currentStencilSource===i.source||!i.isTileClipped()||!c||!c.length)return;this.currentStencilSource=i.source,this.nextStencilID+c.length>256&&this.clearStencil();const _=this.context;_.setColorMode(Ai.disabled),_.setDepthMode(ri.disabled);const S={};for(const C of c)S[C.key]=this.nextStencilID++;this._renderTileMasks(S,c,g,!0),this._renderTileMasks(S,c,g,!1),this._tileClippingMaskIDs=S}_renderTileMasks(i,c,g,_){const S=this.context,C=S.gl,O=this.style.projection,R=this.transform,B=this.useProgram("clippingMask");for(const V of c){const q=i[V.key],H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(V),W=O.getMeshFromTileID(this.context,V.canonical,_,!0,"stencil"),Y=R.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!0,applyTerrainMatrix:!0});B.draw(S,C.TRIANGLES,ri.disabled,new vi({func:C.ALWAYS,mask:0},q,255,C.KEEP,C.KEEP,C.REPLACE),Ai.disabled,g?Ti.disabled:Ti.backCCW,null,H,Y,"$clipping",W.vertexBuffer,W.indexBuffer,W.segments)}}_renderTilesDepthBuffer(){const i=this.context,c=i.gl,g=this.style.projection,_=this.transform,S=this.useProgram("depth"),C=this.getDepthModeFor3D(),O=Te(_,{tileSize:_.tileSize});for(const R of O){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),V=g.getMeshFromTileID(this.context,R.canonical,!0,!0,"raster"),q=_.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(i,c.TRIANGLES,C,vi.disabled,Ai.disabled,Ti.backCCW,null,B,q,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new vi({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){const c=this.context.gl;return new vi({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(i){const c=this.context.gl,g=i.sort((C,O)=>O.overscaledZ-C.overscaledZ),_=g[g.length-1].overscaledZ,S=g[0].overscaledZ-_+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const C={};for(let O=0;O<S;O++)C[O+_]=new vi({func:c.GEQUAL,mask:255},O+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[C,g]}return[{[_]:vi.disabled},g]}stencilConfigForOverlapTwoPass(i){const c=this.context.gl,g=i.sort((C,O)=>O.overscaledZ-C.overscaledZ),_=g[g.length-1].overscaledZ,S=g[0].overscaledZ-_+1;if(this.clearStencil(),S>1){const C={},O={};for(let R=0;R<S;R++)C[R+_]=new vi({func:c.GREATER,mask:255},S+1+R,255,c.KEEP,c.KEEP,c.REPLACE),O[R+_]=new vi({func:c.GREATER,mask:255},1+R,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID=2*S+1,[C,O,g]}return this.nextStencilID=3,[{[_]:new vi({func:c.GREATER,mask:255},2,255,c.KEEP,c.KEEP,c.REPLACE)},{[_]:new vi({func:c.GREATER,mask:255},1,255,c.KEEP,c.KEEP,c.REPLACE)},g]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ai([i.CONSTANT_COLOR,i.ONE],new a.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ai.unblended:Ai.alphaBlended}getDepthModeForSublayer(i,c,g){if(!this.opaquePassEnabledForLayer())return ri.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new ri(g||this.context.gl.LEQUAL,c,[_,_])}getDepthModeFor3D(){return new ri(this.context.gl.LEQUAL,ri.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,c){var g,_;this.style=i,this.options=c,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(j.now()),this.imageManager.beginFrame();const S=this.style._order,C=this.style.sourceCaches,O={},R={},B={},V={isRenderingToTexture:!1,isRenderingGlobe:((g=i.projection)===null||g===void 0?void 0:g.transitionState)>0};for(const H in C){const W=C[H];W.used&&W.prepare(this.context),O[H]=W.getVisibleCoordinates(!1),R[H]=O[H].slice().reverse(),B[H]=W.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<S.length;H++)if(this.style._layers[S[H]].is3D()){this.opaquePassCutoff=H;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const H of S){const W=this.style._layers[H];if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;const Y=R[W.source];(W.type==="custom"||Y.length)&&this.renderLayer(this,C[W.source],W,Y,V)}if((_=this.style.projection)===null||_===void 0||_.updateGPUdependent({context:this.context,useProgram:H=>this.useProgram(H)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?a.b7.black:a.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(H,W){const Y=H.context,ue=Y.gl,ce=((Pe,Ce,Ne)=>{const qe=Math.cos(Ce.rollInRadians),it=Math.sin(Ce.rollInRadians),tt=De(Ce),et=Ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(Ce.width/2-tt*it)*Ne,(Ce.height/2+tt*qe)*Ne],u_horizon_normal:[-it,qe],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*Ce.height/2*Ne,u_sky_blend:et}})(W,H.style.map.transform,H.pixelRatio),he=new ri(ue.LEQUAL,ri.ReadWrite,[0,1]),de=vi.disabled,_e=H.colorModeForRenderPass(),be=H.useProgram("sky"),Me=kh(Y,W);be.draw(Y,ue.TRIANGLES,he,de,_e,Ti.disabled,ce,null,void 0,"sky",Me.vertexBuffer,Me.indexBuffer,Me.segments)}(this,this.style.sky),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[S[this.currentLayer]],W=C[H.source],Y=O[H.source];this._renderTileClippingMasks(H,Y,!1),this.renderLayer(this,W,H,Y,V)}this.renderPass="translucent";let q=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const H=this.style._layers[S[this.currentLayer]],W=C[H.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(H,V))continue;this.opaquePassEnabledForLayer()||q||(q=!0,V.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Y=(H.type==="symbol"?B:R)[H.source];this._renderTileClippingMasks(H,O[H.source],!1),this.renderLayer(this,W,H,Y,V)}if(V.isRenderingGlobe&&function(H,W,Y){const ue=H.context,ce=ue.gl,he=H.useProgram("atmosphere"),de=new ri(ce.LEQUAL,ri.ReadOnly,[0,1]),_e=H.transform,be=function(et,wt){const vt=et.properties.get("position"),rt=[-vt.x,-vt.y,-vt.z],zt=a.ad(new Float64Array(16));return et.properties.get("anchor")==="map"&&(a.a_(zt,zt,wt.rollInRadians),a.a$(zt,zt,-wt.pitchInRadians),a.a_(zt,zt,wt.bearingInRadians),a.a$(zt,zt,wt.center.lat*Math.PI/180),a.bp(zt,zt,-wt.center.lng*Math.PI/180)),a.bX(rt,rt,zt),rt}(Y,H.transform),Me=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=W.properties.get("atmosphere-blend")*Me.projectionTransition;if(Pe===0)return;const Ce=uh(_e.worldSize,_e.center.lat),Ne=_e.inverseProjectionMatrix,qe=new Float64Array(4);qe[3]=1,a.at(qe,qe,_e.modelViewProjectionMatrix),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1,a.at(qe,qe,Ne),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1;const it=((et,wt,vt,rt,zt)=>({u_sun_pos:et,u_atmosphere_blend:wt,u_globe_position:vt,u_globe_radius:rt,u_inv_proj_matrix:zt}))(be,Pe,[qe[0],qe[1],qe[2]],Ce,Ne),tt=kh(ue,W);he.draw(ue,ce.TRIANGLES,de,vi.disabled,Ai.alphaBlended,Ti.disabled,it,null,null,"atmosphere",tt.vertexBuffer,tt.indexBuffer,tt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const H=function(W,Y){let ue=null;const ce=Object.values(W._layers).flatMap(be=>be.source&&!be.isHidden(Y)?[W.sourceCaches[be.source]]:[]),he=ce.filter(be=>be.getSource().type==="vector"),de=ce.filter(be=>be.getSource().type!=="vector"),_e=be=>{(!ue||ue.getSource().maxzoom<be.getSource().maxzoom)&&(ue=be)};return he.forEach(be=>_e(be)),ue||de.forEach(be=>_e(be)),ue}(this.style,this.transform.zoom);H&&function(W,Y,ue){for(let ce=0;ce<ue.length;ce++)ea(W,Y,ue[ce])}(this,H,H.getVisibleCoordinates())}this.options.showPadding&&function(H){const W=H.transform.padding;Jo(H,H.transform.height-(W.top||0),3,gn),Jo(H,W.bottom||0,3,Yo),Ls(H,W.left||0,3,on),Ls(H,H.transform.width-(W.right||0),3,yn);const Y=H.transform.centerPoint;(function(ue,ce,he,de){Mo(ue,ce-1,he-10,2,20,de),Mo(ue,ce-10,he-1,20,2,de)})(H,Y.x,H.transform.height-Y.y,Pi)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const c=this.terrainFacilitator.matrix,g=this.transform.modelViewProjectionMatrix;let _=this.terrainFacilitator.dirty;_||(_=i?!a.b_(c,g):!a.b$(c,g)),_||(_=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),_&&(a.c0(c,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,C){const O=S.context,R=O.gl,B=S.transform,V=Ai.unblended,q=new ri(R.LEQUAL,ri.ReadWrite,[0,1]),H=C.sourceCache.getRenderableTiles(),W=S.useProgram("terrainDepth");O.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:a.b7.transparent,depth:1});for(const Y of H){const ue=C.getTerrainMesh(Y.tileID),ce=C.getTerrainData(Y.tileID),he=B.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),de={u_ele_delta:C.getMeshFrameDelta(B.zoom)};W.draw(O,R.TRIANGLES,q,vi.disabled,V,Ti.backCCW,de,ce,he,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,C){const O=S.context,R=O.gl,B=S.transform,V=Ai.unblended,q=new ri(R.LEQUAL,ri.ReadWrite,[0,1]),H=C.getCoordsTexture(),W=C.sourceCache.getRenderableTiles(),Y=S.useProgram("terrainCoords");O.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:a.b7.transparent,depth:1}),C.coordsIndex=[];for(const ue of W){const ce=C.getTerrainMesh(ue.tileID),he=C.getTerrainData(ue.tileID);O.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,H.texture);const de={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(B.zoom)},_e=B.getProjectionData({overscaledTileID:ue.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Y.draw(O,R.TRIANGLES,q,vi.disabled,V,Ti.backCCW,de,he,_e,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments),C.coordsIndex.push(ue.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(i,c,g,_,S){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="custom"||(_||[]).length)&&(this.id=g.id,a.c1(g)?function(C,O,R,B,V,q){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:H}=q,W=vi.disabled,Y=C.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ue,ce,he,de,_e,be,Me,Pe,Ce){const Ne=ce.transform,qe=ce.style.map.terrain,it=_e==="map",tt=be==="map";for(const et of ue){const wt=de.getTile(et),vt=wt.getBucket(he);if(!vt||!vt.text||!vt.text.segments.get().length)continue;const rt=a.ak(vt.textSizeData,Ne.zoom),zt=a.az(wt,1,ce.transform.zoom),ci=Vt(it,ce.transform,zt),ii=he.layout.get("icon-text-fit")!=="none"&&vt.hasIconData();if(rt){const cn=Math.pow(2,Ne.zoom-wt.tileID.overscaledZ),Ii=qe?(un,Zi)=>qe.getElevation(et,un,Zi):null;kl(vt,it,tt,Ce,Ne,ci,cn,rt,ii,a.aA(Ne,wt,Me,Pe),et.toUnwrapped(),Ii)}}}(B,C,R,O,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),V),R.paint.get("icon-opacity").constantOr(1)!==0&&yc(C,O,R,B,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),W,Y,H),R.paint.get("text-opacity").constantOr(1)!==0&&yc(C,O,R,B,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),W,Y,H),O.map.showCollisionBoxes&&(vs(C,O,R,B,!0),vs(C,O,R,B,!1))}(i,c,g,_,this.style.placement.variableOffsets,S):a.c2(g)?function(C,O,R,B,V){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:q}=V,H=R.paint.get("circle-opacity"),W=R.paint.get("circle-stroke-width"),Y=R.paint.get("circle-stroke-opacity"),ue=!R.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(W.constantOr(1)===0||Y.constantOr(1)===0))return;const ce=C.context,he=ce.gl,de=C.transform,_e=C.getDepthModeForSublayer(0,ri.ReadOnly),be=vi.disabled,Me=C.colorModeForRenderPass(),Pe=[],Ce=de.getCircleRadiusCorrection();for(let Ne=0;Ne<B.length;Ne++){const qe=B[Ne],it=O.getTile(qe),tt=it.getBucket(R);if(!tt)continue;const et=R.paint.get("circle-translate"),wt=R.paint.get("circle-translate-anchor"),vt=a.aA(de,it,et,wt),rt=tt.programConfigurations.get(R.id),zt=C.useProgram("circle",rt),ci=tt.layoutVertexBuffer,ii=tt.indexBuffer,cn=C.style.map.terrain&&C.style.map.terrain.getTerrainData(qe),Ii={programConfiguration:rt,program:zt,layoutVertexBuffer:ci,indexBuffer:ii,uniformValues:ip(C,it,R,vt,Ce),terrainData:cn,projectionData:de.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!q,applyTerrainMatrix:!0})};if(ue){const un=tt.segments.get();for(const Zi of un)Pe.push({segments:new a.aJ([Zi]),sortKey:Zi.sortKey,state:Ii})}else Pe.push({segments:tt.segments,sortKey:0,state:Ii})}ue&&Pe.sort((Ne,qe)=>Ne.sortKey-qe.sortKey);for(const Ne of Pe){const{programConfiguration:qe,program:it,layoutVertexBuffer:tt,indexBuffer:et,uniformValues:wt,terrainData:vt,projectionData:rt}=Ne.state;it.draw(ce,he.TRIANGLES,_e,be,Me,Ti.backCCW,wt,vt,rt,R.id,tt,et,Ne.segments,R.paint,C.transform.zoom,qe)}}(i,c,g,_,S):a.c3(g)?function(C,O,R,B,V){if(R.paint.get("heatmap-opacity")===0)return;const q=C.context,{isRenderingToTexture:H,isRenderingGlobe:W}=V;if(C.style.map.terrain){for(const Y of B){const ue=O.getTile(Y);O.hasRenderableParent(Y)||(C.renderPass==="offscreen"?Fa(C,ue,R,Y,W):C.renderPass==="translucent"&&_c(C,R,Y,H,W))}q.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?function(Y,ue,ce,he){const de=Y.context,_e=de.gl,be=Y.transform,Me=vi.disabled,Pe=new Ai([_e.ONE,_e.ONE],a.b7.transparent,[!0,!0,!0,!0]);(function(Ce,Ne,qe){const it=Ce.gl;Ce.activeTexture.set(it.TEXTURE1),Ce.viewport.set([0,0,Ne.width/4,Ne.height/4]);let tt=qe.heatmapFbos.get(a.bU);tt?(it.bindTexture(it.TEXTURE_2D,tt.colorAttachment.get()),Ce.bindFramebuffer.set(tt.framebuffer)):(tt=bc(Ce,Ne.width/4,Ne.height/4),qe.heatmapFbos.set(a.bU,tt))})(de,Y,ce),de.clear({color:a.b7.transparent});for(let Ce=0;Ce<he.length;Ce++){const Ne=he[Ce];if(ue.hasRenderableParent(Ne))continue;const qe=ue.getTile(Ne),it=qe.getBucket(ce);if(!it)continue;const tt=it.programConfigurations.get(ce.id),et=Y.useProgram("heatmap",tt),wt=be.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),vt=be.getCircleRadiusCorrection();et.draw(de,_e.TRIANGLES,ri.disabled,Me,Pe,Ti.backCCW,Oa(qe,be.zoom,ce.paint.get("heatmap-intensity"),vt),null,wt,ce.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,ce.paint,be.zoom,tt)}de.viewport.set([0,0,Y.width,Y.height])}(C,O,R,B):C.renderPass==="translucent"&&function(Y,ue){const ce=Y.context,he=ce.gl;ce.setColorMode(Y.colorModeForRenderPass());const de=ue.heatmapFbos.get(a.bU);de&&(ce.activeTexture.set(he.TEXTURE0),he.bindTexture(he.TEXTURE_2D,de.colorAttachment.get()),ce.activeTexture.set(he.TEXTURE1),ja(ce,ue).bind(he.LINEAR,he.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(ce,he.TRIANGLES,ri.disabled,vi.disabled,Y.colorModeForRenderPass(),Ti.disabled,Nf(Y,ue,0,1),null,null,ue.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,ue.paint,Y.transform.zoom))}(C,R)}(i,c,g,_,S):a.c4(g)?function(C,O,R,B,V){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:q}=V,H=R.paint.get("line-opacity"),W=R.paint.get("line-width");if(H.constantOr(1)===0||W.constantOr(1)===0)return;const Y=C.getDepthModeForSublayer(0,ri.ReadOnly),ue=C.colorModeForRenderPass(),ce=R.paint.get("line-dasharray"),he=R.paint.get("line-pattern"),de=he.constantOr(1),_e=R.paint.get("line-gradient"),be=R.getCrossfadeParameters(),Me=de?"linePattern":ce?"lineSDF":_e?"lineGradient":"line",Pe=C.context,Ce=Pe.gl,Ne=C.transform;let qe=!0;for(const it of B){const tt=O.getTile(it);if(de&&!tt.patternsLoaded())continue;const et=tt.getBucket(R);if(!et)continue;const wt=et.programConfigurations.get(R.id),vt=C.context.program.get(),rt=C.useProgram(Me,wt),zt=qe||rt.program!==vt,ci=C.style.map.terrain&&C.style.map.terrain.getTerrainData(it),ii=he.constantOr(null);if(ii&&tt.imageAtlas){const Li=tt.imageAtlas,Oi=Li.patternPositions[ii.to.toString()],qn=Li.patternPositions[ii.from.toString()];Oi&&qn&&wt.setConstantPatternPositions(Oi,qn)}const cn=Ne.getProjectionData({overscaledTileID:it,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),Ii=Ne.getPixelScale(),un=de?fu(C,tt,R,Ii,be):ce?gh(C,tt,R,Ii,ce,be):_e?Xo(C,tt,R,Ii,et.lineClipsArray.length):hu(C,tt,R,Ii);if(de)Pe.activeTexture.set(Ce.TEXTURE0),tt.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),wt.updatePaintBuffers(be);else if(ce&&(zt||C.lineAtlas.dirty))Pe.activeTexture.set(Ce.TEXTURE0),C.lineAtlas.bind(Pe);else if(_e){const Li=et.gradients[R.id];let Oi=Li.texture;if(R.gradientVersion!==Li.version){let qn=256;if(R.stepInterpolant){const Hn=O.getSource().maxzoom,cs=it.canonical.z===Hn?Math.ceil(1<<C.transform.maxZoom-it.canonical.z):1;qn=a.ae(a.bV(et.maxLineLength/a.Z*1024*cs),256,Pe.maxTextureSize)}Li.gradient=a.bW({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:qn,image:Li.gradient||void 0,clips:et.lineClipsArray}),Li.texture?Li.texture.update(Li.gradient):Li.texture=new He(Pe,Li.gradient,Ce.RGBA),Li.version=R.gradientVersion,Oi=Li.texture}Pe.activeTexture.set(Ce.TEXTURE0),Oi.bind(R.stepInterpolant?Ce.NEAREST:Ce.LINEAR,Ce.CLAMP_TO_EDGE)}let Zi;if(q){const[Li]=C.getStencilConfigForOverlapAndUpdateStencilID(B);Zi=Li[it.overscaledZ]}else Zi=C.stencilModeForClipping(it);rt.draw(Pe,Ce.TRIANGLES,Y,Zi,ue,Ti.disabled,un,ci,cn,R.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,R.paint,C.transform.zoom,wt,et.layoutVertexBuffer2),qe=!1}}(i,c,g,_,S):a.c5(g)?function(C,O,R,B,V){const q=R.paint.get("fill-color"),H=R.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const{isRenderingToTexture:W}=V,Y=C.colorModeForRenderPass(),ue=R.paint.get("fill-pattern"),ce=C.opaquePassEnabledForLayer()&&!ue.constantOr(1)&&q.constantOr(a.b7.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===ce){const he=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?ri.ReadWrite:ri.ReadOnly);lr(C,O,R,B,he,Y,!1,W)}if(C.renderPass==="translucent"&&R.paint.get("fill-antialias")){const he=C.getDepthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,ri.ReadOnly);lr(C,O,R,B,he,Y,!0,W)}}(i,c,g,_,S):a.c6(g)?function(C,O,R,B,V){const q=R.paint.get("fill-extrusion-opacity");if(q===0)return;const{isRenderingToTexture:H}=V;if(C.renderPass==="translucent"){const W=new ri(C.context.gl.LEQUAL,ri.ReadWrite,C.depthRangeFor3D);if(q!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))So(C,O,R,B,W,vi.disabled,Ai.disabled,H),So(C,O,R,B,W,C.stencilModeFor3D(),C.colorModeForRenderPass(),H);else{const Y=C.colorModeForRenderPass();So(C,O,R,B,W,vi.disabled,Y,H)}}}(i,c,g,_,S):a.c7(g)?function(C,O,R,B,V){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:q}=V,H=C.context,W=C.style.projection.useSubdivision,Y=C.getDepthModeForSublayer(0,ri.ReadOnly),ue=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(ce,he,de,_e,be,Me,Pe){const Ce=ce.context,Ne=Ce.gl;for(const qe of de){const it=he.getTile(qe),tt=it.dem;if(!tt||!tt.data||!it.needsHillshadePrepare)continue;const et=tt.dim,wt=tt.stride,vt=tt.getPixels();if(Ce.activeTexture.set(Ne.TEXTURE1),Ce.pixelStoreUnpackPremultiplyAlpha.set(!1),it.demTexture=it.demTexture||ce.getTileTexture(wt),it.demTexture){const zt=it.demTexture;zt.update(vt,{premultiply:!1}),zt.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE)}else it.demTexture=new He(Ce,vt,Ne.RGBA,{premultiply:!1}),it.demTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);Ce.activeTexture.set(Ne.TEXTURE0);let rt=it.fbo;if(!rt){const zt=new He(Ce,{width:et,height:et,data:null},Ne.RGBA);zt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),rt=it.fbo=Ce.createFramebuffer(et,et,!0,!1),rt.colorAttachment.set(zt.texture)}Ce.bindFramebuffer.set(rt.framebuffer),Ce.viewport.set([0,0,et,et]),ce.useProgram("hillshadePrepare").draw(Ce,Ne.TRIANGLES,be,Me,Pe,Ti.disabled,Ml(it.tileID,tt),null,null,_e.id,ce.rasterBoundsBuffer,ce.quadTriangleIndexBuffer,ce.rasterBoundsSegments),it.needsHillshadePrepare=!1}})(C,O,B,R,Y,vi.disabled,ue),H.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(W){const[ce,he,de]=C.stencilConfigForOverlapTwoPass(B);cr(C,O,R,de,ce,Y,ue,!1,q),cr(C,O,R,de,he,Y,ue,!0,q)}else{const[ce,he]=C.getStencilConfigForOverlapAndUpdateStencilID(B);cr(C,O,R,he,ce,Y,ue,!1,q)}}(i,c,g,_,S):a.c8(g)?function(C,O,R,B,V){if(C.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:q}=V,H=O.getSource(),W=C.style.projection.useSubdivision;if(H instanceof tr)To(C,O,R,B,null,!1,!1,H.tileCoords,H.flippedWindingOrder,q);else if(W){const[Y,ue,ce]=C.stencilConfigForOverlapTwoPass(B);To(C,O,R,ce,Y,!1,!0,xr,!1,q),To(C,O,R,ce,ue,!0,!0,xr,!1,q)}else{const[Y,ue]=C.getStencilConfigForOverlapAndUpdateStencilID(B);To(C,O,R,ue,Y,!1,!0,xr,!1,q)}}(i,c,g,_,S):a.c9(g)?function(C,O,R,B,V){const q=R.paint.get("background-color"),H=R.paint.get("background-opacity");if(H===0)return;const{isRenderingToTexture:W}=V,Y=C.context,ue=Y.gl,ce=C.style.projection,he=C.transform,de=he.tileSize,_e=R.paint.get("background-pattern");if(C.isPatternMissing(_e))return;const be=!_e&&q.a===1&&H===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==be)return;const Me=vi.disabled,Pe=C.getDepthModeForSublayer(0,be==="opaque"?ri.ReadWrite:ri.ReadOnly),Ce=C.colorModeForRenderPass(),Ne=C.useProgram(_e?"backgroundPattern":"background"),qe=B||Te(he,{tileSize:de,terrain:C.style.map.terrain});_e&&(Y.activeTexture.set(ue.TEXTURE0),C.imageManager.bind(C.context));const it=R.getCrossfadeParameters();for(const tt of qe){const et=he.getProjectionData({overscaledTileID:tt,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),wt=_e?Qo(H,C,_e,{tileID:tt,tileSize:de},it):gu(H,q),vt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(tt),rt=ce.getMeshFromTileID(Y,tt.canonical,!1,!0,"raster");Ne.draw(Y,ue.TRIANGLES,Pe,Me,Ce,Ti.backCCW,wt,vt,et,R.id,rt.vertexBuffer,rt.indexBuffer,rt.segments)}}(i,0,g,_,S):a.ca(g)&&function(C,O,R,B){const{isRenderingGlobe:V}=B,q=C.context,H=R.implementation,W=C.style.projection,Y=C.transform,ue=Y.getProjectionDataForCustomLayer(V),ce={farZ:Y.farZ,nearZ:Y.nearZ,fov:Y.fov*Math.PI/180,modelViewProjectionMatrix:Y.modelViewProjectionMatrix,projectionMatrix:Y.projectionMatrix,shaderData:{variantName:W.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${W.shaderPreludeCode.vertexSource}`,define:W.shaderDefine},defaultProjectionData:ue},he=H.renderingMode?H.renderingMode:"2d";if(C.renderPass==="offscreen"){const de=H.prerender;de&&(C.setCustomLayerDefaults(),q.setColorMode(C.colorModeForRenderPass()),de.call(H,q.gl,ce),q.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),q.setColorMode(C.colorModeForRenderPass()),q.setStencilMode(vi.disabled);const de=he==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,ri.ReadOnly);q.setDepthMode(de),H.render(q.gl,ce),q.setDirty(),C.setBaseState(),q.bindFramebuffer.set(null)}}(i,0,g,S))}saveTileTexture(i){const c=this._tileTextures[i.size[0]];c?c.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const c=this.imageManager.getPattern(i.from.toString()),g=this.imageManager.getPattern(i.to.toString());return!c||!g}useProgram(i,c,g=!1){this.cache=this.cache||{};const _=!!this.style.map.terrain,S=this.style.projection,C=i+(c?c.cacheKey:"")+`/${g?Ps:S.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"");return this.cache[C]||(this.cache[C]=new cu(this.context,hi[i],c,qf[i],this._showOverdrawInspector,_,g?hi.projectionMercator:S.shaderPreludeCode,g?rr:S.shaderDefine)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new He(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:c}=this.context.gl;return this.width!==i||this.height!==c}}function El(x,i){let c,g=!1,_=null,S=null;const C=()=>{_=null,g&&(x.apply(S,c),_=setTimeout(C,i),g=!1)};return(...O)=>(g=!0,S=this,c=O,_||C(),_)}class Eh{constructor(i){this._getCurrentHash=()=>{const c=window.location.hash.replace("#","");if(this._hashName){let g;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(g=_)}),(g&&g[1]||"").split("/")}return c.split("/")},this._onHashChange=()=>{const c=this._getCurrentHash();if(!this._isValidHash(c))return!1;const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0},this._updateHashUnthrottled=()=>{const c=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,c)},this._removeHash=()=>{const c=this._getCurrentHash();if(c.length===0)return;const g=c.join("/");let _=g;_.split("&").length>0&&(_=_.split("&")[0]),this._hashName&&(_=`${this._hashName}=${g}`);let S=window.location.hash.replace(_,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let C=window.location.href.replace(/(#.+)?$/,S);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=El(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const c=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,_=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,_),C=Math.round(c.lng*S)/S,O=Math.round(c.lat*S)/S,R=this._map.getBearing(),B=this._map.getPitch();let V="";if(V+=i?`/${C}/${O}/${g}`:`${g}/${O}/${C}`,(R||B)&&(V+="/"+Math.round(10*R)/10),B&&(V+=`/${Math.round(B)}`),this._hashName){const q=this._hashName;let H=!1;const W=window.location.hash.slice(1).split("&").map(Y=>{const ue=Y.split("=")[0];return ue===q?(H=!0,`${ue}=${V}`):Y}).filter(Y=>Y);return H||W.push(`${q}=${V}`),`#${W.join("&")}`}return`#${V}`}_isValidHash(i){if(i.length<3||i.some(isNaN))return!1;try{new a.Q(+i[2],+i[1])}catch{return!1}const c=+i[0],g=+(i[3]||0),_=+(i[4]||0);return c>=this._map.getMinZoom()&&c<=this._map.getMaxZoom()&&g>=-180&&g<=180&&_>=this._map.getMinPitch()&&_<=this._map.getMaxPitch()}}const Xs={linearity:.3,easing:a.cb(0,0,.3,1)},Ph=a.e({deceleration:2500,maxSpeed:1400},Xs),Va=a.e({deceleration:20,maxSpeed:1400},Xs),Co=a.e({deceleration:1e3,maxSpeed:360},Xs),ta=a.e({deceleration:1e3,maxSpeed:90},Xs),Ao=a.e({deceleration:1e3,maxSpeed:360},Xs);class Oh{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:j.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=j.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,c.roll+=S.rollDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){const S=Vr(c.pan.mag(),g,a.e({},Ph,i||{})),C=c.pan.mult(S.amount/c.pan.mag()),O=this._map.cameraHelper.handlePanInertia(C,this._map.transform);_.center=O.easingCenter,_.offset=O.easingOffset,Ua(_,S)}if(c.zoom){const S=Vr(c.zoom,g,Va);_.zoom=this._map.transform.zoom+S.amount,Ua(_,S)}if(c.bearing){const S=Vr(c.bearing,g,Co);_.bearing=this._map.transform.bearing+a.ae(S.amount,-179,179),Ua(_,S)}if(c.pitch){const S=Vr(c.pitch,g,ta);_.pitch=this._map.transform.pitch+S.amount,Ua(_,S)}if(c.roll){const S=Vr(c.roll,g,Ao);_.roll=this._map.transform.roll+a.ae(S.amount,-179,179),Ua(_,S)}if(_.zoom||_.bearing){const S=c.pinchAround===void 0?c.around:c.pinchAround;_.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),a.e(_,{noMoveStart:!0})}}function Ua(x,i){(!x.duration||x.duration<i.duration)&&(x.duration=i.duration,x.easing=i.easing)}function Vr(x,i,c){const{maxSpeed:g,linearity:_,deceleration:S}=c,C=a.ae(x*_/(i/1e3),-g,g),O=Math.abs(C)/(S*_);return{easing:c.easing,duration:1e3*O,amount:C*(O/2)}}class xs extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g,_={}){g=g instanceof MouseEvent?g:new MouseEvent(i,g);const S=F.mousePos(c.getCanvas(),g),C=c.unproject(S);super(i,a.e({point:S,lngLat:C,originalEvent:g},_)),this._defaultPrevented=!1,this.target=c}}class zn extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g){const _=i==="touchend"?g.changedTouches:g.touches,S=F.touchPos(c.getCanvasContainer(),_),C=S.map(R=>c.unproject(R)),O=S.reduce((R,B,V,q)=>R.add(B.div(q.length)),new a.P(0,0));super(i,{points:S,point:O,lngLats:C,lngLat:c.unproject(O),originalEvent:g}),this._defaultPrevented=!1}}class an extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g){super(i,{originalEvent:g}),this._defaultPrevented=!1}}class xu{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new an(i.type,this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new xs(i.type,this._map,i))}mouseup(i){this._map.fire(new xs(i.type,this._map,i))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new xs(i.type,this._map,i))}dblclick(i){return this._firePreventable(new xs(i.type,this._map,i))}mouseover(i){this._map.fire(new xs(i.type,this._map,i))}mouseout(i){this._map.fire(new xs(i.type,this._map,i))}touchstart(i){return this._firePreventable(new zn(i.type,this._map,i))}touchmove(i){this._map.fire(new zn(i.type,this._map,i))}touchend(i){this._map.fire(new zn(i.type,this._map,i))}touchcancel(i){this._map.fire(new zn(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class io{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new xs(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new xs(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ko{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.screenPointToLocation(a.P.convert(i),this._map.terrain)}}class cp{constructor(i,c){this._map=i,this._tr=new ko(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(F.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const g=c;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=g,this._box||(this._box=F.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const S=Math.min(_.x,g.x),C=Math.max(_.x,g.x),O=Math.min(_.y,g.y),R=Math.max(_.y,g.y);F.setTransform(this._box,`translate(${S}px,${O}px)`),this._box.style.width=C-S+"px",this._box.style.height=R-O+"px"}mouseupWindow(i,c){if(!this._active||i.button!==0)return;const g=this._startPos,_=c;if(this.reset(),F.suppressClick(),g.x!==_.x||g.y!==_.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:i})),{cameraAnimation:S=>S.fitScreenCoordinates(g,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new a.l(i,{originalEvent:c}))}}function Jf(x,i){if(x.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${i.length}`);const c={};for(let g=0;g<x.length;g++)c[x[g].identifier]=i[g];return c}class ts{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),g.length===this.numTouches&&(this.centroid=function(_){const S=new a.P(0,0);for(const C of _)S._add(C);return S.div(_.length)}(c),this.touches=Jf(g,c)))}touchmove(i,c,g){if(this.aborted||!this.centroid)return;const _=Jf(g,c);for(const S in this.touches){const C=_[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(i,c,g){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class wu{constructor(i){this.singleTap=new ts(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,c,g){this.singleTap.touchstart(i,c,g)}touchmove(i,c,g){this.singleTap.touchmove(i,c,g)}touchend(i,c,g){const _=this.singleTap.touchend(i,c,g);if(_){const S=i.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(_)<30;if(S&&C||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class xc{constructor(i){this._tr=new ko(i),this._zoomIn=new wu({numTouches:1,numTaps:2}),this._zoomOut=new wu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,g){this._zoomIn.touchstart(i,c,g),this._zoomOut.touchstart(i,c,g)}touchmove(i,c,g){this._zoomIn.touchmove(i,c,g),this._zoomOut.touchmove(i,c,g)}touchend(i,c,g){const _=this._zoomIn.touchend(i,c,g),S=this._zoomOut.touchend(i,c,g),C=this._tr;return _?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(_)},{originalEvent:i})}):S?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(S)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wr{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const c=this._moveFunction(...i);if(c.bearingDelta||c.pitchDelta||c.rollDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(i,c){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=Array.isArray(c)?c[0]:c,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,c){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const _=Array.isArray(c)?c[0]:c;return!this._moved&&_.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(g,_))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&F.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const no={0:1,2:2};class At{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const c=F.mouseButton(i);this._eventButton=c}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(c,g){const _=no[g];return c.buttons===void 0||(c.buttons&_)!==_}(i,this._eventButton)}isValidEndEvent(i){return F.mouseButton(i)===this._eventButton}}class Pl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}class ed{constructor(i=new At({checkCorrectEvent:()=>!0}),c=new Pl){this.mouseMoveStateManager=i,this.oneFingerTouchMoveStateManager=c}_executeRelevantHandler(i,c,g){return i instanceof MouseEvent?c(i):typeof TouchEvent<"u"&&i instanceof TouchEvent?g(i):void 0}startMove(i){this._executeRelevantHandler(i,c=>this.mouseMoveStateManager.startMove(c),c=>this.oneFingerTouchMoveStateManager.startMove(c))}endMove(i){this._executeRelevantHandler(i,c=>this.mouseMoveStateManager.endMove(c),c=>this.oneFingerTouchMoveStateManager.endMove(c))}isValidStartEvent(i){return this._executeRelevantHandler(i,c=>this.mouseMoveStateManager.isValidStartEvent(c),c=>this.oneFingerTouchMoveStateManager.isValidStartEvent(c))}isValidMoveEvent(i){return this._executeRelevantHandler(i,c=>this.mouseMoveStateManager.isValidMoveEvent(c),c=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(c))}isValidEndEvent(i){return this._executeRelevantHandler(i,c=>this.mouseMoveStateManager.isValidEndEvent(c),c=>this.oneFingerTouchMoveStateManager.isValidEndEvent(c))}}const wc=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=i=>{i.preventDefault()}};class Su{constructor(i,c){this._clickTolerance=i.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,c,g){return this._calculateTransform(i,c,g)}touchmove(i,c,g){if(this._active){if(!this._shouldBePrevented(g.length))return i.preventDefault(),this._calculateTransform(i,c,g);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,c,g){this._calculateTransform(i,c,g),this._active&&this._shouldBePrevented(g.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,g){g.length>0&&(this._active=!0);const _=Jf(g,c),S=new a.P(0,0),C=new a.P(0,0);let O=0;for(const B in _){const V=_[B],q=this._touches[B];q&&(S._add(V),C._add(V.sub(q)),O++,_[B]=V)}if(this._touches=_,this._shouldBePrevented(O)||!C.mag())return;const R=C.div(O);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(O),panDelta:R}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,g){if(!this._firstTwoTouches)return;i.preventDefault();const[_,S]=this._firstTwoTouches,C=so(g,c,_),O=so(g,c,S);if(!C||!O)return;const R=this._aroundCenter?null:C.add(O).div(2);return this._move([C,O],R,i)}touchend(i,c,g){if(!this._firstTwoTouches)return;const[_,S]=this._firstTwoTouches,C=so(g,c,_),O=so(g,c,S);C&&O||(this._active&&F.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function so(x,i,c){for(let g=0;g<x.length;g++)if(x[g].identifier===c)return i[g]}function di(x,i){return Math.log(x/i)/Math.LN2}class Ol extends qa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const g=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(di(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:di(this._distance,g),pinchAround:c}}}function td(x,i){return 180*x.angleWith(i)/Math.PI}class Ha extends qa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c,g){const _=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:td(this._vector,_),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,g=td(i,this._startVector);return Math.abs(g)<c}}function Dh(x){return Math.abs(x.y)>Math.abs(x.x)}class Tu extends qa{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,c,g){super.touchstart(i,c,g),this._currentTouchCount=g.length}_start(i){this._lastPoints=i,Dh(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const _=i[0].sub(this._lastPoints[0]),S=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,S,g.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(i,c,g){if(this._valid!==void 0)return this._valid;const _=i.mag()>=2,S=c.mag()>=2;if(!_&&!S)return;if(!_||!S)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=i.y>0==c.y>0;return Dh(i)&&Dh(c)&&C}}const Rh={panStep:100,bearingStep:15,pitchStep:10};class Mu{constructor(i){this._tr=new ko(i);const c=Rh;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,g=0,_=0,S=0,C=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?g=-1:(i.preventDefault(),S=-1);break;case 39:i.shiftKey?g=1:(i.preventDefault(),S=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),C=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,_=0),{cameraAnimation:O=>{const R=this._tr;O.easeTo({duration:300,easeId:"keyboardHandler",easing:Cu,zoom:c?Math.round(R.zoom)+c*(i.shiftKey?2:1):R.zoom,bearing:R.bearing+g*this._bearingStep,pitch:R.pitch+_*this._pitchStep,offset:[-S*this._panStep,-C*this._panStep],center:R.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cu(x){return x*(2-x)}const id=4.000244140625;class Dl{constructor(i,c){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=i,this._tr=new ko(i),this._triggerRenderFrame=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const g=j.now(),_=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,c!==0&&c%id==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=F.mousePos(this._map.getCanvas(),i),g=this._tr;this._aroundPoint=this._aroundCenter?g.transform.locationToScreenPoint(a.Q.convert(g.center)):c,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const O=i.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=O),typeof this._targetZoom=="number"&&(this._targetZoom+=O)}if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>id?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&R!==0&&(R=1/R);const B=typeof this._targetZoom!="number"?i.scale:a.ac(this._targetZoom);this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,a.ah(B*R))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom!="number"?i.zoom:this._targetZoom,g=this._startZoom,_=this._easing;let S,C=!1;if(this._type==="wheel"&&g&&_){const O=j.now()-this._lastWheelEventTime,R=Math.min((O+5)/200,1),B=_(R);S=a.B.number(g,c,B),R<1?this._frameId||(this._frameId=!0):C=!0}else S=c,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!C,zoomDelta:S-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=a.cd;if(this._prevEase){const g=this._prevEase,_=(j.now()-g.start)/g.duration,S=g.easing(_+.01)-g.easing(_),C=.27/Math.sqrt(S*S+1e-4)*.01,O=Math.sqrt(.0729-C*C);c=a.cb(C,O,.25,1)}return this._prevEase={start:j.now(),duration:i,easing:c},c}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class nd{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class up{constructor(i){this._tr=new ko(i),this.reset()}reset(){this._active=!1}dblclick(i,c){return i.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qs{constructor(){this._tap=new wu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,c,g){if(!this._swipePoint)if(this._tapTime){const _=c[0],S=i.timeStamp-this._tapTime<500,C=this._tapPoint.dist(_)<30;S&&C?g.length>0&&(this._swipePoint=_,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(i,c,g)}touchmove(i,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const _=c[0],S=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(i,c,g)}touchend(i,c,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const _=this._tap.touchend(i,c,g);_&&(this._tapTime=i.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hi{constructor(i,c,g){this._el=i,this._mousePan=c,this._touchPan=g}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rl{constructor(i,c,g,_){this._pitchWithRotate=i.pitchWithRotate,this._rollEnabled=i.rollEnabled,this._mouseRotate=c,this._mousePitch=g,this._mouseRoll=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ro{constructor(i,c,g,_){this._el=i,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Eo{constructor(i,c){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=c,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=F.create("div","maplibregl-cooperative-gesture-screen",i);let c=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(c=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),_=document.createElement("div");_.className="maplibregl-desktop-message",_.textContent=c,this._container.appendChild(_);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=g,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(F.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,c){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:i,originalEvent:c})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ia=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class Ih extends a.l{}function Au(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class ur{constructor(i,c){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,S)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=_.type==="renderFrame"?void 0:_,O={needsRenderFrame:!1},R={},B={};for(const{handlerName:H,handler:W,allowed:Y}of this._handlers){if(!W.isEnabled())continue;let ue;if(this._blockedByActive(B,Y,H))W.reset();else if(W[S||_.type]){if(a.ce(_,S||_.type)){const ce=F.mousePos(this._map.getCanvas(),_);ue=W[S||_.type](_,ce)}else if(a.cf(_,S||_.type)){const ce=this._getMapTouches(_.touches),he=F.touchPos(this._map.getCanvas(),ce);ue=W[S||_.type](_,he,ce)}else a.cg(S||_.type)||(ue=W[S||_.type](_));this.mergeHandlerResult(O,R,ue,H,C),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()}(ue||W.isActive())&&(B[H]=W)}const V={};for(const H in this._previousActiveHandlers)B[H]||(V[H]=C);this._previousActiveHandlers=B,(Object.keys(V).length||Au(O))&&(this._changes.push([O,R,V]),this._triggerRenderFrame()),(Object.keys(B).length||Au(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=O;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Oh(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,S,C]of this._listeners)F.addEventListener(_,S,_===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[i,c,g]of this._listeners)F.removeEventListener(i,c,i===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(i){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new xu(c,i));const _=c.boxZoom=new cp(c,i);this._add("boxZoom",_),i.interactive&&i.boxZoom&&_.enable();const S=c.cooperativeGestures=new Eo(c,i.cooperativeGestures);this._add("cooperativeGestures",S),i.cooperativeGestures&&S.enable();const C=new xc(c),O=new up(c);c.doubleClickZoom=new nd(O,C),this._add("tapZoom",C),this._add("clickZoom",O),i.interactive&&i.doubleClickZoom&&c.doubleClickZoom.enable();const R=new Qs;this._add("tapDragZoom",R);const B=c.touchPitch=new Tu(c);this._add("touchPitch",B),i.interactive&&i.touchPitch&&c.touchPitch.enable(i.touchPitch);const V=()=>c.project(c.getCenter()),q=function({enable:be,clickTolerance:Me,aroundCenter:Pe=!0,minPixelCenterThreshold:Ce=100,rotateDegreesPerPixelMoved:Ne=.8},qe){const it=new At({checkCorrectEvent:tt=>F.mouseButton(tt)===0&&tt.ctrlKey||F.mouseButton(tt)===2&&!tt.ctrlKey});return new wr({clickTolerance:Me,move:(tt,et)=>{const wt=qe();if(Pe&&Math.abs(wt.y-tt.y)>Ce)return{bearingDelta:a.cc(new a.P(tt.x,et.y),et,wt)};let vt=(et.x-tt.x)*Ne;return Pe&&et.y<wt.y&&(vt=-vt),{bearingDelta:vt}},moveStateManager:it,enable:be,assignEvents:wc})}(i,V),H=function({enable:be,clickTolerance:Me,pitchDegreesPerPixelMoved:Pe=-.5}){const Ce=new At({checkCorrectEvent:Ne=>F.mouseButton(Ne)===0&&Ne.ctrlKey||F.mouseButton(Ne)===2});return new wr({clickTolerance:Me,move:(Ne,qe)=>({pitchDelta:(qe.y-Ne.y)*Pe}),moveStateManager:Ce,enable:be,assignEvents:wc})}(i),W=function({enable:be,clickTolerance:Me,rollDegreesPerPixelMoved:Pe=.3},Ce){const Ne=new At({checkCorrectEvent:qe=>F.mouseButton(qe)===2&&qe.ctrlKey});return new wr({clickTolerance:Me,move:(qe,it)=>{const tt=Ce();let et=(it.x-qe.x)*Pe;return it.y<tt.y&&(et=-et),{rollDelta:et}},moveStateManager:Ne,enable:be,assignEvents:wc})}(i,V);c.dragRotate=new Rl(i,q,H,W),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",H,["mouseRotate","mouseRoll"]),this._add("mouseRoll",W,["mousePitch"]),i.interactive&&i.dragRotate&&c.dragRotate.enable();const Y=function({enable:be,clickTolerance:Me}){const Pe=new At({checkCorrectEvent:Ce=>F.mouseButton(Ce)===0&&!Ce.ctrlKey});return new wr({clickTolerance:Me,move:(Ce,Ne)=>({around:Ne,panDelta:Ne.sub(Ce)}),activateOnStart:!0,moveStateManager:Pe,enable:be,assignEvents:wc})}(i),ue=new Su(i,c);c.dragPan=new Hi(g,Y,ue),this._add("mousePan",Y),this._add("touchPan",ue,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&c.dragPan.enable(i.dragPan);const ce=new Ha,he=new Ol;c.touchZoomRotate=new ro(g,he,ce,R),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",he,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&c.touchZoomRotate.enable(i.touchZoomRotate);const de=c.scrollZoom=new Dl(c,()=>this._triggerRenderFrame());this._add("scrollZoom",de,["mousePan"]),i.interactive&&i.scrollZoom&&c.scrollZoom.enable(i.scrollZoom);const _e=c.keyboard=new Mu(c);this._add("keyboard",_e),i.interactive&&i.keyboard&&c.keyboard.enable(),this._add("blockableMapEvent",new io(c))}_add(i,c,g){this._handlers.push({handlerName:i,handler:c,allowed:g}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ia(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,c,g){for(const _ in i)if(_!==g&&(!c||c.indexOf(_)<0))return!0;return!1}_getMapTouches(i){const c=[];for(const g of i)this._el.contains(g.target)&&c.push(g);return c}mergeHandlerResult(i,c,g,_,S){if(!g)return;a.e(i,g);const C={handlerName:_,originalEvent:g.originalEvent||S};g.zoomDelta!==void 0&&(c.zoom=C),g.panDelta!==void 0&&(c.drag=C),g.rollDelta!==void 0&&(c.roll=C),g.pitchDelta!==void 0&&(c.pitch=C),g.bearingDelta!==void 0&&(c.rotate=C)}_applyChanges(){const i={},c={},g={};for(const[_,S,C]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.rollDelta&&(i.rollDelta=(i.rollDelta||0)+_.rollDelta),_.around!==void 0&&(i.around=_.around),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),a.e(c,S),a.e(g,C);this._updateMapTransform(i,c,g),this._changes=[]}_updateMapTransform(i,c,g){const _=this._map,S=_._getTransformForUpdate(),C=_.terrain;if(!(Au(i)||C&&this._terrainMovement))return this._fireEvents(c,g,!0);_._stop(!0);let{panDelta:O,zoomDelta:R,bearingDelta:B,pitchDelta:V,rollDelta:q,around:H,pinchAround:W}=i;W!==void 0&&(H=W),H=H||_.transform.centerPoint,C&&!S.isPointOnMapSurface(H)&&(H=S.centerPoint);const Y={panDelta:O,zoomDelta:R,rollDelta:q,pitchDelta:V,bearingDelta:B,around:H};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(H)&&(H=S.centerPoint);const ue=H.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(O?H.sub(O):H);C?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Y,S),this._terrainMovement||!c.drag&&!c.zoom?c.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(O))):this._map.cameraHelper.handleMapControlsPan(Y,S,ue):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Y,S,ue))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Y,S),this._map.cameraHelper.handleMapControlsPan(Y,S,ue)),_._applyUpdatedTransform(S),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,g,!0)}_fireEvents(i,c,g){const _=ia(this._eventsInProgress),S=ia(i),C={};for(const q in i){const{originalEvent:H}=i[q];this._eventsInProgress[q]||(C[`${q}start`]=H),this._eventsInProgress[q]=i[q]}!_&&S&&this._fireEvent("movestart",S.originalEvent);for(const q in C)this._fireEvent(q,C[q]);S&&this._fireEvent("move",S.originalEvent);for(const q in i){const{originalEvent:H}=i[q];this._fireEvent(q,H)}const O={};let R;for(const q in this._eventsInProgress){const{handlerName:H,originalEvent:W}=this._eventsInProgress[q];this._handlersById[H].isActive()||(delete this._eventsInProgress[q],R=c[H]||W,O[`${q}end`]=R)}for(const q in O)this._fireEvent(q,O[q]);const B=ia(this._eventsInProgress),V=(_||S)&&!B;if(V&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const q=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&q.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(q)}if(g&&V){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;!q||!q.essential&&j.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()):(H(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:R})),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new a.l(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Ih("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Za extends a.E{constructor(i,c,g){super(),this._renderFrameCallback=()=>{const _=Math.min((j.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=g.bearingSnap,this.cameraHelper=c,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(i,c){i.apply(this.transform),this.transform=i,this.cameraHelper=c}getCenter(){return new a.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}getCenterElevation(){return this.transform.elevation}setCenterElevation(i,c){return this.jumpTo({elevation:i},c),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(i){this._centerClampedToGround=i}panBy(i,c,g){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,a.e({offset:i},c),g)}panTo(i,c,g){return this.easeTo(a.e({center:i},c),g)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,g){return this.easeTo(a.e({zoom:i},c),g)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(i,c){return i!=this.transform.fov&&(this.transform.setFov(i),this.fire(new a.l("movestart",c)).fire(new a.l("move",c)).fire(new a.l("moveend",c))),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,g){return this.easeTo(a.e({bearing:i},c),g)}resetNorth(i,c){return this.rotateTo(0,a.e({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}getRoll(){return this.transform.roll}setRoll(i,c){return this.jumpTo({roll:i},c),this}cameraForBounds(i,c){i=ji.convert(i).adjustAntiMeridian();const g=c&&c.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),g,c)}_cameraForBoxAndBearing(i,c,g,_){const S={top:0,bottom:0,right:0,left:0};if(typeof(_=a.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const B=_.padding;_.padding={top:B,bottom:B,right:B,left:B}}const C=a.e(S,_.padding);_.padding=C;const O=this.transform,R=new ji(i,c);return this.cameraHelper.cameraForBoxAndBearing(_,C,R,g,O)}fitBounds(i,c,g){return this._fitInternal(this.cameraForBounds(i,c),c,g)}fitScreenCoordinates(i,c,g,_,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(i)),this.transform.screenPointToLocation(a.P.convert(c)),g,_),_,S)}_fitInternal(i,c,g){return i?(delete(c=a.e(i,c)).padding,c.linear?this.easeTo(c,g):this.flyTo(c,g)):this}jumpTo(i,c){this.stop();const g=this._getTransformForUpdate();let _=!1,S=!1,C=!1;const O=g.zoom;this.cameraHelper.handleJumpToCenterZoom(g,i);const R=g.zoom!==O;return"elevation"in i&&g.elevation!==+i.elevation&&g.setElevation(+i.elevation),"bearing"in i&&g.bearing!==+i.bearing&&(_=!0,g.setBearing(+i.bearing)),"pitch"in i&&g.pitch!==+i.pitch&&(S=!0,g.setPitch(+i.pitch)),"roll"in i&&g.roll!==+i.roll&&(C=!0,g.setRoll(+i.roll)),i.padding==null||g.isPaddingEqual(i.padding)||g.setPadding(i.padding),this._applyUpdatedTransform(g),this.fire(new a.l("movestart",c)).fire(new a.l("move",c)),R&&this.fire(new a.l("zoomstart",c)).fire(new a.l("zoom",c)).fire(new a.l("zoomend",c)),_&&this.fire(new a.l("rotatestart",c)).fire(new a.l("rotate",c)).fire(new a.l("rotateend",c)),S&&this.fire(new a.l("pitchstart",c)).fire(new a.l("pitch",c)).fire(new a.l("pitchend",c)),C&&this.fire(new a.l("rollstart",c)).fire(new a.l("roll",c)).fire(new a.l("rollend",c)),this.fire(new a.l("moveend",c))}calculateCameraOptionsFromTo(i,c,g,_=0){const S=a.$.fromLngLat(i,c),C=a.$.fromLngLat(g,_),O=C.x-S.x,R=C.y-S.y,B=C.z-S.z,V=Math.hypot(O,R,B);if(V===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(O,R),H=a.ah(this.transform.cameraToCenterDistance/V/this.transform.tileSize),W=180*Math.atan2(O,-R)/Math.PI;let Y=180*Math.acos(q/V)/Math.PI;return Y=B<0?90-Y:90+Y,{center:C.toLngLat(),elevation:_,zoom:H,pitch:Y,bearing:W}}calculateCameraOptionsFromCameraLngLatAltRotation(i,c,g,_,S){const C=this.transform.calculateCenterFromCameraLngLatAlt(i,c,g,_);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:g,pitch:_,roll:S}}easeTo(i,c){this._stop(!1,i.easeId),((i=a.e({offset:[0,0],duration:500,easing:a.cd},i)).animate===!1||!i.essential&&j.prefersReducedMotion)&&(i.duration=0);const g=this._getTransformForUpdate(),_=this.getBearing(),S=g.pitch,C=g.roll,O="bearing"in i?this._normalizeBearing(i.bearing,_):_,R="pitch"in i?+i.pitch:S,B="roll"in i?this._normalizeBearing(i.roll,C):C,V="padding"in i?i.padding:g.padding,q=a.P.convert(i.offset);let H,W;i.around&&(H=a.Q.convert(i.around),W=g.locationToScreenPoint(H));const Y={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ue=this.cameraHelper.handleEaseTo(g,{bearing:O,pitch:R,roll:B,padding:V,around:H,aroundPoint:W,offsetAsPoint:q,offset:i.offset,zoom:i.zoom,center:i.center});return this._rotating=this._rotating||_!==O,this._pitching=this._pitching||R!==S,this._rolling=this._rolling||B!==C,this._padding=!g.isPaddingEqual(V),this._zooming=this._zooming||ue.isZooming,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,Y),this.terrain&&this._prepareElevation(ue.elevationCenter),this._ease(ce=>{ue.easeFunc(ce),this.terrain&&!i.freezeElevation&&this._updateElevation(ce),this._applyUpdatedTransform(g),this._fireMoveEvents(c)},ce=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(c,ce)},i),this}_prepareEase(i,c,g={}){this._moving=!0,c||g.moving||this.fire(new a.l("movestart",i)),this._zooming&&!g.zooming&&this.fire(new a.l("zoomstart",i)),this._rotating&&!g.rotating&&this.fire(new a.l("rotatestart",i)),this._pitching&&!g.pitching&&this.fire(new a.l("pitchstart",i)),this._rolling&&!g.rolling&&this.fire(new a.l("rollstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const c=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&c!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(g-(c-(g*i+this._elevationStart))/(1-i)),this._elevationTarget=c}this.transform.setElevation(a.B.number(this._elevationStart,this._elevationTarget,i))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){if(!this.terrain&&i.elevation>=0&&i.pitch<=90)return{};const c=i.getCameraLngLat(),g=i.getCameraAltitude(),_=this.terrain?this.terrain.getElevationForLngLatZoom(c,i.zoom):0;if(g<_){const S=this.calculateCameraOptionsFromTo(c,_,i.center,i.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(i){const c=[];if(c.push(_=>this._elevateCameraIfInsideTerrain(_)),this.transformCameraUpdate&&c.push(_=>this.transformCameraUpdate(_)),!c.length)return;const g=i.clone();for(const _ of c){const S=g.clone(),{center:C,zoom:O,roll:R,pitch:B,bearing:V,elevation:q}=_(S);C&&S.setCenter(C),q!==void 0&&S.setElevation(q),O!==void 0&&S.setZoom(O),R!==void 0&&S.setRoll(R),B!==void 0&&S.setPitch(B),V!==void 0&&S.setBearing(V),g.apply(S)}this.transform.apply(g)}_fireMoveEvents(i){this.fire(new a.l("move",i)),this._zooming&&this.fire(new a.l("zoom",i)),this._rotating&&this.fire(new a.l("rotate",i)),this._pitching&&this.fire(new a.l("pitch",i)),this._rolling&&this.fire(new a.l("roll",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const g=this._zooming,_=this._rotating,S=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,g&&this.fire(new a.l("zoomend",i)),_&&this.fire(new a.l("rotateend",i)),S&&this.fire(new a.l("pitchend",i)),C&&this.fire(new a.l("rollend",i)),this.fire(new a.l("moveend",i))}flyTo(i,c){if(!i.essential&&j.prefersReducedMotion){const et=a.O(i,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(et,c)}this.stop(),i=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cd},i);const g=this._getTransformForUpdate(),_=g.bearing,S=g.pitch,C=g.roll,O=g.padding,R="bearing"in i?this._normalizeBearing(i.bearing,_):_,B="pitch"in i?+i.pitch:S,V="roll"in i?this._normalizeBearing(i.roll,C):C,q="padding"in i?i.padding:g.padding,H=a.P.convert(i.offset);let W=g.centerPoint.add(H);const Y=g.screenPointToLocation(W),ue=this.cameraHelper.handleFlyTo(g,{bearing:R,pitch:B,roll:V,padding:q,locationAtOffset:Y,offsetAsPoint:H,center:i.center,minZoom:i.minZoom,zoom:i.zoom});let ce=i.curve;const he=Math.max(g.width,g.height),de=he/ue.scaleOfZoom,_e=ue.pixelPathLength;typeof ue.scaleOfMinZoom=="number"&&(ce=Math.sqrt(he/ue.scaleOfMinZoom/_e*2));const be=ce*ce;function Me(et){const wt=(de*de-he*he+(et?-1:1)*be*be*_e*_e)/(2*(et?de:he)*be*_e);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Pe(et){return(Math.exp(et)-Math.exp(-et))/2}function Ce(et){return(Math.exp(et)+Math.exp(-et))/2}const Ne=Me(!1);let qe=function(et){return Ce(Ne)/Ce(Ne+ce*et)},it=function(et){return he*((Ce(Ne)*(Pe(wt=Ne+ce*et)/Ce(wt))-Pe(Ne))/be)/_e;var wt},tt=(Me(!0)-Ne)/ce;if(Math.abs(_e)<2e-6||!isFinite(tt)){if(Math.abs(he-de)<1e-6)return this.easeTo(i,c);const et=de<he?-1:1;tt=Math.abs(Math.log(de/he))/ce,it=()=>0,qe=wt=>Math.exp(et*ce*wt)}return i.duration="duration"in i?+i.duration:1e3*tt/("screenSpeed"in i?+i.screenSpeed/ce:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=_!==R,this._pitching=B!==S,this._rolling=V!==C,this._padding=!g.isPaddingEqual(q),this._prepareEase(c,!1),this.terrain&&this._prepareElevation(ue.targetCenter),this._ease(et=>{const wt=et*tt,vt=1/qe(wt),rt=it(wt);this._rotating&&g.setBearing(a.B.number(_,R,et)),this._pitching&&g.setPitch(a.B.number(S,B,et)),this._rolling&&g.setRoll(a.B.number(C,V,et)),this._padding&&(g.interpolatePadding(O,q,et),W=g.centerPoint.add(H)),ue.easeFunc(et,vt,rt,W),this.terrain&&!i.freezeElevation&&this._updateElevation(et),this._applyUpdatedTransform(g),this._fireMoveEvents(c)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(c)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,c){var g;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,c)}return i||(g=this.handlers)===null||g===void 0||g.stop(!1),this}_ease(i,c,g){g.animate===!1||g.duration===0?(i(1),c()):(this._easeStart=j.now(),this._easeOptions=g,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,c){i=a.aL(i,-180,180);const g=Math.abs(i-c);return Math.abs(i-360-c)<g&&(i-=360),Math.abs(i+360-c)<g&&(i+=360),i}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(a.Q.convert(i),this.transform.tileZoom):null}}const jt={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Yt{constructor(i=jt){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=c=>{!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"&&c.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=F.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=F.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,c){const g=this._map._getUIString(`AttributionControl.${c}`);i.title=g,i.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const c=this._map.style.sourceCaches;for(const _ in c){const S=c[_];if(S.used||S.usedForTerrain){const C=S.getSource();C.attribution&&i.indexOf(C.attribution)<0&&i.push(C.attribution)}}i=i.filter(_=>String(_).trim()),i.sort((_,S)=>_.length-S.length),i=i.filter((_,S)=>{for(let C=S+1;C<i.length;C++)if(i[C].indexOf(_)>=0)return!1;return!0});const g=i.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,i.length?(this._innerContainer.innerHTML=F.sanitize(g),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Po{constructor(i={}){this._updateCompact=()=>{const c=this._container.children;if(c.length){const g=c[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=F.create("div","maplibregl-ctrl");const c=F.create("a","maplibregl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){F.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const _ of g)if(_.id===i)return void(_.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zh=a.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Bs extends a.E{constructor(i){super(),this._lastTilesetChange=j.now(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=i._source.tileSize*2**this.deltaZoom,i.usedForTerrain=!0,i.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,c){this.sourceCache.update(i,c),this._renderableTilesKeys=[];const g={};for(const _ of Te(i,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))g[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.terrainRttPosMatrix32f=new Float64Array(16),a.bQ(_.terrainRttPosMatrix32f,0,a.Z,a.Z,0,0,1),this._tiles[_.key]=new Yn(_,this.tileSize),this._lastTilesetChange=j.now());for(const _ in this._tiles)g[_]||delete this._tiles[_]}freeRtt(i){for(const c in this._tiles){const g=this._tiles[c];(!i||g.tileID.equals(i)||g.tileID.isChildOf(i)||i.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i,c){return c?this._getTerrainCoordsForTileRanges(i,c):this._getTerrainCoordsForRegularTile(i)}_getTerrainCoordsForRegularTile(i){const c={};for(const g of this._renderableTilesKeys){const _=this._tiles[g].tileID,S=i.clone(),C=a.b2();if(_.canonical.equals(i.canonical))a.bQ(C,0,a.Z,a.Z,0,0,1);else if(_.canonical.isChildOf(i.canonical)){const O=_.canonical.z-i.canonical.z,R=_.canonical.x-(_.canonical.x>>O<<O),B=_.canonical.y-(_.canonical.y>>O<<O),V=a.Z>>O;a.bQ(C,0,V,V,0,0,1),a.L(C,C,[-R*V,-B*V,0])}else{if(!i.canonical.isChildOf(_.canonical))continue;{const O=i.canonical.z-_.canonical.z,R=i.canonical.x-(i.canonical.x>>O<<O),B=i.canonical.y-(i.canonical.y>>O<<O),V=a.Z>>O;a.bQ(C,0,a.Z,a.Z,0,0,1),a.L(C,C,[R*V,B*V,0]),a.M(C,C,[1/2**O,1/2**O,0])}}S.terrainRttPosMatrix32f=new Float32Array(C),c[g]=S}return c}_getTerrainCoordsForTileRanges(i,c){const g={};for(const _ of this._renderableTilesKeys){const S=this._tiles[_].tileID;if(!this._isWithinTileRanges(S,c))continue;const C=i.clone(),O=a.b2();if(S.canonical.z===i.canonical.z){const R=i.canonical.x-S.canonical.x,B=i.canonical.y-S.canonical.y;a.bQ(O,0,a.Z,a.Z,0,0,1),a.L(O,O,[R*a.Z,B*a.Z,0])}else if(S.canonical.z>i.canonical.z){const R=S.canonical.z-i.canonical.z,B=S.canonical.x-(S.canonical.x>>R<<R),V=S.canonical.y-(S.canonical.y>>R<<R),q=i.canonical.x-(S.canonical.x>>R),H=i.canonical.y-(S.canonical.y>>R),W=a.Z>>R;a.bQ(O,0,W,W,0,0,1),a.L(O,O,[-B*W+q*a.Z,-V*W+H*a.Z,0])}else{const R=i.canonical.z-S.canonical.z,B=i.canonical.x-(i.canonical.x>>R<<R),V=i.canonical.y-(i.canonical.y>>R<<R),q=(i.canonical.x>>R)-S.canonical.x,H=(i.canonical.y>>R)-S.canonical.y,W=a.Z<<R;a.bQ(O,0,W,W,0,0,1),a.L(O,O,[B*a.Z+q*W,V*a.Z+H*W,0])}C.terrainRttPosMatrix32f=new Float32Array(O),g[_]=C}return g}getSourceTile(i,c){const g=this.sourceCache._source;let _=i.overscaledZ-this.deltaZoom;if(_>g.maxzoom&&(_=g.maxzoom),_<g.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(_).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!S||!S.dem)&&c)for(;_>=g.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(i.scaledTo(_--).key);return S}anyTilesAfterTime(i=Date.now()){return this._lastTilesetChange>=i}_isWithinTileRanges(i,c){return c[i.canonical.z]&&i.canonical.x>=c[i.canonical.z].minTileX&&i.canonical.x<=c[i.canonical.z].maxTileX&&i.canonical.y>=c[i.canonical.z].minTileY&&i.canonical.y<=c[i.canonical.z].maxTileY}}class Lh{constructor(i,c,g){this._meshCache={},this.painter=i,this.sourceCache=new Bs(c),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,c,g,_=a.Z){var S;if(!(c>=0&&c<_&&g>=0&&g<_))return 0;const C=this.getTerrainData(i),O=(S=C.tile)===null||S===void 0?void 0:S.dem;if(!O)return 0;const R=a.ch([],[c/_*a.Z,g/_*a.Z],C.u_terrain_matrix),B=[R[0]*O.dim,R[1]*O.dim],V=Math.floor(B[0]),q=Math.floor(B[1]),H=B[0]-V,W=B[1]-q;return O.get(V,q)*(1-H)*(1-W)+O.get(V+1,q)*H*(1-W)+O.get(V,q+1)*(1-H)*W+O.get(V+1,q+1)*H*W}getElevationForLngLatZoom(i,c){if(!a.ci(c,i.wrap()))return 0;const{tileID:g,mercatorX:_,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(i,c);return this.getElevation(g,_%a.Z,S%a.Z,a.Z)}getElevation(i,c,g,_=a.Z){return this.getDEMElevation(i,c,g,_)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const _=this.painter.context,S=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new He(_,S,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new He(_,new a.R({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ad([])}const c=this.sourceCache.getSourceTile(i,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const _=this.painter.context;c.demTexture=this.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new He(_,c.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),c.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const g=c&&c+c.tileID.key+i.key;if(g&&!this._demMatrixCache[g]){const _=this.sourceCache.sourceCache._source.maxzoom;let S=i.canonical.z-c.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=_?S=i.canonical.z-_:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=i.canonical.x-(i.canonical.x>>S<<S),O=i.canonical.y-(i.canonical.y>>S<<S),R=a.cj(new Float64Array(16),[1/(a.Z<<S),1/(a.Z<<S),0]);a.L(R,R,[C*a.Z,O*a.Z,0]),this._demMatrixCache[i.key]={matrix:R,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getFramebuffer(i){const c=this.painter,g=c.width/devicePixelRatio,_=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new He(c.context,{width:g,height:_,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new He(c.context,{width:g,height:_,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(g,_,!0,!1),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,g,_))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,C=0;S<this._coordsTextureSize;S++)for(let O=0;O<this._coordsTextureSize;O++,C+=4)c[C+0]=255&O,c[C+1]=255&S,c[C+2]=O>>8<<4|S>>8,c[C+3]=0;const g=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),_=new He(i,g,i.gl.RGBA,{premultiply:!1});return _.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const c=new Uint8Array(4),g=this.painter.context,_=g.gl,S=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),O=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(S,O-C-1,1,1,_.RGBA,_.UNSIGNED_BYTE,c),g.bindFramebuffer.set(null);const R=c[0]+(c[2]>>4<<8),B=c[1]+((15&c[2])<<8),V=this.coordsIndex[255-c[3]],q=V&&this.sourceCache.getTileByID(V);if(!q)return null;const H=this._coordsTextureSize,W=(1<<q.tileID.canonical.z)*H;return new a.$((q.tileID.canonical.x*H+R)/W+q.tileID.wrap,(q.tileID.canonical.y*H+B)/W,this.getElevation(q.tileID,R,B,H))}depthAtPoint(i){const c=new Uint8Array(4),g=this.painter.context,_=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),_.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,c),g.bindFramebuffer.set(null),(c[0]/16777216+c[1]/65536+c[2]/256+c[3])/256}getTerrainMesh(i){var c;const g=((c=this.painter.style.projection)===null||c===void 0?void 0:c.transitionState)>0,_=g&&i.canonical.y===0,S=g&&i.canonical.y===(1<<i.canonical.z)-1,C=`m_${_?"n":""}_${S?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const O=this.painter.context,R=new a.ck,B=new a.aK,V=this.meshSize,q=a.Z/V,H=V*V;for(let Ce=0;Ce<=V;Ce++)for(let Ne=0;Ne<=V;Ne++)R.emplaceBack(Ne*q,Ce*q,0);for(let Ce=0;Ce<H;Ce+=V+1)for(let Ne=0;Ne<V;Ne++)B.emplaceBack(Ne+Ce,V+Ne+Ce+1,V+Ne+Ce+2),B.emplaceBack(Ne+Ce,V+Ne+Ce+2,Ne+Ce+1);const W=R.length,Y=W+(V+1),ue=(V+1)*V,ce=_?a.b9:0,he=_?0:1,de=S?a.ba:a.Z,_e=S?0:1;for(let Ce=0;Ce<=V;Ce++)R.emplaceBack(Ce*q,ce,he);for(let Ce=0;Ce<=V;Ce++)R.emplaceBack(Ce*q,de,_e);for(let Ce=0;Ce<V;Ce++)B.emplaceBack(ue+Ce,Y+Ce,Y+Ce+1),B.emplaceBack(ue+Ce,Y+Ce+1,ue+Ce+1),B.emplaceBack(0+Ce,W+Ce+1,W+Ce),B.emplaceBack(0+Ce,0+Ce+1,W+Ce+1);const be=R.length,Me=be+2*(V+1);for(const Ce of[0,1])for(let Ne=0;Ne<=V;Ne++)for(const qe of[0,1])R.emplaceBack(Ce*a.Z,Ne*q,qe);for(let Ce=0;Ce<2*V;Ce+=2)B.emplaceBack(be+Ce,be+Ce+1,be+Ce+3),B.emplaceBack(be+Ce,be+Ce+3,be+Ce+2),B.emplaceBack(Me+Ce,Me+Ce+3,Me+Ce+1),B.emplaceBack(Me+Ce,Me+Ce+2,Me+Ce+3);const Pe=new bl(O.createVertexBuffer(R,zh.members),O.createIndexBuffer(B),a.aJ.simpleSegment(0,0,R.length,B.length));return this._meshCache[C]=Pe,Pe}getMeshFrameDelta(i){return 2*Math.PI*a.bu/Math.pow(2,Math.max(i,0))/5}getMinTileElevationForLngLatZoom(i,c){var g;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(i,c);return(g=this.getMinMaxElevation(_).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(i){const c=this.getTerrainData(i).tile,g={minElevation:null,maxElevation:null};return c&&c.dem&&(g.minElevation=c.dem.min*this.exaggeration,g.maxElevation=c.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(i,c){const g=a.$.fromLngLat(i.wrap()),_=(1<<c)*a.Z,S=g.x*_,C=g.y*_,O=Math.floor(S/a.Z),R=Math.floor(C/a.Z);return{tileID:new a.Y(c,0,c,O,R),mercatorX:S,mercatorY:C}}}class ws{constructor(i,c,g){this._context=i,this._size=c,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const c=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new He(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),c.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),c.colorAttachment.set(g.texture),{id:i,fbo:c,texture:g,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(c=>i.id!==c),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const c of this._recentlyUsed)if(!this._objects[c].inUse)return this._objects[c];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const ui={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ri{constructor(i,c){this.painter=i,this.terrain=c,this.pool=new ws(i.context,30,c.sourceCache.tileSize*c.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,c){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(g=>!i._layers[g].isHidden(c)),this._coordsAscending={};for(const g in i.sourceCaches){this._coordsAscending[g]={};const _=i.sourceCaches[g].getVisibleCoordinates(),S=i.sourceCaches[g].getSource(),C=S instanceof tr?S.terrainTileRanges:null;for(const O of _){const R=this.terrain.sourceCache.getTerrainCoords(O,C);for(const B in R)this._coordsAscending[g][B]||(this._coordsAscending[g][B]=[]),this._coordsAscending[g][B].push(R[B])}}this._coordsAscendingStr={};for(const g of i._order){const _=i._layers[g],S=_.source;if(ui[_.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const C in this._coordsAscending[S])this._coordsAscendingStr[S][C]=this._coordsAscending[S][C].map(O=>O.key).sort().join()}}for(const g of this._renderableTiles)for(const _ in this._coordsAscendingStr){const S=this._coordsAscendingStr[_][g.tileID.key];S&&S!==g.rttCoords[_]&&(g.rtt=[])}}renderLayer(i,c){if(i.isHidden(this.painter.transform.zoom))return!1;const g=Object.assign(Object.assign({},c),{isRenderingToTexture:!0}),_=i.type,S=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(ui[_]&&(this._prevType&&ui[this._prevType]||this._stacks.push([]),this._prevType=_,this._stacks[this._stacks.length-1].push(i.id),!C))return!0;if(ui[this._prevType]||ui[_]&&C){this._prevType=_;const O=this._stacks.length-1,R=this._stacks[O]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(Ah(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[O]){const q=this.pool.getObjectForId(B.rtt[O].id);if(q.stamp===B.rtt[O].stamp){this.pool.useObject(q);continue}}const V=this.pool.getOrCreateFreeObject();this.pool.useObject(V),this.pool.stampObject(V),B.rtt[O]={id:V.id,stamp:V.stamp},S.context.bindFramebuffer.set(V.fbo.framebuffer),S.context.clear({color:a.b7.transparent,stencil:0}),S.currentStencilSource=void 0;for(let q=0;q<R.length;q++){const H=S.style._layers[R[q]],W=H.source?this._coordsAscending[H.source][B.tileID.key]:[B.tileID];S.context.viewport.set([0,0,V.fbo.width,V.fbo.height]),S._renderTileClippingMasks(H,W,!0),S.renderLayer(S,S.style.sourceCaches[H.source],H,W,g),H.source&&(B.rttCoords[H.source]=this._coordsAscendingStr[H.source][B.tileID.key])}}return Ah(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects(),ui[_]}return!1}}const pi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},_n=v,Ga={hash:!1,interactive:!0,bearingSnap:7,attributionControl:jt,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},oo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Il{constructor(i,c,g=!1){this.mousedown=S=>{this.startMove(S,F.mousePos(this.element,S)),F.addEventListener(window,"mousemove",this.mousemove),F.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,F.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHanlder.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),F.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=c;const _=new ed;this._rotatePitchHanlder=new wr({clickTolerance:3,move:(S,C)=>{const O=c.getBoundingClientRect(),R=new a.P((O.bottom-O.top)/2,(O.right-O.left)/2);return{bearingDelta:a.cc(new a.P(S.x,C.y),C,R),pitchDelta:g?-.5*(C.y-S.y):void 0}},moveStateManager:_,enable:!0,assignEvents:()=>{}}),this.map=i,F.addEventListener(c,"mousedown",this.mousedown),F.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(c,"touchcancel",this.reset)}startMove(i,c){this._rotatePitchHanlder.dragStart(i,c),F.disableDrag()}move(i,c){const g=this.map,{bearingDelta:_,pitchDelta:S}=this._rotatePitchHanlder.dragMove(i,c)||{};_&&g.setBearing(g.getBearing()+_),S&&g.setPitch(g.getPitch()+S)}off(){const i=this.element;F.removeEventListener(i,"mousedown",this.mousedown),F.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend),F.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){F.enableDrag(),F.removeEventListener(window,"mousemove",this.mousemove),F.removeEventListener(window,"mouseup",this.mouseup),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend)}}let Sr;function na(x,i,c,g=!1){if(g||!c.getCoveringTilesDetailsProvider().allowWorldCopies())return x==null?void 0:x.wrap();const _=new a.Q(x.lng,x.lat);if(x=new a.Q(x.lng,x.lat),i){const S=new a.Q(x.lng-360,x.lat),C=new a.Q(x.lng+360,x.lat),O=c.locationToScreenPoint(x).distSqr(i);c.locationToScreenPoint(S).distSqr(i)<O?x=S:c.locationToScreenPoint(C).distSqr(i)<O&&(x=C)}for(;Math.abs(x.lng-c.center.lng)>180;){const S=c.locationToScreenPoint(x);if(S.x>=0&&S.y>=0&&S.x<=c.width&&S.y<=c.height)break;x.lng>c.center.lng?x.lng-=360:x.lng+=360}return x.lng!==_.lng&&c.isPointOnMapSurface(c.locationToScreenPoint(x))?x:_}const ku={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ln(x,i,c){const g=x.classList;for(const _ in ku)g.remove(`maplibregl-${c}-anchor-${_}`);g.add(`maplibregl-${c}-anchor-${i}`)}class zl extends a.E{constructor(i){if(super(),this._onKeyPress=c=>{const g=c.code,_=c.charCode||c.keyCode;g!=="Space"&&g!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=c=>{const g=c.originalEvent.target,_=this._element;this._popup&&(g===_||_.contains(g))&&this.togglePopup()},this._update=c=>{if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((c==null?void 0:c.type)==="terrain"||(c==null?void 0:c.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=na(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||c&&c.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,`${ku[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${_}`),j.frameAsync(new AbortController).then(()=>{this._updateOpacity(c&&c.type==="moveend")}).catch(()=>{})},this._onMove=c=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=c=>{this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div");const c=F.createNS("http://www.w3.org/2000/svg","svg"),g=41,_=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${g}px`),c.setAttributeNS(null,"width",`${_}px`),c.setAttributeNS(null,"viewBox",`0 0 ${_} ${g}`);const S=F.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const C=F.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const O=F.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const he of R){const de=F.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",he.rx),de.setAttributeNS(null,"ry",he.ry),O.appendChild(de)}const B=F.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const V=F.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(V);const q=F.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const H=F.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(H);const W=F.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(6.0, 7.0)"),W.setAttributeNS(null,"fill","#FFFFFF");const Y=F.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ue=F.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#000000"),ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962");const ce=F.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),Y.appendChild(ue),Y.appendChild(ce),C.appendChild(O),C.appendChild(B),C.appendChild(q),C.appendChild(W),C.appendChild(Y),c.appendChild(C),c.setAttributeNS(null,"height",g*this._scale+"px"),c.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(c),this._offset=a.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),ln(this._element,this._anchor,"marker"),i&&i.className)for(const c of i.className.split(" "))this._element.classList.add(c);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),i.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.Q.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const _=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var c,g;if(!(!((c=this._map)===null||c===void 0)&&c.terrain)){const q=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,S=_.terrain.depthAtPoint(this._pos),C=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,C)-S<.006)return void(this._element.style.opacity=this._opacity);const O=-this._offset.y/_.transform.pixelsPerMeter,R=Math.sin(_.getPitch()*Math.PI/180)*O,B=_.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),V=_.transform.lngLatToCameraDepth(this._lngLat,C+R)-B>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,c){return(this._opacity===void 0||i===void 0&&c===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),c!==void 0&&(this._opacityWhenCovered=c),this._map&&this._updateOpacity(!0),this}}const Eu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ll=0,$a=!1;const sd={maxWidth:100,unit:"metric"};function Tc(x,i,c){const g=c&&c.maxWidth||100,_=x._container.clientHeight/2,S=x._container.clientWidth/2,C=x.unproject([S-g/2,_]),O=x.unproject([S+g/2,_]),R=Math.round(x.project(O).x-x.project(C).x),B=Math.min(g,R,x._container.clientWidth),V=C.distanceTo(O);if(c&&c.unit==="imperial"){const q=3.2808*V;q>5280?sa(i,B,q/5280,x._getUIString("ScaleControl.Miles")):sa(i,B,q,x._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?sa(i,B,V/1852,x._getUIString("ScaleControl.NauticalMiles")):V>=1e3?sa(i,B,V/1e3,x._getUIString("ScaleControl.Kilometers")):sa(i,B,V,x._getUIString("ScaleControl.Meters"))}function sa(x,i,c,g){const _=function(S){const C=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/C;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(O),C*O}(c);x.style.width=i*(_/c)+"px",x.innerHTML=`${_}&nbsp;${g}`}const Pu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Ss=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sn(x){if(x){if(typeof x=="number"){const i=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(i,i),"top-right":new a.P(-i,i),bottom:new a.P(0,-x),"bottom-left":new a.P(i,-i),"bottom-right":new a.P(-i,-i),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const i=a.P.convert(x);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return Sn(new a.P(0,0))}const Ou=v;d.AJAXError=a.co,d.Event=a.l,d.Evented=a.E,d.LngLat=a.Q,d.MercatorCoordinate=a.$,d.Point=a.P,d.addProtocol=a.cp,d.config=a.a,d.removeProtocol=a.cq,d.AttributionControl=Yt,d.BoxZoomHandler=cp,d.CanvasSource=pl,d.CooperativeGesturesHandler=Eo,d.DoubleClickZoomHandler=nd,d.DragPanHandler=Hi,d.DragRotateHandler=Rl,d.EdgeInsets=vl,d.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var i;let c=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=c==null?void 0:c.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)c=c.shadowRoot.fullscreenElement;c===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){F.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=F.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);F.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=sc,d.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",i)),this._finish()}},this._updateCamera=i=>{const c=new a.Q(i.coords.longitude,i.coords.latitude),g=i.coords.accuracy,_=this._map.getBearing(),S=a.e({bearing:_},this.options.fitBoundsOptions),C=ji.fromLngLat(c,g);this._map.fitBounds(C,S,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const c=new a.Q(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&$a)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=F.create("button","maplibregl-ctrl-geolocate",this._container),F.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new zl({element:this._dotElement}),this._circleElement=F.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},Eu,x)}onAdd(x){return this._map=x,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(i=!1){if(Sr!==void 0&&!i)return Sr;if(window.navigator.permissions===void 0)return Sr=!!window.navigator.geolocation,Sr;try{Sr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Sr=!!window.navigator.geolocation}return Sr})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ll=0,$a=!1}_isOutOfMapMaxBounds(x){const i=this._map.getMaxBounds(),c=x.coords;return i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),i=x.getSouthEast(),c=x.getNorthEast(),g=i.distanceTo(c),_=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ll--,$a=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ll++,Ll>1?(x={maximumAge:6e5,timeout:0},$a=!0):(x=this.options.positionOptions,$a=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;const i=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(i!=="mercator"&&i?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=F.create("button","maplibregl-ctrl-globe",this._container),F.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},d.Hash=Eh,d.ImageSource=tr,d.KeyboardHandler=Mu,d.LngLatBounds=ji,d.LogoControl=Po,d.Map=class extends Za{constructor(x){var i,c;a.cl.mark(a.cm.create);const g=Object.assign(Object.assign(Object.assign({},Ga),x),{canvasContextAttributes:Object.assign(Object.assign({},Ga.canvasContextAttributes),x.canvasContextAttributes)});if(g.minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const _=new or,S=new Fr;if(g.minZoom!==void 0&&_.setMinZoom(g.minZoom),g.maxZoom!==void 0&&_.setMaxZoom(g.maxZoom),g.minPitch!==void 0&&_.setMinPitch(g.minPitch),g.maxPitch!==void 0&&_.setMaxPitch(g.maxPitch),g.renderWorldCopies!==void 0&&_.setRenderWorldCopies(g.renderWorldCopies),super(_,S,{bearingSnap:g.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Sc,this._controls=[],this._mapId=a.a4(),this._contextLost=O=>{O.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:O}))},this._contextRestored=O=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:O}))},this._onMapScroll=O=>{if(O.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},g.canvasContextAttributes),this._trackResize=g.trackResize===!0,this._bearingSnap=g.bearingSnap,this._centerClampedToGround=g.centerClampedToGround,this._refreshExpiredTiles=g.refreshExpiredTiles===!0,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions===!0,this._collectResourceTiming=g.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},pi),g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this.transformCameraUpdate=g.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=g.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ze.addThrottleControl(()=>this.isMoving()),this._requestManager=new ke(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let O=!1;const R=El(B=>{this._trackResize&&!this._removed&&(this.resize(B),this.redraw())},50);this._resizeObserver=new ResizeObserver(B=>{O?R(B):O=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ur(this,g),this._hash=g.hash&&new Eh(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,roll:g.roll}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,a.e({},g.fitBoundsOptions,{duration:0}))));const C=typeof g.style=="string"||((c=(i=g.style)===null||i===void 0?void 0:i.projection)===null||c===void 0?void 0:c.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Yt(typeof g.attributionControl=="boolean"?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new Po,g.logoPosition),this.on("style.load",()=>{if(C||this._resizeTransform(),this.transform.unmodified){const O=a.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(O)}}),this.on("data",O=>{this._update(O.dataType==="style"),this.fire(new a.l(`${O.dataType}data`,O))}),this.on("dataloading",O=>{this.fire(new a.l(`${O.dataType}dataloading`,O))}),this.on("dataabort",O=>{this.fire(new a.l("sourcedataabort",O))})}_getMapId(){return this._mapId}addControl(x,i){if(i===void 0&&(i=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=x.onAdd(this);this._controls.push(x);const g=this._controlPositions[i];return i.indexOf("bottom")!==-1?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(x);return i>-1&&this._controls.splice(i,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,i,c,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,i,c,g)}resize(x,i=!0){const[c,g]=this._containerDimensions(),_=this._getClampedPixelRatio(c,g);if(this._resizeCanvas(c,g,_),this.painter.resize(c,g,_),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const O=this._getClampedPixelRatio(c,g);this._resizeCanvas(c,g,O),this.painter.resize(c,g,O)}this._resizeTransform(i);const S=!this._moving;return S&&(this.stop(),this.fire(new a.l("movestart",x)).fire(new a.l("move",x))),this.fire(new a.l("resize",x)),S&&this.fire(new a.l("moveend",x)),this}_resizeTransform(x=!0){var i;const[c,g]=this._containerDimensions();this.transform.resize(c,g,x),(i=this._requestedCameraState)===null||i===void 0||i.resize(c,g,x)}_getClampedPixelRatio(x,i){const{0:c,1:g}=this._maxCanvasSize,_=this.getPixelRatio(),S=x*_,C=i*_;return Math.min(S>c?c/S:1,C>g?g/C:1)*_}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(ji.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.setMinZoom(x),this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.setMaxZoom(x),this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.setMinPitch(x),this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch)return this.transform.setMaxPitch(x),this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}project(x){return this.transform.locationToScreenPoint(a.Q.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,i,c){if(x==="mouseenter"||x==="mouseover"){let g=!1;return{layers:i,listener:c,delegates:{mousemove:S=>{const C=i.filter(R=>this.getLayer(R)),O=C.length!==0?this.queryRenderedFeatures(S.point,{layers:C}):[];O.length?g||(g=!0,c.call(this,new xs(x,this,S.originalEvent,{features:O}))):g=!1},mouseout:()=>{g=!1}}}}if(x==="mouseleave"||x==="mouseout"){let g=!1;return{layers:i,listener:c,delegates:{mousemove:C=>{const O=i.filter(R=>this.getLayer(R));(O.length!==0?this.queryRenderedFeatures(C.point,{layers:O}):[]).length?g=!0:g&&(g=!1,c.call(this,new xs(x,this,C.originalEvent)))},mouseout:C=>{g&&(g=!1,c.call(this,new xs(x,this,C.originalEvent)))}}}}{const g=_=>{const S=i.filter(O=>this.getLayer(O)),C=S.length!==0?this.queryRenderedFeatures(_.point,{layers:S}):[];C.length&&(_.features=C,c.call(this,_),delete _.features)};return{layers:i,listener:c,delegates:{[x]:g}}}}_saveDelegatedListener(x,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(i)}_removeDelegatedListener(x,i,c){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const g=this._delegatedListeners[x];for(let _=0;_<g.length;_++){const S=g[_];if(S.listener===c&&S.layers.length===i.length&&S.layers.every(C=>i.includes(C))){for(const C in S.delegates)this.off(C,S.delegates[C]);return void g.splice(_,1)}}}on(x,i,c){if(c===void 0)return super.on(x,i);const g=typeof i=="string"?[i]:i,_=this._createDelegatedListener(x,g,c);this._saveDelegatedListener(x,_);for(const S in _.delegates)this.on(S,_.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(x,g,c)}}}once(x,i,c){if(c===void 0)return super.once(x,i);const g=typeof i=="string"?[i]:i,_=this._createDelegatedListener(x,g,c);for(const S in _.delegates){const C=_.delegates[S];_.delegates[S]=(...O)=>{this._removeDelegatedListener(x,g,c),C(...O)}}this._saveDelegatedListener(x,_);for(const S in _.delegates)this.once(S,_.delegates[S]);return this}off(x,i,c){return c===void 0?super.off(x,i):(this._removeDelegatedListener(x,typeof i=="string"?[i]:i,c),this)}queryRenderedFeatures(x,i){if(!this.style)return[];let c;const g=x instanceof a.P||Array.isArray(x),_=g?x:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(g?{}:x)||{},_ instanceof a.P||typeof _[0]=="number")c=[a.P.convert(_)];else{const S=a.P.convert(_[0]),C=a.P.convert(_[1]);c=[S,new a.P(C.x,S.y),C,new a.P(S.x,C.y),S]}return this.style.queryRenderedFeatures(c,i,this.transform)}querySourceFeatures(x,i){return this.style.querySourceFeatures(x,i)}setStyle(x,i){return(i=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(x,i))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const i=this._locale[x];if(i==null)throw new Error(`Missing UI string '${x}'`);return i}_updateStyle(x,i){var c,g;if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,i));const _=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new lu(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,i,_):this.style.loadJSON(x,i,_),this):((g=(c=this.style)===null||c===void 0?void 0:c.projection)===null||g===void 0||g.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new lu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,i){if(typeof x=="string"){const c=this._requestManager.transformRequest(x,"Style");a.j(c,new AbortController).then(g=>{this._updateDiff(g.data,i)}).catch(g=>{g&&this.fire(new a.k(g))})}else typeof x=="object"&&this._updateDiff(x,i)}_updateDiff(x,i){try{this.style.setState(x,i)&&this._update(!0)}catch(c){a.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(x,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,i){return this._lazyInitEmptyStyle(),this.style.addSource(x,i),this._update(!0)}isSourceLoaded(x){const i=this.style&&this.style.sourceCaches[x];if(i!==void 0)return i.loaded();this.fire(new a.k(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const i=this.style.sourceCaches[x.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&i.reload();for(const c in this.style._layers){const g=this.style._layers[c];g.type==="hillshade"&&g.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Lh(this.painter,i,x),this.painter.renderToTexture=new Ri(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=c=>{var g;c.dataType==="style"?this.terrain.sourceCache.freeRtt():c.dataType==="source"&&c.tile&&(c.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((g=c.source)===null||g===void 0?void 0:g.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(c.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:x})),this}getTerrain(){var x,i;return(i=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const i in x){const c=x[i]._tiles;for(const g in c){const _=c[g];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}setSourceTileLodParams(x,i,c){if(c){const g=this.getSource(c);if(!g)throw new Error(`There is no source with ID "${c}", cannot set LOD parameters`);g.calculateTileZoom=ne(Math.max(1,x),Math.max(1,i))}else for(const g in this.style.sourceCaches)this.style.sourceCaches[g].getSource().calculateTileZoom=ne(Math.max(1,x),Math.max(1,i));return this._update(!0),this}addImage(x,i,c={}){const{pixelRatio:g=1,sdf:_=!1,stretchX:S,stretchY:C,content:O,textFitWidth:R,textFitHeight:B}=c;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||a.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:V,height:q,data:H}=i,W=i;return this.style.addImage(x,{data:new a.R({width:V,height:q},new Uint8Array(H)),pixelRatio:g,stretchX:S,stretchY:C,content:O,textFitWidth:R,textFitHeight:B,sdf:_,version:0,userImage:W}),W.onAdd&&W.onAdd(this,x),this}}{const{width:V,height:q,data:H}=j.getImageData(i);this.style.addImage(x,{data:new a.R({width:V,height:q},H),pixelRatio:g,stretchX:S,stretchY:C,content:O,textFitWidth:R,textFitHeight:B,sdf:_,version:0})}}updateImage(x,i){const c=this.style.getImage(x);if(!c)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=i instanceof HTMLImageElement||a.b(i)?j.getImageData(i):i,{width:_,height:S,data:C}=g;if(_===void 0||S===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==c.data.width||S!==c.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(i instanceof HTMLImageElement||a.b(i));return c.data.replace(C,O),this.style.updateImage(x,c),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return ze.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,i){return this._lazyInitEmptyStyle(),this.style.addLayer(x,i),this._update(!0)}moveLayer(x,i){return this.style.moveLayer(x,i),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,i,c){return this.style.setLayerZoomRange(x,i,c),this._update(!0)}setFilter(x,i,c={}){return this.style.setFilter(x,i,c),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,i,c,g={}){return this.style.setPaintProperty(x,i,c,g),this._update(!0)}getPaintProperty(x,i){return this.style.getPaintProperty(x,i)}setLayoutProperty(x,i,c,g={}){return this.style.setLayoutProperty(x,i,c,g),this._update(!0)}getLayoutProperty(x,i){return this.style.getLayoutProperty(x,i)}setGlyphs(x,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,i,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,i,c,g=>{g||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,i,c=>{c||this._update(!0)}),this}setLight(x,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(x,i={}){return this._lazyInitEmptyStyle(),this.style.setSky(x,i),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,i){return this.style.setFeatureState(x,i),this._update()}removeFeatureState(x,i){return this.style.removeFeatureState(x,i),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,i=0;return this._container&&(x=this._container.clientWidth||400,i=this._container.clientHeight||300),[x,i]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const i=this._canvasContainer=F.create("div","maplibregl-canvas-container",x);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=F.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const c=this._containerDimensions(),g=this._getClampedPixelRatio(c[0],c[1]);this._resizeCanvas(c[0],c[1],g);const _=this._controlContainer=F.create("div","maplibregl-control-container",x),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{S[C]=F.create("div",`maplibregl-ctrl-${C} `,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,i,c){this._canvas.width=Math.floor(c*x),this._canvas.height=Math.floor(c*i),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let i=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{i={requestedAttributes:x},g&&(i.statusMessage=g.statusMessage,i.type=g.type)},{once:!0});let c=null;if(c=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!c){const g="Failed to initialize WebGL";throw i?(i.message=g,new Error(JSON.stringify(i))):new Error(g)}this.painter=new vc(c,this.transform),K.testSupport(c)}migrateProjection(x,i){super.migrateProjection(x,i),this.painter.transform=x,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var i,c,g,_,S;const C=this._idleTriggered?this._fadeDuration:0,O=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let R=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const q=this.transform.zoom,H=j.now();this.style.zoomHistory.update(q,H);const W=new a.C(q,{now:H,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=W.crossFadingFactor();Y===1&&Y===this._crossFadingFactor||(R=!0,this._crossFadingFactor=Y),this.style.update(W)}const B=((c=this.style.projection)===null||c===void 0?void 0:c.transitionState)>0!==O;(g=this.style.projection)===null||g===void 0||g.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((_=this.style.projection)===null||_===void 0?void 0:_.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cl.mark(a.cm.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||R)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const V=this._sourcesDirty||this._styleDirty||this._placementDirty;return V||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||V||(this._fullyLoaded=!0,a.cl.mark(a.cm.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ze.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),F.remove(this._canvasContainer),F.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cl.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frame(this._frameRequest,x=>{a.cl.frame(x),this._frameRequest=null;try{this._render(x)}catch(i){if(!a.cn(i)&&!function(c){return c.message===Th}(i))throw i}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return _n}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},d.MapMouseEvent=xs,d.MapTouchEvent=zn,d.MapWheelEvent=an,d.Marker=zl,d.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const i=this._map.getZoom(),c=i===this._map.getMaxZoom(),g=i===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(i,c)=>{const g=this._map._getUIString(`NavigationControl.${c}`);i.title=g,i.setAttribute("aria-label",g)},this.options=a.e({},oo,x),this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),F.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),F.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=F.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Il(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,i){const c=F.create("button",x,this._container);return c.type="button",c.addEventListener("click",i),c}},d.Popup=class extends a.E{constructor(x){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=F.create("div","maplibregl-popup",this._map.getContainer()),this._tip=F.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=na(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!i)return;const c=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationToScreenPoint(this._lngLat));let g=this.options.anchor;const _=Sn(this.options.offset);if(!g){const C=this._container.offsetWidth,O=this._container.offsetHeight;let R;R=c.y+_.bottom.y<O?["top"]:c.y>this._map.transform.height-O?["bottom"]:[],c.x<C/2?R.push("left"):c.x>this._map.transform.width-C/2&&R.push("right"),g=R.length===0?"bottom":R.join("-")}let S=c.add(_[g]);this.options.subpixelPositioning||(S=S.round()),F.setTransform(this._container,`${ku[g]} translate(${S.x}px,${S.y}px)`),ln(this._container,g,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Pu),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.Q.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const i=document.createDocumentFragment(),c=document.createElement("body");let g;for(c.innerHTML=x;g=c.firstChild,g;)i.appendChild(g);return this.setDOMContent(i)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=F.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(Ss);x&&x.focus()}},d.RasterDEMTileSource=Yc,d.RasterTileSource=Rn,d.ScaleControl=class{constructor(x){this._onMove=()=>{Tc(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Tc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},sd),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=Dl,d.Style=lu,d.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=F.create("button","maplibregl-ctrl-terrain",this._container),F.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){F.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Tu,d.TwoFingersTouchRotateHandler=Ha,d.TwoFingersTouchZoomHandler=Ol,d.TwoFingersTouchZoomRotateHandler=ro,d.VectorTileSource=wa,d.VideoSource=br,d.addSourceType=(x,i)=>a._(void 0,void 0,void 0,function*(){if(Jc(x))throw new Error(`A source type called "${x}" already exists.`);((c,g)=>{Kr[c]=g})(x,i)}),d.clearPrewarmedResources=function(){const x=Rt;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(ot),Rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.createTileMesh=ch,d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return ys().getRTLTextPluginStatus()},d.getVersion=function(){return Ou},d.getWorkerCount=function(){return xt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(x){return Ni().broadcast("IS",x)},d.prewarm=function(){Nt().acquire(ot)},d.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},d.setRTLTextPlugin=function(x,i){return ys().setRTLTextPlugin(x,i)},d.setWorkerCount=function(x){xt.workerCount=x},d.setWorkerUrl=function(x){a.a.WORKER_URL=x}});var f=t;return f})}(n0)),n0.exports}var sC=Iz();const rC=tA(sC),zz=eA({__proto__:null,default:rC},[sC]),t1=Symbol.for("yaml.alias"),px=Symbol.for("yaml.document"),bf=Symbol.for("yaml.map"),oC=Symbol.for("yaml.pair"),Xc=Symbol.for("yaml.scalar"),Lm=Symbol.for("yaml.seq"),hl=Symbol.for("yaml.node.type"),Wd=s=>!!s&&typeof s=="object"&&s[hl]===t1,Kd=s=>!!s&&typeof s=="object"&&s[hl]===px,Bm=s=>!!s&&typeof s=="object"&&s[hl]===bf,Wn=s=>!!s&&typeof s=="object"&&s[hl]===oC,kn=s=>!!s&&typeof s=="object"&&s[hl]===Xc,Nm=s=>!!s&&typeof s=="object"&&s[hl]===Lm;function ss(s){if(s&&typeof s=="object")switch(s[hl]){case bf:case Lm:return!0}return!1}function rs(s){if(s&&typeof s=="object")switch(s[hl]){case t1:case bf:case Xc:case Lm:return!0}return!1}const Lz=s=>(kn(s)||ss(s))&&!!s.anchor,No=Symbol("break visit"),aC=Symbol("skip children"),Gc=Symbol("remove node");function Cf(s,e){const t=lC(e);Kd(s)?am(null,s.contents,t,Object.freeze([s]))===Gc&&(s.contents=null):am(null,s,t,Object.freeze([]))}Cf.BREAK=No;Cf.SKIP=aC;Cf.REMOVE=Gc;function am(s,e,t,n){const o=cC(s,e,t,n);if(rs(o)||Wn(o))return uC(s,n,o),am(s,o,t,n);if(typeof o!="symbol"){if(ss(e)){n=Object.freeze(n.concat(e));for(let f=0;f<e.items.length;++f){const d=am(f,e.items[f],t,n);if(typeof d=="number")f=d-1;else{if(d===No)return No;d===Gc&&(e.items.splice(f,1),f-=1)}}}else if(Wn(e)){n=Object.freeze(n.concat(e));const f=am("key",e.key,t,n);if(f===No)return No;f===Gc&&(e.key=null);const d=am("value",e.value,t,n);if(d===No)return No;d===Gc&&(e.value=null)}}return o}async function ib(s,e){const t=lC(e);Kd(s)?await lm(null,s.contents,t,Object.freeze([s]))===Gc&&(s.contents=null):await lm(null,s,t,Object.freeze([]))}ib.BREAK=No;ib.SKIP=aC;ib.REMOVE=Gc;async function lm(s,e,t,n){const o=await cC(s,e,t,n);if(rs(o)||Wn(o))return uC(s,n,o),lm(s,o,t,n);if(typeof o!="symbol"){if(ss(e)){n=Object.freeze(n.concat(e));for(let f=0;f<e.items.length;++f){const d=await lm(f,e.items[f],t,n);if(typeof d=="number")f=d-1;else{if(d===No)return No;d===Gc&&(e.items.splice(f,1),f-=1)}}}else if(Wn(e)){n=Object.freeze(n.concat(e));const f=await lm("key",e.key,t,n);if(f===No)return No;f===Gc&&(e.key=null);const d=await lm("value",e.value,t,n);if(d===No)return No;d===Gc&&(e.value=null)}}return o}function lC(s){return typeof s=="object"&&(s.Collection||s.Node||s.Value)?Object.assign({Alias:s.Node,Map:s.Node,Scalar:s.Node,Seq:s.Node},s.Value&&{Map:s.Value,Scalar:s.Value,Seq:s.Value},s.Collection&&{Map:s.Collection,Seq:s.Collection},s):s}function cC(s,e,t,n){var o,f,d,a,v;if(typeof t=="function")return t(s,e,n);if(Bm(e))return(o=t.Map)==null?void 0:o.call(t,s,e,n);if(Nm(e))return(f=t.Seq)==null?void 0:f.call(t,s,e,n);if(Wn(e))return(d=t.Pair)==null?void 0:d.call(t,s,e,n);if(kn(e))return(a=t.Scalar)==null?void 0:a.call(t,s,e,n);if(Wd(e))return(v=t.Alias)==null?void 0:v.call(t,s,e,n)}function uC(s,e,t){const n=e[e.length-1];if(ss(n))n.items[s]=t;else if(Wn(n))s==="key"?n.key=t:n.value=t;else if(Kd(n))n.contents=t;else{const o=Wd(n)?"alias":"scalar";throw new Error(`Cannot replace node with ${o} parent`)}}const Bz={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},Nz=s=>s.replace(/[!,[\]{}]/g,e=>Bz[e]);class fo{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},fo.defaultYaml,e),this.tags=Object.assign({},fo.defaultTags,t)}clone(){const e=new fo(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new fo(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:fo.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},fo.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:fo.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},fo.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),o=n.shift();switch(o){case"%TAG":{if(n.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[f,d]=n;return this.tags[f]=d,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[f]=n;if(f==="1.1"||f==="1.2")return this.yaml.version=f,!0;{const d=/^\d+\.\d+$/.test(f);return t(6,`Unsupported YAML version ${f}`,d),!1}}default:return t(0,`Unknown directive ${o}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const d=e.slice(2,-1);return d==="!"||d==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),d)}const[,n,o]=e.match(/^(.*!)([^!]*)$/s);o||t(`The ${e} tag has no suffix`);const f=this.tags[n];if(f)try{return f+decodeURIComponent(o)}catch(d){return t(String(d)),null}return n==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+Nz(e.substring(n.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let o;if(e&&n.length>0&&rs(e.contents)){const f={};Cf(e.contents,(d,a)=>{rs(a)&&a.tag&&(f[a.tag]=!0)}),o=Object.keys(f)}else o=[];for(const[f,d]of n)f==="!!"&&d==="tag:yaml.org,2002:"||(!e||o.some(a=>a.startsWith(d)))&&t.push(`%TAG ${f} ${d}`);return t.join(`
`)}}fo.defaultYaml={explicit:!1,version:"1.2"};fo.defaultTags={"!!":"tag:yaml.org,2002:"};function hC(s){if(/[\x00-\x19\s,[\]{}]/.test(s)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(s)}`;throw new Error(t)}return!0}function fC(s){const e=new Set;return Cf(s,{Value(t,n){n.anchor&&e.add(n.anchor)}}),e}function dC(s,e){for(let t=1;;++t){const n=`${s}${t}`;if(!e.has(n))return n}}function Fz(s,e){const t=[],n=new Map;let o=null;return{onAnchor:f=>{t.push(f),o||(o=fC(s));const d=dC(e,o);return o.add(d),d},setAnchors:()=>{for(const f of t){const d=n.get(f);if(typeof d=="object"&&d.anchor&&(kn(d.node)||ss(d.node)))d.node.anchor=d.anchor;else{const a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=f,a}}},sourceObjects:n}}function cm(s,e,t,n){if(n&&typeof n=="object")if(Array.isArray(n))for(let o=0,f=n.length;o<f;++o){const d=n[o],a=cm(s,n,String(o),d);a===void 0?delete n[o]:a!==d&&(n[o]=a)}else if(n instanceof Map)for(const o of Array.from(n.keys())){const f=n.get(o),d=cm(s,n,o,f);d===void 0?n.delete(o):d!==f&&n.set(o,d)}else if(n instanceof Set)for(const o of Array.from(n)){const f=cm(s,n,o,o);f===void 0?n.delete(o):f!==o&&(n.delete(o),n.add(f))}else for(const[o,f]of Object.entries(n)){const d=cm(s,n,o,f);d===void 0?delete n[o]:d!==f&&(n[o]=d)}return s.call(e,t,n)}function cl(s,e,t){if(Array.isArray(s))return s.map((n,o)=>cl(n,String(o),t));if(s&&typeof s.toJSON=="function"){if(!t||!Lz(s))return s.toJSON(e,t);const n={aliasCount:0,count:1,res:void 0};t.anchors.set(s,n),t.onCreate=f=>{n.res=f,delete t.onCreate};const o=s.toJSON(e,t);return t.onCreate&&t.onCreate(o),o}return typeof s=="bigint"&&!(t!=null&&t.keep)?Number(s):s}class i1{constructor(e){Object.defineProperty(this,hl,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:n,onAnchor:o,reviver:f}={}){if(!Kd(e))throw new TypeError("A document argument is required");const d={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},a=cl(this,"",d);if(typeof o=="function")for(const{count:v,res:A}of d.anchors.values())o(A,v);return typeof f=="function"?cm(f,{"":a},"",a):a}}class nb extends i1{constructor(e){super(t1),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return Cf(e,{Node:(n,o)=>{if(o===this)return Cf.BREAK;o.anchor===this.source&&(t=o)}}),t}toJSON(e,t){if(!t)return{source:this.source};const{anchors:n,doc:o,maxAliasCount:f}=t,d=this.resolve(o);if(!d){const v=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(v)}let a=n.get(d);if(a||(cl(d,null,t),a=n.get(d)),!a||a.res===void 0){const v="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(v)}if(f>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=s0(o,d,n)),a.count*a.aliasCount>f)){const v="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(v)}return a.res}toString(e,t,n){const o=`*${this.source}`;if(e){if(hC(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const f=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(f)}if(e.implicitKey)return`${o} `}return o}}function s0(s,e,t){if(Wd(e)){const n=e.resolve(s),o=t&&n&&t.get(n);return o?o.count*o.aliasCount:0}else if(ss(e)){let n=0;for(const o of e.items){const f=s0(s,o,t);f>n&&(n=f)}return n}else if(Wn(e)){const n=s0(s,e.key,t),o=s0(s,e.value,t);return Math.max(n,o)}return 1}const pC=s=>!s||typeof s!="function"&&typeof s!="object";class yi extends i1{constructor(e){super(Xc),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:cl(this.value,e,t)}toString(){return String(this.value)}}yi.BLOCK_FOLDED="BLOCK_FOLDED";yi.BLOCK_LITERAL="BLOCK_LITERAL";yi.PLAIN="PLAIN";yi.QUOTE_DOUBLE="QUOTE_DOUBLE";yi.QUOTE_SINGLE="QUOTE_SINGLE";const jz="tag:yaml.org,2002:";function Vz(s,e,t){if(e){const n=t.filter(f=>f.tag===e),o=n.find(f=>!f.format)??n[0];if(!o)throw new Error(`Tag ${e} not found`);return o}return t.find(n=>{var o;return((o=n.identify)==null?void 0:o.call(n,s))&&!n.format})}function by(s,e,t){var L,j,F;if(Kd(s)&&(s=s.contents),rs(s))return s;if(Wn(s)){const K=(j=(L=t.schema[bf]).createNode)==null?void 0:j.call(L,t.schema,null,t);return K.items.push(s),K}(s instanceof String||s instanceof Number||s instanceof Boolean||typeof BigInt<"u"&&s instanceof BigInt)&&(s=s.valueOf());const{aliasDuplicateObjects:n,onAnchor:o,onTagObj:f,schema:d,sourceObjects:a}=t;let v;if(n&&s&&typeof s=="object"){if(v=a.get(s),v)return v.anchor||(v.anchor=o(s)),new nb(v.anchor);v={anchor:null,node:null},a.set(s,v)}e!=null&&e.startsWith("!!")&&(e=jz+e.slice(2));let A=Vz(s,e,d.tags);if(!A){if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),!s||typeof s!="object"){const K=new yi(s);return v&&(v.node=K),K}A=s instanceof Map?d[bf]:Symbol.iterator in Object(s)?d[Lm]:d[bf]}f&&(f(A),delete t.onTagObj);const P=A!=null&&A.createNode?A.createNode(t.schema,s,t):typeof((F=A==null?void 0:A.nodeClass)==null?void 0:F.from)=="function"?A.nodeClass.from(t.schema,s,t):new yi(s);return e?P.tag=e:A.default||(P.tag=A.tag),v&&(v.node=P),P}function B0(s,e,t){let n=t;for(let o=e.length-1;o>=0;--o){const f=e[o];if(typeof f=="number"&&Number.isInteger(f)&&f>=0){const d=[];d[f]=n,n=d}else n=new Map([[f,n]])}return by(n,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:s,sourceObjects:new Map})}const Xg=s=>s==null||typeof s=="object"&&!!s[Symbol.iterator]().next().done;class mC extends i1{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(n=>rs(n)||Wn(n)?n.clone(e):n),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(Xg(e))this.add(t);else{const[n,...o]=e,f=this.get(n,!0);if(ss(f))f.addIn(o,t);else if(f===void 0&&this.schema)this.set(n,B0(this.schema,o,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${o}`)}}deleteIn(e){const[t,...n]=e;if(n.length===0)return this.delete(t);const o=this.get(t,!0);if(ss(o))return o.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(e,t){const[n,...o]=e,f=this.get(n,!0);return o.length===0?!t&&kn(f)?f.value:f:ss(f)?f.getIn(o,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!Wn(t))return!1;const n=t.value;return n==null||e&&kn(n)&&n.value==null&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){const[t,...n]=e;if(n.length===0)return this.has(t);const o=this.get(t,!0);return ss(o)?o.hasIn(n):!1}setIn(e,t){const[n,...o]=e;if(o.length===0)this.set(n,t);else{const f=this.get(n,!0);if(ss(f))f.setIn(o,t);else if(f===void 0&&this.schema)this.set(n,B0(this.schema,o,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${o}`)}}}const Uz=s=>s.replace(/^(?!$)(?: $)?/gm,"#");function Ju(s,e){return/^\n+$/.test(s)?s.substring(1):e?s.replace(/^(?! *$)/gm,e):s}const Nd=(s,e,t)=>s.endsWith(`
`)?Ju(t,e):t.includes(`
`)?`
`+Ju(t,e):(s.endsWith(" ")?"":" ")+t,gC="flow",mx="block",r0="quoted";function sb(s,e,t="flow",{indentAtStart:n,lineWidth:o=80,minContentWidth:f=20,onFold:d,onOverflow:a}={}){if(!o||o<0)return s;o<f&&(f=0);const v=Math.max(1+f,1+o-e.length);if(s.length<=v)return s;const A=[],P={};let L=o-e.length;typeof n=="number"&&(n>o-Math.max(2,f)?A.push(0):L=o-n);let j,F,K=!1,se=-1,le=-1,ve=-1;t===mx&&(se=LS(s,se,e.length),se!==-1&&(L=se+v));for(let je;je=s[se+=1];){if(t===r0&&je==="\\"){switch(le=se,s[se+1]){case"x":se+=3;break;case"u":se+=5;break;case"U":se+=9;break;default:se+=1}ve=se}if(je===`
`)t===mx&&(se=LS(s,se,e.length)),L=se+e.length+v,j=void 0;else{if(je===" "&&F&&F!==" "&&F!==`
`&&F!=="	"){const ze=s[se+1];ze&&ze!==" "&&ze!==`
`&&ze!=="	"&&(j=se)}if(se>=L)if(j)A.push(j),L=j+v,j=void 0;else if(t===r0){for(;F===" "||F==="	";)F=je,je=s[se+=1],K=!0;const ze=se>ve+1?se-2:le-1;if(P[ze])return s;A.push(ze),P[ze]=!0,L=ze+v,j=void 0}else K=!0}F=je}if(K&&a&&a(),A.length===0)return s;d&&d();let Be=s.slice(0,A[0]);for(let je=0;je<A.length;++je){const ze=A[je],ke=A[je+1]||s.length;ze===0?Be=`
${e}${s.slice(0,ke)}`:(t===r0&&P[ze]&&(Be+=`${s[ze]}\\`),Be+=`
${e}${s.slice(ze+1,ke)}`)}return Be}function LS(s,e,t){let n=e,o=e+1,f=s[o];for(;f===" "||f==="	";)if(e<o+t)f=s[++e];else{do f=s[++e];while(f&&f!==`
`);n=e,o=e+1,f=s[o]}return n}const rb=(s,e)=>({indentAtStart:e?s.indent.length:s.indentAtStart,lineWidth:s.options.lineWidth,minContentWidth:s.options.minContentWidth}),ob=s=>/^(%|---|\.\.\.)/m.test(s);function qz(s,e,t){if(!e||e<0)return!1;const n=e-t,o=s.length;if(o<=n)return!1;for(let f=0,d=0;f<o;++f)if(s[f]===`
`){if(f-d>n)return!0;if(d=f+1,o-d<=n)return!1}return!0}function ty(s,e){const t=JSON.stringify(s);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:n}=e,o=e.options.doubleQuotedMinMultiLineLength,f=e.indent||(ob(s)?"  ":"");let d="",a=0;for(let v=0,A=t[v];A;A=t[++v])if(A===" "&&t[v+1]==="\\"&&t[v+2]==="n"&&(d+=t.slice(a,v)+"\\ ",v+=1,a=v,A="\\"),A==="\\")switch(t[v+1]){case"u":{d+=t.slice(a,v);const P=t.substr(v+2,4);switch(P){case"0000":d+="\\0";break;case"0007":d+="\\a";break;case"000b":d+="\\v";break;case"001b":d+="\\e";break;case"0085":d+="\\N";break;case"00a0":d+="\\_";break;case"2028":d+="\\L";break;case"2029":d+="\\P";break;default:P.substr(0,2)==="00"?d+="\\x"+P.substr(2):d+=t.substr(v,6)}v+=5,a=v+1}break;case"n":if(n||t[v+2]==='"'||t.length<o)v+=1;else{for(d+=t.slice(a,v)+`

`;t[v+2]==="\\"&&t[v+3]==="n"&&t[v+4]!=='"';)d+=`
`,v+=2;d+=f,t[v+2]===" "&&(d+="\\"),v+=1,a=v+1}break;default:v+=1}return d=a?d+t.slice(a):t,n?d:sb(d,f,r0,rb(e,!1))}function gx(s,e){if(e.options.singleQuote===!1||e.implicitKey&&s.includes(`
`)||/[ \t]\n|\n[ \t]/.test(s))return ty(s,e);const t=e.indent||(ob(s)?"  ":""),n="'"+s.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?n:sb(n,t,gC,rb(e,!1))}function um(s,e){const{singleQuote:t}=e.options;let n;if(t===!1)n=ty;else{const o=s.includes('"'),f=s.includes("'");o&&!f?n=gx:f&&!o?n=ty:n=t?gx:ty}return n(s,e)}let yx;try{yx=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{yx=/\n+(?!\n|$)/g}function o0({comment:s,type:e,value:t},n,o,f){const{blockQuote:d,commentString:a,lineWidth:v}=n.options;if(!d||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return um(t,n);const A=n.indent||(n.forceBlockIndent||ob(t)?"  ":""),P=d==="literal"?!0:d==="folded"||e===yi.BLOCK_FOLDED?!1:e===yi.BLOCK_LITERAL?!0:!qz(t,v,A.length);if(!t)return P?`|
`:`>
`;let L,j;for(j=t.length;j>0;--j){const ke=t[j-1];if(ke!==`
`&&ke!=="	"&&ke!==" ")break}let F=t.substring(j);const K=F.indexOf(`
`);K===-1?L="-":t===F||K!==F.length-1?(L="+",f&&f()):L="",F&&(t=t.slice(0,-F.length),F[F.length-1]===`
`&&(F=F.slice(0,-1)),F=F.replace(yx,`$&${A}`));let se=!1,le,ve=-1;for(le=0;le<t.length;++le){const ke=t[le];if(ke===" ")se=!0;else if(ke===`
`)ve=le;else break}let Be=t.substring(0,ve<le?ve+1:le);Be&&(t=t.substring(Be.length),Be=Be.replace(/\n+/g,`$&${A}`));let ze=(se?A?"2":"1":"")+L;if(s&&(ze+=" "+a(s.replace(/ ?[\r\n]+/g," ")),o&&o()),!P){const ke=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${A}`);let Se=!1;const Fe=rb(n,!0);d!=="folded"&&e!==yi.BLOCK_FOLDED&&(Fe.onOverflow=()=>{Se=!0});const He=sb(`${Be}${ke}${F}`,A,mx,Fe);if(!Se)return`>${ze}
${A}${He}`}return t=t.replace(/\n+/g,`$&${A}`),`|${ze}
${A}${Be}${t}${F}`}function Hz(s,e,t,n){const{type:o,value:f}=s,{actualString:d,implicitKey:a,indent:v,indentStep:A,inFlow:P}=e;if(a&&f.includes(`
`)||P&&/[[\]{},]/.test(f))return um(f,e);if(!f||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(f))return a||P||!f.includes(`
`)?um(f,e):o0(s,e,t,n);if(!a&&!P&&o!==yi.PLAIN&&f.includes(`
`))return o0(s,e,t,n);if(ob(f)){if(v==="")return e.forceBlockIndent=!0,o0(s,e,t,n);if(a&&v===A)return um(f,e)}const L=f.replace(/\n+/g,`$&
${v}`);if(d){const j=se=>{var le;return se.default&&se.tag!=="tag:yaml.org,2002:str"&&((le=se.test)==null?void 0:le.test(L))},{compat:F,tags:K}=e.doc.schema;if(K.some(j)||F!=null&&F.some(j))return um(f,e)}return a?L:sb(L,v,gC,rb(e,!1))}function Ey(s,e,t,n){const{implicitKey:o,inFlow:f}=e,d=typeof s.value=="string"?s:Object.assign({},s,{value:String(s.value)});let{type:a}=s;a!==yi.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(d.value)&&(a=yi.QUOTE_DOUBLE);const v=P=>{switch(P){case yi.BLOCK_FOLDED:case yi.BLOCK_LITERAL:return o||f?um(d.value,e):o0(d,e,t,n);case yi.QUOTE_DOUBLE:return ty(d.value,e);case yi.QUOTE_SINGLE:return gx(d.value,e);case yi.PLAIN:return Hz(d,e,t,n);default:return null}};let A=v(a);if(A===null){const{defaultKeyType:P,defaultStringType:L}=e.options,j=o&&P||L;if(A=v(j),A===null)throw new Error(`Unsupported default string type ${j}`)}return A}function yC(s,e){const t=Object.assign({blockQuote:!0,commentString:Uz,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},s.schema.toStringOptions,e);let n;switch(t.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:s,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:n,options:t}}function Zz(s,e){var o;if(e.tag){const f=s.filter(d=>d.tag===e.tag);if(f.length>0)return f.find(d=>d.format===e.format)??f[0]}let t,n;if(kn(e)){n=e.value;let f=s.filter(d=>{var a;return(a=d.identify)==null?void 0:a.call(d,n)});if(f.length>1){const d=f.filter(a=>a.test);d.length>0&&(f=d)}t=f.find(d=>d.format===e.format)??f.find(d=>!d.format)}else n=e,t=s.find(f=>f.nodeClass&&n instanceof f.nodeClass);if(!t){const f=((o=n==null?void 0:n.constructor)==null?void 0:o.name)??typeof n;throw new Error(`Tag not resolved for ${f} value`)}return t}function Gz(s,e,{anchors:t,doc:n}){if(!n.directives)return"";const o=[],f=(kn(s)||ss(s))&&s.anchor;f&&hC(f)&&(t.add(f),o.push(`&${f}`));const d=s.tag?s.tag:e.default?null:e.tag;return d&&o.push(n.directives.tagString(d)),o.join(" ")}function Pm(s,e,t,n){var v;if(Wn(s))return s.toString(e,t,n);if(Wd(s)){if(e.doc.directives)return s.toString(e);if((v=e.resolvedAliases)!=null&&v.has(s))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(s):e.resolvedAliases=new Set([s]),s=s.resolve(e.doc)}let o;const f=rs(s)?s:e.doc.createNode(s,{onTagObj:A=>o=A});o||(o=Zz(e.doc.schema.tags,f));const d=Gz(f,o,e);d.length>0&&(e.indentAtStart=(e.indentAtStart??0)+d.length+1);const a=typeof o.stringify=="function"?o.stringify(f,e,t,n):kn(f)?Ey(f,e,t,n):f.toString(e,t,n);return d?kn(f)||a[0]==="{"||a[0]==="["?`${d} ${a}`:`${d}
${e.indent}${a}`:a}function $z({key:s,value:e},t,n,o){const{allNullValues:f,doc:d,indent:a,indentStep:v,options:{commentString:A,indentSeq:P,simpleKeys:L}}=t;let j=rs(s)&&s.comment||null;if(L){if(j)throw new Error("With simple keys, key nodes cannot have comments");if(ss(s)||!rs(s)&&typeof s=="object"){const Fe="With simple keys, collection cannot be used as a key value";throw new Error(Fe)}}let F=!L&&(!s||j&&e==null&&!t.inFlow||ss(s)||(kn(s)?s.type===yi.BLOCK_FOLDED||s.type===yi.BLOCK_LITERAL:typeof s=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!F&&(L||!f),indent:a+v});let K=!1,se=!1,le=Pm(s,t,()=>K=!0,()=>se=!0);if(!F&&!t.inFlow&&le.length>1024){if(L)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");F=!0}if(t.inFlow){if(f||e==null)return K&&n&&n(),le===""?"?":F?`? ${le}`:le}else if(f&&!L||e==null&&F)return le=`? ${le}`,j&&!K?le+=Nd(le,t.indent,A(j)):se&&o&&o(),le;K&&(j=null),F?(j&&(le+=Nd(le,t.indent,A(j))),le=`? ${le}
${a}:`):(le=`${le}:`,j&&(le+=Nd(le,t.indent,A(j))));let ve,Be,je;rs(e)?(ve=!!e.spaceBefore,Be=e.commentBefore,je=e.comment):(ve=!1,Be=null,je=null,e&&typeof e=="object"&&(e=d.createNode(e))),t.implicitKey=!1,!F&&!j&&kn(e)&&(t.indentAtStart=le.length+1),se=!1,!P&&v.length>=2&&!t.inFlow&&!F&&Nm(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let ze=!1;const ke=Pm(e,t,()=>ze=!0,()=>se=!0);let Se=" ";if(j||ve||Be){if(Se=ve?`
`:"",Be){const Fe=A(Be);Se+=`
${Ju(Fe,t.indent)}`}ke===""&&!t.inFlow?Se===`
`&&(Se=`

`):Se+=`
${t.indent}`}else if(!F&&ss(e)){const Fe=ke[0],He=ke.indexOf(`
`),gt=He!==-1,Et=t.inFlow??e.flow??e.items.length===0;if(gt||!Et){let Mt=!1;if(gt&&(Fe==="&"||Fe==="!")){let ht=ke.indexOf(" ");Fe==="&"&&ht!==-1&&ht<He&&ke[ht+1]==="!"&&(ht=ke.indexOf(" ",ht+1)),(ht===-1||He<ht)&&(Mt=!0)}Mt||(Se=`
${t.indent}`)}}else(ke===""||ke[0]===`
`)&&(Se="");return le+=Se+ke,t.inFlow?ze&&n&&n():je&&!ze?le+=Nd(le,t.indent,A(je)):se&&o&&o(),le}function _C(s,e){(s==="debug"||s==="warn")&&console.warn(e)}const V_="<<",th={identify:s=>s===V_||typeof s=="symbol"&&s.description===V_,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new yi(Symbol(V_)),{addToJSMap:bC}),stringify:()=>V_},Xz=(s,e)=>(th.identify(e)||kn(e)&&(!e.type||e.type===yi.PLAIN)&&th.identify(e.value))&&(s==null?void 0:s.doc.schema.tags.some(t=>t.tag===th.tag&&t.default));function bC(s,e,t){if(t=s&&Wd(t)?t.resolve(s.doc):t,Nm(t))for(const n of t.items)ov(s,e,n);else if(Array.isArray(t))for(const n of t)ov(s,e,n);else ov(s,e,t)}function ov(s,e,t){const n=s&&Wd(t)?t.resolve(s.doc):t;if(!Bm(n))throw new Error("Merge sources must be maps or map aliases");const o=n.toJSON(null,s,Map);for(const[f,d]of o)e instanceof Map?e.has(f)||e.set(f,d):e instanceof Set?e.add(f):Object.prototype.hasOwnProperty.call(e,f)||Object.defineProperty(e,f,{value:d,writable:!0,enumerable:!0,configurable:!0});return e}function vC(s,e,{key:t,value:n}){if(rs(t)&&t.addToJSMap)t.addToJSMap(s,e,n);else if(Xz(s,t))bC(s,e,n);else{const o=cl(t,"",s);if(e instanceof Map)e.set(o,cl(n,o,s));else if(e instanceof Set)e.add(o);else{const f=Qz(t,o,s),d=cl(n,f,s);f in e?Object.defineProperty(e,f,{value:d,writable:!0,enumerable:!0,configurable:!0}):e[f]=d}}return e}function Qz(s,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(rs(s)&&(t!=null&&t.doc)){const n=yC(t.doc,{});n.anchors=new Set;for(const f of t.anchors.keys())n.anchors.add(f.anchor);n.inFlow=!0,n.inStringifyKey=!0;const o=s.toString(n);if(!t.mapKeyWarned){let f=JSON.stringify(o);f.length>40&&(f=f.substring(0,36)+'..."'),_C(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${f}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return o}return JSON.stringify(e)}function n1(s,e,t){const n=by(s,void 0,t),o=by(e,void 0,t);return new Xr(n,o)}class Xr{constructor(e,t=null){Object.defineProperty(this,hl,{value:oC}),this.key=e,this.value=t}clone(e){let{key:t,value:n}=this;return rs(t)&&(t=t.clone(e)),rs(n)&&(n=n.clone(e)),new Xr(t,n)}toJSON(e,t){const n=t!=null&&t.mapAsMap?new Map:{};return vC(t,n,this)}toString(e,t,n){return e!=null&&e.doc?$z(this,e,t,n):JSON.stringify(this)}}function xC(s,e,t){return(e.inFlow??s.flow?Kz:Wz)(s,e,t)}function Wz({comment:s,items:e},t,{blockItemPrefix:n,flowChars:o,itemIndent:f,onChompKeep:d,onComment:a}){const{indent:v,options:{commentString:A}}=t,P=Object.assign({},t,{indent:f,type:null});let L=!1;const j=[];for(let K=0;K<e.length;++K){const se=e[K];let le=null;if(rs(se))!L&&se.spaceBefore&&j.push(""),N0(t,j,se.commentBefore,L),se.comment&&(le=se.comment);else if(Wn(se)){const Be=rs(se.key)?se.key:null;Be&&(!L&&Be.spaceBefore&&j.push(""),N0(t,j,Be.commentBefore,L))}L=!1;let ve=Pm(se,P,()=>le=null,()=>L=!0);le&&(ve+=Nd(ve,f,A(le))),L&&le&&(L=!1),j.push(n+ve)}let F;if(j.length===0)F=o.start+o.end;else{F=j[0];for(let K=1;K<j.length;++K){const se=j[K];F+=se?`
${v}${se}`:`
`}}return s?(F+=`
`+Ju(A(s),v),a&&a()):L&&d&&d(),F}function Kz({items:s},e,{flowChars:t,itemIndent:n}){const{indent:o,indentStep:f,flowCollectionPadding:d,options:{commentString:a}}=e;n+=f;const v=Object.assign({},e,{indent:n,inFlow:!0,type:null});let A=!1,P=0;const L=[];for(let K=0;K<s.length;++K){const se=s[K];let le=null;if(rs(se))se.spaceBefore&&L.push(""),N0(e,L,se.commentBefore,!1),se.comment&&(le=se.comment);else if(Wn(se)){const Be=rs(se.key)?se.key:null;Be&&(Be.spaceBefore&&L.push(""),N0(e,L,Be.commentBefore,!1),Be.comment&&(A=!0));const je=rs(se.value)?se.value:null;je?(je.comment&&(le=je.comment),je.commentBefore&&(A=!0)):se.value==null&&(Be!=null&&Be.comment)&&(le=Be.comment)}le&&(A=!0);let ve=Pm(se,v,()=>le=null);K<s.length-1&&(ve+=","),le&&(ve+=Nd(ve,n,a(le))),!A&&(L.length>P||ve.includes(`
`))&&(A=!0),L.push(ve),P=L.length}const{start:j,end:F}=t;if(L.length===0)return j+F;if(!A){const K=L.reduce((se,le)=>se+le.length+2,2);A=e.options.lineWidth>0&&K>e.options.lineWidth}if(A){let K=j;for(const se of L)K+=se?`
${f}${o}${se}`:`
`;return`${K}
${o}${F}`}else return`${j}${d}${L.join(" ")}${d}${F}`}function N0({indent:s,options:{commentString:e}},t,n,o){if(n&&o&&(n=n.replace(/^\n+/,"")),n){const f=Ju(e(n),s);t.push(f.trimStart())}}function Fd(s,e){const t=kn(e)?e.value:e;for(const n of s)if(Wn(n)&&(n.key===e||n.key===t||kn(n.key)&&n.key.value===t))return n}class va extends mC{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(bf,e),this.items=[]}static from(e,t,n){const{keepUndefined:o,replacer:f}=n,d=new this(e),a=(v,A)=>{if(typeof f=="function")A=f.call(t,v,A);else if(Array.isArray(f)&&!f.includes(v))return;(A!==void 0||o)&&d.items.push(n1(v,A,n))};if(t instanceof Map)for(const[v,A]of t)a(v,A);else if(t&&typeof t=="object")for(const v of Object.keys(t))a(v,t[v]);return typeof e.sortMapEntries=="function"&&d.items.sort(e.sortMapEntries),d}add(e,t){var d;let n;Wn(e)?n=e:!e||typeof e!="object"||!("key"in e)?n=new Xr(e,e==null?void 0:e.value):n=new Xr(e.key,e.value);const o=Fd(this.items,n.key),f=(d=this.schema)==null?void 0:d.sortMapEntries;if(o){if(!t)throw new Error(`Key ${n.key} already set`);kn(o.value)&&pC(n.value)?o.value.value=n.value:o.value=n.value}else if(f){const a=this.items.findIndex(v=>f(n,v)<0);a===-1?this.items.push(n):this.items.splice(a,0,n)}else this.items.push(n)}delete(e){const t=Fd(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const n=Fd(this.items,e),o=n==null?void 0:n.value;return(!t&&kn(o)?o.value:o)??void 0}has(e){return!!Fd(this.items,e)}set(e,t){this.add(new Xr(e,t),!0)}toJSON(e,t,n){const o=n?new n:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(o);for(const f of this.items)vC(t,o,f);return o}toString(e,t,n){if(!e)return JSON.stringify(this);for(const o of this.items)if(!Wn(o))throw new Error(`Map items must all be pairs; found ${JSON.stringify(o)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),xC(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:t})}}const Fm={collection:"map",default:!0,nodeClass:va,tag:"tag:yaml.org,2002:map",resolve(s,e){return Bm(s)||e("Expected a mapping for this tag"),s},createNode:(s,e,t)=>va.from(s,e,t)};class Af extends mC{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Lm,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=U_(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const n=U_(e);if(typeof n!="number")return;const o=this.items[n];return!t&&kn(o)?o.value:o}has(e){const t=U_(e);return typeof t=="number"&&t<this.items.length}set(e,t){const n=U_(e);if(typeof n!="number")throw new Error(`Expected a valid index, not ${e}.`);const o=this.items[n];kn(o)&&pC(t)?o.value=t:this.items[n]=t}toJSON(e,t){const n=[];t!=null&&t.onCreate&&t.onCreate(n);let o=0;for(const f of this.items)n.push(cl(f,String(o++),t));return n}toString(e,t,n){return e?xC(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(e,t,n){const{replacer:o}=n,f=new this(e);if(t&&Symbol.iterator in Object(t)){let d=0;for(let a of t){if(typeof o=="function"){const v=t instanceof Set?a:String(d++);a=o.call(t,v,a)}f.items.push(by(a,void 0,n))}}return f}}function U_(s){let e=kn(s)?s.value:s;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const jm={collection:"seq",default:!0,nodeClass:Af,tag:"tag:yaml.org,2002:seq",resolve(s,e){return Nm(s)||e("Expected a sequence for this tag"),s},createNode:(s,e,t)=>Af.from(s,e,t)},ab={identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify(s,e,t,n){return e=Object.assign({actualString:!0},e),Ey(s,e,t,n)}},lb={identify:s=>s==null,createNode:()=>new yi(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new yi(null),stringify:({source:s},e)=>typeof s=="string"&&lb.test.test(s)?s:e.options.nullStr},s1={identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:s=>new yi(s[0]==="t"||s[0]==="T"),stringify({source:s,value:e},t){if(s&&s1.test.test(s)){const n=s[0]==="t"||s[0]==="T";if(e===n)return s}return e?t.options.trueStr:t.options.falseStr}};function nc({format:s,minFractionDigits:e,tag:t,value:n}){if(typeof n=="bigint")return String(n);const o=typeof n=="number"?n:Number(n);if(!isFinite(o))return isNaN(o)?".nan":o<0?"-.inf":".inf";let f=JSON.stringify(n);if(!s&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(f)){let d=f.indexOf(".");d<0&&(d=f.length,f+=".");let a=e-(f.length-d-1);for(;a-- >0;)f+="0"}return f}const wC={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:nc},SC={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():nc(s)}},TC={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(s){const e=new yi(parseFloat(s)),t=s.indexOf(".");return t!==-1&&s[s.length-1]==="0"&&(e.minFractionDigits=s.length-t-1),e},stringify:nc},cb=s=>typeof s=="bigint"||Number.isInteger(s),r1=(s,e,t,{intAsBigInt:n})=>n?BigInt(s):parseInt(s.substring(e),t);function MC(s,e,t){const{value:n}=s;return cb(n)&&n>=0?t+n.toString(e):nc(s)}const CC={identify:s=>cb(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(s,e,t)=>r1(s,2,8,t),stringify:s=>MC(s,8,"0o")},AC={identify:cb,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(s,e,t)=>r1(s,0,10,t),stringify:nc},kC={identify:s=>cb(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(s,e,t)=>r1(s,2,16,t),stringify:s=>MC(s,16,"0x")},Yz=[Fm,jm,ab,lb,s1,CC,AC,kC,wC,SC,TC];function BS(s){return typeof s=="bigint"||Number.isInteger(s)}const q_=({value:s})=>JSON.stringify(s),Jz=[{identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify:q_},{identify:s=>s==null,createNode:()=>new yi(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:q_},{identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:s=>s==="true",stringify:q_},{identify:BS,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(s,e,{intAsBigInt:t})=>t?BigInt(s):parseInt(s,10),stringify:({value:s})=>BS(s)?s.toString():JSON.stringify(s)},{identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:s=>parseFloat(s),stringify:q_}],eL={default:!0,tag:"",test:/^/,resolve(s,e){return e(`Unresolved plain scalar ${JSON.stringify(s)}`),s}},tL=[Fm,jm].concat(Jz,eL),o1={identify:s=>s instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(s,e){if(typeof atob=="function"){const t=atob(s.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),s},stringify({comment:s,type:e,value:t},n,o,f){if(!t)return"";const d=t;let a;if(typeof btoa=="function"){let v="";for(let A=0;A<d.length;++A)v+=String.fromCharCode(d[A]);a=btoa(v)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e||(e=yi.BLOCK_LITERAL),e!==yi.QUOTE_DOUBLE){const v=Math.max(n.options.lineWidth-n.indent.length,n.options.minContentWidth),A=Math.ceil(a.length/v),P=new Array(A);for(let L=0,j=0;L<A;++L,j+=v)P[L]=a.substr(j,v);a=P.join(e===yi.BLOCK_LITERAL?`
`:" ")}return Ey({comment:s,type:e,value:a},n,o,f)}};function EC(s,e){if(Nm(s))for(let t=0;t<s.items.length;++t){let n=s.items[t];if(!Wn(n)){if(Bm(n)){n.items.length>1&&e("Each pair must have its own sequence indicator");const o=n.items[0]||new Xr(new yi(null));if(n.commentBefore&&(o.key.commentBefore=o.key.commentBefore?`${n.commentBefore}
${o.key.commentBefore}`:n.commentBefore),n.comment){const f=o.value??o.key;f.comment=f.comment?`${n.comment}
${f.comment}`:n.comment}n=o}s.items[t]=Wn(n)?n:new Xr(n)}}else e("Expected a sequence for this tag");return s}function PC(s,e,t){const{replacer:n}=t,o=new Af(s);o.tag="tag:yaml.org,2002:pairs";let f=0;if(e&&Symbol.iterator in Object(e))for(let d of e){typeof n=="function"&&(d=n.call(e,String(f++),d));let a,v;if(Array.isArray(d))if(d.length===2)a=d[0],v=d[1];else throw new TypeError(`Expected [key, value] tuple: ${d}`);else if(d&&d instanceof Object){const A=Object.keys(d);if(A.length===1)a=A[0],v=d[a];else throw new TypeError(`Expected tuple with one key, not ${A.length} keys`)}else a=d;o.items.push(n1(a,v,t))}return o}const a1={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:EC,createNode:PC};class _m extends Af{constructor(){super(),this.add=va.prototype.add.bind(this),this.delete=va.prototype.delete.bind(this),this.get=va.prototype.get.bind(this),this.has=va.prototype.has.bind(this),this.set=va.prototype.set.bind(this),this.tag=_m.tag}toJSON(e,t){if(!t)return super.toJSON(e);const n=new Map;t!=null&&t.onCreate&&t.onCreate(n);for(const o of this.items){let f,d;if(Wn(o)?(f=cl(o.key,"",t),d=cl(o.value,f,t)):f=cl(o,"",t),n.has(f))throw new Error("Ordered maps must not include duplicate keys");n.set(f,d)}return n}static from(e,t,n){const o=PC(e,t,n),f=new this;return f.items=o.items,f}}_m.tag="tag:yaml.org,2002:omap";const l1={collection:"seq",identify:s=>s instanceof Map,nodeClass:_m,default:!1,tag:"tag:yaml.org,2002:omap",resolve(s,e){const t=EC(s,e),n=[];for(const{key:o}of t.items)kn(o)&&(n.includes(o.value)?e(`Ordered maps must not include duplicate keys: ${o.value}`):n.push(o.value));return Object.assign(new _m,t)},createNode:(s,e,t)=>_m.from(s,e,t)};function OC({value:s,source:e},t){return e&&(s?DC:RC).test.test(e)?e:s?t.options.trueStr:t.options.falseStr}const DC={identify:s=>s===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new yi(!0),stringify:OC},RC={identify:s=>s===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new yi(!1),stringify:OC},iL={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:nc},nL={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s.replace(/_/g,"")),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():nc(s)}},sL={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(s){const e=new yi(parseFloat(s.replace(/_/g,""))),t=s.indexOf(".");if(t!==-1){const n=s.substring(t+1).replace(/_/g,"");n[n.length-1]==="0"&&(e.minFractionDigits=n.length)}return e},stringify:nc},Py=s=>typeof s=="bigint"||Number.isInteger(s);function ub(s,e,t,{intAsBigInt:n}){const o=s[0];if((o==="-"||o==="+")&&(e+=1),s=s.substring(e).replace(/_/g,""),n){switch(t){case 2:s=`0b${s}`;break;case 8:s=`0o${s}`;break;case 16:s=`0x${s}`;break}const d=BigInt(s);return o==="-"?BigInt(-1)*d:d}const f=parseInt(s,t);return o==="-"?-1*f:f}function c1(s,e,t){const{value:n}=s;if(Py(n)){const o=n.toString(e);return n<0?"-"+t+o.substr(1):t+o}return nc(s)}const rL={identify:Py,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(s,e,t)=>ub(s,2,2,t),stringify:s=>c1(s,2,"0b")},oL={identify:Py,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(s,e,t)=>ub(s,1,8,t),stringify:s=>c1(s,8,"0")},aL={identify:Py,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(s,e,t)=>ub(s,0,10,t),stringify:nc},lL={identify:Py,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(s,e,t)=>ub(s,2,16,t),stringify:s=>c1(s,16,"0x")};class bm extends va{constructor(e){super(e),this.tag=bm.tag}add(e){let t;Wn(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new Xr(e.key,null):t=new Xr(e,null),Fd(this.items,t.key)||this.items.push(t)}get(e,t){const n=Fd(this.items,e);return!t&&Wn(n)?kn(n.key)?n.key.value:n.key:n}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const n=Fd(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new Xr(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(e,t,n){const{replacer:o}=n,f=new this(e);if(t&&Symbol.iterator in Object(t))for(let d of t)typeof o=="function"&&(d=o.call(t,d,d)),f.items.push(n1(d,null,n));return f}}bm.tag="tag:yaml.org,2002:set";const u1={collection:"map",identify:s=>s instanceof Set,nodeClass:bm,default:!1,tag:"tag:yaml.org,2002:set",createNode:(s,e,t)=>bm.from(s,e,t),resolve(s,e){if(Bm(s)){if(s.hasAllNullValues(!0))return Object.assign(new bm,s);e("Set items must all have null values")}else e("Expected a mapping for this tag");return s}};function h1(s,e){const t=s[0],n=t==="-"||t==="+"?s.substring(1):s,o=d=>e?BigInt(d):Number(d),f=n.replace(/_/g,"").split(":").reduce((d,a)=>d*o(60)+o(a),o(0));return t==="-"?o(-1)*f:f}function IC(s){let{value:e}=s,t=d=>d;if(typeof e=="bigint")t=d=>BigInt(d);else if(isNaN(e)||!isFinite(e))return nc(s);let n="";e<0&&(n="-",e*=t(-1));const o=t(60),f=[e%o];return e<60?f.unshift(0):(e=(e-f[0])/o,f.unshift(e%o),e>=60&&(e=(e-f[0])/o,f.unshift(e))),n+f.map(d=>String(d).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const zC={identify:s=>typeof s=="bigint"||Number.isInteger(s),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(s,e,{intAsBigInt:t})=>h1(s,t),stringify:IC},LC={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:s=>h1(s,!1),stringify:IC},hb={identify:s=>s instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(s){const e=s.match(hb.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,n,o,f,d,a]=e.map(Number),v=e[7]?Number((e[7]+"00").substr(1,3)):0;let A=Date.UTC(t,n-1,o,f||0,d||0,a||0,v);const P=e[8];if(P&&P!=="Z"){let L=h1(P,!1);Math.abs(L)<30&&(L*=60),A-=6e4*L}return new Date(A)},stringify:({value:s})=>(s==null?void 0:s.toISOString().replace(/(T00:00:00)?\.000Z$/,""))??""},NS=[Fm,jm,ab,lb,DC,RC,rL,oL,aL,lL,iL,nL,sL,o1,th,l1,a1,u1,zC,LC,hb],FS=new Map([["core",Yz],["failsafe",[Fm,jm,ab]],["json",tL],["yaml11",NS],["yaml-1.1",NS]]),jS={binary:o1,bool:s1,float:TC,floatExp:SC,floatNaN:wC,floatTime:LC,int:AC,intHex:kC,intOct:CC,intTime:zC,map:Fm,merge:th,null:lb,omap:l1,pairs:a1,seq:jm,set:u1,timestamp:hb},cL={"tag:yaml.org,2002:binary":o1,"tag:yaml.org,2002:merge":th,"tag:yaml.org,2002:omap":l1,"tag:yaml.org,2002:pairs":a1,"tag:yaml.org,2002:set":u1,"tag:yaml.org,2002:timestamp":hb};function av(s,e,t){const n=FS.get(e);if(n&&!s)return t&&!n.includes(th)?n.concat(th):n.slice();let o=n;if(!o)if(Array.isArray(s))o=[];else{const f=Array.from(FS.keys()).filter(d=>d!=="yaml11").map(d=>JSON.stringify(d)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${f} or define customTags array`)}if(Array.isArray(s))for(const f of s)o=o.concat(f);else typeof s=="function"&&(o=s(o.slice()));return t&&(o=o.concat(th)),o.reduce((f,d)=>{const a=typeof d=="string"?jS[d]:d;if(!a){const v=JSON.stringify(d),A=Object.keys(jS).map(P=>JSON.stringify(P)).join(", ");throw new Error(`Unknown custom tag ${v}; use one of ${A}`)}return f.includes(a)||f.push(a),f},[])}const uL=(s,e)=>s.key<e.key?-1:s.key>e.key?1:0;class fb{constructor({compat:e,customTags:t,merge:n,resolveKnownTags:o,schema:f,sortMapEntries:d,toStringDefaults:a}){this.compat=Array.isArray(e)?av(e,"compat"):e?av(null,e):null,this.name=typeof f=="string"&&f||"core",this.knownTags=o?cL:{},this.tags=av(t,this.name,n),this.toStringOptions=a??null,Object.defineProperty(this,bf,{value:Fm}),Object.defineProperty(this,Xc,{value:ab}),Object.defineProperty(this,Lm,{value:jm}),this.sortMapEntries=typeof d=="function"?d:d===!0?uL:null}clone(){const e=Object.create(fb.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function hL(s,e){var v;const t=[];let n=e.directives===!0;if(e.directives!==!1&&s.directives){const A=s.directives.toString(s);A?(t.push(A),n=!0):s.directives.docStart&&(n=!0)}n&&t.push("---");const o=yC(s,e),{commentString:f}=o.options;if(s.commentBefore){t.length!==1&&t.unshift("");const A=f(s.commentBefore);t.unshift(Ju(A,""))}let d=!1,a=null;if(s.contents){if(rs(s.contents)){if(s.contents.spaceBefore&&n&&t.push(""),s.contents.commentBefore){const L=f(s.contents.commentBefore);t.push(Ju(L,""))}o.forceBlockIndent=!!s.comment,a=s.contents.comment}const A=a?void 0:()=>d=!0;let P=Pm(s.contents,o,()=>a=null,A);a&&(P+=Nd(P,"",f(a))),(P[0]==="|"||P[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${P}`:t.push(P)}else t.push(Pm(s.contents,o));if((v=s.directives)!=null&&v.docEnd)if(s.comment){const A=f(s.comment);A.includes(`
`)?(t.push("..."),t.push(Ju(A,""))):t.push(`... ${A}`)}else t.push("...");else{let A=s.comment;A&&d&&(A=A.replace(/^\n+/,"")),A&&((!d||a)&&t[t.length-1]!==""&&t.push(""),t.push(Ju(f(A),"")))}return t.join(`
`)+`
`}class Vm{constructor(e,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,hl,{value:px});let o=null;typeof t=="function"||Array.isArray(t)?o=t:n===void 0&&t&&(n=t,t=void 0);const f=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=f;let{version:d}=f;n!=null&&n._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(d=this.directives.yaml.version)):this.directives=new fo({version:d}),this.setSchema(d,n),this.contents=e===void 0?null:this.createNode(e,o,n)}clone(){const e=Object.create(Vm.prototype,{[hl]:{value:px}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=rs(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Jp(this.contents)&&this.contents.add(e)}addIn(e,t){Jp(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const n=fC(this);e.anchor=!t||n.has(t)?dC(t||"a",n):t}return new nb(e.anchor)}createNode(e,t,n){let o;if(typeof t=="function")e=t.call({"":e},"",e),o=t;else if(Array.isArray(t)){const le=Be=>typeof Be=="number"||Be instanceof String||Be instanceof Number,ve=t.filter(le).map(String);ve.length>0&&(t=t.concat(ve)),o=t}else n===void 0&&t&&(n=t,t=void 0);const{aliasDuplicateObjects:f,anchorPrefix:d,flow:a,keepUndefined:v,onTagObj:A,tag:P}=n??{},{onAnchor:L,setAnchors:j,sourceObjects:F}=Fz(this,d||"a"),K={aliasDuplicateObjects:f??!0,keepUndefined:v??!1,onAnchor:L,onTagObj:A,replacer:o,schema:this.schema,sourceObjects:F},se=by(e,P,K);return a&&ss(se)&&(se.flow=!0),j(),se}createPair(e,t,n={}){const o=this.createNode(e,null,n),f=this.createNode(t,null,n);return new Xr(o,f)}delete(e){return Jp(this.contents)?this.contents.delete(e):!1}deleteIn(e){return Xg(e)?this.contents==null?!1:(this.contents=null,!0):Jp(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return ss(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return Xg(e)?!t&&kn(this.contents)?this.contents.value:this.contents:ss(this.contents)?this.contents.getIn(e,t):void 0}has(e){return ss(this.contents)?this.contents.has(e):!1}hasIn(e){return Xg(e)?this.contents!==void 0:ss(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=B0(this.schema,[e],t):Jp(this.contents)&&this.contents.set(e,t)}setIn(e,t){Xg(e)?this.contents=t:this.contents==null?this.contents=B0(this.schema,Array.from(e),t):Jp(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let n;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new fo({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new fo({version:e}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{const o=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${o}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(n)this.schema=new fb(Object.assign(n,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:o,onAnchor:f,reviver:d}={}){const a={anchors:new Map,doc:this,keep:!e,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof o=="number"?o:100},v=cl(this.contents,t??"",a);if(typeof f=="function")for(const{count:A,res:P}of a.anchors.values())f(P,A);return typeof d=="function"?cm(d,{"":v},"",v):v}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return hL(this,e)}}function Jp(s){if(ss(s))return!0;throw new Error("Expected a YAML collection as document contents")}class f1 extends Error{constructor(e,t,n,o){super(),this.name=e,this.code=n,this.message=o,this.pos=t}}class jd extends f1{constructor(e,t,n){super("YAMLParseError",e,t,n)}}class BC extends f1{constructor(e,t,n){super("YAMLWarning",e,t,n)}}const F0=(s,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(a=>e.linePos(a));const{line:n,col:o}=t.linePos[0];t.message+=` at line ${n}, column ${o}`;let f=o-1,d=s.substring(e.lineStarts[n-1],e.lineStarts[n]).replace(/[\n\r]+$/,"");if(f>=60&&d.length>80){const a=Math.min(f-39,d.length-79);d="…"+d.substring(a),f-=a-1}if(d.length>80&&(d=d.substring(0,79)+"…"),n>1&&/^ *$/.test(d.substring(0,f))){let a=s.substring(e.lineStarts[n-2],e.lineStarts[n-1]);a.length>80&&(a=a.substring(0,79)+`…
`),d=a+d}if(/[^ ]/.test(d)){let a=1;const v=t.linePos[1];v&&v.line===n&&v.col>o&&(a=Math.max(1,Math.min(v.col-o,80-f)));const A=" ".repeat(f)+"^".repeat(a);t.message+=`:

${d}
${A}
`}};function Om(s,{flow:e,indicator:t,next:n,offset:o,onError:f,parentIndent:d,startOnNewline:a}){let v=!1,A=a,P=a,L="",j="",F=!1,K=!1,se=null,le=null,ve=null,Be=null,je=null,ze=null,ke=null;for(const He of s)switch(K&&(He.type!=="space"&&He.type!=="newline"&&He.type!=="comma"&&f(He.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),K=!1),se&&(A&&He.type!=="comment"&&He.type!=="newline"&&f(se,"TAB_AS_INDENT","Tabs are not allowed as indentation"),se=null),He.type){case"space":!e&&(t!=="doc-start"||(n==null?void 0:n.type)!=="flow-collection")&&He.source.includes("	")&&(se=He),P=!0;break;case"comment":{P||f(He,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const gt=He.source.substring(1)||" ";L?L+=j+gt:L=gt,j="",A=!1;break}case"newline":A?L?L+=He.source:(!ze||t!=="seq-item-ind")&&(v=!0):j+=He.source,A=!0,F=!0,(le||ve)&&(Be=He),P=!0;break;case"anchor":le&&f(He,"MULTIPLE_ANCHORS","A node can have at most one anchor"),He.source.endsWith(":")&&f(He.offset+He.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),le=He,ke===null&&(ke=He.offset),A=!1,P=!1,K=!0;break;case"tag":{ve&&f(He,"MULTIPLE_TAGS","A node can have at most one tag"),ve=He,ke===null&&(ke=He.offset),A=!1,P=!1,K=!0;break}case t:(le||ve)&&f(He,"BAD_PROP_ORDER",`Anchors and tags must be after the ${He.source} indicator`),ze&&f(He,"UNEXPECTED_TOKEN",`Unexpected ${He.source} in ${e??"collection"}`),ze=He,A=t==="seq-item-ind"||t==="explicit-key-ind",P=!1;break;case"comma":if(e){je&&f(He,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),je=He,A=!1,P=!1;break}default:f(He,"UNEXPECTED_TOKEN",`Unexpected ${He.type} token`),A=!1,P=!1}const Se=s[s.length-1],Fe=Se?Se.offset+Se.source.length:o;return K&&n&&n.type!=="space"&&n.type!=="newline"&&n.type!=="comma"&&(n.type!=="scalar"||n.source!=="")&&f(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),se&&(A&&se.indent<=d||(n==null?void 0:n.type)==="block-map"||(n==null?void 0:n.type)==="block-seq")&&f(se,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:je,found:ze,spaceBefore:v,comment:L,hasNewline:F,anchor:le,tag:ve,newlineAfterProp:Be,end:Fe,start:ke??Fe}}function vy(s){if(!s)return null;switch(s.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(s.source.includes(`
`))return!0;if(s.end){for(const e of s.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of s.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(vy(e.key)||vy(e.value))return!0}return!1;default:return!0}}function _x(s,e,t){if((e==null?void 0:e.type)==="flow-collection"){const n=e.end[0];n.indent===s&&(n.source==="]"||n.source==="}")&&vy(e)&&t(n,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function NC(s,e,t){const{uniqueKeys:n}=s.options;if(n===!1)return!1;const o=typeof n=="function"?n:(f,d)=>f===d||kn(f)&&kn(d)&&f.value===d.value;return e.some(f=>o(f.key,t))}const VS="All mapping items must start at the same column";function fL({composeNode:s,composeEmptyNode:e},t,n,o,f){var P;const d=(f==null?void 0:f.nodeClass)??va,a=new d(t.schema);t.atRoot&&(t.atRoot=!1);let v=n.offset,A=null;for(const L of n.items){const{start:j,key:F,sep:K,value:se}=L,le=Om(j,{indicator:"explicit-key-ind",next:F??(K==null?void 0:K[0]),offset:v,onError:o,parentIndent:n.indent,startOnNewline:!0}),ve=!le.found;if(ve){if(F&&(F.type==="block-seq"?o(v,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in F&&F.indent!==n.indent&&o(v,"BAD_INDENT",VS)),!le.anchor&&!le.tag&&!K){A=le.end,le.comment&&(a.comment?a.comment+=`
`+le.comment:a.comment=le.comment);continue}(le.newlineAfterProp||vy(F))&&o(F??j[j.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((P=le.found)==null?void 0:P.indent)!==n.indent&&o(v,"BAD_INDENT",VS);t.atKey=!0;const Be=le.end,je=F?s(t,F,le,o):e(t,Be,j,null,le,o);t.schema.compat&&_x(n.indent,F,o),t.atKey=!1,NC(t,a.items,je)&&o(Be,"DUPLICATE_KEY","Map keys must be unique");const ze=Om(K??[],{indicator:"map-value-ind",next:se,offset:je.range[2],onError:o,parentIndent:n.indent,startOnNewline:!F||F.type==="block-scalar"});if(v=ze.end,ze.found){ve&&((se==null?void 0:se.type)==="block-map"&&!ze.hasNewline&&o(v,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&le.start<ze.found.offset-1024&&o(je.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const ke=se?s(t,se,ze,o):e(t,v,K,null,ze,o);t.schema.compat&&_x(n.indent,se,o),v=ke.range[2];const Se=new Xr(je,ke);t.options.keepSourceTokens&&(Se.srcToken=L),a.items.push(Se)}else{ve&&o(je.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),ze.comment&&(je.comment?je.comment+=`
`+ze.comment:je.comment=ze.comment);const ke=new Xr(je);t.options.keepSourceTokens&&(ke.srcToken=L),a.items.push(ke)}}return A&&A<v&&o(A,"IMPOSSIBLE","Map comment with trailing content"),a.range=[n.offset,v,A??v],a}function dL({composeNode:s,composeEmptyNode:e},t,n,o,f){const d=(f==null?void 0:f.nodeClass)??Af,a=new d(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let v=n.offset,A=null;for(const{start:P,value:L}of n.items){const j=Om(P,{indicator:"seq-item-ind",next:L,offset:v,onError:o,parentIndent:n.indent,startOnNewline:!0});if(!j.found)if(j.anchor||j.tag||L)L&&L.type==="block-seq"?o(j.end,"BAD_INDENT","All sequence items must start at the same column"):o(v,"MISSING_CHAR","Sequence item without - indicator");else{A=j.end,j.comment&&(a.comment=j.comment);continue}const F=L?s(t,L,j,o):e(t,j.end,P,null,j,o);t.schema.compat&&_x(n.indent,L,o),v=F.range[2],a.items.push(F)}return a.range=[n.offset,v,A??v],a}function Oy(s,e,t,n){let o="";if(s){let f=!1,d="";for(const a of s){const{source:v,type:A}=a;switch(A){case"space":f=!0;break;case"comment":{t&&!f&&n(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const P=v.substring(1)||" ";o?o+=d+P:o=P,d="";break}case"newline":o&&(d+=v),f=!0;break;default:n(a,"UNEXPECTED_TOKEN",`Unexpected ${A} at node end`)}e+=v.length}}return{comment:o,offset:e}}const lv="Block collections are not allowed within flow collections",cv=s=>s&&(s.type==="block-map"||s.type==="block-seq");function pL({composeNode:s,composeEmptyNode:e},t,n,o,f){const d=n.start.source==="{",a=d?"flow map":"flow sequence",v=(f==null?void 0:f.nodeClass)??(d?va:Af),A=new v(t.schema);A.flow=!0;const P=t.atRoot;P&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let L=n.offset+n.start.source.length;for(let le=0;le<n.items.length;++le){const ve=n.items[le],{start:Be,key:je,sep:ze,value:ke}=ve,Se=Om(Be,{flow:a,indicator:"explicit-key-ind",next:je??(ze==null?void 0:ze[0]),offset:L,onError:o,parentIndent:n.indent,startOnNewline:!1});if(!Se.found){if(!Se.anchor&&!Se.tag&&!ze&&!ke){le===0&&Se.comma?o(Se.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):le<n.items.length-1&&o(Se.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),Se.comment&&(A.comment?A.comment+=`
`+Se.comment:A.comment=Se.comment),L=Se.end;continue}!d&&t.options.strict&&vy(je)&&o(je,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(le===0)Se.comma&&o(Se.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(Se.comma||o(Se.start,"MISSING_CHAR",`Missing , between ${a} items`),Se.comment){let Fe="";e:for(const He of Be)switch(He.type){case"comma":case"space":break;case"comment":Fe=He.source.substring(1);break e;default:break e}if(Fe){let He=A.items[A.items.length-1];Wn(He)&&(He=He.value??He.key),He.comment?He.comment+=`
`+Fe:He.comment=Fe,Se.comment=Se.comment.substring(Fe.length+1)}}if(!d&&!ze&&!Se.found){const Fe=ke?s(t,ke,Se,o):e(t,Se.end,ze,null,Se,o);A.items.push(Fe),L=Fe.range[2],cv(ke)&&o(Fe.range,"BLOCK_IN_FLOW",lv)}else{t.atKey=!0;const Fe=Se.end,He=je?s(t,je,Se,o):e(t,Fe,Be,null,Se,o);cv(je)&&o(He.range,"BLOCK_IN_FLOW",lv),t.atKey=!1;const gt=Om(ze??[],{flow:a,indicator:"map-value-ind",next:ke,offset:He.range[2],onError:o,parentIndent:n.indent,startOnNewline:!1});if(gt.found){if(!d&&!Se.found&&t.options.strict){if(ze)for(const ht of ze){if(ht===gt.found)break;if(ht.type==="newline"){o(ht,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}Se.start<gt.found.offset-1024&&o(gt.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else ke&&("source"in ke&&ke.source&&ke.source[0]===":"?o(ke,"MISSING_CHAR",`Missing space after : in ${a}`):o(gt.start,"MISSING_CHAR",`Missing , or : between ${a} items`));const Et=ke?s(t,ke,gt,o):gt.found?e(t,gt.end,ze,null,gt,o):null;Et?cv(ke)&&o(Et.range,"BLOCK_IN_FLOW",lv):gt.comment&&(He.comment?He.comment+=`
`+gt.comment:He.comment=gt.comment);const Mt=new Xr(He,Et);if(t.options.keepSourceTokens&&(Mt.srcToken=ve),d){const ht=A;NC(t,ht.items,He)&&o(Fe,"DUPLICATE_KEY","Map keys must be unique"),ht.items.push(Mt)}else{const ht=new va(t.schema);ht.flow=!0,ht.items.push(Mt);const Gt=(Et??He).range;ht.range=[He.range[0],Gt[1],Gt[2]],A.items.push(ht)}L=Et?Et.range[2]:gt.end}}const j=d?"}":"]",[F,...K]=n.end;let se=L;if(F&&F.source===j)se=F.offset+F.source.length;else{const le=a[0].toUpperCase()+a.substring(1),ve=P?`${le} must end with a ${j}`:`${le} in block collection must be sufficiently indented and end with a ${j}`;o(L,P?"MISSING_CHAR":"BAD_INDENT",ve),F&&F.source.length!==1&&K.unshift(F)}if(K.length>0){const le=Oy(K,se,t.options.strict,o);le.comment&&(A.comment?A.comment+=`
`+le.comment:A.comment=le.comment),A.range=[n.offset,se,le.offset]}else A.range=[n.offset,se,se];return A}function uv(s,e,t,n,o,f){const d=t.type==="block-map"?fL(s,e,t,n,f):t.type==="block-seq"?dL(s,e,t,n,f):pL(s,e,t,n,f),a=d.constructor;return o==="!"||o===a.tagName?(d.tag=a.tagName,d):(o&&(d.tag=o),d)}function mL(s,e,t,n,o){var j;const f=n.tag,d=f?e.directives.tagName(f.source,F=>o(f,"TAG_RESOLVE_FAILED",F)):null;if(t.type==="block-seq"){const{anchor:F,newlineAfterProp:K}=n,se=F&&f?F.offset>f.offset?F:f:F??f;se&&(!K||K.offset<se.offset)&&o(se,"MISSING_CHAR","Missing newline after block sequence props")}const a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!f||!d||d==="!"||d===va.tagName&&a==="map"||d===Af.tagName&&a==="seq")return uv(s,e,t,o,d);let v=e.schema.tags.find(F=>F.tag===d&&F.collection===a);if(!v){const F=e.schema.knownTags[d];if(F&&F.collection===a)e.schema.tags.push(Object.assign({},F,{default:!1})),v=F;else return F?o(f,"BAD_COLLECTION_TYPE",`${F.tag} used for ${a} collection, but expects ${F.collection??"scalar"}`,!0):o(f,"TAG_RESOLVE_FAILED",`Unresolved tag: ${d}`,!0),uv(s,e,t,o,d)}const A=uv(s,e,t,o,d,v),P=((j=v.resolve)==null?void 0:j.call(v,A,F=>o(f,"TAG_RESOLVE_FAILED",F),e.options))??A,L=rs(P)?P:new yi(P);return L.range=A.range,L.tag=d,v!=null&&v.format&&(L.format=v.format),L}function FC(s,e,t){const n=e.offset,o=gL(e,s.options.strict,t);if(!o)return{value:"",type:null,comment:"",range:[n,n,n]};const f=o.mode===">"?yi.BLOCK_FOLDED:yi.BLOCK_LITERAL,d=e.source?yL(e.source):[];let a=d.length;for(let se=d.length-1;se>=0;--se){const le=d[se][1];if(le===""||le==="\r")a=se;else break}if(a===0){const se=o.chomp==="+"&&d.length>0?`
`.repeat(Math.max(1,d.length-1)):"";let le=n+o.length;return e.source&&(le+=e.source.length),{value:se,type:f,comment:o.comment,range:[n,le,le]}}let v=e.indent+o.indent,A=e.offset+o.length,P=0;for(let se=0;se<a;++se){const[le,ve]=d[se];if(ve===""||ve==="\r")o.indent===0&&le.length>v&&(v=le.length);else{le.length<v&&t(A+le.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),o.indent===0&&(v=le.length),P=se,v===0&&!s.atRoot&&t(A,"BAD_INDENT","Block scalar values in collections must be indented");break}A+=le.length+ve.length+1}for(let se=d.length-1;se>=a;--se)d[se][0].length>v&&(a=se+1);let L="",j="",F=!1;for(let se=0;se<P;++se)L+=d[se][0].slice(v)+`
`;for(let se=P;se<a;++se){let[le,ve]=d[se];A+=le.length+ve.length+1;const Be=ve[ve.length-1]==="\r";if(Be&&(ve=ve.slice(0,-1)),ve&&le.length<v){const ze=`Block scalar lines must not be less indented than their ${o.indent?"explicit indentation indicator":"first line"}`;t(A-ve.length-(Be?2:1),"BAD_INDENT",ze),le=""}f===yi.BLOCK_LITERAL?(L+=j+le.slice(v)+ve,j=`
`):le.length>v||ve[0]==="	"?(j===" "?j=`
`:!F&&j===`
`&&(j=`

`),L+=j+le.slice(v)+ve,j=`
`,F=!0):ve===""?j===`
`?L+=`
`:j=`
`:(L+=j+ve,j=" ",F=!1)}switch(o.chomp){case"-":break;case"+":for(let se=a;se<d.length;++se)L+=`
`+d[se][0].slice(v);L[L.length-1]!==`
`&&(L+=`
`);break;default:L+=`
`}const K=n+o.length+e.source.length;return{value:L,type:f,comment:o.comment,range:[n,K,K]}}function gL({offset:s,props:e},t,n){if(e[0].type!=="block-scalar-header")return n(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:o}=e[0],f=o[0];let d=0,a="",v=-1;for(let j=1;j<o.length;++j){const F=o[j];if(!a&&(F==="-"||F==="+"))a=F;else{const K=Number(F);!d&&K?d=K:v===-1&&(v=s+j)}}v!==-1&&n(v,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${o}`);let A=!1,P="",L=o.length;for(let j=1;j<e.length;++j){const F=e[j];switch(F.type){case"space":A=!0;case"newline":L+=F.source.length;break;case"comment":t&&!A&&n(F,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),L+=F.source.length,P=F.source.substring(1);break;case"error":n(F,"UNEXPECTED_TOKEN",F.message),L+=F.source.length;break;default:{const K=`Unexpected token in block scalar header: ${F.type}`;n(F,"UNEXPECTED_TOKEN",K);const se=F.source;se&&typeof se=="string"&&(L+=se.length)}}}return{mode:f,indent:d,chomp:a,comment:P,length:L}}function yL(s){const e=s.split(/\n( *)/),t=e[0],n=t.match(/^( *)/),f=[n!=null&&n[1]?[n[1],t.slice(n[1].length)]:["",t]];for(let d=1;d<e.length;d+=2)f.push([e[d],e[d+1]]);return f}function jC(s,e,t){const{offset:n,type:o,source:f,end:d}=s;let a,v;const A=(j,F,K)=>t(n+j,F,K);switch(o){case"scalar":a=yi.PLAIN,v=_L(f,A);break;case"single-quoted-scalar":a=yi.QUOTE_SINGLE,v=bL(f,A);break;case"double-quoted-scalar":a=yi.QUOTE_DOUBLE,v=vL(f,A);break;default:return t(s,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${o}`),{value:"",type:null,comment:"",range:[n,n+f.length,n+f.length]}}const P=n+f.length,L=Oy(d,P,e,t);return{value:v,type:a,comment:L.comment,range:[n,P,L.offset]}}function _L(s,e){let t="";switch(s[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${s[0]}`;break}case"@":case"`":{t=`reserved character ${s[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),VC(s)}function bL(s,e){return(s[s.length-1]!=="'"||s.length===1)&&e(s.length,"MISSING_CHAR","Missing closing 'quote"),VC(s.slice(1,-1)).replace(/''/g,"'")}function VC(s){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=e.exec(s);if(!n)return s;let o=n[1],f=" ",d=e.lastIndex;for(t.lastIndex=d;n=t.exec(s);)n[1]===""?f===`
`?o+=f:f=`
`:(o+=f+n[1],f=" "),d=t.lastIndex;const a=/[ \t]*(.*)/sy;return a.lastIndex=d,n=a.exec(s),o+f+((n==null?void 0:n[1])??"")}function vL(s,e){let t="";for(let n=1;n<s.length-1;++n){const o=s[n];if(!(o==="\r"&&s[n+1]===`
`))if(o===`
`){const{fold:f,offset:d}=xL(s,n);t+=f,n=d}else if(o==="\\"){let f=s[++n];const d=wL[f];if(d)t+=d;else if(f===`
`)for(f=s[n+1];f===" "||f==="	";)f=s[++n+1];else if(f==="\r"&&s[n+1]===`
`)for(f=s[++n+1];f===" "||f==="	";)f=s[++n+1];else if(f==="x"||f==="u"||f==="U"){const a={x:2,u:4,U:8}[f];t+=SL(s,n+1,a,e),n+=a}else{const a=s.substr(n-1,2);e(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),t+=a}}else if(o===" "||o==="	"){const f=n;let d=s[n+1];for(;d===" "||d==="	";)d=s[++n+1];d!==`
`&&!(d==="\r"&&s[n+2]===`
`)&&(t+=n>f?s.slice(f,n+1):o)}else t+=o}return(s[s.length-1]!=='"'||s.length===1)&&e(s.length,"MISSING_CHAR",'Missing closing "quote'),t}function xL(s,e){let t="",n=s[e+1];for(;(n===" "||n==="	"||n===`
`||n==="\r")&&!(n==="\r"&&s[e+2]!==`
`);)n===`
`&&(t+=`
`),e+=1,n=s[e+1];return t||(t=" "),{fold:t,offset:e}}const wL={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function SL(s,e,t,n){const o=s.substr(e,t),d=o.length===t&&/^[0-9a-fA-F]+$/.test(o)?parseInt(o,16):NaN;if(isNaN(d)){const a=s.substr(e-2,t+2);return n(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(d)}function UC(s,e,t,n){const{value:o,type:f,comment:d,range:a}=e.type==="block-scalar"?FC(s,e,n):jC(e,s.options.strict,n),v=t?s.directives.tagName(t.source,L=>n(t,"TAG_RESOLVE_FAILED",L)):null;let A;s.options.stringKeys&&s.atKey?A=s.schema[Xc]:v?A=TL(s.schema,o,v,t,n):e.type==="scalar"?A=ML(s,o,e,n):A=s.schema[Xc];let P;try{const L=A.resolve(o,j=>n(t??e,"TAG_RESOLVE_FAILED",j),s.options);P=kn(L)?L:new yi(L)}catch(L){const j=L instanceof Error?L.message:String(L);n(t??e,"TAG_RESOLVE_FAILED",j),P=new yi(o)}return P.range=a,P.source=o,f&&(P.type=f),v&&(P.tag=v),A.format&&(P.format=A.format),d&&(P.comment=d),P}function TL(s,e,t,n,o){var a;if(t==="!")return s[Xc];const f=[];for(const v of s.tags)if(!v.collection&&v.tag===t)if(v.default&&v.test)f.push(v);else return v;for(const v of f)if((a=v.test)!=null&&a.test(e))return v;const d=s.knownTags[t];return d&&!d.collection?(s.tags.push(Object.assign({},d,{default:!1,test:void 0})),d):(o(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),s[Xc])}function ML({atKey:s,directives:e,schema:t},n,o,f){const d=t.tags.find(a=>{var v;return(a.default===!0||s&&a.default==="key")&&((v=a.test)==null?void 0:v.test(n))})||t[Xc];if(t.compat){const a=t.compat.find(v=>{var A;return v.default&&((A=v.test)==null?void 0:A.test(n))})??t[Xc];if(d.tag!==a.tag){const v=e.tagString(d.tag),A=e.tagString(a.tag),P=`Value may be parsed as either ${v} or ${A}`;f(o,"TAG_RESOLVE_FAILED",P,!0)}}return d}function CL(s,e,t){if(e){t===null&&(t=e.length);for(let n=t-1;n>=0;--n){let o=e[n];switch(o.type){case"space":case"comment":case"newline":s-=o.source.length;continue}for(o=e[++n];(o==null?void 0:o.type)==="space";)s+=o.source.length,o=e[++n];break}}return s}const AL={composeNode:qC,composeEmptyNode:d1};function qC(s,e,t,n){const o=s.atKey,{spaceBefore:f,comment:d,anchor:a,tag:v}=t;let A,P=!0;switch(e.type){case"alias":A=kL(s,e,n),(a||v)&&n(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":A=UC(s,e,v,n),a&&(A.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":A=mL(AL,s,e,t,n),a&&(A.anchor=a.source.substring(1));break;default:{const L=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;n(e,"UNEXPECTED_TOKEN",L),A=d1(s,e.offset,void 0,null,t,n),P=!1}}return a&&A.anchor===""&&n(a,"BAD_ALIAS","Anchor cannot be an empty string"),o&&s.options.stringKeys&&(!kn(A)||typeof A.value!="string"||A.tag&&A.tag!=="tag:yaml.org,2002:str")&&n(v??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),f&&(A.spaceBefore=!0),d&&(e.type==="scalar"&&e.source===""?A.comment=d:A.commentBefore=d),s.options.keepSourceTokens&&P&&(A.srcToken=e),A}function d1(s,e,t,n,{spaceBefore:o,comment:f,anchor:d,tag:a,end:v},A){const P={type:"scalar",offset:CL(e,t,n),indent:-1,source:""},L=UC(s,P,a,A);return d&&(L.anchor=d.source.substring(1),L.anchor===""&&A(d,"BAD_ALIAS","Anchor cannot be an empty string")),o&&(L.spaceBefore=!0),f&&(L.comment=f,L.range[2]=v),L}function kL({options:s},{offset:e,source:t,end:n},o){const f=new nb(t.substring(1));f.source===""&&o(e,"BAD_ALIAS","Alias cannot be an empty string"),f.source.endsWith(":")&&o(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const d=e+t.length,a=Oy(n,d,s.strict,o);return f.range=[e,d,a.offset],a.comment&&(f.comment=a.comment),f}function EL(s,e,{offset:t,start:n,value:o,end:f},d){const a=Object.assign({_directives:e},s),v=new Vm(void 0,a),A={atKey:!1,atRoot:!0,directives:v.directives,options:v.options,schema:v.schema},P=Om(n,{indicator:"doc-start",next:o??(f==null?void 0:f[0]),offset:t,onError:d,parentIndent:0,startOnNewline:!0});P.found&&(v.directives.docStart=!0,o&&(o.type==="block-map"||o.type==="block-seq")&&!P.hasNewline&&d(P.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),v.contents=o?qC(A,o,P,d):d1(A,P.end,n,null,P,d);const L=v.contents.range[2],j=Oy(f,L,!1,d);return j.comment&&(v.comment=j.comment),v.range=[t,L,j.offset],v}function Ug(s){if(typeof s=="number")return[s,s+1];if(Array.isArray(s))return s.length===2?s:[s[0],s[1]];const{offset:e,source:t}=s;return[e,e+(typeof t=="string"?t.length:1)]}function US(s){var o;let e="",t=!1,n=!1;for(let f=0;f<s.length;++f){const d=s[f];switch(d[0]){case"#":e+=(e===""?"":n?`

`:`
`)+(d.substring(1)||" "),t=!0,n=!1;break;case"%":((o=s[f+1])==null?void 0:o[0])!=="#"&&(f+=1),t=!1;break;default:t||(n=!0),t=!1}}return{comment:e,afterEmptyLine:n}}class p1{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,n,o,f)=>{const d=Ug(t);f?this.warnings.push(new BC(d,n,o)):this.errors.push(new jd(d,n,o))},this.directives=new fo({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:n,afterEmptyLine:o}=US(this.prelude);if(n){const f=e.contents;if(t)e.comment=e.comment?`${e.comment}
${n}`:n;else if(o||e.directives.docStart||!f)e.commentBefore=n;else if(ss(f)&&!f.flow&&f.items.length>0){let d=f.items[0];Wn(d)&&(d=d.key);const a=d.commentBefore;d.commentBefore=a?`${n}
${a}`:n}else{const d=f.commentBefore;f.commentBefore=d?`${n}
${d}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:US(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,n=-1){for(const o of e)yield*this.next(o);yield*this.end(t,n)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,n,o)=>{const f=Ug(e);f[0]+=t,this.onError(f,"BAD_DIRECTIVE",n,o)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=EL(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new jd(Ug(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const n="Unexpected doc-end without preceding document";this.errors.push(new jd(Ug(e),"UNEXPECTED_TOKEN",n));break}this.doc.directives.docEnd=!0;const t=Oy(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const n=this.doc.comment;this.doc.comment=n?`${n}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new jd(Ug(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const n=Object.assign({_directives:this.directives},this.options),o=new Vm(void 0,n);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),o.range=[0,t,t],this.decorate(o,!1),yield o}}}function PL(s,e=!0,t){if(s){const n=(o,f,d)=>{const a=typeof o=="number"?o:Array.isArray(o)?o[0]:o.offset;if(t)t(a,f,d);else throw new jd([a,a+1],f,d)};switch(s.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return jC(s,e,n);case"block-scalar":return FC({options:{strict:e}},s,n)}}return null}function OL(s,e){const{implicitKey:t=!1,indent:n,inFlow:o=!1,offset:f=-1,type:d="PLAIN"}=e,a=Ey({type:d,value:s},{implicitKey:t,indent:n>0?" ".repeat(n):"",inFlow:o,options:{blockQuote:!0,lineWidth:-1}}),v=e.end??[{type:"newline",offset:-1,indent:n,source:`
`}];switch(a[0]){case"|":case">":{const A=a.indexOf(`
`),P=a.substring(0,A),L=a.substring(A+1)+`
`,j=[{type:"block-scalar-header",offset:f,indent:n,source:P}];return HC(j,v)||j.push({type:"newline",offset:-1,indent:n,source:`
`}),{type:"block-scalar",offset:f,indent:n,props:j,source:L}}case'"':return{type:"double-quoted-scalar",offset:f,indent:n,source:a,end:v};case"'":return{type:"single-quoted-scalar",offset:f,indent:n,source:a,end:v};default:return{type:"scalar",offset:f,indent:n,source:a,end:v}}}function DL(s,e,t={}){let{afterKey:n=!1,implicitKey:o=!1,inFlow:f=!1,type:d}=t,a="indent"in s?s.indent:null;if(n&&typeof a=="number"&&(a+=2),!d)switch(s.type){case"single-quoted-scalar":d="QUOTE_SINGLE";break;case"double-quoted-scalar":d="QUOTE_DOUBLE";break;case"block-scalar":{const A=s.props[0];if(A.type!=="block-scalar-header")throw new Error("Invalid block scalar header");d=A.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:d="PLAIN"}const v=Ey({type:d,value:e},{implicitKey:o||a===null,indent:a!==null&&a>0?" ".repeat(a):"",inFlow:f,options:{blockQuote:!0,lineWidth:-1}});switch(v[0]){case"|":case">":RL(s,v);break;case'"':hv(s,v,"double-quoted-scalar");break;case"'":hv(s,v,"single-quoted-scalar");break;default:hv(s,v,"scalar")}}function RL(s,e){const t=e.indexOf(`
`),n=e.substring(0,t),o=e.substring(t+1)+`
`;if(s.type==="block-scalar"){const f=s.props[0];if(f.type!=="block-scalar-header")throw new Error("Invalid block scalar header");f.source=n,s.source=o}else{const{offset:f}=s,d="indent"in s?s.indent:-1,a=[{type:"block-scalar-header",offset:f,indent:d,source:n}];HC(a,"end"in s?s.end:void 0)||a.push({type:"newline",offset:-1,indent:d,source:`
`});for(const v of Object.keys(s))v!=="type"&&v!=="offset"&&delete s[v];Object.assign(s,{type:"block-scalar",indent:d,props:a,source:o})}}function HC(s,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":s.push(t);break;case"newline":return s.push(t),!0}return!1}function hv(s,e,t){switch(s.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":s.type=t,s.source=e;break;case"block-scalar":{const n=s.props.slice(1);let o=e.length;s.props[0].type==="block-scalar-header"&&(o-=s.props[0].source.length);for(const f of n)f.offset+=o;delete s.props,Object.assign(s,{type:t,source:e,end:n});break}case"block-map":case"block-seq":{const o={type:"newline",offset:s.offset+e.length,indent:s.indent,source:`
`};delete s.items,Object.assign(s,{type:t,source:e,end:[o]});break}default:{const n="indent"in s?s.indent:-1,o="end"in s&&Array.isArray(s.end)?s.end.filter(f=>f.type==="space"||f.type==="comment"||f.type==="newline"):[];for(const f of Object.keys(s))f!=="type"&&f!=="offset"&&delete s[f];Object.assign(s,{type:t,indent:n,source:e,end:o})}}}const IL=s=>"type"in s?j0(s):a0(s);function j0(s){switch(s.type){case"block-scalar":{let e="";for(const t of s.props)e+=j0(t);return e+s.source}case"block-map":case"block-seq":{let e="";for(const t of s.items)e+=a0(t);return e}case"flow-collection":{let e=s.start.source;for(const t of s.items)e+=a0(t);for(const t of s.end)e+=t.source;return e}case"document":{let e=a0(s);if(s.end)for(const t of s.end)e+=t.source;return e}default:{let e=s.source;if("end"in s&&s.end)for(const t of s.end)e+=t.source;return e}}}function a0({start:s,key:e,sep:t,value:n}){let o="";for(const f of s)o+=f.source;if(e&&(o+=j0(e)),t)for(const f of t)o+=f.source;return n&&(o+=j0(n)),o}const bx=Symbol("break visit"),zL=Symbol("skip children"),ZC=Symbol("remove item");function $d(s,e){"type"in s&&s.type==="document"&&(s={start:s.start,value:s.value}),GC(Object.freeze([]),s,e)}$d.BREAK=bx;$d.SKIP=zL;$d.REMOVE=ZC;$d.itemAtPath=(s,e)=>{let t=s;for(const[n,o]of e){const f=t==null?void 0:t[n];if(f&&"items"in f)t=f.items[o];else return}return t};$d.parentCollection=(s,e)=>{const t=$d.itemAtPath(s,e.slice(0,-1)),n=e[e.length-1][0],o=t==null?void 0:t[n];if(o&&"items"in o)return o;throw new Error("Parent collection not found")};function GC(s,e,t){let n=t(e,s);if(typeof n=="symbol")return n;for(const o of["key","value"]){const f=e[o];if(f&&"items"in f){for(let d=0;d<f.items.length;++d){const a=GC(Object.freeze(s.concat([[o,d]])),f.items[d],t);if(typeof a=="number")d=a-1;else{if(a===bx)return bx;a===ZC&&(f.items.splice(d,1),d-=1)}}typeof n=="function"&&o==="key"&&(n=n(e,s))}}return typeof n=="function"?n(e,s):n}const db="\uFEFF",pb="",mb="",xy="",LL=s=>!!s&&"items"in s,BL=s=>!!s&&(s.type==="scalar"||s.type==="single-quoted-scalar"||s.type==="double-quoted-scalar"||s.type==="block-scalar");function NL(s){switch(s){case db:return"<BOM>";case pb:return"<DOC>";case mb:return"<FLOW_END>";case xy:return"<SCALAR>";default:return JSON.stringify(s)}}function $C(s){switch(s){case db:return"byte-order-mark";case pb:return"doc-mode";case mb:return"flow-error-end";case xy:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(s[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const FL=Object.freeze(Object.defineProperty({__proto__:null,BOM:db,DOCUMENT:pb,FLOW_END:mb,SCALAR:xy,createScalarToken:OL,isCollection:LL,isScalar:BL,prettyToken:NL,resolveAsScalar:PL,setScalarValue:DL,stringify:IL,tokenType:$C,visit:$d},Symbol.toStringTag,{value:"Module"}));function Yl(s){switch(s){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const qS=new Set("0123456789ABCDEFabcdef"),jL=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),H_=new Set(",[]{}"),VL=new Set(` ,[]{}
\r	`),fv=s=>!s||VL.has(s);class XC{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let n=this.next??"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;t===" ";)t=this.buffer[++n+e];if(t==="\r"){const o=this.buffer[n+e+1];if(o===`
`||!o&&!this.atEnd)return e+n+1}return t===`
`||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if(t==="-"||t==="."){const n=this.buffer.substr(e,3);if((n==="---"||n==="...")&&Yl(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===db&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,n=e.indexOf("#");for(;n!==-1;){const f=e[n-1];if(f===" "||f==="	"){t=n-1;break}else n=e.indexOf("#",n+1)}for(;;){const f=e[t-1];if(f===" "||f==="	")t-=1;else break}const o=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-o),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield pb,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&Yl(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Yl(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&Yl(t)){const n=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=n,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(fv),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,n=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const o=this.getLine();if(o===null)return this.setNext("flow");if((n!==-1&&n<this.indentNext&&o[0]!=="#"||n===0&&(o.startsWith("---")||o.startsWith("..."))&&Yl(o[3]))&&!(n===this.indentNext-1&&this.flowLevel===1&&(o[0]==="]"||o[0]==="}")))return this.flowLevel=0,yield mb,yield*this.parseLineStart();let f=0;for(;o[f]===",";)f+=yield*this.pushCount(1),f+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(f+=yield*this.pushIndicators(),o[f]){case void 0:return"flow";case"#":return yield*this.pushCount(o.length-f),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(fv),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const d=this.charAt(1);if(this.flowKey||Yl(d)||d===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let f=0;for(;this.buffer[t-1-f]==="\\";)f+=1;if(f%2===0)break;t=this.buffer.indexOf('"',t+1)}const n=this.buffer.substring(0,t);let o=n.indexOf(`
`,this.pos);if(o!==-1){for(;o!==-1;){const f=this.continueScalar(o+1);if(f===-1)break;o=n.indexOf(`
`,f)}o!==-1&&(t=o-(n[o-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>Yl(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,n;e:for(let f=this.pos;n=this.buffer[f];++f)switch(n){case" ":t+=1;break;case`
`:e=f,t=0;break;case"\r":{const d=this.buffer[f+1];if(!d&&!this.atEnd)return this.setNext("block-scalar");if(d===`
`)break}default:break e}if(!n&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const f=this.continueScalar(e+1);if(f===-1)break;e=this.buffer.indexOf(`
`,f)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let o=e+1;for(n=this.buffer[o];n===" ";)n=this.buffer[++o];if(n==="	"){for(;n==="	"||n===" "||n==="\r"||n===`
`;)n=this.buffer[++o];e=o-1}else if(!this.blockScalarKeep)do{let f=e-1,d=this.buffer[f];d==="\r"&&(d=this.buffer[--f]);const a=f;for(;d===" ";)d=this.buffer[--f];if(d===`
`&&f>=this.pos&&f+1+t>a)e=f;else break}while(!0);return yield xy,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,n=this.pos-1,o;for(;o=this.buffer[++n];)if(o===":"){const f=this.buffer[n+1];if(Yl(f)||e&&H_.has(f))break;t=n}else if(Yl(o)){let f=this.buffer[n+1];if(o==="\r"&&(f===`
`?(n+=1,o=`
`,f=this.buffer[n+1]):t=n),f==="#"||e&&H_.has(f))break;if(o===`
`){const d=this.continueScalar(n+1);if(d===-1)break;n=Math.max(n,d-2)}}else{if(e&&H_.has(o))break;t=n}return!o&&!this.atEnd?this.setNext("plain-scalar"):(yield xy,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(fv))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(Yl(t)||e&&H_.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!Yl(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(jL.has(t))t=this.buffer[++e];else if(t==="%"&&qS.has(this.buffer[e+1])&&qS.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,n;do n=this.buffer[++t];while(n===" "||e&&n==="	");const o=t-this.pos;return o>0&&(yield this.buffer.substr(this.pos,o),this.pos=t),o}*pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class QC{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){const f=t+n>>1;this.lineStarts[f]<e?t=f+1:n=f}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const o=this.lineStarts[t-1];return{line:t,col:e-o+1}}}}function uf(s,e){for(let t=0;t<s.length;++t)if(s[t].type===e)return!0;return!1}function HS(s){for(let e=0;e<s.length;++e)switch(s[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function WC(s){switch(s==null?void 0:s.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Z_(s){switch(s.type){case"document":return s.start;case"block-map":{const e=s.items[s.items.length-1];return e.sep??e.start}case"block-seq":return s.items[s.items.length-1].start;default:return[]}}function em(s){var t;if(s.length===0)return[];let e=s.length;e:for(;--e>=0;)switch(s[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=s[++e])==null?void 0:t.type)==="space";);return s.splice(e,s.length)}function ZS(s){if(s.start.type==="flow-seq-start")for(const e of s.items)e.sep&&!e.value&&!uf(e.start,"explicit-key-ind")&&!uf(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,WC(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class m1{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new XC,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const n of this.lexer.lex(e,t))yield*this.next(n);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=$C(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const n=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:n,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const n=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in n?n.indent:0:t.type==="flow-collection"&&n.type==="document"&&(t.indent=0),t.type==="flow-collection"&&ZS(t),n.type){case"document":n.value=t;break;case"block-scalar":n.props.push(t);break;case"block-map":{const o=n.items[n.items.length-1];if(o.value){n.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(o.sep)o.value=t;else{Object.assign(o,{key:t,sep:[]}),this.onKeyLine=!o.explicitKey;return}break}case"block-seq":{const o=n.items[n.items.length-1];o.value?n.items.push({start:[],value:t}):o.value=t;break}case"flow-collection":{const o=n.items[n.items.length-1];!o||o.value?n.items.push({start:[],key:t,sep:[]}):o.sep?o.value=t:Object.assign(o,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((n.type==="document"||n.type==="block-map"||n.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const o=t.items[t.items.length-1];o&&!o.sep&&!o.value&&o.start.length>0&&HS(o.start)===-1&&(t.indent===0||o.start.every(f=>f.type!=="comment"||f.indent<t.indent))&&(n.type==="document"?n.end=o.start:n.items.push({start:o.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{HS(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=Z_(this.peek(2)),n=em(t);let o;e.end?(o=e.end,o.push(this.sourceToken),delete e.end):o=[this.sourceToken];const f={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=f}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var n;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const o="end"in t.value?t.value.end:void 0,f=Array.isArray(o)?o[o.length-1]:void 0;(f==null?void 0:f.type)==="comment"?o==null||o.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const o=e.items[e.items.length-2],f=(n=o==null?void 0:o.value)==null?void 0:n.end;if(Array.isArray(f)){Array.prototype.push.apply(f,t.start),f.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const o=!this.onKeyLine&&this.indent===e.indent,f=o&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let d=[];if(f&&t.sep&&!t.value){const a=[];for(let v=0;v<t.sep.length;++v){const A=t.sep[v];switch(A.type){case"newline":a.push(v);break;case"space":break;case"comment":A.indent>e.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(d=t.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":f||t.value?(d.push(this.sourceToken),e.items.push({start:d}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):f||t.value?(d.push(this.sourceToken),e.items.push({start:d,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(uf(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:d,key:null,sep:[this.sourceToken]}]});else if(WC(t.key)&&!uf(t.sep,"newline")){const a=em(t.start),v=t.key,A=t.sep;A.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:v,sep:A}]})}else d.length>0?t.sep=t.sep.concat(d,this.sourceToken):t.sep.push(this.sourceToken);else if(uf(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const a=em(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||f?e.items.push({start:d,key:null,sep:[this.sourceToken]}):uf(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const a=this.flowScalar(this.type);f||t.value?(e.items.push({start:d,key:a,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(a):(Object.assign(t,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{const a=this.startBlockValue(e);if(a){if(a.type==="block-seq"){if(!t.explicitKey&&t.sep&&!uf(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else o&&e.items.push({start:d});this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var n;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const o="end"in t.value?t.value.end:void 0,f=Array.isArray(o)?o[o.length-1]:void 0;(f==null?void 0:f.type)==="comment"?o==null||o.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const o=e.items[e.items.length-2],f=(n=o==null?void 0:o.value)==null?void 0:n.end;if(Array.isArray(f)){Array.prototype.push.apply(f,t.start),f.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||uf(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const o=this.startBlockValue(e);if(o){this.stack.push(o);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let n;do yield*this.pop(),n=this.peek(1);while(n&&n.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:o,sep:[]}):t.sep?this.stack.push(o):Object.assign(t,{key:o,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{const n=this.peek(2);if(n.type==="block-map"&&(this.type==="map-value-ind"&&n.indent===e.indent||this.type==="newline"&&!n.items[n.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&n.type!=="flow-collection"){const o=Z_(n),f=em(o);ZS(e);const d=e.end.splice(1,e.end.length);d.push(this.sourceToken);const a={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:f,key:e,sep:d}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Z_(e),n=em(t);return n.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Z_(e),n=em(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(n=>n.type==="newline"||n.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function KC(s){const e=s.prettyErrors!==!1;return{lineCounter:s.lineCounter||e&&new QC||null,prettyErrors:e}}function UL(s,e={}){const{lineCounter:t,prettyErrors:n}=KC(e),o=new m1(t==null?void 0:t.addNewLine),f=new p1(e),d=Array.from(f.compose(o.parse(s)));if(n&&t)for(const a of d)a.errors.forEach(F0(s,t)),a.warnings.forEach(F0(s,t));return d.length>0?d:Object.assign([],{empty:!0},f.streamInfo())}function YC(s,e={}){const{lineCounter:t,prettyErrors:n}=KC(e),o=new m1(t==null?void 0:t.addNewLine),f=new p1(e);let d=null;for(const a of f.compose(o.parse(s),!0,s.length))if(!d)d=a;else if(d.options.logLevel!=="silent"){d.errors.push(new jd(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return n&&t&&(d.errors.forEach(F0(s,t)),d.warnings.forEach(F0(s,t))),d}function qL(s,e,t){let n;typeof e=="function"?n=e:t===void 0&&e&&typeof e=="object"&&(t=e);const o=YC(s,t);if(!o)return null;if(o.warnings.forEach(f=>_C(o.options.logLevel,f)),o.errors.length>0){if(o.options.logLevel!=="silent")throw o.errors[0];o.errors=[]}return o.toJS(Object.assign({reviver:n},t))}function HL(s,e,t){let n=null;if(typeof e=="function"||Array.isArray(e)?n=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const o=Math.round(t);t=o<1?void 0:o>8?{indent:8}:{indent:o}}if(s===void 0){const{keepUndefined:o}=t??e??{};if(!o)return}return Kd(s)&&!n?s.toString(t):new Vm(s,n,t).toString(t)}const af=Object.freeze(Object.defineProperty({__proto__:null,Alias:nb,CST:FL,Composer:p1,Document:Vm,Lexer:XC,LineCounter:QC,Pair:Xr,Parser:m1,Scalar:yi,Schema:fb,YAMLError:f1,YAMLMap:va,YAMLParseError:jd,YAMLSeq:Af,YAMLWarning:BC,isAlias:Wd,isCollection:ss,isDocument:Kd,isMap:Bm,isNode:rs,isPair:Wn,isScalar:kn,isSeq:Nm,parse:qL,parseAllDocuments:UL,parseDocument:YC,stringify:HL,visit:Cf,visitAsync:ib},Symbol.toStringTag,{value:"Module"})),ZL=()=>{const[s,e]=Ot.useState(""),[t,n]=Ot.useState(null),[o,f]=Ot.useState(""),[d,a]=Ot.useState([]),[v,A]=Ot.useState("style.yml"),[P,L]=Ot.useState(null),j=Ot.useRef(null);cz({key:"s",ctrlKey:!0,onKeyDown:()=>K()});const F=async()=>{try{const Fe=await(await fetch("/maplibre-style-editor/styles/default.json")).json(),{version:He,name:gt,metadata:Et,sources:Mt,sprite:ht,glyphs:Gt,layers:Ft}=Fe,ei={version:He,name:gt??"Untitled",metadata:Et,sources:Mt,sprite:ht,glyphs:Gt,layers:Ft.map(Nt=>`!!inc/file layers/${Nt.id}.yml`)},Xe=af.stringify(ei),dt=await navigator.storage.getDirectory(),_t=await dt.getFileHandle("style.yml",{create:!0}),qt=await _t.createWritable();await qt.write(Xe),await qt.close(),n(_t),e(Xe);const xe=await dt.getDirectoryHandle("layers",{create:!0});for(const Nt of Ft){const Ei=af.stringify(Nt),ms=await(await xe.getFileHandle(`${Nt.id}.yml`,{create:!0})).createWritable();await ms.write(Ei),await ms.close()}const xt=await(await _t.getFile()).text(),Rt=(af.parse(xt).layers??[]).filter(Nt=>typeof Nt=="string"&&Nt.includes("layers/")).map(Nt=>{const Ei=Nt.match(/layers\/([\w\-.]+\.ya?ml)/);return Ei?Ei[1]:null}).filter(Nt=>!!Nt);a(Rt);const Jt=await je(_t,dt);L(Jt),f("assets/style.json を初期読み込みしました")}catch(Se){console.error("初期 style.json 読み込み失敗",Se),f("初期スタイルの読み込みに失敗しました")}},K=Ot.useCallback(async()=>{if(t){try{const Se=await t.createWritable();await Se.write(s),await Se.close(),f("ファイルを保存しました")}catch(Se){console.error(Se),f("ファイルの保存に失敗しました")}try{const Se=await navigator.storage.getDirectory(),Fe=await Se.getFileHandle("style.yml"),He=await je(Fe,Se);L(He),f("YAMLをJSONに変換しました")}catch(Se){console.error(Se),f("YAMLの変換に失敗しました")}}},[s,t]),se=async Se=>{try{const Fe=await navigator.storage.getDirectory(),He=Se==="style.yml"?await Fe.getFileHandle("style.yml"):await(await Fe.getDirectoryHandle("layers")).getFileHandle(Se),Et=await(await He.getFile()).text();e(Et),n(He),A(Se)}catch(Fe){console.error(Fe),f("ファイルの選択に失敗しました")}},le=async Se=>{var Tt;const Fe=(Tt=Se.target.files)==null?void 0:Tt[0];if(!Fe)return;const He=await Fe.text(),gt=JSON.parse(He),{version:Et,name:Mt,metadata:ht,sources:Gt,sprite:Ft,glyphs:ei,layers:Xe}=gt,dt={version:Et,name:Mt,metadata:ht,sources:Gt,sprite:Ft,glyphs:ei,layers:Xe.map(Rt=>`!!inc/file layers/${Rt.id}.yml`)},_t=af.stringify(dt);e(_t);const qt=await navigator.storage.getDirectory(),xe=await qt.getFileHandle("style.yml",{create:!0}),ot=await xe.createWritable();await ot.write(_t),await ot.close(),n(xe),await ve(Xe,qt);const xt=await je(xe,qt);L(xt),f("style.json を読み込み YAML に変換しました")},ve=async(Se,Fe)=>{const He=await Fe.getDirectoryHandle("layers",{create:!0});for(const Et of Se){const Mt=af.stringify(Et),Gt=await(await He.getFileHandle(`${Et.id}.yml`,{create:!0})).createWritable();await Gt.write(Mt),await Gt.close()}for await(const[Et,Mt]of He.entries())Mt.kind;const gt=await ze(Fe);a(gt)},Be=async()=>{try{const Se=await navigator.storage.getDirectory(),Fe=await Se.getFileHandle("style.yml"),He=await je(Fe,Se),gt=JSON.stringify(He,null,2),Et=new Blob([gt],{type:"application/json"}),Mt=URL.createObjectURL(Et),ht=document.createElement("a");ht.href=Mt,ht.download="style.json",ht.click(),URL.revokeObjectURL(Mt),f("style.json をエクスポートしました")}catch(Se){console.error(Se),f("style.json のエクスポートに失敗しました")}},je=async(Se,Fe)=>{const He=await(await Se.getFile()).text(),gt=af.parse(He),Et=[];for(const Mt of gt.layers)if(typeof Mt=="string"&&Mt.startsWith("!!inc/file")){const ht=Mt.match(/!!inc\/file\s+(.+)/);if(ht){const Ft=ht[1].trim().split("/"),dt=await(await(await(await Fe.getDirectoryHandle(Ft[0])).getFileHandle(Ft[1])).getFile()).text(),_t=af.parse(dt);Array.isArray(_t)?Et.push(..._t):Et.push(_t)}}else typeof Mt=="object"&&Et.push(Mt);return{version:gt.version,name:gt.name??"Untitled",metadata:gt.metadata,sources:gt.sources,sprite:gt.sprite,glyphs:gt.glyphs,layers:Et}},ze=async Se=>{try{const He=await(await(await Se.getFileHandle("style.yml")).getFile()).text(),gt=af.parse(He),Et=[];for(const Mt of gt.layers??[])if(typeof Mt=="string"&&Mt.startsWith("!!inc/file")){const ht=Mt.match(/!!inc\/file\s+layers\/(.+\.yml)/);ht&&Et.push(ht[1])}return Et}catch(Fe){return console.error("レイヤー順の抽出に失敗しました",Fe),[]}},ke={padding:"8px 16px",backgroundColor:"#1976d2",color:"#fff",border:"none",borderRadius:"6px",fontWeight:"bold",fontSize:"14px",cursor:"pointer",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.15)",transition:"background-color 0.3s"};return Ot.useEffect(()=>{F()},[]),wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{style:{display:"flex",height:"85vh",fontFamily:"sans-serif",padding:"12px",gap:"12px",boxSizing:"border-box"},children:[wn.jsx("div",{style:{width:"300px",backgroundColor:"#2b2b2b",color:"white",padding:"10px",borderRadius:"6px",boxShadow:"inset -1px 0 0 rgba(255,255,255,0.1)",overflowY:"auto"},children:wn.jsxs("ul",{children:[wn.jsx("li",{onClick:()=>se("style.yml"),style:{cursor:"pointer",color:v==="style.yml"?"lightblue":"white",fontWeight:"bold"},children:"style.yml"}),wn.jsx("li",{style:{cursor:"pointer",color:v!=="style.yml"?"lightblue":"white",marginLeft:"8px",fontWeight:"bold"},children:"layers"}),wn.jsx("ul",{children:d.map(Se=>wn.jsx("li",{onClick:()=>se(Se),style:{cursor:"pointer",color:v===Se?"lightblue":"white",marginLeft:"16px"},children:Se},Se))})]})}),wn.jsx("div",{style:{width:"560px",backgroundColor:"#1e1e1e",borderRadius:"6px",overflow:"hidden"},children:wn.jsx(GM,{value:s,theme:xI,extensions:[az()],onChange:Se=>e(Se),height:"90vh",width:"600px",style:{borderRadius:"6px"}})}),wn.jsx("div",{style:{flex:1,borderRadius:"6px",overflow:"hidden",boxShadow:"0 0 0 1px #ccc inset"},children:P&&wn.jsx(Tz,{mapLib:rC,initialViewState:{longitude:139.766966,latitude:35.681163,zoom:11},style:{width:"100%",height:"100%"},mapStyle:P,ref:Se=>{if(Se&&!j.current){const Fe=Se.getMap();j.current=Fe,Fe.on("error",He=>{console.error("MapLibre runtime error:",He.error),alert(`地図スタイルの適用中にエラーが発生しました。
詳細は開発者ツールをご確認ください。`)})}}})})]}),wn.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",background:"#f4f4f4",borderTop:"1px solid #ccc",height:"5vh"},children:[wn.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[wn.jsx("button",{style:ke,onMouseOver:Se=>Se.currentTarget.style.backgroundColor="#1565c0",onMouseOut:Se=>Se.currentTarget.style.backgroundColor="#1976d2",onClick:K,disabled:!t,children:"Save (Ctrl + S)"}),wn.jsx("span",{style:{color:"#666",fontSize:"0.9rem"},children:o})]}),wn.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[wn.jsx("input",{type:"file",accept:".json",onChange:le}),wn.jsx("button",{style:ke,onMouseOver:Se=>Se.currentTarget.style.backgroundColor="#1565c0",onMouseOut:Se=>Se.currentTarget.style.backgroundColor="#1976d2",onClick:Be,children:"style.json をエクスポート"})]})]})]})};function GL(){return wn.jsx(wn.Fragment,{children:wn.jsxs("div",{children:[wn.jsx("h1",{style:{padding:"5px"},children:"maplibre-style-editor"}),wn.jsx(ZL,{})]})})}uA.createRoot(document.getElementById("root")).render(wn.jsx(Ot.StrictMode,{children:wn.jsx(GL,{})}));
